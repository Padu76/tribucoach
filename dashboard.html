    // Mostra dettagli lead
    window.viewLeadDetails = function(leadId) {
        const lead = window.dashboardTracker?.data?.quizResults?.find(l => l.id === leadId);
        if (lead) {
            const details = `üéØ PROFILO COMPLETO: ${lead.name}
üì± WhatsApp: ${lead.whatsapp || lead.email || 'N/A'}
üìß Email: ${lead.email || 'N/A'}
üéÇ Et√†: ${lead.age || 'N/A'} anni
üí™ Profilo: ${lead.profile || 'N/A'} (Score: ${lead.score || lead.lead_score || 0})
üíé OBIETTIVI: ${Array.isArray(lead.goals) ? lead.goals.map(g => `\n   ‚Ä¢ ${g}`).join('') : 'N/A'}
‚è∞ ALLENAMENTO = Frequenza: ${lead.training?.style || lead.workout_frequency || 'N/A'} ‚Ä¢ Durata: ${lead.workout_duration || 'N/A'}
üçé ALIMENTAZIONE = Qualit√†: ${lead.diet || 'N/A'} ‚Ä¢ Colazione: ${lead.breakfast_habit || 'N/A'}
üè† Allena a casa: ${lead.eating_out || 'N/A'}
üöß OSTACOLI: ${Array.isArray(lead.obstacles) ? lead.obstacles.map(o => `\n   ‚Ä¢ ${o}`).join('') : 'N/A'}
‚≠ê MOTIVAZIONE: ${lead.obstacles || 'N/A'}
üéØ LIFE BALANCE: ${lead.work_life_balance || 'N/A'}
üèÉ PREFERENZE ‚Ä¢ Sport: ${Array.isArray(lead.preferred_activities) ? lead.preferred_activities.join(', ') : lead.preferred_activities || 'N/A'}
üí° Motivazione: ${lead.motivation_source || 'N/A'}
üìù NOTE: ${lead.notes || 'Nessuna nota aggiuntiva'}`;
            
            // Crea la finestra modale pi√π user-friendly
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed !important;
                top: 0 !important;
                left: 0 !important;
                right: 0 !important;
                bottom: 0 !important;
                background: rgba(0,0,0,0.9) !important;
                z-index: 99999 !important;
                display: flex !important;
                align-items: center !important;
                justify-content: center !important;
                padding: 20px !important;
            `;
            modal.className = 'modal-overlay';
            
            modal.innerHTML = `
                <div style="background: white; border-radius: 15px; padding: 25px; max-width: 600px; width: 100%; max-height: 80vh; overflow-y: auto; box-shadow: 0 10px 30px rgba(0,0,0,0.3);">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; border-bottom: 2px solid #ff6b35; padding-bottom: 15px;">
                        <h2 style="margin: 0; color: #ff6b35; font-size: 22px;">üéØ Dettagli Lead Completi</h2>
                        <button onclick="this.closest('.modal-overlay').remove()" style="background: #ff6b35; color: white; border: none; border-radius: 50%; width: 35px; height: 35px; cursor: pointer; font-size: 18px; font-weight: bold;">√ó</button>
                    </div>
                    <pre style="white-space: pre-wrap; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui; font-size: 14px; line-height: 1.6; color: #333; margin: 0;">${details}</pre>
                    <div style="margin-top: 25px; text-align: center; display: flex; gap: 15px; justify-content: center;">
                        <button onclick="this.closest('.modal-overlay').remove()" style="background: #6c757d; color: white; border: none; padding: 12px 25px; border-radius: 8px; cursor: pointer; font-weight: 500;">Chiudi</button>
                        <button onclick="window.open('https://wa.me/${lead.whatsapp || lead.phone || ''}', '_blank')" style="background: #25d366; color: white; border: none; padding: 12px 25px; border-radius: 8px; cursor: pointer; font-weight: 500; display: ${lead.whatsapp || lead.phone ? 'inline-block' : 'none'};">üì± Contatta WhatsApp</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // Previeni scroll del body quando modal √® aperto
            document.body.style.overflow = 'hidden';
            modal.onclick = (e) => { 
                if (e.target === modal) { 
                    modal.remove(); 
                    document.body.style.overflow = 'auto'; 
                } 
            };
            
            // Chiudi con ESC
            const closeOnEsc = (e) => { 
                if (e.key === 'Escape') { 
                    modal.remove(); 
                    document.body.style.overflow = 'auto'; 
                    document.removeEventListener('keydown', closeOnEsc); 
                } 
            };
            document.addEventListener('keydown', closeOnEsc);
            
            // Tracking azione
            if (window.tribuCoachTracker) {
                window.tribuCoachTracker.trackUserAction('lead_details_viewed', { leadId, name: lead.name });
            }
        } else {
            alert('Lead non trovato');
        }
    };