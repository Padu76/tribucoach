        // 🧠 LEAD INTELLIGENCE - ALGORITMI PREDITTIVI
        function calculateAdvancedLeadScore(lead) {
            let score = lead.lead_score || 0;
            let factors = {
                base: score,
                profile: 0,
                engagement: 0,
                budget: 0,
                timeline: 0,
                contact: 0
            };
            
            // 1. PROFILO MULTIPLIER
            const profileScores = {
                'Champion Pro': 25,
                'Guerriero della Forza': 20,
                'Guerriero': 15,
                'Fitness Enthusiast': 10,
                'Beginner': 5
            };
            factors.profile = profileScores[lead.profile] || 0;
            
            // 2. ENGAGEMENT SCORE
            if (lead.whatsapp && lead.email) factors.engagement = 15;
            else if (lead.whatsapp || lead.email) factors.engagement = 10;
            
            // 3. BUDGET INDICATOR
            const budgetPatterns = {
                'alto': 20, 'premium': 20, 'illimitato': 25,
                'medio': 15, 'standard': 10,
                'basso': 5, 'limitato': 0
            };
            const budgetText = (lead.budget || '').toLowerCase();
            for (const [pattern, points] of Object.entries(budgetPatterns)) {
                if (budgetText.includes(pattern)) {
                    factors.budget = points;
                    break;
                }
            }
            
            // 4. TIMELINE FRESHNESS
            const daysSince = lead.timestamp ? 
                Math.floor((new Date() - lead.timestamp) / (1000 * 60 * 60 * 24)) : 30;
            factors.timeline = Math.max(0, 15 - daysSince);
            
            // 5. CONTACT READINESS
            if (lead.whatsapp && lead.whatsapp !== 'Non fornito') factors.contact = 10;
            
            const totalScore = Math.min(100, factors.base + factors.profile + 
                factors.engagement + factors.budget + factors.timeline + factors.contact);
            
            return { score: totalScore, factors };
        }
        
        function predictConversionProbability(lead) {
            const advanced = calculateAdvancedLeadScore(lead);
            const score = advanced.score;
            
            // Modello predittivo basilare
            let probability = 0;
            if (score >= 90) probability = 85;
            else if (score >= 80) probability = 65;
            else if (score >= 70) probability = 45;
            else if (score >= 60) probability = 25;
            else probability = 10;
            
            // Aggiustamenti basati su pattern
            if (lead.profile === 'Champion Pro') probability += 10;
            if (lead.whatsapp && lead.email) probability += 5;
            if (lead.goals && lead.goals.toLowerCase().includes('rapidi')) probability += 5;
            
            return Math.min(95, probability);
        }
        
        function getLeadPriorityCategory(lead) {
            const advanced = calculateAdvancedLeadScore(lead);
            const conversion = predictConversionProbability(lead);
            
            if (advanced.score >= 85 && conversion >= 70) {
                return { level: 'CRITICAL', color: '#ff1744', icon: '🚨' };
            } else if (advanced.score >= 75 && conversion >= 50) {
                return { level: 'HIGH', color: '#ff6600', icon: '🔥' };
            } else if (advanced.score >= 65 && conversion >= 30) {
                return { level: 'MEDIUM', color: '#ff9800', icon: '⚡' };
            } else if (advanced.score >= 50) {
                return { level: 'LOW', color: '#4CAF50', icon: '🌱' };
            } else {
                return { level: 'COLD', color: '#666', icon: '❄️' };
            }
        }
        
        function generateLeadInsights() {
            const insights = [];
            const criticalLeads = [];
            const emergingPatterns = [];
            let totalValue = 0;
            
            // Analizza tutti i lead
            for (let i = 0; i < allQuizLeads.length; i++) {
                const lead = allQuizLeads[i];
                const advanced = calculateAdvancedLeadScore(lead);
                const conversion = predictConversionProbability(lead);
                const priority = getLeadPriorityCategory(lead);
                
                lead.advancedScore = advanced.score;
                lead.conversionProbability = conversion;
                lead.priorityCategory = priority;
                
                if (priority.level === 'CRITICAL') {
                    criticalLeads.push(lead);
                    totalValue += 1000; // Valore stimato per lead critico
                } else if (priority.level === 'HIGH') {
                    totalValue += 600;
                }
                
                // Pattern detection
                if (lead.profile === 'Champion Pro' && conversion > 70) {
                    emergingPatterns.push('Champion Pro ad alta conversione');
                }
            }
            
            return {
                criticalCount: criticalLeads.length,
                totalPredictedValue: totalValue,
                averageConversion: allQuizLeads.length > 0 ? 
                    Math.round(allQuizLeads.reduce((sum, lead) => 
                        sum + (lead.conversionProbability || 0), 0) / allQuizLeads.length) : 0,
                emergingPatterns: [...new Set(emergingPatterns)],
                recommendations: generateSmartRecommendations(criticalLeads)
            };
        }
        
        function generateSmartRecommendations(criticalLeads) {
            const recommendations = [];
            
            if (criticalLeads.length > 0) {
                recommendations.push({
                    type: 'URGENT',
                    icon: '🚨',
                    title: 'Azione Immediata Richiesta',
                    message: `${criticalLeads.length} lead critici necessitano contatto entro 24h`
                });
            }
            
            const highBudgetLeads = allQuizLeads.filter(lead => 
                (lead.budget || '').toLowerCase().includes('alto') || 
                (lead.budget || '').toLowerCase().includes('premium')
            ).length;
            
            if (highBudgetLeads > 2) {
                recommendations.push({
                    type: 'OPPORTUNITY',
                    icon: '💰',
                    title: 'Opportunità Premium',
                    message: `${highBudgetLeads} lead con budget elevato identificati`
                });
            }
            
            const recentLeads = allQuizLeads.filter(lead => {
                const daysSince = lead.timestamp ? 
                    Math.floor((new Date() - lead.timestamp) / (1000 * 60 * 60 * 24)) : 30;
                return daysSince <= 1;
            }).length;
            
            if (recentLeads > 0) {
                recommendations.push({
                    type: 'TIMING',
                    icon: '⏰',
                    title: 'Strike While Hot',
                    message: `${recentLeads} lead raccolti nelle ultime 24h - contatto ottimale`
                });
            }
            
            return recommendations;
        }
        
        // 🛠️ FUNZIONI UTILITY MIGLIORATE
        function getProfileIcon(profile) {
            const icons = {
                'Champion Pro': '🏆',
                'Guerriero della Forza': '💪',
                'Guerriero': '⚔️',
                'Fitness Enthusiast': '🔥',
                'Beginner': '🌱'
            };
            return icons[profile] || '👤';
        }