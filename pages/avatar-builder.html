<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Avatar Builder - Sistema Personalizzabile</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 2rem;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .avatar-builder {
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 2rem;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 2rem;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .controls-panel {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        .control-group {
            background: rgba(255, 255, 255, 0.1);
            padding: 1.5rem;
            border-radius: 15px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .control-group h3 {
            font-size: 1.2rem;
            margin-bottom: 1rem;
            color: #fff;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .control-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
            gap: 0.5rem;
        }

        .option-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.2);
            color: white;
            padding: 0.75rem 0.5rem;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
            text-align: center;
        }

        .option-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }

        .option-btn.active {
            background: linear-gradient(135deg, #ea580c, #f97316);
            border-color: #ea580c;
            box-shadow: 0 4px 15px rgba(234, 88, 12, 0.4);
        }

        .color-options {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 0.5rem;
        }

        .color-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: 3px solid rgba(255, 255, 255, 0.3);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .color-btn:hover {
            transform: scale(1.1);
            border-color: white;
        }

        .color-btn.active {
            border-color: #ea580c;
            border-width: 4px;
            box-shadow: 0 0 0 2px white;
        }

        .avatar-preview {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 1.5rem;
        }

        .avatar-container {
            background: white;
            border-radius: 20px;
            padding: 2rem;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .avatar-svg {
            width: 300px;
            height: 300px;
            border-radius: 15px;
        }

        .avatar-actions {
            display: flex;
            gap: 1rem;
        }

        .action-btn {
            background: linear-gradient(135deg, #ea580c, #f97316);
            color: white;
            border: none;
            padding: 1rem 1.5rem;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(234, 88, 12, 0.4);
        }

        .action-btn.secondary {
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
        }

        .action-btn.secondary:hover {
            box-shadow: 0 8px 25px rgba(99, 102, 241, 0.4);
        }

        .avatar-info {
            background: rgba(255, 255, 255, 0.1);
            padding: 1rem;
            border-radius: 10px;
            text-align: center;
            margin-top: 1rem;
        }

        .avatar-info h4 {
            margin-bottom: 0.5rem;
            color: #ea580c;
        }

        .mood-indicator {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            background: rgba(255, 255, 255, 0.1);
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.9rem;
        }

        @media (max-width: 768px) {
            .avatar-builder {
                grid-template-columns: 1fr;
                gap: 1rem;
            }
            
            .avatar-svg {
                width: 250px;
                height: 250px;
            }
            
            .control-options {
                grid-template-columns: repeat(auto-fit, minmax(60px, 1fr));
            }
        }

        /* Animazioni */
        .avatar-svg {
            transition: all 0.3s ease;
        }

        .avatar-svg:hover {
            transform: scale(1.02);
        }

        /* Toast notification */
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            padding: 1rem 1.5rem;
            border-radius: 10px;
            font-weight: 600;
            z-index: 1000;
            transform: translateX(100%);
            transition: transform 0.3s ease;
        }

        .toast.show {
            transform: translateX(0);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ðŸŽ¨ Avatar Builder</h1>
            <p>Crea il tuo avatar personalizzato per il percorso coaching</p>
        </div>

        <div class="avatar-builder">
            <div class="controls-panel">
                <!-- Genere -->
                <div class="control-group">
                    <h3>ðŸ‘¤ Genere</h3>
                    <div class="control-options">
                        <button class="option-btn active" data-option="gender" data-value="male">ðŸ‘¨ Uomo</button>
                        <button class="option-btn" data-option="gender" data-value="female">ðŸ‘© Donna</button>
                        <button class="option-btn" data-option="gender" data-value="neutral">ðŸ§‘ Neutro</button>
                    </div>
                </div>

                <!-- Forma Viso -->
                <div class="control-group">
                    <h3>ðŸŽ­ Forma Viso</h3>
                    <div class="control-options">
                        <button class="option-btn active" data-option="faceShape" data-value="oval">Ovale</button>
                        <button class="option-btn" data-option="faceShape" data-value="round">Rotondo</button>
                        <button class="option-btn" data-option="faceShape" data-value="square">Quadrato</button>
                        <button class="option-btn" data-option="faceShape" data-value="heart">Cuore</button>
                    </div>
                </div>

                <!-- Capelli -->
                <div class="control-group">
                    <h3>ðŸ’‡ Stile Capelli</h3>
                    <div class="control-options">
                        <button class="option-btn active" data-option="hairStyle" data-value="short">Corti</button>
                        <button class="option-btn" data-option="hairStyle" data-value="medium">Medi</button>
                        <button class="option-btn" data-option="hairStyle" data-value="long">Lunghi</button>
                        <button class="option-btn" data-option="hairStyle" data-value="curly">Ricci</button>
                        <button class="option-btn" data-option="hairStyle" data-value="bald">Calvo</button>
                    </div>
                </div>

                <!-- Colore Capelli -->
                <div class="control-group">
                    <h3>ðŸŽ¨ Colore Capelli</h3>
                    <div class="color-options">
                        <button class="color-btn active" data-option="hairColor" data-value="#8B4513" style="background: #8B4513"></button>
                        <button class="color-btn" data-option="hairColor" data-value="#2F1B14" style="background: #2F1B14"></button>
                        <button class="color-btn" data-option="hairColor" data-value="#FFD700" style="background: #FFD700"></button>
                        <button class="color-btn" data-option="hairColor" data-value="#DC143C" style="background: #DC143C"></button>
                        <button class="color-btn" data-option="hairColor" data-value="#708090" style="background: #708090"></button>
                        <button class="color-btn" data-option="hairColor" data-value="#800080" style="background: #800080"></button>
                    </div>
                </div>

                <!-- Occhi -->
                <div class="control-group">
                    <h3>ðŸ‘€ Colore Occhi</h3>
                    <div class="color-options">
                        <button class="color-btn active" data-option="eyeColor" data-value="#8B4513" style="background: #8B4513"></button>
                        <button class="color-btn" data-option="eyeColor" data-value="#4169E1" style="background: #4169E1"></button>
                        <button class="color-btn" data-option="eyeColor" data-value="#228B22" style="background: #228B22"></button>
                        <button class="color-btn" data-option="eyeColor" data-value="#708090" style="background: #708090"></button>
                        <button class="color-btn" data-option="eyeColor" data-value="#2F4F4F" style="background: #2F4F4F"></button>
                        <button class="color-btn" data-option="eyeColor" data-value="#800080" style="background: #800080"></button>
                    </div>
                </div>

                <!-- Accessori -->
                <div class="control-group">
                    <h3>ðŸ‘“ Accessori</h3>
                    <div class="control-options">
                        <button class="option-btn active" data-option="glasses" data-value="none">Nessuno</button>
                        <button class="option-btn" data-option="glasses" data-value="regular">Occhiali</button>
                        <button class="option-btn" data-option="glasses" data-value="sunglasses">Da Sole</button>
                        <button class="option-btn" data-option="glasses" data-value="beard">Barba</button>
                    </div>
                </div>

                <!-- Mood -->
                <div class="control-group">
                    <h3>ðŸ˜Š Espressione</h3>
                    <div class="control-options">
                        <button class="option-btn active" data-option="mood" data-value="happy">ðŸ˜Š Felice</button>
                        <button class="option-btn" data-option="mood" data-value="focused">ðŸŽ¯ Concentrato</button>
                        <button class="option-btn" data-option="mood" data-value="calm">ðŸ˜Œ Calmo</button>
                        <button class="option-btn" data-option="mood" data-value="determined">ðŸ’ª Determinato</button>
                    </div>
                </div>
            </div>

            <div class="avatar-preview">
                <div class="avatar-container">
                    <svg class="avatar-svg" viewBox="0 0 200 200" id="avatarSvg">
                        <!-- Background Circle -->
                        <circle cx="100" cy="100" r="95" fill="#f0f9ff" stroke="#e0e7ff" stroke-width="2"/>
                        
                        <!-- Face -->
                        <ellipse id="face" cx="100" cy="110" rx="50" ry="55" fill="#fdbcbc"/>
                        
                        <!-- Hair -->
                        <path id="hair" d="M50 80 Q100 50 150 80 Q150 90 140 100 Q100 70 60 100 Q50 90 50 80" fill="#8B4513"/>
                        
                        <!-- Eyes -->
                        <ellipse id="leftEye" cx="85" cy="100" rx="8" ry="6" fill="white"/>
                        <circle cx="85" cy="100" r="4" fill="#8B4513" id="leftPupil"/>
                        <ellipse id="rightEye" cx="115" cy="100" rx="8" ry="6" fill="white"/>
                        <circle cx="115" cy="100" r="4" fill="#8B4513" id="rightPupil"/>
                        
                        <!-- Nose -->
                        <ellipse cx="100" cy="115" rx="3" ry="2" fill="#f8a5a5"/>
                        
                        <!-- Mouth -->
                        <path id="mouth" d="M90 130 Q100 140 110 130" stroke="#d97706" stroke-width="3" fill="none" stroke-linecap="round"/>
                        
                        <!-- Glasses (hidden by default) -->
                        <g id="glasses" style="display: none;">
                            <circle cx="85" cy="100" r="15" fill="none" stroke="#333" stroke-width="2"/>
                            <circle cx="115" cy="100" r="15" fill="none" stroke="#333" stroke-width="2"/>
                            <line x1="100" y1="100" x2="100" y2="100" stroke="#333" stroke-width="2"/>
                        </g>
                        
                        <!-- Beard (hidden by default) -->
                        <path id="beard" d="M75 135 Q100 150 125 135 Q125 145 100 150 Q75 145 75 135" fill="#8B4513" style="display: none;"/>
                    </svg>
                </div>

                <div class="avatar-info">
                    <h4>Il Tuo Avatar Coaching</h4>
                    <div class="mood-indicator">
                        <span id="moodEmoji">ðŸ˜Š</span>
                        <span id="moodText">Pronto per il cambiamento!</span>
                    </div>
                </div>

                <div class="avatar-actions">
                    <button class="action-btn" onclick="saveAvatar()">
                        ðŸ’¾ Salva Avatar
                    </button>
                    <button class="action-btn secondary" onclick="randomizeAvatar()">
                        ðŸŽ² Randomizza
                    </button>
                    <button class="action-btn secondary" onclick="downloadAvatar()">
                        ðŸ“¥ Download SVG
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast notification -->
    <div class="toast" id="toast"></div>

    <script>
        // Avatar configuration object
        const avatarConfig = {
            gender: 'male',
            faceShape: 'oval',
            hairStyle: 'short',
            hairColor: '#8B4513',
            eyeColor: '#8B4513',
            glasses: 'none',
            mood: 'happy',
            skinTone: '#fdbcbc'
        };

        // Face shapes data
        const faceShapes = {
            oval: { rx: 50, ry: 55 },
            round: { rx: 55, ry: 55 },
            square: { rx: 45, ry: 50 },
            heart: { rx: 50, ry: 52 }
        };

        // Hair styles data
        const hairStyles = {
            short: "M50 80 Q100 50 150 80 Q150 90 140 100 Q100 70 60 100 Q50 90 50 80",
            medium: "M45 75 Q100 45 155 75 Q155 95 145 110 Q100 65 55 110 Q45 95 45 75",
            long: "M40 70 Q100 35 160 70 Q160 100 150 120 Q100 60 50 120 Q40 100 40 70",
            curly: "M50 85 Q70 50 100 70 Q130 50 150 85 Q140 95 130 100 Q110 85 100 90 Q90 85 70 100 Q60 95 50 85",
            bald: "M60 90 Q100 75 140 90"
        };

        // Mood expressions
        const moodExpressions = {
            happy: { 
                mouth: "M90 130 Q100 140 110 130",
                emoji: "ðŸ˜Š",
                text: "Pronto per il cambiamento!"
            },
            focused: { 
                mouth: "M90 135 Q100 135 110 135",
                emoji: "ðŸŽ¯",
                text: "Concentrato sui miei obiettivi!"
            },
            calm: { 
                mouth: "M90 132 Q100 138 110 132",
                emoji: "ðŸ˜Œ",
                text: "In perfetto equilibrio!"
            },
            determined: { 
                mouth: "M88 135 Q100 132 112 135",
                emoji: "ðŸ’ª",
                text: "Determinato a riuscire!"
            }
        };

        // Initialize event listeners
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ðŸŽ¨ Avatar Builder inizializzato');
            
            // Add click listeners to all option buttons
            document.querySelectorAll('.option-btn, .color-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    handleOptionClick(this);
                });
            });
            
            // Initial avatar render
            updateAvatar();
        });

        function handleOptionClick(button) {
            const option = button.dataset.option;
            const value = button.dataset.value;
            
            // Remove active class from siblings
            const siblings = button.parentElement.querySelectorAll('.option-btn, .color-btn');
            siblings.forEach(sibling => sibling.classList.remove('active'));
            
            // Add active class to clicked button
            button.classList.add('active');
            
            // Update avatar config
            avatarConfig[option] = value;
            
            // Update avatar display
            updateAvatar();
            
            console.log('ðŸŽ¨ Avatar aggiornato:', option, '=', value);
        }

        function updateAvatar() {
            const svg = document.getElementById('avatarSvg');
            
            // Update face shape
            const face = document.getElementById('face');
            const shape = faceShapes[avatarConfig.faceShape];
            face.setAttribute('rx', shape.rx);
            face.setAttribute('ry', shape.ry);
            
            // Update hair
            const hair = document.getElementById('hair');
            if (avatarConfig.hairStyle === 'bald') {
                hair.style.display = 'none';
            } else {
                hair.style.display = 'block';
                hair.setAttribute('d', hairStyles[avatarConfig.hairStyle]);
                hair.setAttribute('fill', avatarConfig.hairColor);
            }
            
            // Update eye color
            document.getElementById('leftPupil').setAttribute('fill', avatarConfig.eyeColor);
            document.getElementById('rightPupil').setAttribute('fill', avatarConfig.eyeColor);
            
            // Update glasses/accessories
            const glasses = document.getElementById('glasses');
            const beard = document.getElementById('beard');
            
            // Hide all accessories first
            glasses.style.display = 'none';
            beard.style.display = 'none';
            
            if (avatarConfig.glasses === 'regular' || avatarConfig.glasses === 'sunglasses') {
                glasses.style.display = 'block';
                const lensColor = avatarConfig.glasses === 'sunglasses' ? 'rgba(0,0,0,0.3)' : 'none';
                glasses.querySelectorAll('circle').forEach(circle => {
                    circle.setAttribute('fill', lensColor);
                });
            } else if (avatarConfig.glasses === 'beard') {
                beard.style.display = 'block';
                beard.setAttribute('fill', avatarConfig.hairColor);
            }
            
            // Update mood expression
            const mood = moodExpressions[avatarConfig.mood];
            document.getElementById('mouth').setAttribute('d', mood.mouth);
            document.getElementById('moodEmoji').textContent = mood.emoji;
            document.getElementById('moodText').textContent = mood.text;
            
            // Gender-specific adjustments
            if (avatarConfig.gender === 'female') {
                // Slightly smaller face, longer eyelashes
                face.setAttribute('ry', parseInt(face.getAttribute('ry')) - 2);
            }
        }

        function randomizeAvatar() {
            console.log('ðŸŽ² Randomizzazione avatar...');
            
            // Random selections
            const genders = ['male', 'female', 'neutral'];
            const faceShapeKeys = Object.keys(faceShapes);
            const hairStyleKeys = Object.keys(hairStyles);
            const hairColors = ['#8B4513', '#2F1B14', '#FFD700', '#DC143C', '#708090', '#800080'];
            const eyeColors = ['#8B4513', '#4169E1', '#228B22', '#708090', '#2F4F4F', '#800080'];
            const glassesOptions = ['none', 'regular', 'sunglasses', 'beard'];
            const moodKeys = Object.keys(moodExpressions);
            
            // Apply random values
            avatarConfig.gender = genders[Math.floor(Math.random() * genders.length)];
            avatarConfig.faceShape = faceShapeKeys[Math.floor(Math.random() * faceShapeKeys.length)];
            avatarConfig.hairStyle = hairStyleKeys[Math.floor(Math.random() * hairStyleKeys.length)];
            avatarConfig.hairColor = hairColors[Math.floor(Math.random() * hairColors.length)];
            avatarConfig.eyeColor = eyeColors[Math.floor(Math.random() * eyeColors.length)];
            avatarConfig.glasses = glassesOptions[Math.floor(Math.random() * glassesOptions.length)];
            avatarConfig.mood = moodKeys[Math.floor(Math.random() * moodKeys.length)];
            
            // Update UI to reflect random choices
            updateUIFromConfig();
            
            // Update avatar
            updateAvatar();
            
            showToast('ðŸŽ² Avatar randomizzato!');
        }

        function updateUIFromConfig() {
            // Update all buttons to match current config
            Object.entries(avatarConfig).forEach(([option, value]) => {
                const button = document.querySelector(`[data-option="${option}"][data-value="${value}"]`);
                if (button) {
                    // Remove active from siblings
                    const siblings = button.parentElement.querySelectorAll('.option-btn, .color-btn');
                    siblings.forEach(sibling => sibling.classList.remove('active'));
                    
                    // Add active to correct button
                    button.classList.add('active');
                }
            });
        }

        function saveAvatar() {
            console.log('ðŸ’¾ Salvataggio avatar...', avatarConfig);
            
            // In a real app, this would save to Firebase
            localStorage.setItem('userAvatar', JSON.stringify(avatarConfig));
            
            showToast('ðŸ’¾ Avatar salvato con successo!');
        }

        function downloadAvatar() {
            const svg = document.getElementById('avatarSvg');
            const svgData = new XMLSerializer().serializeToString(svg);
            const svgBlob = new Blob([svgData], {type: 'image/svg+xml;charset=utf-8'});
            const svgUrl = URL.createObjectURL(svgBlob);
            
            const downloadLink = document.createElement('a');
            downloadLink.href = svgUrl;
            downloadLink.download = 'my-coaching-avatar.svg';
            document.body.appendChild(downloadLink);
            downloadLink.click();
            document.body.removeChild(downloadLink);
            
            showToast('ðŸ“¥ Avatar scaricato!');
        }

        function showToast(message) {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.classList.add('show');
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        // Export functions for integration
        window.AvatarBuilder = {
            getConfig: () => avatarConfig,
            setConfig: (config) => {
                Object.assign(avatarConfig, config);
                updateUIFromConfig();
                updateAvatar();
            },
            generateSVG: () => {
                const svg = document.getElementById('avatarSvg');
                return new XMLSerializer().serializeToString(svg);
            }
        };

        console.log('ðŸŽ¨ Avatar Builder System caricato!');
    </script>
</body>
</html>