<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lifestyle Assessment Quiz - 6 Profili</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #f8fafc 0%, #fff7ed 50%, #f0fdf4 100%);
            min-height: 100vh;
            line-height: 1.6;
        }

        .container {
            max-width: 1024px;
            margin: 0 auto;
            padding: 16px;
        }

        .quiz-card {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px -12px rgba(0, 0, 0, 0.25);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #1e293b 0%, #ea580c 100%);
            padding: 32px 20px;
            text-align: center;
            color: white;
        }

        .header h1 {
            font-size: 1.75rem;
            font-weight: bold;
            margin-bottom: 8px;
        }

        .header p {
            font-size: 1rem;
            opacity: 0.9;
        }

        .user-welcome {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 12px;
            margin-top: 16px;
            border-left: 4px solid #fff;
        }

        .user-welcome.hidden {
            display: none;
        }

        .content {
            padding: 20px;
        }

        .progress-section {
            margin-bottom: 24px;
        }

        .progress-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .progress-text {
            font-size: 0.875rem;
            font-weight: 500;
            color: #475569;
        }

        .progress-bar {
            width: 100%;
            height: 10px;
            background: #e2e8f0;
            border-radius: 5px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(135deg, #1e293b 0%, #ea580c 100%);
            transition: width 0.5s ease-out;
        }

        .progress-labels {
            display: flex;
            justify-content: space-between;
            margin-top: 6px;
        }

        .progress-label {
            font-size: 0.75rem;
            color: #64748b;
        }

        .question-card {
            background: linear-gradient(135deg, #f8fafc 0%, #fff7ed 100%);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 24px;
            border-left: 4px solid #ea580c;
        }

        .question-header {
            display: flex;
            align-items: flex-start;
            margin-bottom: 20px;
        }

        .question-icon {
            background: linear-gradient(135deg, #1e293b 0%, #ea580c 100%);
            border-radius: 50%;
            padding: 12px;
            color: white;
            margin-right: 16px;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
            flex-shrink: 0;
            font-size: 1.2rem;
            min-width: 48px;
            min-height: 48px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .question-text {
            flex: 1;
        }

        .question-title {
            font-size: 1.25rem;
            font-weight: bold;
            color: #1e293b;
            margin-bottom: 8px;
            line-height: 1.3;
        }

        .question-subtitle {
            font-size: 1rem;
            color: #475569;
            margin-bottom: 6px;
            line-height: 1.4;
        }

        .question-description {
            font-size: 0.875rem;
            color: #ea580c;
            font-style: italic;
        }

        .options-container {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        /* MOBILE-FIRST: Scale options always single column on mobile */
        .scale-options {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
        }

        .option-button {
            background: white;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            padding: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            min-height: 56px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .option-button:hover {
            transform: translateY(-1px);
            border-color: #cbd5e1;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }

        .option-button:active {
            transform: translateY(0);
        }

        .option-button.selected {
            border-color: #ea580c;
            background: #fff7ed;
            color: #ea580c;
            box-shadow: 0 4px 12px rgba(234, 88, 12, 0.2);
            transform: translateY(-1px);
        }

        .option-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .option-emoji {
            font-size: 1.5rem;
            margin-bottom: 6px;
        }

        .option-value {
            font-size: 1rem;
            font-weight: bold;
            margin-bottom: 2px;
        }

        .option-label {
            font-size: 0.8rem;
            line-height: 1.2;
        }

        /* Single choice options - full width */
        .single-option {
            width: 100%;
            text-align: left;
            padding: 18px 16px;
        }

        .single-option .option-content {
            display: flex;
            align-items: center;
            width: 100%;
        }

        .single-option .option-emoji {
            font-size: 1.4rem;
            margin-right: 12px;
            margin-bottom: 0;
            flex-shrink: 0;
        }

        .single-option .option-label {
            font-size: 1rem;
            line-height: 1.3;
            flex: 1;
        }

        /* Multiple choice options - full width */
        .multiple-option {
            width: 100%;
            text-align: left;
            padding: 18px 16px;
        }

        .multiple-option .option-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
            width: 100%;
        }

        .multiple-option .option-left {
            display: flex;
            align-items: center;
            flex: 1;
        }

        .multiple-option .option-emoji {
            font-size: 1.4rem;
            margin-right: 12px;
            margin-bottom: 0;
            flex-shrink: 0;
        }

        .multiple-option .option-label {
            font-size: 1rem;
            line-height: 1.3;
        }

        .check-icon {
            width: 24px;
            height: 24px;
            color: #ea580c;
            font-weight: bold;
            flex-shrink: 0;
        }

        .selection-info {
            text-align: center;
            margin-top: 12px;
            font-size: 0.875rem;
            color: #64748b;
            padding: 8px;
            background: rgba(234, 88, 12, 0.1);
            border-radius: 8px;
        }

        .navigation {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 12px;
            flex-wrap: wrap;
        }

        .nav-button {
            display: flex;
            align-items: center;
            padding: 16px 20px;
            border-radius: 12px;
            font-weight: 600;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1rem;
            min-height: 48px;
            flex: 1;
            justify-content: center;
        }

        .nav-button:disabled {
            background: #f1f5f9;
            color: #94a3b8;
            cursor: not-allowed;
        }

        .nav-button.prev {
            background: #e2e8f0;
            color: #475569;
        }

        .nav-button.prev:hover:not(:disabled) {
            background: #cbd5e1;
        }

        .nav-button.next {
            background: linear-gradient(135deg, #1e293b 0%, #ea580c 100%);
            color: white;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        .nav-button.next:hover:not(:disabled) {
            background: linear-gradient(135deg, #0f172a 0%, #c2410c 100%);
            transform: translateY(-1px);
        }

        .progress-dots {
            display: flex;
            gap: 6px;
            flex-wrap: wrap;
            justify-content: center;
            order: 3;
            width: 100%;
            margin-top: 12px;
        }

        .dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #cbd5e1;
            transition: all 0.3s ease;
        }

        .dot.current {
            background: #ea580c;
            width: 24px;
            border-radius: 4px;
        }

        .dot.completed {
            background: #16a34a;
        }

        /* Contact Form Styles */
        .contact-form {
            background: linear-gradient(135deg, #f8fafc 0%, #fff7ed 100%);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 24px;
            border-left: 4px solid #16a34a;
        }

        .form-row {
            display: flex;
            flex-direction: column;
            gap: 16px;
            margin-bottom: 16px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-label {
            font-size: 0.875rem;
            font-weight: 600;
            color: #1e293b;
            margin-bottom: 8px;
        }

        .form-label.required::after {
            content: " *";
            color: #ef4444;
        }

        .form-input, .form-select {
            padding: 16px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
            min-height: 52px;
            -webkit-appearance: none;
            appearance: none;
        }

        .form-input:focus, .form-select:focus {
            outline: none;
            border-color: #ea580c;
        }

        .form-select {
            background: white;
            cursor: pointer;
            background-image: url('data:image/svg+xml;charset=US-ASCII,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 4 5"><path fill="%23666" d="M2 0L0 2h4zm0 5L0 3h4z"/></svg>');
            background-repeat: no-repeat;
            background-position: right 12px center;
            background-size: 12px;
            padding-right: 40px;
        }

        .privacy-checkbox {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            margin-top: 20px;
        }

        .privacy-checkbox input[type="checkbox"] {
            width: 20px;
            height: 20px;
            margin-top: 2px;
            cursor: pointer;
            flex-shrink: 0;
        }

        .privacy-text {
            font-size: 0.875rem;
            color: #64748b;
            line-height: 1.5;
        }

        .whatsapp-preview {
            background: #dcfce7;
            border: 1px solid #16a34a;
            border-radius: 8px;
            padding: 16px;
            margin-top: 16px;
        }

        .whatsapp-preview-title {
            font-size: 0.875rem;
            font-weight: 600;
            color: #16a34a;
            margin-bottom: 8px;
        }

        .whatsapp-preview-text {
            font-size: 0.875rem;
            color: #15803d;
            font-style: italic;
            line-height: 1.4;
        }

        /* Profile Page Styles */
        .profile-header {
            background: linear-gradient(135deg, #1e293b 0%, #ea580c 100%);
            padding: 32px 20px;
            text-align: center;
            color: white;
        }

        .profile-header h1 {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 16px;
            line-height: 1.2;
        }

        .profile-header p {
            font-size: 1.125rem;
            opacity: 0.9;
        }

        .profile-content {
            padding: 20px;
        }

        .profile-section {
            margin-bottom: 24px;
        }

        .profile-grid {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .profile-card {
            border-radius: 16px;
            padding: 20px;
            border-left: 4px solid;
        }

        .profile-card.primary {
            background: linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%);
            border-left-color: #1e293b;
        }

        .profile-card.secondary {
            background: linear-gradient(135deg, #fff7ed 0%, #fed7aa 100%);
            border-left-color: #ea580c;
        }

        .profile-card.success {
            background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);
            border-left-color: #16a34a;
        }

        .profile-card.warning {
            background: linear-gradient(135deg, #fef3c7 0%, #fed7aa 100%);
            border-left-color: #f59e0b;
        }

        .profile-card.purple {
            background: linear-gradient(135deg, #faf5ff 0%, #e9d5ff 100%);
            border-left-color: #7c3aed;
        }

        .profile-card.blue {
            background: linear-gradient(135deg, #f0f9ff 0%, #dbeafe 100%);
            border-left-color: #2563eb;
        }

        .profile-card h3 {
            font-size: 1.25rem;
            font-weight: bold;
            margin-bottom: 16px;
            line-height: 1.3;
        }

        .profile-card.primary h3 { color: #1e293b; }
        .profile-card.secondary h3 { color: #ea580c; }
        .profile-card.success h3 { color: #16a34a; }
        .profile-card.warning h3 { color: #f59e0b; }
        .profile-card.purple h3 { color: #7c3aed; }
        .profile-card.blue h3 { color: #2563eb; }

        .profile-text {
            font-size: 1rem;
            margin-bottom: 12px;
            line-height: 1.5;
        }

        .profile-description {
            color: #64748b;
            line-height: 1.6;
            font-size: 0.95rem;
        }

        .readiness-meter {
            background: #fed7aa;
            border-radius: 8px;
            padding: 16px;
            margin-top: 16px;
        }

        .readiness-label {
            font-size: 0.875rem;
            color: #ea580c;
            margin-bottom: 8px;
        }

        .readiness-bar {
            width: 100%;
            height: 8px;
            background: #fef3c7;
            border-radius: 4px;
            overflow: hidden;
        }

        .readiness-fill {
            height: 100%;
            background: #ea580c;
            transition: width 0.3s ease;
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
        }

        .dashboard-item {
            text-align: center;
        }

        .dashboard-score {
            font-size: 1.75rem;
            font-weight: bold;
            color: #16a34a;
            margin-bottom: 4px;
        }

        .dashboard-label {
            font-size: 0.8rem;
            color: #16a34a;
            margin-bottom: 8px;
            text-transform: capitalize;
            line-height: 1.2;
        }

        .dashboard-bar {
            width: 100%;
            height: 8px;
            background: #dcfce7;
            border-radius: 4px;
            overflow: hidden;
        }

        .dashboard-fill {
            height: 100%;
            background: #16a34a;
            transition: width 0.3s ease;
        }

        .list-container {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .list-item {
            display: flex;
            align-items: center;
            background: white;
            padding: 12px;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .list-icon {
            width: 20px;
            height: 20px;
            margin-right: 12px;
            color: #ea580c;
            flex-shrink: 0;
        }

        .list-text {
            color: #475569;
            text-transform: capitalize;
            font-size: 0.9rem;
            line-height: 1.3;
        }

        .cta-section {
            text-align: center;
            background: linear-gradient(135deg, #1e293b 0%, #ea580c 100%);
            border-radius: 16px;
            padding: 24px 20px;
            color: white;
        }

        .cta-section h3 {
            font-size: 1.25rem;
            font-weight: bold;
            margin-bottom: 12px;
            line-height: 1.3;
        }

        .cta-section p {
            opacity: 0.9;
            margin-bottom: 20px;
            line-height: 1.5;
        }

        .cta-button {
            background: white;
            color: #1e293b;
            padding: 16px 24px;
            border-radius: 12px;
            font-weight: bold;
            border: none;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            width: 100%;
        }

        .cta-button:hover {
            background: #fff7ed;
            transform: translateY(-1px);
        }

        /* Loading overlay */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(30, 41, 59, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            color: white;
            font-size: 1.2rem;
        }

        .loading-overlay.hidden {
            display: none;
        }

        /* RESPONSIVE BREAKPOINTS */
        
        /* Small phones: up to 380px */
        @media (max-width: 380px) {
            .container {
                padding: 12px;
            }
            
            .header {
                padding: 24px 16px;
            }
            
            .header h1 {
                font-size: 1.5rem;
            }
            
            .content {
                padding: 16px;
            }
            
            .question-card {
                padding: 16px;
            }
            
            .question-title {
                font-size: 1.125rem;
            }
            
            .scale-options {
                grid-template-columns: 1fr;
            }
            
            .option-button {
                padding: 12px;
                min-height: 48px;
            }
            
            .nav-button {
                padding: 14px 16px;
                font-size: 0.9rem;
            }
            
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Medium phones: 381px to 480px */
        @media (min-width: 381px) and (max-width: 480px) {
            .scale-options {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .dashboard-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        /* Large phones and small tablets: 481px to 768px */
        @media (min-width: 481px) and (max-width: 768px) {
            .container {
                padding: 20px;
            }
            
            .content {
                padding: 24px;
            }
            
            .form-row {
                flex-direction: row;
                gap: 16px;
            }
            
            .form-group {
                flex: 1;
            }
            
            .scale-options {
                grid-template-columns: repeat(3, 1fr);
            }
            
            .navigation {
                flex-wrap: nowrap;
            }
            
            .progress-dots {
                order: 0;
                width: auto;
                margin: 0;
            }
        }

        /* Tablets and small desktops: 769px and up */
        @media (min-width: 769px) {
            .container {
                padding: 24px;
            }
            
            .header {
                padding: 48px 32px;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .header p {
                font-size: 1.125rem;
            }
            
            .content {
                padding: 32px;
            }
            
            .question-card {
                padding: 32px;
            }
            
            .question-header {
                margin-bottom: 24px;
            }
            
            .question-icon {
                padding: 16px;
                margin-right: 24px;
                font-size: 1.5rem;
            }
            
            .question-title {
                font-size: 1.5rem;
            }
            
            .question-subtitle {
                font-size: 1.125rem;
            }
            
            .scale-options {
                grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            }
            
            .option-button {
                padding: 24px;
            }
            
            .option-emoji {
                font-size: 2rem;
                margin-bottom: 8px;
            }
            
            .option-value {
                font-size: 1.125rem;
            }
            
            .option-label {
                font-size: 0.875rem;
            }
            
            .single-option .option-emoji,
            .multiple-option .option-emoji {
                font-size: 1.5rem;
            }
            
            .single-option .option-label,
            .multiple-option .option-label {
                font-size: 1.125rem;
            }
            
            .navigation {
                flex-wrap: nowrap;
            }
            
            .nav-button {
                padding: 16px 32px;
                flex: 0 0 auto;
            }
            
            .progress-dots {
                order: 0;
                width: auto;
                margin: 0;
            }
            
            .profile-grid {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
                gap: 32px;
            }
            
            .profile-card {
                padding: 32px;
            }
            
            .profile-card h3 {
                font-size: 1.5rem;
            }
            
            .profile-text {
                font-size: 1.125rem;
            }
            
            .dashboard-grid {
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                gap: 24px;
            }
            
            .dashboard-score {
                font-size: 2rem;
            }
            
            .dashboard-label {
                font-size: 0.875rem;
            }
            
            .cta-section {
                padding: 32px;
            }
            
            .cta-section h3 {
                font-size: 1.5rem;
            }
            
            .cta-button {
                padding: 16px 32px;
                font-size: 1.125rem;
                width: auto;
                display: inline-block;
            }
        }

        /* Large desktops: 1024px and up */
        @media (min-width: 1024px) {
            .form-row {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 16px;
            }
            
            .form-group.full-width {
                grid-column: 1 / -1;
            }
        }

        /* Landscape orientation adjustments */
        @media (orientation: landscape) and (max-height: 500px) {
            .header {
                padding: 20px;
            }
            
            .header h1 {
                font-size: 1.5rem;
                margin-bottom: 4px;
            }
            
            .question-card {
                padding: 16px;
            }
            
            .question-header {
                margin-bottom: 16px;
            }
            
            .cta-section {
                padding: 20px;
            }
        }

        /* Dark mode support */
        @media (prefers-color-scheme: dark) {
            body {
                background: linear-gradient(135deg, #1e293b 0%, #334155 50%, #475569 100%);
            }
            
            .quiz-card {
                background: #334155;
                color: #f1f5f9;
            }
            
            .question-card {
                background: linear-gradient(135deg, #475569 0%, #64748b 100%);
            }
            
            .option-button {
                background: #475569;
                border-color: #64748b;
                color: #f1f5f9;
            }
            
            .option-button:hover {
                border-color: #94a3b8;
            }
            
            .list-item {
                background: #475569;
                color: #f1f5f9;
            }
        }

        /* High contrast mode */
        @media (prefers-contrast: high) {
            .option-button {
                border-width: 3px;
            }
            
            .option-button.selected {
                border-width: 4px;
            }
            
            .nav-button {
                border: 2px solid currentColor;
            }
        }

        /* Reduced motion */
        @media (prefers-reduced-motion: reduce) {
            * {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }

        /* Print styles */
        @media print {
            .navigation,
            .progress-section {
                display: none;
            }
            
            .quiz-card {
                box-shadow: none;
                border: 1px solid #000;
            }
            
            .header {
                background: #000 !important;
                color: #fff !important;
            }
        }
    </style>
</head>
<body>
    <!-- Loading overlay -->
    <div id="loadingOverlay" class="loading-overlay">
        <div>üîÑ Caricamento sessione...</div>
    </div>

    <div class="container">
        <div class="quiz-card">
            <div id="quiz-container">
                <!-- Quiz content will be inserted here -->
            </div>
        </div>
    </div>

    <!-- Unified Session Manager -->
    <script type="module" src="../api/unified-session-manager.js"></script>

    <!-- Firebase SDK -->
    <script type="module">
        // Import Firebase functions
        import { db } from './firebase.js';
        import { collection, addDoc, serverTimestamp } from 'https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js';
        
        // Make functions available globally
        window.firebaseDB = db;
        window.firebaseCollection = collection;
        window.firebaseAddDoc = addDoc;
        window.firebaseServerTimestamp = serverTimestamp;
    </script>
    
    <script>
        // 6 LIFESTYLE PROFILES SYSTEM
        const LIFESTYLE_PROFILES = {
            'stressato_esaurito': {
                name: 'Stressato Esaurito',
                emoji: 'üò∞',
                color: 'warning',
                description: 'Burnout, sovraccarico e bisogno di recupero',
                approach: 'Recupero graduale e gestione dello stress',
                strengths: ['Resistenza', 'Dedizione', 'Capacit√† di sacrificio'],
                challenges: ['Burnout', 'Stress cronico', 'Mancanza di energia'],
                goals: ['Recuperare energia', 'Gestire lo stress', 'Trovare equilibrio'],
                strategies: ['Tecniche di rilassamento', 'Boundaries lavorativi', 'Self-care quotidiano'],
                language: 'Comprensivo, rassicurante, orientato al recupero',
                timeline: 'Lento ma costante, priorit√† al benessere'
            },
            'procrastinatore_bloccato': {
                name: 'Procrastinatore Bloccato',
                emoji: '‚è≥',
                color: 'blue',
                description: 'Rimanda continuamente, manca di azione concreta',
                approach: 'Sblocco mentale e azione guidata',
                strengths: ['Creativit√†', 'Visione', 'Potenziale nascosto'],
                challenges: ['Procrastinazione', 'Paralisi decisionale', 'Mancanza di azione'],
                goals: ['Iniziare ad agire', 'Superare i blocchi', 'Creare momentum'],
                strategies: ['Micro-azioni', 'Accountability', 'Sistemi di reward'],
                language: 'Motivazionale, orientato all\'azione, pratico',
                timeline: 'Passi piccoli ma immediati, focus sull\'azione'
            },
            'perfezionista_insoddisfatto': {
                name: 'Perfezionista Insoddisfatto',
                emoji: 'üéØ',
                color: 'purple',
                description: 'Standard troppo alti, mai soddisfatto dei risultati',
                approach: 'Accettazione e progress over perfection',
                strengths: ['Attenzione al dettaglio', 'Standard elevati', 'Qualit√†'],
                challenges: ['Perfezionismo paralizzante', 'Insoddisfazione', 'Stress da performance'],
                goals: ['Accettare "buono abbastanza"', 'Celebrare i progressi', 'Ridurre l\'autocritica'],
                strategies: ['Progress tracking', 'Mindfulness', 'Reframing cognitivo'],
                language: 'Paziente, orientato al progresso, anti-perfezionismo',
                timeline: 'Graduale, con focus sui piccoli miglioramenti'
            },
            'dispersivo_confuso': {
                name: 'Dispersivo Confuso',
                emoji: 'ü§Ø',
                color: 'primary',
                description: 'Troppe cose in mente, manca focus e chiarezza',
                approach: 'Chiarezza, focus e prioritizzazione',
                strengths: ['Versatilit√†', 'Apertura mentale', 'Multitasking'],
                challenges: ['Mancanza di focus', 'Confusione', 'Dispersione energetica'],
                goals: ['Trovare chiarezza', 'Definire priorit√†', 'Concentrarsi sull\'essenziale'],
                strategies: ['Mind mapping', 'Matrice priorit√†', 'Single-tasking'],
                language: 'Chiaro, strutturato, orientato al focus',
                timeline: 'Strutturato, con obiettivi chiari e specifici'
            },
            'motivato_inconsistente': {
                name: 'Motivato Inconsistente',
                emoji: 'üé¢',
                color: 'secondary',
                description: 'Entusiasmo a ondate, difficolt√† a mantenere costanza',
                approach: 'Sistemi e routine per la consistenza',
                strengths: ['Entusiasmo', 'Energia quando motivato', 'Capacit√† di sprint'],
                challenges: ['Inconsistenza', 'Motivazione altalenante', 'Difficolt√† nel mantenere ritmo'],
                goals: ['Creare consistenza', 'Sistemi automatici', 'Mantenere momentum'],
                strategies: ['Habit stacking', 'Tracking visivo', 'Reward systems'],
                language: 'Energico, orientato ai sistemi, motivazionale',
                timeline: 'Costante, con sistemi di supporto e monitoraggio'
            },
            'equilibrato_ottimizzatore': {
                name: 'Equilibrato Ottimizzatore',
                emoji: '‚ö°',
                color: 'success',
                description: 'Situazione gi√† buona, cerca ottimizzazione e crescita',
                approach: 'Fine-tuning e crescita avanzata',
                strengths: ['Equilibrio', 'Autodisciplina', 'Visione a lungo termine'],
                challenges: ['Compiacenza', 'Plateau', 'Mancanza di sfide'],
                goals: ['Ottimizzare performance', 'Nuove sfide', 'Crescita continua'],
                strategies: ['Biohacking', 'Advanced techniques', 'Mentoring'],
                language: 'Sofisticato, orientato alla performance, consulenziale',
                timeline: 'Avanzato, con focus su ottimizzazione e crescita'
            }
        };

        class LifestyleQuiz {
            constructor() {
                this.currentStep = 0;
                this.answers = {};
                this.contactData = {};
                this.profile = null;
                this.container = document.getElementById('quiz-container');
                this.showingContactForm = false;
                this.isAuthenticated = false;
                this.currentUser = null;
                this.userDataPreloaded = false;
                
                this.questions = [
                    // === STRESS/BURNOUT QUESTIONS (5) ===
                    {
                        id: 'stress_level',
                        title: 'Livello di Stress',
                        icon: 'üò∞',
                        question: 'Come descriveresti il tuo livello di stress negli ultimi 30 giorni?',
                        subtitle: 'Il tuo stato emotivo e fisico generale',
                        type: 'scale',
                        category: 'stress',
                        options: [
                            { value: 1, label: 'Rilassato', emoji: 'üòå' },
                            { value: 2, label: 'Gestibile', emoji: 'üôÇ' },
                            { value: 3, label: 'Moderato', emoji: 'üòê' },
                            { value: 4, label: 'Alto', emoji: 'üòü' },
                            { value: 5, label: 'Estremo', emoji: 'üò∞' }
                        ]
                    },
                    {
                        id: 'energy_depletion',
                        title: 'Esaurimento Energetico',
                        icon: 'üîã',
                        question: 'Quanto spesso ti senti completamente scarico di energie?',
                        subtitle: 'La tua batteria personale',
                        type: 'scale',
                        category: 'energy',
                        options: [
                            { value: 1, label: 'Mai', emoji: 'üîã' },
                            { value: 2, label: 'Raramente', emoji: 'üîÑ' },
                            { value: 3, label: 'Qualche volta', emoji: 'ü™´' },
                            { value: 4, label: 'Spesso', emoji: '‚ö°' },
                            { value: 5, label: 'Sempre', emoji: 'üíÄ' }
                        ]
                    },
                    {
                        id: 'work_overwhelm',
                        title: 'Sovraccarico Lavorativo',
                        icon: 'üíº',
                        question: 'Quanto spesso ti senti sopraffatto dal lavoro?',
                        subtitle: 'La tua esperienza lavorativa quotidiana',
                        type: 'scale',
                        category: 'work',
                        options: [
                            { value: 1, label: 'Mai', emoji: 'üòå' },
                            { value: 2, label: 'Raramente', emoji: 'üôÇ' },
                            { value: 3, label: 'Qualche volta', emoji: 'üòê' },
                            { value: 4, label: 'Spesso', emoji: 'üòü' },
                            { value: 5, label: 'Sempre', emoji: 'üòµ' }
                        ]
                    },
                    {
                        id: 'sleep_quality',
                        title: 'Qualit√† del Sonno',
                        icon: 'üò¥',
                        question: 'Come valuti la qualit√† del tuo sonno?',
                        subtitle: 'Il tuo riposo e recupero',
                        type: 'scale',
                        category: 'sleep',
                        options: [
                            { value: 1, label: 'Pessima', emoji: 'üòµ' },
                            { value: 2, label: 'Scarsa', emoji: 'üò™' },
                            { value: 3, label: 'Nella media', emoji: 'üòê' },
                            { value: 4, label: 'Buona', emoji: 'üòå' },
                            { value: 5, label: 'Eccellente', emoji: 'üò¥' }
                        ]
                    },
                    {
                        id: 'burnout_signs',
                        title: 'Segnali di Burnout',
                        icon: 'üî•',
                        question: 'Quali di questi segnali riconosci in te? (seleziona tutti quelli che si applicano)',
                        subtitle: 'Sintomi di esaurimento',
                        type: 'multiple',
                        category: 'burnout',
                        options: [
                            { value: 'exhaustion', label: 'Esaurimento fisico costante', emoji: 'üíÄ' },
                            { value: 'cynicism', label: 'Cinismo verso il lavoro', emoji: 'üòí' },
                            { value: 'detachment', label: 'Distacco emotivo', emoji: 'üö´' },
                            { value: 'irritability', label: 'Irritabilit√† frequente', emoji: 'üò†' },
                            { value: 'physical_symptoms', label: 'Sintomi fisici (mal di testa, tensione)', emoji: 'ü§ï' },
                            { value: 'lost_motivation', label: 'Perdita di motivazione', emoji: 'üìâ' },
                            { value: 'none', label: 'Nessuno di questi', emoji: '‚úÖ' }
                        ]
                    },

                    // === PROCRASTINATION QUESTIONS (4) ===
                    {
                        id: 'action_delay',
                        title: 'Tendenza al Rimando',
                        icon: '‚è≥',
                        question: 'Quando hai un compito importante, di solito:',
                        subtitle: 'Il tuo pattern di azione',
                        type: 'single',
                        category: 'procrastination',
                        options: [
                            { value: 'immediate', label: 'Lo faccio subito', emoji: '‚ö°' },
                            { value: 'planned', label: 'Lo pianifico e lo faccio', emoji: 'üìã' },
                            { value: 'delay', label: 'Lo rimando un po\'', emoji: '‚è∞' },
                            { value: 'last_minute', label: 'Lo faccio all\'ultimo minuto', emoji: 'üèÉ' },
                            { value: 'avoid', label: 'Spesso lo evito completamente', emoji: 'üö´' }
                        ]
                    },
                    {
                        id: 'decision_paralysis',
                        title: 'Paralisi Decisionale',
                        icon: 'ü§∑',
                        question: 'Davanti a decisioni importanti, quanto spesso rimani bloccato?',
                        subtitle: 'La tua capacit√† decisionale',
                        type: 'scale',
                        category: 'decisions',
                        options: [
                            { value: 1, label: 'Mai', emoji: '‚ö°' },
                            { value: 2, label: 'Raramente', emoji: 'ü§î' },
                            { value: 3, label: 'Qualche volta', emoji: 'üòê' },
                            { value: 4, label: 'Spesso', emoji: 'üòï' },
                            { value: 5, label: 'Sempre', emoji: 'ü§∑' }
                        ]
                    },
                    {
                        id: 'task_completion',
                        title: 'Completamento Compiti',
                        icon: 'üìã',
                        question: 'Qual √® la tua percentuale di completamento dei compiti che ti poni?',
                        subtitle: 'Il tuo track record',
                        type: 'single',
                        category: 'completion',
                        options: [
                            { value: 'high', label: '80-100% - Completo quasi tutto', emoji: 'üèÜ' },
                            { value: 'medium', label: '60-80% - Completo la maggior parte', emoji: 'üëç' },
                            { value: 'low', label: '40-60% - Completamento altalenante', emoji: 'üìä' },
                            { value: 'very_low', label: '20-40% - Completo poche cose', emoji: 'üòû' },
                            { value: 'minimal', label: '0-20% - Quasi mai completo', emoji: 'üíî' }
                        ]
                    },
                    {
                        id: 'procrastination_triggers',
                        title: 'Trigger di Procrastinazione',
                        icon: 'üéØ',
                        question: 'Cosa ti fa procrastinare di pi√π? (seleziona fino a 3)',
                        subtitle: 'I tuoi ostacoli principali',
                        type: 'multiple',
                        category: 'triggers',
                        maxSelections: 3,
                        options: [
                            { value: 'perfectionism', label: 'Paura di non farlo perfetto', emoji: 'üéØ' },
                            { value: 'overwhelm', label: 'Il compito sembra troppo grande', emoji: 'üóª' },
                            { value: 'boring', label: 'Il compito √® noioso', emoji: 'üò¥' },
                            { value: 'unclear', label: 'Non so da dove iniziare', emoji: 'ü§î' },
                            { value: 'failure', label: 'Paura di fallire', emoji: 'üò∞' },
                            { value: 'distractions', label: 'Troppe distrazioni', emoji: 'üì±' },
                            { value: 'no_mood', label: 'Non sono dell\'umore giusto', emoji: 'üòí' }
                        ]
                    },

                    // === PERFECTIONISM QUESTIONS (4) ===
                    {
                        id: 'satisfaction_level',
                        title: 'Soddisfazione dei Risultati',
                        icon: 'üò§',
                        question: 'Quanto spesso sei soddisfatto dei tuoi risultati?',
                        subtitle: 'La tua relazione con i tuoi successi',
                        type: 'scale',
                        category: 'satisfaction',
                        options: [
                            { value: 1, label: 'Sempre', emoji: 'üòä' },
                            { value: 2, label: 'Spesso', emoji: 'üôÇ' },
                            { value: 3, label: 'Qualche volta', emoji: 'üòê' },
                            { value: 4, label: 'Raramente', emoji: 'üòï' },
                            { value: 5, label: 'Mai', emoji: 'üò§' }
                        ]
                    },
                    {
                        id: 'standards_pressure',
                        title: 'Pressione degli Standard',
                        icon: 'üìè',
                        question: 'Quanto pressione ti metti per raggiungere standard elevati?',
                        subtitle: 'La tua auto-pressione',
                        type: 'scale',
                        category: 'pressure',
                        options: [
                            { value: 1, label: 'Nessuna pressione', emoji: 'üòå' },
                            { value: 2, label: 'Poca pressione', emoji: 'üôÇ' },
                            { value: 3, label: 'Pressione moderata', emoji: 'üòê' },
                            { value: 4, label: 'Molta pressione', emoji: 'üòü' },
                            { value: 5, label: 'Pressione estrema', emoji: 'üò∞' }
                        ]
                    },
                    {
                        id: 'mistake_reaction',
                        title: 'Reazione agli Errori',
                        icon: '‚ùå',
                        question: 'Come reagisci quando commetti un errore?',
                        subtitle: 'Il tuo rapporto con i fallimenti',
                        type: 'single',
                        category: 'mistakes',
                        options: [
                            { value: 'learning', label: 'Lo vedo come opportunit√† di apprendimento', emoji: 'üìö' },
                            { value: 'mild_frustration', label: 'Un po\' di frustrazione, poi vado avanti', emoji: 'üòï' },
                            { value: 'harsh_criticism', label: 'Mi critico duramente', emoji: 'üò§' },
                            { value: 'rumination', label: 'Ci penso per giorni', emoji: 'üîÑ' },
                            { value: 'devastating', label: 'Mi sento devastato', emoji: 'üíî' }
                        ]
                    },
                    {
                        id: 'completion_difficulty',
                        title: 'Difficolt√† nel Completare',
                        icon: 'üèÅ',
                        question: 'Quanto spesso hai difficolt√† a "finire" i progetti perch√© non ti sembrano abbastanza buoni?',
                        subtitle: 'Il tuo rapporto con la finalizzazione',
                        type: 'scale',
                        category: 'completion',
                        options: [
                            { value: 1, label: 'Mai', emoji: '‚úÖ' },
                            { value: 2, label: 'Raramente', emoji: 'üëç' },
                            { value: 3, label: 'Qualche volta', emoji: 'üòê' },
                            { value: 4, label: 'Spesso', emoji: 'üòü' },
                            { value: 5, label: 'Sempre', emoji: 'üîÑ' }
                        ]
                    },

                    // === FOCUS/CLARITY QUESTIONS (4) ===
                    {
                        id: 'mental_clarity',
                        title: 'Chiarezza Mentale',
                        icon: 'üß†',
                        question: 'Come descriveresti la tua chiarezza mentale attuale?',
                        subtitle: 'La tua lucidit√† e concentrazione',
                        type: 'single',
                        category: 'clarity',
                        options: [
                            { value: 'crystal_clear', label: 'Cristallina, so esattamente cosa voglio', emoji: 'üíé' },
                            { value: 'mostly_clear', label: 'Abbastanza chiara con qualche dubbio', emoji: 'üå§Ô∏è' },
                            { value: 'cloudy', label: 'Nebbiosa, spesso confusa', emoji: 'üå´Ô∏è' },
                            { value: 'foggy', label: 'Molto confusa, tutto sembra sfocato', emoji: 'üå™Ô∏è' },
                            { value: 'overwhelmed', label: 'Sopraffatta, non so da dove guardare', emoji: 'ü§Ø' }
                        ]
                    },
                    {
                        id: 'priority_setting',
                        title: 'Definizione Priorit√†',
                        icon: 'üéØ',
                        question: 'Quanto ti riesce facile definire le tue priorit√†?',
                        subtitle: 'La tua capacit√† di scegliere',
                        type: 'scale',
                        category: 'priorities',
                        options: [
                            { value: 1, label: 'Molto difficile', emoji: 'ü§∑' },
                            { value: 2, label: 'Difficile', emoji: 'üòï' },
                            { value: 3, label: 'Nella media', emoji: 'üòê' },
                            { value: 4, label: 'Facile', emoji: 'üòä' },
                            { value: 5, label: 'Molto facile', emoji: 'üéØ' }
                        ]
                    },
                    {
                        id: 'attention_span',
                        title: 'Durata dell\'Attenzione',
                        icon: '‚è±Ô∏è',
                        question: 'Per quanto tempo riesci a concentrarti su un compito senza distrarti?',
                        subtitle: 'La tua capacit√† di focus',
                        type: 'single',
                        category: 'attention',
                        options: [
                            { value: 'very_short', label: 'Meno di 15 minuti', emoji: '‚ö°' },
                            { value: 'short', label: '15-30 minuti', emoji: '‚è∞' },
                            { value: 'medium', label: '30-60 minuti', emoji: 'üïê' },
                            { value: 'long', label: '1-2 ore', emoji: 'üïë' },
                            { value: 'very_long', label: 'Oltre 2 ore', emoji: 'üéØ' }
                        ]
                    },
                    {
                        id: 'information_overload',
                        title: 'Sovraccarico Informativo',
                        icon: 'üìä',
                        question: 'Quanto spesso ti senti sopraffatto dalla quantit√† di informazioni che devi processare?',
                        subtitle: 'Il tuo rapporto con l\'informazione',
                        type: 'scale',
                        category: 'overload',
                        options: [
                            { value: 1, label: 'Mai', emoji: 'üòå' },
                            { value: 2, label: 'Raramente', emoji: 'üôÇ' },
                            { value: 3, label: 'Qualche volta', emoji: 'üòê' },
                            { value: 4, label: 'Spesso', emoji: 'üòü' },
                            { value: 5, label: 'Sempre', emoji: 'ü§Ø' }
                        ]
                    },

                    // === CONSISTENCY QUESTIONS (4) ===
                    {
                        id: 'motivation_pattern',
                        title: 'Pattern Motivazionale',
                        icon: 'üé¢',
                        question: 'La tua motivazione nel tempo √®:',
                        subtitle: 'Come varia la tua energia',
                        type: 'single',
                        category: 'motivation',
                        options: [
                            { value: 'stable', label: 'Costante e stabile', emoji: 'üìà' },
                            { value: 'gradual', label: 'Cresce gradualmente', emoji: 'üìä' },
                            { value: 'waves', label: 'A ondate: alti e bassi', emoji: 'üåä' },
                            { value: 'explosive', label: 'Esplosiva ma breve', emoji: 'üí•' },
                            { value: 'declining', label: 'In costante diminuzione', emoji: 'üìâ' }
                        ]
                    },
                    {
                        id: 'habit_maintenance',
                        title: 'Mantenimento Abitudini',
                        icon: 'üîÑ',
                        question: 'Quanto ti riesce facile mantenere nuove abitudini?',
                        subtitle: 'La tua costanza comportamentale',
                        type: 'scale',
                        category: 'habits',
                        options: [
                            { value: 1, label: 'Molto difficile', emoji: 'üòû' },
                            { value: 2, label: 'Difficile', emoji: 'üòï' },
                            { value: 3, label: 'Nella media', emoji: 'üòê' },
                            { value: 4, label: 'Facile', emoji: 'üòä' },
                            { value: 5, label: 'Molto facile', emoji: 'üí™' }
                        ]
                    },
                    {
                        id: 'routine_preference',
                        title: 'Rapporto con le Routine',
                        icon: 'üìÖ',
                        question: 'Come ti trovi con le routine strutturate?',
                        subtitle: 'Il tuo stile di vita',
                        type: 'single',
                        category: 'routine',
                        options: [
                            { value: 'love', label: 'Le amo, mi danno sicurezza', emoji: 'üìã' },
                            { value: 'helpful', label: 'Utili ma non troppo rigide', emoji: 'üìù' },
                            { value: 'neutral', label: 'Indifferente alle routine', emoji: 'ü§∑' },
                            { value: 'restrictive', label: 'Mi sento limitato', emoji: 'üîí' },
                            { value: 'hate', label: 'Le odio, preferisco improvvisare', emoji: 'üö´' }
                        ]
                    },
                    {
                        id: 'consistency_barriers',
                        title: 'Ostacoli alla Costanza',
                        icon: 'üöß',
                        question: 'Cosa ti impedisce di essere costante? (seleziona fino a 3)',
                        subtitle: 'Le tue barriere principali',
                        type: 'multiple',
                        category: 'barriers',
                        maxSelections: 3,
                        options: [
                            { value: 'motivation_drops', label: 'Calo di motivazione', emoji: 'üìâ' },
                            { value: 'time_constraints', label: 'Mancanza di tempo', emoji: '‚è∞' },
                            { value: 'distractions', label: 'Troppe distrazioni', emoji: 'üì±' },
                            { value: 'perfectionism', label: 'Se non riesco a fare tutto perfetto, mollo', emoji: 'üéØ' },
                            { value: 'boredom', label: 'Mi annoio facilmente', emoji: 'üò¥' },
                            { value: 'external_pressures', label: 'Pressioni esterne', emoji: 'üë•' },
                            { value: 'self_doubt', label: 'Dubbi su me stesso', emoji: 'üòî' }
                        ]
                    },

                    // === OPTIMIZATION QUESTIONS (4) ===
                    {
                        id: 'current_satisfaction',
                        title: 'Soddisfazione Generale',
                        icon: '‚≠ê',
                        question: 'Quanto sei soddisfatto della tua vita attuale?',
                        subtitle: 'Il tuo livello di contentezza',
                        type: 'scale',
                        category: 'life_satisfaction',
                        options: [
                            { value: 1, label: 'Molto insoddisfatto', emoji: 'üòû' },
                            { value: 2, label: 'Insoddisfatto', emoji: 'üòï' },
                            { value: 3, label: 'Neutrale', emoji: 'üòê' },
                            { value: 4, label: 'Soddisfatto', emoji: 'üòä' },
                            { value: 5, label: 'Molto soddisfatto', emoji: 'ü•∞' }
                        ]
                    },
                    {
                        id: 'optimization_mindset',
                        title: 'Mentalit√† di Ottimizzazione',
                        icon: '‚ö°',
                        question: 'Anche quando le cose vanno bene, pensi sempre a come migliorare?',
                        subtitle: 'La tua spinta al miglioramento',
                        type: 'scale',
                        category: 'optimization',
                        options: [
                            { value: 1, label: 'Mai', emoji: 'üòå' },
                            { value: 2, label: 'Raramente', emoji: 'üôÇ' },
                            { value: 3, label: 'Qualche volta', emoji: 'üòê' },
                            { value: 4, label: 'Spesso', emoji: 'ü§î' },
                            { value: 5, label: 'Sempre', emoji: '‚ö°' }
                        ]
                    },
                    {
                        id: 'growth_investment',
                        title: 'Investimento nella Crescita',
                        icon: 'üìà',
                        question: 'Quanto tempo/denaro investi attualmente nella tua crescita personale?',
                        subtitle: 'Il tuo commitment al miglioramento',
                        type: 'single',
                        category: 'investment',
                        options: [
                            { value: 'none', label: 'Niente o quasi', emoji: 'üö´' },
                            { value: 'minimal', label: 'Molto poco', emoji: 'üìâ' },
                            { value: 'moderate', label: 'Una quantit√† moderata', emoji: 'üìä' },
                            { value: 'significant', label: 'Parecchio', emoji: 'üìà' },
                            { value: 'major', label: '√à una priorit√† importante', emoji: 'üöÄ' }
                        ]
                    },
                    {
                        id: 'advanced_techniques',
                        title: 'Interesse per Tecniche Avanzate',
                        icon: 'üî¨',
                        question: 'Quanto ti interessano tecniche avanzate di produttivit√†, benessere o performance?',
                        subtitle: 'La tua curiosit√† per l\'ottimizzazione',
                        type: 'scale',
                        category: 'advanced_interest',
                        options: [
                            { value: 1, label: 'Per niente', emoji: 'üòí' },
                            { value: 2, label: 'Poco', emoji: 'üòê' },
                            { value: 3, label: 'Moderatamente', emoji: 'üôÇ' },
                            { value: 4, label: 'Molto', emoji: 'üòä' },
                            { value: 5, label: 'Estremamente', emoji: 'ü§©' }
                        ]
                    },

                    // === GENERAL ASSESSMENT QUESTIONS (4) ===
                    {
                        id: 'main_challenges',
                        title: 'Sfide Principali',
                        icon: 'üõ°Ô∏è',
                        question: 'Quali sono le tue 3 sfide principali in questo momento?',
                        subtitle: 'I tuoi ostacoli pi√π significativi',
                        type: 'multiple',
                        category: 'challenges',
                        maxSelections: 3,
                        options: [
                            { value: 'stress', label: 'Gestione dello stress', emoji: 'üò∞' },
                            { value: 'procrastination', label: 'Procrastinazione', emoji: '‚è≥' },
                            { value: 'perfectionism', label: 'Perfezionismo eccessivo', emoji: 'üéØ' },
                            { value: 'focus', label: 'Mancanza di focus', emoji: 'ü§Ø' },
                            { value: 'consistency', label: 'Mancanza di costanza', emoji: 'üé¢' },
                            { value: 'energy', label: 'Bassa energia', emoji: 'üîã' },
                            { value: 'time', label: 'Gestione del tempo', emoji: '‚è∞' },
                            { value: 'balance', label: 'Equilibrio vita-lavoro', emoji: '‚öñÔ∏è' }
                        ]
                    },
                    {
                        id: 'social_support',
                        title: 'Supporto Sociale',
                        icon: 'üë•',
                        question: 'Come valuti il supporto delle persone intorno a te?',
                        subtitle: 'La tua rete di sostegno',
                        type: 'scale',
                        category: 'social',
                        options: [
                            { value: 1, label: 'Nessun supporto', emoji: 'üòî' },
                            { value: 2, label: 'Poco supporto', emoji: 'üòï' },
                            { value: 3, label: 'Supporto moderato', emoji: 'üôÇ' },
                            { value: 4, label: 'Buon supporto', emoji: 'üòä' },
                            { value: 5, label: 'Supporto eccellente', emoji: 'ü•∞' }
                        ]
                    },
                    {
                        id: 'change_readiness',
                        title: 'Apertura al Cambiamento',
                        icon: 'ü¶ã',
                        question: 'Quanto sei pronto a cambiare le tue abitudini per migliorare?',
                        subtitle: 'Il tuo commitment alla trasformazione',
                        type: 'scale',
                        category: 'readiness',
                        options: [
                            { value: 1, label: 'Per niente pronto', emoji: 'üòí' },
                            { value: 2, label: 'Un po\' scettico', emoji: 'ü§î' },
                            { value: 3, label: 'Curioso di provare', emoji: 'üòä' },
                            { value: 4, label: 'Molto motivato', emoji: 'üí™' },
                            { value: 5, label: 'Completamente pronto', emoji: 'üöÄ' }
                        ]
                    },
                    {
                        id: 'success_definition',
                        title: 'Definizione di Successo',
                        icon: 'üèÜ',
                        question: 'Per te, il successo nel miglioramento personale significa:',
                        subtitle: 'La tua visione del successo',
                        type: 'single',
                        category: 'success',
                        options: [
                            { value: 'survive', label: 'Sopravvivere alle sfide quotidiane', emoji: 'üí™' },
                            { value: 'balance', label: 'Trovare equilibrio e serenit√†', emoji: '‚öñÔ∏è' },
                            { value: 'growth', label: 'Crescere e migliorarsi costantemente', emoji: 'üìà' },
                            { value: 'excellence', label: 'Raggiungere l\'eccellenza', emoji: 'üèÜ' },
                            { value: 'impact', label: 'Fare la differenza nel mondo', emoji: 'üåç' }
                        ]
                    }
                ];
                
                this.init();
            }

            async init() {
                console.log('üéØ Lifestyle Quiz con Session Manager - Inizializzazione...');
                
                // Hide loading overlay after short delay
                setTimeout(() => {
                    document.getElementById('loadingOverlay').classList.add('hidden');
                }, 1500);
                
                // Wait for session manager to be ready
                this.waitForSessionManager();
            }

            async waitForSessionManager() {
                let attempts = 0;
                const maxAttempts = 50; // 5 seconds max
                
                const checkSessionManager = () => {
                    attempts++;
                    
                    if (window.sessionManager || window.tribucoachSession) {
                        console.log('‚úÖ Session Manager trovato, integrazione...');
                        this.integrateWithSessionManager();
                        this.render();
                        return;
                    }
                    
                    if (attempts >= maxAttempts) {
                        console.log('‚ö†Ô∏è Session Manager non trovato, modalit√† standalone');
                        this.render();
                        return;
                    }
                    
                    setTimeout(checkSessionManager, 100);
                };
                
                checkSessionManager();
            }

            integrateWithSessionManager() {
                try {
                    const sessionManager = window.sessionManager || window.tribucoachSession;
                    
                    if (sessionManager) {
                        this.isAuthenticated = sessionManager.isAuthenticated;
                        this.currentUser = sessionManager.user;
                        
                        console.log('üîó Integrazione completata:', {
                            authenticated: this.isAuthenticated,
                            user: this.currentUser?.email || 'guest'
                        });
                        
                        // Pre-load user data if authenticated
                        if (this.isAuthenticated && this.currentUser) {
                            this.preloadUserData();
                        }
                        
                        // Listen for auth changes
                        sessionManager.onAuthStateChanged((user) => {
                            this.currentUser = user;
                            this.isAuthenticated = !!user;
                            console.log('üë§ Auth state changed:', user?.email || 'logged out');
                        });
                    }
                } catch (error) {
                    console.error('‚ùå Errore integrazione session manager:', error);
                }
            }

            preloadUserData() {
                try {
                    if (this.currentUser) {
                        // Pre-fill contact form with user data
                        this.contactData.name = this.currentUser.displayName || 
                                               this.currentUser.email?.split('@')[0] || '';
                        this.contactData.email = this.currentUser.email || '';
                        
                        this.userDataPreloaded = true;
                        console.log('üìã Dati utente pre-caricati:', this.contactData);
                    }
                } catch (error) {
                    console.error('‚ùå Errore pre-caricamento dati:', error);
                }
            }

            handleAnswer(questionId, value) {
                this.answers[questionId] = value;
                
                // Auto-save to session manager if available
                this.autoSaveToSession();
                
                this.render();
            }

            autoSaveToSession() {
                try {
                    const sessionManager = window.sessionManager || window.tribucoachSession;
                    if (sessionManager && this.isAuthenticated) {
                        const quizData = {
                            lifestyleQuizAnswers: this.answers,
                            lifestyleQuizProgress: this.currentStep,
                            lifestyleQuizTimestamp: Date.now()
                        };
                        
                        sessionManager.updateUserData(quizData);
                        console.log('üíæ Auto-save quiz progress:', this.currentStep);
                    }
                } catch (error) {
                    console.error('‚ùå Errore auto-save:', error);
                }
            }

            handleNext() {
                if (this.currentStep < this.questions.length - 1) {
                    this.currentStep++;
                    this.render();
                } else {
                    this.showContactForm();
                }
            }

            handlePrevious() {
                if (this.showingContactForm) {
                    this.showingContactForm = false;
                    this.render();
                } else if (this.currentStep > 0) {
                    this.currentStep--;
                    this.render();
                }
            }

            showContactForm() {
                this.showingContactForm = true;
                this.render();
            }

            handleContactSubmit() {
                // Validate required fields
                const name = document.getElementById('contactName').value.trim();
                const phone = document.getElementById('contactPhone').value.trim();
                const gender = document.getElementById('contactGender').value;
                const privacy = document.getElementById('privacyConsent').checked;

                if (!name || !phone || !gender || !privacy) {
                    alert('Compila tutti i campi obbligatori e accetta l\'informativa privacy.');
                    return;
                }

                // Save contact data
                this.contactData = {
                    ...this.contactData, // Keep pre-loaded data
                    name: name,
                    phone: phone,
                    gender: gender,
                    email: document.getElementById('contactEmail').value.trim() || this.contactData.email,
                    city: document.getElementById('contactCity').value.trim(),
                    privacyConsent: privacy
                };

                // Generate profile
                this.generateProfile();
            }

            generateProfile() {
                // Advanced profile generation with 6 categories
                const profileType = this.calculateProfileType();
                const profileData = LIFESTYLE_PROFILES[profileType];
                
                // Calculate wellbeing scores
                const wellbeingScore = this.calculateWellbeingScore();
                const healthScore = this.calculateHealthScore();
                const professionalScore = this.calculateProfessionalScore();
                const socialScore = this.answers.social_support || 3;

                this.profile = {
                    ...this.contactData,
                    profileType: profileType,
                    profileData: profileData,
                    scores: {
                        wellbeing: wellbeingScore,
                        health: healthScore,
                        professional: professionalScore,
                        social: socialScore
                    },
                    insights: {
                        stressLevel: this.answers.stress_level || 3,
                        actionTendency: this.answers.action_delay || 'planned',
                        perfectionism: this.answers.satisfaction_level || 3,
                        motivationPattern: this.answers.motivation_pattern || 'waves',
                        readinessLevel: this.answers.change_readiness || 3
                    },
                    challenges: this.answers.main_challenges || [],
                    personalizedAnalysis: this.generatePersonalizedAnalysis(profileType, profileData),
                    
                    // Add session data
                    userId: this.isAuthenticated ? this.currentUser?.uid : null,
                    userEmail: this.isAuthenticated ? this.currentUser?.email : null,
                    isAuthenticatedUser: this.isAuthenticated
                };
                
                this.render();
            }

            calculateProfileType() {
                // Advanced profiling with 25 questions
                const stress = this.answers.stress_level || 3;
                const energy = this.answers.energy_depletion || 3;
                const overwhelm = this.answers.work_overwhelm || 3;
                const sleep = this.answers.sleep_quality || 3;
                const burnout = this.answers.burnout_signs || [];
                
                const actionDelay = this.answers.action_delay || 'planned';
                const decisionParalysis = this.answers.decision_paralysis || 3;
                const completion = this.answers.task_completion || 'medium';
                const triggers = this.answers.procrastination_triggers || [];
                
                const satisfaction = this.answers.satisfaction_level || 3;
                const standards = this.answers.standards_pressure || 3;
                const mistakes = this.answers.mistake_reaction || 'mild_frustration';
                const completionDiff = this.answers.completion_difficulty || 3;
                
                const clarity = this.answers.mental_clarity || 'mostly_clear';
                const priorities = this.answers.priority_setting || 3;
                const attention = this.answers.attention_span || 'medium';
                const overload = this.answers.information_overload || 3;
                
                const motivation = this.answers.motivation_pattern || 'waves';
                const habits = this.answers.habit_maintenance || 3;
                const routine = this.answers.routine_preference || 'helpful';
                const barriers = this.answers.consistency_barriers || [];
                
                const lifeSatisfaction = this.answers.current_satisfaction || 3;
                const optimization = this.answers.optimization_mindset || 3;
                const investment = this.answers.growth_investment || 'moderate';
                const advanced = this.answers.advanced_techniques || 3;
                
                // Calculate profile scores
                let scores = {
                    stressato_esaurito: 0,
                    procrastinatore_bloccato: 0,
                    perfezionista_insoddisfatto: 0,
                    dispersivo_confuso: 0,
                    motivato_inconsistente: 0,
                    equilibrato_ottimizzatore: 0
                };
                
                // STRESSATO ESAURITO scoring
                if (stress >= 4) scores.stressato_esaurito += 3;
                if (energy >= 4) scores.stressato_esaurito += 3;
                if (overwhelm >= 4) scores.stressato_esaurito += 3;
                if (sleep <= 2) scores.stressato_esaurito += 2;
                if (burnout.length >= 3) scores.stressato_esaurito += 4;
                if (burnout.includes('exhaustion')) scores.stressato_esaurito += 2;
                
                // PROCRASTINATORE BLOCCATO scoring
                if (actionDelay === 'last_minute' || actionDelay === 'avoid') scores.procrastinatore_bloccato += 4;
                if (decisionParalysis >= 4) scores.procrastinatore_bloccato += 3;
                if (completion === 'low' || completion === 'very_low' || completion === 'minimal') scores.procrastinatore_bloccato += 3;
                if (triggers.includes('perfectionism')) scores.procrastinatore_bloccato += 2;
                if (triggers.includes('overwhelm')) scores.procrastinatore_bloccato += 2;
                
                // PERFEZIONISTA INSODDISFATTO scoring
                if (satisfaction >= 4) scores.perfezionista_insoddisfatto += 3;
                if (standards >= 4) scores.perfezionista_insoddisfatto += 3;
                if (mistakes === 'harsh_criticism' || mistakes === 'rumination' || mistakes === 'devastating') scores.perfezionista_insoddisfatto += 3;
                if (completionDiff >= 4) scores.perfezionista_insoddisfatto += 3;
                if (triggers.includes('perfectionism')) scores.perfezionista_insoddisfatto += 2;
                
                // DISPERSIVO CONFUSO scoring
                if (clarity === 'foggy' || clarity === 'overwhelmed') scores.dispersivo_confuso += 4;
                if (priorities <= 2) scores.dispersivo_confuso += 3;
                if (attention === 'very_short' || attention === 'short') scores.dispersivo_confuso += 3;
                if (overload >= 4) scores.dispersivo_confuso += 3;
                
                // MOTIVATO INCONSISTENTE scoring
                if (motivation === 'waves' || motivation === 'explosive') scores.motivato_inconsistente += 4;
                if (habits <= 2) scores.motivato_inconsistente += 3;
                if (barriers.includes('motivation_drops')) scores.motivato_inconsistente += 2;
                if (barriers.includes('boredom')) scores.motivato_inconsistente += 2;
                if (routine === 'restrictive' || routine === 'hate') scores.motivato_inconsistente += 2;
                
                // EQUILIBRATO OTTIMIZZATORE scoring
                if (lifeSatisfaction >= 4) scores.equilibrato_ottimizzatore += 3;
                if (optimization >= 4) scores.equilibrato_ottimizzatore += 3;
                if (investment === 'significant' || investment === 'major') scores.equilibrato_ottimizzatore += 3;
                if (advanced >= 4) scores.equilibrato_ottimizzatore += 3;
                if (stress <= 2 && energy <= 2) scores.equilibrato_ottimizzatore += 2;
                
                // Find the highest scoring profile
                let maxScore = 0;
                let selectedProfile = 'motivato_inconsistente'; // default
                
                for (const [profile, score] of Object.entries(scores)) {
                    if (score > maxScore) {
                        maxScore = score;
                        selectedProfile = profile;
                    }
                }
                
                // If no clear winner, use fallback logic
                if (maxScore < 5) {
                    // Fallback based on main challenges
                    const challenges = this.answers.main_challenges || [];
                    if (challenges.includes('stress')) return 'stressato_esaurito';
                    if (challenges.includes('procrastination')) return 'procrastinatore_bloccato';
                    if (challenges.includes('perfectionism')) return 'perfezionista_insoddisfatto';
                    if (challenges.includes('focus')) return 'dispersivo_confuso';
                    if (challenges.includes('consistency')) return 'motivato_inconsistente';
                    if (lifeSatisfaction >= 4) return 'equilibrato_ottimizzatore';
                }
                
                return selectedProfile;
            }

            calculateWellbeingScore() {
                const stress = this.answers.stress_level || 3;
                const satisfaction = this.answers.current_satisfaction || 3;
                const energy = this.answers.energy_depletion || 3;
                
                let score = satisfaction;
                if (stress >= 4) score -= 1;
                if (energy >= 4) score -= 1;
                if (energy <= 2) score += 1;
                
                return Math.max(1, Math.min(5, Math.round(score)));
            }

            calculateHealthScore() {
                const energy = this.answers.energy_depletion || 3;
                const sleep = this.answers.sleep_quality || 3;
                const stress = this.answers.stress_level || 3;
                
                let score = (6 - energy + sleep) / 2; // Invert energy depletion
                if (stress >= 4) score -= 1;
                
                return Math.max(1, Math.min(5, Math.round(score)));
            }

            calculateProfessionalScore() {
                const overwhelm = this.answers.work_overwhelm || 3;
                const satisfaction = this.answers.current_satisfaction || 3;
                
                let score = 6 - overwhelm; // Inverted because overwhelm is negative
                score = (score + satisfaction) / 2;
                
                return Math.max(1, Math.min(5, Math.round(score)));
            }

            generatePersonalizedAnalysis(profileType, profileData) {
                const name = this.contactData.name || this.currentUser?.displayName || 'Amico/a';
                const challenges = this.answers.main_challenges || [];
                const stress = this.answers.stress_level || 3;
                const readiness = this.answers.change_readiness || 3;
                
                // Create completely personalized analysis based on profile
                const analyses = {
                    'stressato_esaurito': this.generateStressedAnalysis(name, challenges, stress, readiness),
                    'procrastinatore_bloccato': this.generateProcrastinatorAnalysis(name, challenges, stress, readiness),
                    'perfezionista_insoddisfatto': this.generatePerfectionistAnalysis(name, challenges, stress, readiness),
                    'dispersivo_confuso': this.generateConfusedAnalysis(name, challenges, stress, readiness),
                    'motivato_inconsistente': this.generateInconsistentAnalysis(name, challenges, stress, readiness),
                    'equilibrato_ottimizzatore': this.generateOptimizerAnalysis(name, challenges, stress, readiness)
                };
                
                return analyses[profileType] || analyses['motivato_inconsistente'];
            }

            generateStressedAnalysis(name, challenges, stress, readiness) {
                return `
                    <p><strong>Ciao ${name},</strong> vedo che stai attraversando un periodo molto intenso e impegnativo. Il tuo profilo mi dice che sei una persona che d√† tutto se stesso, ma che ora sta pagando il prezzo di un impegno eccessivo. Ti riconosco perfettamente - sono stato esattamente dove sei tu ora.</p>
                    
                    <div class="warning">
                        <p><strong>La tua situazione:</strong> Sei in una fase di burnout o pre-burnout. Il tuo livello di stress √® elevato e le tue energie sono al limite. Non √® una debolezza - √® il segnale che hai dato tutto quello che avevi.</p>
                    </div>
                    
                    <p><strong>La mia esperienza personale:</strong> Quando ero manager, ho vissuto esattamente la tua situazione. Sveglia alle 6, riunioni infinite, mail anche la domenica. Pensavo che fosse normale essere sempre stanco, sempre in tensione. Poi ho capito che non era sostenibile.</p>
                    
                    <p><strong>Cosa mi ha insegnato l'esperienza:</strong> Il recupero non √® un lusso, √® una necessit√†. Non puoi continuare a correre con il serbatoio vuoto. La prima cosa che faremo insieme sar√† riempire quel serbatoio, lentamente ma costantemente.</p>
                    
                    <p><strong>Il tuo percorso sar√† diverso:</strong> Non ti dar√≤ una lista di cose da fare in pi√π. Ti aiuter√≤ a fare meno, ma meglio. Ti insegner√≤ a dire no, a creare dei boundaries, a rispettare i tuoi limiti senza sentirti in colpa.</p>
                    
                    <p><strong>Le tue sfide specifiche:</strong> ${challenges.includes('stress') ? 'La gestione dello stress √® chiaramente la tua priorit√† numero uno.' : ''} ${challenges.includes('time') ? 'Il tempo sembra scapparti di mano, ma ti insegner√≤ a riprenderlo.' : ''} ${challenges.includes('balance') ? 'L\'equilibrio vita-lavoro non √® un mito - √® una competenza che si pu√≤ imparare.' : ''}</p>
                    
                    <p><strong>La mia promessa:</strong> Non ti chieder√≤ di fare di pi√π. Ti insegner√≤ a stare meglio con quello che fai. Inizieremo con piccoli cambiamenti che ti daranno energia invece di toglierla. Il tuo benessere √® la priorit√† assoluta.</p>
                    
                    <p><strong>Il tuo superpotere nascosto:</strong> La tua capacit√† di resistenza e dedizione sono straordinarie. Una volta che imparerai a canalizzarle correttamente, diventerai inarrestabile. Ma prima, dobbiamo curarti.</p>
                `;
            }

            generateProcrastinatorAnalysis(name, challenges, stress, readiness) {
                return `
                    <p><strong>Ciao ${name},</strong> riconosco in te una persona con un potenziale enorme che per√≤ fatica a trasformarlo in azione concreta. Non √® pigrizia - √® un blocco mentale che conosco bene e che si pu√≤ superare.</p>
                    
                    <div class="highlight">
                        <p><strong>La verit√† sulla procrastinazione:</strong> Non rimandi perch√© non sai cosa fare. Rimandi perch√© hai paura di non farlo abbastanza bene, o perch√© l'obiettivo ti sembra troppo grande. √à un meccanismo di protezione della tua mente.</p>
                    </div>
                    
                    <p><strong>Il tuo nuovo approccio:</strong> Dimentica i grandi gesti eroici. Ti insegner√≤ la tecnica dei "micro-passi" - azioni cos√¨ piccole che √® impossibile non farle. Un passo alla volta, costruiremo il tuo momentum.</p>
                    
                    <p><strong>Il sistema anti-procrastinazione:</strong> Ti insegner√≤ il metodo "2-minuti": se una cosa richiede meno di 2 minuti, la fai subito. Ti dar√≤ tecniche per spezzare i progetti grandi in micro-azioni. Creerai sistemi di accountability che ti manterranno in movimento.</p>
                    
                    <p><strong>Il tuo superpotere nascosto:</strong> La tua capacit√† di visione e creativit√† sono straordinarie. Una volta che avrai sbloccato l'azione, diventerai una forza inarrestabile.</p>
                `;
            }

            generatePerfectionistAnalysis(name, challenges, stress, readiness) {
                return `
                    <p><strong>Ciao ${name},</strong> vedo in te una persona con standard altissimi e una qualit√† del lavoro straordinaria. Ma sento anche la frustrazione di non sentirti mai veramente soddisfatto di quello che raggiungi.</p>
                    
                    <div class="warning">
                        <p><strong>Il paradosso del perfezionismo:</strong> I tuoi standard elevati sono la tua forza, ma stanno diventando la tua prigione. Stai sacrificando la tua felicit√† per un ideale di perfezione che non esiste.</p>
                    </div>
                    
                    <p><strong>Il tuo nuovo mindset:</strong> Ti insegner√≤ a distinguere tra eccellenza (che √® sana) e perfezionismo (che √® paralizzante). Imparerai a celebrare il progresso invece di ossessionarti sulla perfezione.</p>
                    
                    <p><strong>Il sistema anti-perfezionismo:</strong> Ti insegner√≤ la regola dell'80/20: il 20% dello sforzo produce l'80% dei risultati. Imparerai a identificare quando sei nel 20% utile e quando stai sprecando tempo.</p>
                    
                    <p><strong>Il tuo superpotere rivelato:</strong> La tua attenzione ai dettagli e i tuoi standard elevati sono un dono raro. Quando li userai strategicamente invece che ossessivamente, diventerai incredibilmente produttivo.</p>
                `;
            }

            generateConfusedAnalysis(name, challenges, stress, readiness) {
                return `
                    <p><strong>Ciao ${name},</strong> vedo in te una persona con tanti talenti e interessi, ma che si sente sopraffatta da tutte le possibilit√†. Non √® mancanza di capacit√† - √® eccesso di opzioni.</p>
                    
                    <div class="highlight">
                        <p><strong>Il dono della versatilit√†:</strong> La tua mente aperta e curiosa √® un grande vantaggio, ma senza focus diventa dispersione. Il problema non √® quello che sai fare, ma scegliere su cosa concentrarti.</p>
                    </div>
                    
                    <p><strong>Il tuo percorso verso la chiarezza:</strong> Ti insegner√≤ l'arte della prioritizzazione. Non si tratta di rinunciare a tutto, ma di scegliere consapevolmente su cosa concentrare la tua energia limitata.</p>
                    
                    <p><strong>Il sistema della chiarezza:</strong> Ti insegner√≤ la regola del "3 massimo": mai pi√π di 3 progetti principali contemporaneamente. Imparerai a dire no alle distrazioni e s√¨ alle tue priorit√†.</p>
                    
                    <p><strong>Il tuo superpotere nascosto:</strong> La tua capacit√† di vedere connessioni e opportunit√† √® straordinaria. Una volta focalizzato, questa versatilit√† diventer√† la tua arma segreta.</p>
                `;
            }

            generateInconsistentAnalysis(name, challenges, stress, readiness) {
                return `
                    <p><strong>Ciao ${name},</strong> riconosco in te una persona con un'energia contagiosa quando √® motivata, ma che fatica a mantenere la costanza nel tempo. Non √® mancanza di volont√† - √® mancanza di sistemi.</p>
                    
                    <div class="success">
                        <p><strong>La tua forza nascosta:</strong> Quando sei motivato, sei inarrestabile. Il problema non √® la tua capacit√†, ma la sostenibilit√†. Ti insegner√≤ a creare sistemi che mantengano vivo il tuo entusiasmo.</p>
                    </div>
                    
                    <p><strong>Il segreto della costanza:</strong> Non aspettare di sentirti motivato per agire. Crea sistemi cos√¨ semplici che puoi seguirli anche quando non hai voglia. La motivazione √® il starter, l'abitudine √® il motore.</p>
                    
                    <p><strong>Il sistema della costanza:</strong> Ti insegner√≤ l'habit stacking: collegare nuove abitudini a quelle esistenti. Creerai catene di successo che si autoalimentano.</p>
                    
                    <p><strong>Il tuo superpotere rivelato:</strong> La tua capacit√† di sprint e la tua energia quando sei motivato sono straordinarie. Una volta costanti, diventerai una forza della natura.</p>
                `;
            }

            generateOptimizerAnalysis(name, challenges, stress, readiness) {
                return `
                    <p><strong>Ciao ${name},</strong> vedo in te una persona che ha gi√† raggiunto un buon equilibrio nella vita, ma che cerca continuamente di migliorare e ottimizzare. Il mio ruolo sar√† quello di un consulente avanzato.</p>
                    
                    <div class="success">
                        <p><strong>La tua posizione privilegiata:</strong> Sei gi√† avanti rispetto alla maggior parte delle persone. Il tuo livello di consapevolezza e la tua ricerca di miglioramento continuo sono segni di maturit√† personale.</p>
                    </div>
                    
                    <p><strong>Il tuo percorso di eccellenza:</strong> Ti guider√≤ attraverso tecniche avanzate di ottimizzazione. Non cambieremo tutto, ma perfezioneremo quello che gi√† funziona.</p>
                    
                    <p><strong>Il sistema dell'eccellenza:</strong> Ti insegner√≤ principi di ottimizzazione marginale: miglioramenti dell'1% che si compongono nel tempo. Imparerai a misurare e monitorare i tuoi progressi con precisione scientifica.</p>
                    
                    <p><strong>Il tuo superpotere amplificato:</strong> La tua autodisciplina e visione a lungo termine sono straordinarie. Le porteremo al livello successivo, creando un sistema di vita che ti permetter√† di raggiungere risultati che oggi sembrano impossibili.</p>
                `;
            }

            render() {
                if (this.profile) {
                    this.renderProfile();
                } else if (this.showingContactForm) {
                    this.renderContactForm();
                } else {
                    this.renderQuestion();
                }
            }

            renderContactForm() {
                const progress = 95;
                const userName = this.currentUser?.displayName || this.currentUser?.email?.split('@')[0] || '';
                const userEmail = this.currentUser?.email || '';
                
                this.container.innerHTML = `
                    <div class="header">
                        <h1>üë§ I Tuoi Dati</h1>
                        <p>Ultimi dettagli per personalizzare il tuo percorso</p>
                        ${this.isAuthenticated ? `
                            <div class="user-welcome">
                                <div>üëã Ciao ${userName}! Alcuni dati sono gi√† precompilati</div>
                            </div>
                        ` : ''}
                    </div>
                    
                    <div class="content">
                        <div class="progress-section">
                            <div class="progress-header">
                                <span class="progress-text">Quasi finito!</span>
                                <span class="progress-text">25 di 25 ‚úì</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: ${progress}%"></div>
                            </div>
                            <div class="progress-labels">
                                <span class="progress-label">Inizio</span>
                                <span class="progress-label">Completamento</span>
                            </div>
                        </div>
                        
                        <div class="contact-form">
                            <div class="question-header">
                                <div class="question-icon">‚ú®</div>
                                <div class="question-text">
                                    <h2 class="question-title">Conosciamoci Meglio</h2>
                                    <p class="question-subtitle">Questi dati mi aiutano a personalizzare il tuo percorso</p>
                                    <p class="question-description">Tutti i tuoi dati saranno trattati secondo il GDPR</p>
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label required" for="contactName">Nome</label>
                                    <input type="text" id="contactName" class="form-input" placeholder="Il tuo nome" 
                                           value="${userName}" required>
                                </div>
                                <div class="form-group">
                                    <label class="form-label required" for="contactPhone">Telefono</label>
                                    <input type="tel" id="contactPhone" class="form-input" placeholder="+39 123 456 7890" required>
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label required" for="contactGender">Sesso</label>
                                    <select id="contactGender" class="form-select" required>
                                        <option value="">Seleziona...</option>
                                        <option value="M">Maschio</option>
                                        <option value="F">Femmina</option>
                                        <option value="Other">Altro</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label class="form-label" for="contactEmail">Email ${this.isAuthenticated ? '(dal tuo account)' : '(opzionale)'}</label>
                                    <input type="email" id="contactEmail" class="form-input" placeholder="tua@email.com"
                                           value="${userEmail}" ${this.isAuthenticated ? 'readonly' : ''}>
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label" for="contactCity">Citt√† (opzionale)</label>
                                    <input type="text" id="contactCity" class="form-input" placeholder="La tua citt√†">
                                </div>
                            </div>
                            
                            <div class="privacy-checkbox">
                                <input type="checkbox" id="privacyConsent" required>
                                <label for="privacyConsent" class="privacy-text">
                                    Accetto l'<strong>informativa privacy</strong> e autorizzo il trattamento dei miei dati personali per ricevere il percorso di coaching personalizzato e comunicazioni relative al servizio.
                                </label>
                            </div>
                            
                            <div class="whatsapp-preview">
                                <div class="whatsapp-preview-title">üì± Messaggio WhatsApp che riceverai:</div>
                                <div class="whatsapp-preview-text">
                                    "Ciao [Nome]! üëã Sono Andrea, il tuo Lifestyle Coach. Ho preparato il tuo percorso personalizzato di trasformazione. Accedi qui per iniziare: [link dashboard]"
                                </div>
                            </div>
                        </div>
                        
                        <div class="navigation">
                            <button class="nav-button prev" onclick="quiz.handlePrevious()">
                                ‚Üê Indietro
                            </button>
                            
                            <div class="progress-dots">
                                <div class="dot completed"></div>
                                <div class="dot completed"></div>
                                <div class="dot completed"></div>
                                <div class="dot completed"></div>
                                <div class="dot completed"></div>
                                <div class="dot completed"></div>
                                <div class="dot completed"></div>
                                <div class="dot current"></div>
                            </div>
                            
                            <button class="nav-button next" onclick="quiz.handleContactSubmit()">
                                üéØ Genera il Mio Profilo ‚Üí
                            </button>
                        </div>
                    </div>
                `;
            }

            renderProfile() {
                const profile = this.profile.profileData;
                const colorClass = profile.color;
                
                this.container.innerHTML = `
                    <div class="profile-header">
                        <h1>${profile.emoji} Ciao ${this.profile.name}!</h1>
                        <p>Il tuo profilo: ${profile.name}</p>
                    </div>
                    <div class="profile-content">
                        <div class="profile-section">
                            <div class="profile-grid">
                                <div class="profile-card ${colorClass}">
                                    <h3>${profile.emoji} ${profile.name}</h3>
                                    <p class="profile-text">${profile.description}</p>
                                    <p class="profile-description">${profile.approach}</p>
                                    <div class="readiness-meter">
                                        <div class="readiness-label">Motivazione al Cambiamento: ${this.profile.insights.readinessLevel}/5</div>
                                        <div class="readiness-bar">
                                            <div class="readiness-fill" style="width: ${(this.profile.insights.readinessLevel / 5) * 100}%"></div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="profile-card secondary">
                                    <h3>üéØ I Tuoi Punti di Forza</h3>
                                    <div class="list-container">
                                        ${profile.strengths.map(strength => `
                                            <div class="list-item">
                                                <div class="list-icon">‚ú®</div>
                                                <div class="list-text">${strength}</div>
                                            </div>
                                        `).join('')}
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="profile-section">
                            <div class="profile-card success">
                                <h3>üìä Le Tue Aree di Valutazione</h3>
                                <div class="dashboard-grid">
                                    ${Object.entries(this.profile.scores).map(([key, score]) => `
                                        <div class="dashboard-item">
                                            <div class="dashboard-score">${score}/5</div>
                                            <div class="dashboard-label">${this.getScoreLabel(key)}</div>
                                            <div class="dashboard-bar">
                                                <div class="dashboard-fill" style="width: ${(score / 5) * 100}%"></div>
                                            </div>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                        </div>
                        
                        <div class="profile-section">
                            <div class="profile-grid">
                                <div class="profile-card warning">
                                    <h3>üéØ Le Tue Sfide</h3>
                                    <div class="list-container">
                                        ${profile.challenges.map(challenge => `
                                            <div class="list-item">
                                                <div class="list-icon">‚ö°</div>
                                                <div class="list-text">${challenge}</div>
                                            </div>
                                        `).join('')}
                                    </div>
                                </div>
                                
                                <div class="profile-card blue">
                                    <h3>üöÄ I Tuoi Obiettivi</h3>
                                    <div class="list-container">
                                        ${profile.goals.map(goal => `
                                            <div class="list-item">
                                                <div class="list-icon">üéØ</div>
                                                <div class="list-text">${goal}</div>
                                            </div>
                                        `).join('')}
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="profile-section">
                            <div class="profile-card primary">
                                <h3>üîç Analisi Dettagliata del Tuo Profilo</h3>
                                <div class="profile-description" style="line-height: 1.8; font-size: 1rem;">
                                    ${this.profile.personalizedAnalysis}
                                </div>
                            </div>
                        </div>
                        
                        <div class="profile-section">
                            <div class="cta-section">
                                <h3>üöÄ Inizia Ora la Tua Trasformazione</h3>
                                <p>Il tuo percorso personalizzato di 7 settimane basato sul profilo "${profile.name}" ti aspetta</p>
                                <button class="cta-button" onclick="saveProfileAndRedirect()">
                                    ${profile.emoji} Accedi alla Tua Dashboard Personale
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }

            renderQuestion() {
                const currentQuestion = this.questions[this.currentStep];
                const progress = ((this.currentStep + 1) / this.questions.length) * 100;
                const canProceed = this.answers[currentQuestion.id] !== undefined;
                const isLastStep = this.currentStep === this.questions.length - 1;
                const userName = this.currentUser?.displayName || this.currentUser?.email?.split('@')[0] || '';

                this.container.innerHTML = `
                    <div class="header">
                        <h1>üéØ Lifestyle Assessment</h1>
                        <p>Scopri il tuo profilo personalizzato in 25 domande</p>
                        ${this.isAuthenticated ? `
                            <div class="user-welcome">
                                <div>üëã Ciao ${userName}! Le tue risposte vengono salvate automaticamente</div>
                            </div>
                        ` : ''}
                    </div>
                    
                    <div class="content">
                        <div class="progress-section">
                            <div class="progress-header">
                                <span class="progress-text">Progresso</span>
                                <span class="progress-text">${this.currentStep + 1} di ${this.questions.length}</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: ${progress}%"></div>
                            </div>
                            <div class="progress-labels">
                                <span class="progress-label">Inizio</span>
                                <span class="progress-label">Fine</span>
                            </div>
                        </div>
                        
                        <div class="question-card">
                            <div class="question-header">
                                <div class="question-icon">
                                    ${currentQuestion.icon}
                                </div>
                                <div class="question-text">
                                    <h2 class="question-title">${currentQuestion.title}</h2>
                                    <p class="question-subtitle">${currentQuestion.question}</p>
                                    <p class="question-description">${currentQuestion.subtitle}</p>
                                </div>
                            </div>
                            
                            <div class="options-container ${currentQuestion.type === 'scale' ? 'scale-options' : ''}">
                                ${this.renderOptions(currentQuestion)}
                            </div>
                            
                            ${currentQuestion.maxSelections ? `
                                <div class="selection-info">
                                    Seleziona fino a ${currentQuestion.maxSelections} opzioni
                                    (${(this.answers[currentQuestion.id] || []).length}/${currentQuestion.maxSelections})
                                </div>
                            ` : ''}
                        </div>
                        
                        <div class="navigation">
                            <button class="nav-button prev" ${this.currentStep === 0 ? 'disabled' : ''} onclick="quiz.handlePrevious()">
                                ‚Üê Precedente
                            </button>
                            
                            <div class="progress-dots">
                                ${this.questions.map((_, index) => `
                                    <div class="dot ${index === this.currentStep ? 'current' : index < this.currentStep ? 'completed' : ''}"></div>
                                `).join('')}
                            </div>
                            
                            <button class="nav-button next" ${!canProceed ? 'disabled' : ''} onclick="quiz.handleNext()">
                                ${isLastStep ? 'Avanti' : 'Avanti'} ‚Üí
                            </button>
                        </div>
                    </div>
                `;
            }

            renderOptions(question) {
                return question.options.map(option => {
                    if (question.type === 'scale') {
                        return `
                            <button class="option-button ${this.answers[question.id] === option.value ? 'selected' : ''}" 
                                    onclick="quiz.handleAnswer('${question.id}', ${option.value})">
                                <div class="option-emoji">${option.emoji}</div>
                                <div class="option-value">${option.value}</div>
                                <div class="option-label">${option.label}</div>
                            </button>
                        `;
                    } else if (question.type === 'single') {
                        return `
                            <button class="option-button single-option ${this.answers[question.id] === option.value ? 'selected' : ''}" 
                                    onclick="quiz.handleAnswer('${question.id}', '${option.value}')">
                                <div class="option-content">
                                    <span class="option-emoji">${option.emoji}</span>
                                    <span class="option-label">${option.label}</span>
                                </div>
                            </button>
                        `;
                    } else if (question.type === 'multiple') {
                        const isSelected = (this.answers[question.id] || []).includes(option.value);
                        const currentSelections = this.answers[question.id] || [];
                        const maxReached = question.maxSelections && currentSelections.length >= question.maxSelections;
                        
                        return `
                            <button class="option-button multiple-option ${isSelected ? 'selected' : ''}" 
                                    ${!isSelected && maxReached ? 'disabled' : ''}
                                    onclick="quiz.handleMultipleAnswer('${question.id}', '${option.value}')">
                                <div class="option-content">
                                    <div class="option-left">
                                        <span class="option-emoji">${option.emoji}</span>
                                        <span class="option-label">${option.label}</span>
                                    </div>
                                    ${isSelected ? '<div class="check-icon">‚úì</div>' : ''}
                                </div>
                            </button>
                        `;
                    }
                }).join('');
            }

            handleMultipleAnswer(questionId, value) {
                const question = this.questions.find(q => q.id === questionId);
                const current = this.answers[questionId] || [];
                const isSelected = current.includes(value);
                const maxReached = question.maxSelections && current.length >= question.maxSelections;
                
                if (isSelected || !maxReached) {
                    const updated = isSelected 
                        ? current.filter(v => v !== value)
                        : [...current, value];
                    this.handleAnswer(questionId, updated);
                }
            }

            getScoreLabel(key) {
                const labels = {
                    'wellbeing': 'Benessere',
                    'health': 'Salute',
                    'professional': 'Lavoro',
                    'social': 'Sociale'
                };
                return labels[key] || key;
            }
        }

        // Initialize when page loads
        const quiz = new LifestyleQuiz();
        
        // Save profile and redirect function
        function saveProfileAndRedirect() {
            if (quiz.profile) {
                // Save to localStorage as backup
                localStorage.setItem('lifestyleQuizResults', JSON.stringify(quiz.profile));
                
                // Save to session manager if available
                const sessionManager = window.sessionManager || window.tribucoachSession;
                if (sessionManager) {
                    console.log('üíæ Salvando profilo su session manager...');
                    
                    const profileData = {
                        lifestyleProfile: quiz.profile,
                        lifestyleQuizCompleted: true,
                        lifestyleQuizCompletedAt: new Date().toISOString()
                    };
                    
                    sessionManager.updateUserData(profileData);
                    console.log('‚úÖ Profilo salvato su session manager');
                }
                
                // Save to Firebase
                saveToFirebase(quiz.profile);
                
                // Redirect intelligently based on auth state
                if (quiz.isAuthenticated) {
                    window.location.href = 'user-dashboard.html';
                } else {
                    window.location.href = 'user-dashboard.html';
                }
            }
        }
        
        // Firebase integration
        async function saveToFirebase(profileData) {
            try {
                console.log('üíæ Tentativo salvataggio Firebase...', profileData);
                
                // Check if Firebase is available
                if (!window.firebaseDB) {
                    console.error('‚ùå Firebase non disponibile');
                    return;
                }
                
                // Generate user ID
                const userId = profileData.userId || generateUserId();
                
                // Prepare data for Firebase
                const firebaseData = {
                    ...profileData,
                    userId: userId,
                    timestamp: window.firebaseServerTimestamp(),
                    source: 'lifestyle_quiz_6profiles_unified',
                    version: '2.1',
                    sessionManagerIntegrated: true,
                    
                    // Convert answers to serializable format
                    answers: quiz.answers,
                    
                    // Add metadata
                    userAgent: navigator.userAgent,
                    referrer: document.referrer,
                    completedAt: new Date().toISOString()
                };
                
                // Save to quiz_results collection
                const docRef = await window.firebaseAddDoc(
                    window.firebaseCollection(window.firebaseDB, 'quiz_results'), 
                    firebaseData
                );
                
                console.log('‚úÖ Profilo salvato su Firebase:', docRef.id);
                
                // Store IDs for dashboard
                localStorage.setItem('lifestyleProfileId', docRef.id);
                localStorage.setItem('lifestyleUserId', userId);
                
                // Also save to leads collection for admin dashboard
                await window.firebaseAddDoc(
                    window.firebaseCollection(window.firebaseDB, 'leads'), 
                    {
                        name: profileData.name || 'Utente Lifestyle',
                        email: profileData.email || '',
                        phone: profileData.phone || '',
                        gender: profileData.gender || '',
                        city: profileData.city || '',
                        source: 'lifestyle_quiz_6profiles_unified',
                        leadScore: calculateLeadScore(profileData),
                        status: 'new',
                        
                        // New 6-profile specific data
                        profileType: profileData.profileType,
                        profileName: profileData.profileData.name,
                        readinessLevel: profileData.insights.readinessLevel,
                        stressLevel: profileData.insights.stressLevel,
                        challenges: profileData.challenges,
                        scores: profileData.scores,
                        
                        // Session manager integration data
                        isAuthenticatedUser: profileData.isAuthenticatedUser,
                        sessionManagerUserId: profileData.userId,
                        
                        timestamp: window.firebaseServerTimestamp()
                    }
                );
                
                console.log('‚úÖ Lead salvato per dashboard admin');
                
            } catch (error) {
                console.error('‚ùå Errore salvataggio Firebase:', error);
                // Continue anyway, data is in localStorage and session manager
            }
        }
        
        function calculateLeadScore(profileData) {
            let score = 0;
            
            // Score based on readiness level (30 points max)
            if (profileData.insights.readinessLevel) {
                score += profileData.insights.readinessLevel * 6;
            }
            
            // Score based on profile type (25 points max)
            const profileScores = {
                'stressato_esaurito': 25,
                'procrastinatore_bloccato': 20,
                'perfezionista_insoddisfatto': 22,
                'dispersivo_confuso': 18,
                'motivato_inconsistente': 15,
                'equilibrato_ottimizzatore': 10
            };
            score += profileScores[profileData.profileType] || 15;
            
            // Score based on stress level (20 points max - higher stress = higher score)
            if (profileData.insights.stressLevel) {
                score += profileData.insights.stressLevel * 4;
            }
            
            // Score based on challenges (15 points max)
            if (profileData.challenges && profileData.challenges.length > 0) {
                score += Math.min(profileData.challenges.length * 5, 15);
            }
            
            // Score based on wellbeing scores (10 points max - lower scores = higher lead score)
            if (profileData.scores) {
                const avgScore = Object.values(profileData.scores).reduce((a, b) => a + b, 0) / Object.keys(profileData.scores).length;
                if (avgScore < 3) score += 10;
                else if (avgScore < 4) score += 5;
            }
            
            // Bonus for authenticated users (5 points)
            if (profileData.isAuthenticatedUser) {
                score += 5;
            }
            
            return Math.min(Math.max(score, 0), 100);
        }
        
        function generateUserId() {
            return 'user_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
        }
    </script>
</body>
</html>