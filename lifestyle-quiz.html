<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lifestyle Assessment Quiz</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #f8fafc 0%, #fff7ed 50%, #f0fdf4 100%);
            min-height: 100vh;
            line-height: 1.6;
        }

        .container {
            max-width: 1024px;
            margin: 0 auto;
            padding: 24px;
        }

        .quiz-card {
            background: white;
            border-radius: 24px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #1e293b 0%, #ea580c 100%);
            padding: 48px 32px;
            text-align: center;
            color: white;
        }

        .header h1 {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 8px;
        }

        .header p {
            font-size: 1.125rem;
            opacity: 0.9;
        }

        .content {
            padding: 32px;
        }

        .progress-section {
            margin-bottom: 32px;
        }

        .progress-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .progress-text {
            font-size: 0.875rem;
            font-weight: 500;
            color: #475569;
        }

        .progress-bar {
            width: 100%;
            height: 12px;
            background: #e2e8f0;
            border-radius: 6px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(135deg, #1e293b 0%, #ea580c 100%);
            transition: width 0.5s ease-out;
        }

        .progress-labels {
            display: flex;
            justify-content: space-between;
            margin-top: 8px;
        }

        .progress-label {
            font-size: 0.75rem;
            color: #64748b;
        }

        .question-card {
            background: linear-gradient(135deg, #f8fafc 0%, #fff7ed 100%);
            border-radius: 16px;
            padding: 32px;
            margin-bottom: 32px;
            border-left: 4px solid #ea580c;
        }

        .question-header {
            display: flex;
            align-items: flex-start;
            margin-bottom: 24px;
        }

        .question-icon {
            background: linear-gradient(135deg, #1e293b 0%, #ea580c 100%);
            border-radius: 50%;
            padding: 16px;
            color: white;
            margin-right: 24px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
            flex-shrink: 0;
        }

        .question-text {
            flex: 1;
        }

        .question-title {
            font-size: 1.5rem;
            font-weight: bold;
            color: #1e293b;
            margin-bottom: 8px;
        }

        .question-subtitle {
            font-size: 1.125rem;
            color: #475569;
            margin-bottom: 8px;
        }

        .question-description {
            font-size: 0.875rem;
            color: #ea580c;
            font-style: italic;
        }

        .options-container {
            display: grid;
            gap: 16px;
        }

        .scale-options {
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
        }

        .option-button {
            background: white;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            padding: 24px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .option-button:hover {
            transform: translateY(-2px);
            border-color: #cbd5e1;
        }

        .option-button.selected {
            border-color: #ea580c;
            background: #fff7ed;
            color: #ea580c;
            box-shadow: 0 4px 12px rgba(234, 88, 12, 0.2);
        }

        .option-emoji {
            font-size: 2rem;
            margin-bottom: 8px;
        }

        .option-value {
            font-size: 1.125rem;
            font-weight: bold;
            margin-bottom: 4px;
        }

        .option-label {
            font-size: 0.875rem;
        }

        .single-option {
            width: 100%;
            text-align: left;
        }

        .single-option .option-content {
            display: flex;
            align-items: center;
        }

        .single-option .option-emoji {
            font-size: 1.5rem;
            margin-right: 16px;
            margin-bottom: 0;
        }

        .single-option .option-label {
            font-size: 1.125rem;
        }

        .multiple-option {
            width: 100%;
            text-align: left;
        }

        .multiple-option .option-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .multiple-option .option-left {
            display: flex;
            align-items: center;
        }

        .multiple-option .option-emoji {
            font-size: 1.5rem;
            margin-right: 16px;
            margin-bottom: 0;
        }

        .multiple-option .option-label {
            font-size: 1.125rem;
        }

        .check-icon {
            width: 24px;
            height: 24px;
            color: #ea580c;
        }

        .selection-info {
            text-align: center;
            margin-top: 16px;
            font-size: 0.875rem;
            color: #64748b;
        }

        .navigation {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .nav-button {
            display: flex;
            align-items: center;
            padding: 16px 32px;
            border-radius: 12px;
            font-weight: 500;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1rem;
        }

        .nav-button:disabled {
            background: #f1f5f9;
            color: #94a3b8;
            cursor: not-allowed;
        }

        .nav-button.prev {
            background: #e2e8f0;
            color: #475569;
        }

        .nav-button.prev:hover:not(:disabled) {
            background: #cbd5e1;
        }

        .nav-button.next {
            background: linear-gradient(135deg, #1e293b 0%, #ea580c 100%);
            color: white;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        .nav-button.next:hover:not(:disabled) {
            background: linear-gradient(135deg, #0f172a 0%, #c2410c 100%);
        }

        .progress-dots {
            display: flex;
            gap: 8px;
        }

        .dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #cbd5e1;
            transition: all 0.3s ease;
        }

        .dot.current {
            background: #ea580c;
            width: 32px;
            border-radius: 4px;
        }

        .dot.completed {
            background: #16a34a;
        }

        /* Contact Form Styles */
        .contact-form {
            background: linear-gradient(135deg, #f8fafc 0%, #fff7ed 100%);
            border-radius: 16px;
            padding: 32px;
            margin-bottom: 32px;
            border-left: 4px solid #16a34a;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
            margin-bottom: 16px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group.full-width {
            grid-column: 1 / -1;
        }

        .form-label {
            font-size: 0.875rem;
            font-weight: 600;
            color: #1e293b;
            margin-bottom: 8px;
        }

        .form-label.required::after {
            content: " *";
            color: #ef4444;
        }

        .form-input {
            padding: 12px 16px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .form-input:focus {
            outline: none;
            border-color: #ea580c;
        }

        .form-select {
            padding: 12px 16px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 1rem;
            background: white;
            cursor: pointer;
            transition: border-color 0.3s ease;
        }

        .form-select:focus {
            outline: none;
            border-color: #ea580c;
        }

        .privacy-checkbox {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            margin-top: 20px;
        }

        .privacy-checkbox input[type="checkbox"] {
            width: 20px;
            height: 20px;
            margin-top: 2px;
            cursor: pointer;
        }

        .privacy-text {
            font-size: 0.875rem;
            color: #64748b;
            line-height: 1.5;
        }

        .whatsapp-preview {
            background: #dcfce7;
            border: 1px solid #16a34a;
            border-radius: 8px;
            padding: 16px;
            margin-top: 16px;
        }

        .whatsapp-preview-title {
            font-size: 0.875rem;
            font-weight: 600;
            color: #16a34a;
            margin-bottom: 8px;
        }

        .whatsapp-preview-text {
            font-size: 0.875rem;
            color: #15803d;
            font-style: italic;
        }

        /* Profile Page Styles */
        .profile-header {
            background: linear-gradient(135deg, #1e293b 0%, #ea580c 100%);
            padding: 48px 32px;
            text-align: center;
            color: white;
        }

        .profile-header h1 {
            font-size: 2.5rem;
            font-weight: bold;
            margin-bottom: 16px;
        }

        .profile-header p {
            font-size: 1.25rem;
            opacity: 0.9;
        }

        .profile-content {
            padding: 32px;
        }

        .profile-section {
            margin-bottom: 32px;
        }

        .profile-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 32px;
        }

        .profile-card {
            border-radius: 16px;
            padding: 32px;
            border-left: 4px solid;
        }

        .profile-card.primary {
            background: linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%);
            border-left-color: #1e293b;
        }

        .profile-card.secondary {
            background: linear-gradient(135deg, #fff7ed 0%, #fed7aa 100%);
            border-left-color: #ea580c;
        }

        .profile-card.success {
            background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);
            border-left-color: #16a34a;
        }

        .profile-card h3 {
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 16px;
        }

        .profile-card.primary h3 {
            color: #1e293b;
        }

        .profile-card.secondary h3 {
            color: #ea580c;
        }

        .profile-card.success h3 {
            color: #16a34a;
        }

        .profile-text {
            font-size: 1.125rem;
            margin-bottom: 12px;
        }

        .profile-description {
            color: #64748b;
            line-height: 1.6;
        }

        .readiness-meter {
            background: #fed7aa;
            border-radius: 8px;
            padding: 16px;
            margin-top: 16px;
        }

        .readiness-label {
            font-size: 0.875rem;
            color: #ea580c;
            margin-bottom: 8px;
        }

        .readiness-bar {
            width: 100%;
            height: 8px;
            background: #fef3c7;
            border-radius: 4px;
            overflow: hidden;
        }

        .readiness-fill {
            height: 100%;
            background: #ea580c;
            transition: width 0.3s ease;
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 24px;
        }

        .dashboard-item {
            text-align: center;
        }

        .dashboard-score {
            font-size: 2rem;
            font-weight: bold;
            color: #16a34a;
            margin-bottom: 8px;
        }

        .dashboard-label {
            font-size: 0.875rem;
            color: #16a34a;
            margin-bottom: 8px;
            text-transform: capitalize;
        }

        .dashboard-bar {
            width: 100%;
            height: 8px;
            background: #dcfce7;
            border-radius: 4px;
            overflow: hidden;
        }

        .dashboard-fill {
            height: 100%;
            background: #16a34a;
            transition: width 0.3s ease;
        }

        .list-container {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .list-item {
            display: flex;
            align-items: center;
            background: white;
            padding: 12px;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .list-icon {
            width: 20px;
            height: 20px;
            margin-right: 12px;
            color: #ea580c;
        }

        .list-text {
            color: #475569;
            text-transform: capitalize;
        }

        .cta-section {
            text-align: center;
            background: linear-gradient(135deg, #1e293b 0%, #ea580c 100%);
            border-radius: 16px;
            padding: 32px;
            color: white;
        }

        .cta-section h3 {
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 16px;
        }

        .cta-section p {
            opacity: 0.9;
            margin-bottom: 24px;
        }

        .cta-button {
            background: white;
            color: #1e293b;
            padding: 16px 32px;
            border-radius: 12px;
            font-weight: bold;
            border: none;
            cursor: pointer;
            font-size: 1.125rem;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        .cta-button:hover {
            background: #fff7ed;
        }

        @media (max-width: 768px) {
            .container {
                padding: 16px;
            }

            .header {
                padding: 32px 24px;
            }

            .header h1 {
                font-size: 1.5rem;
            }

            .content {
                padding: 24px;
            }

            .question-card {
                padding: 24px;
            }

            .question-header {
                flex-direction: column;
                text-align: center;
            }

            .question-icon {
                margin-right: 0;
                margin-bottom: 16px;
            }

            .scale-options {
                grid-template-columns: 1fr;
            }

            .nav-button {
                padding: 12px 24px;
            }

            .profile-grid {
                grid-template-columns: 1fr;
            }

            .form-row {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="quiz-card">
            <div id="quiz-container">
                <!-- Quiz content will be inserted here -->
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script type="module">
        // Import Firebase functions
        import { db } from './firebase.js';
        import { collection, addDoc, serverTimestamp } from 'https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js';
        
        // Make functions available globally
        window.firebaseDB = db;
        window.firebaseCollection = collection;
        window.firebaseAddDoc = addDoc;
        window.firebaseServerTimestamp = serverTimestamp;
    </script>
    
    <script>
        class LifestyleQuiz {
            constructor() {
                this.currentStep = 0;
                this.answers = {};
                this.contactData = {};
                this.profile = null;
                this.container = document.getElementById('quiz-container');
                this.showingContactForm = false;
                
                this.questions = [
                    {
                        id: 'behavioral_competence',
                        title: 'Competenza Comportamentale',
                        icon: '‚ö°',
                        question: 'Quanto sei sicuro di avere le competenze pratiche per raggiungere i tuoi obiettivi di stile di vita?',
                        subtitle: 'Valuta le tue abilit√† concrete',
                        type: 'scale',
                        category: 'assessment',
                        options: [
                            { value: 1, label: 'Per niente', emoji: 'üòü' },
                            { value: 2, label: 'Poco', emoji: 'üòê' },
                            { value: 3, label: 'Abbastanza', emoji: 'üôÇ' },
                            { value: 4, label: 'Molto', emoji: 'üòä' },
                            { value: 5, label: 'Completamente', emoji: 'ü§©' }
                        ]
                    },
                    {
                        id: 'transitional_competence',
                        title: 'Gestione del Cambiamento',
                        icon: 'üéØ',
                        question: 'Quanto sei bravo a gestire gli ostacoli emotivi e mentali durante i cambiamenti?',
                        subtitle: 'La tua resilienza nei momenti difficili',
                        type: 'scale',
                        category: 'assessment',
                        options: [
                            { value: 1, label: 'Molto difficile', emoji: 'üò∞' },
                            { value: 2, label: 'Difficile', emoji: 'üòï' },
                            { value: 3, label: 'Nella media', emoji: 'üòê' },
                            { value: 4, label: 'Abbastanza bravo', emoji: 'üòå' },
                            { value: 5, label: 'Molto bravo', emoji: 'üí™' }
                        ]
                    },
                    {
                        id: 'consciousness_level',
                        title: 'Livello di Coscienza',
                        icon: 'üß†',
                        question: 'Quale affermazione ti rappresenta di pi√π in questo momento della tua vita?',
                        subtitle: 'Il tuo approccio alla vita',
                        type: 'single',
                        category: 'personality',
                        options: [
                            { value: 1, label: 'Voglio risultati immediati e gratificazioni veloci', emoji: '‚ö°' },
                            { value: 2, label: 'Preferisco seguire regole chiare e tradizioni consolidate', emoji: 'üìã' },
                            { value: 3, label: 'Sono orientato al successo e ai risultati concreti', emoji: 'üéØ' },
                            { value: 4, label: 'Valorizzo la crescita personale e il benessere della comunit√†', emoji: 'üå±' }
                        ]
                    },
                    {
                        id: 'current_life_satisfaction',
                        title: 'Soddisfazione Attuale',
                        icon: '‚≠ê',
                        question: 'Come descriveresti il tuo livello di soddisfazione generale nella vita?',
                        subtitle: 'Il tuo stato emotivo generale',
                        type: 'scale',
                        category: 'wellbeing',
                        options: [
                            { value: 1, label: 'Molto insoddisfatto', emoji: 'üòî' },
                            { value: 2, label: 'Insoddisfatto', emoji: 'üòû' },
                            { value: 3, label: 'Neutrale', emoji: 'üòê' },
                            { value: 4, label: 'Soddisfatto', emoji: 'üòä' },
                            { value: 5, label: 'Molto soddisfatto', emoji: 'ü•∞' }
                        ]
                    },
                    {
                        id: 'motivation_driver',
                        title: 'Driver Motivazionali',
                        icon: '‚ù§Ô∏è',
                        question: 'Cosa ti motiva di pi√π nella vita? (seleziona fino a 3 opzioni)',
                        subtitle: 'Le tue fonti di energia principale',
                        type: 'multiple',
                        category: 'motivation',
                        maxSelections: 3,
                        options: [
                            { value: 'health', label: 'Salute e benessere fisico', emoji: 'üèÉ' },
                            { value: 'confidence', label: 'Fiducia in me stesso', emoji: 'üí™' },
                            { value: 'social', label: 'Essere apprezzato dagli altri', emoji: 'üë•' },
                            { value: 'achievement', label: 'Raggiungere obiettivi ambiziosi', emoji: 'üèÜ' },
                            { value: 'time', label: 'Risparmiare tempo ed essere efficiente', emoji: '‚è∞' },
                            { value: 'creativity', label: 'Esprimere la mia creativit√†', emoji: 'üé®' },
                            { value: 'family', label: 'Essere un buon genitore/partner', emoji: 'üë®‚Äçüë©‚Äçüëß' },
                            { value: 'money', label: 'Sicurezza finanziaria', emoji: 'üí∞' }
                        ]
                    },
                    {
                        id: 'current_challenges',
                        title: 'Sfide Attuali',
                        icon: 'üõ°Ô∏è',
                        question: 'Quali sono le tue principali sfide attuali? (seleziona tutte quelle che si applicano)',
                        subtitle: 'Gli ostacoli che vuoi superare',
                        type: 'multiple',
                        category: 'challenges',
                        options: [
                            { value: 'procrastination', label: 'Procrastinazione e rimandare', emoji: '‚è≥' },
                            { value: 'low_energy', label: 'Bassa energia e stanchezza', emoji: 'üò¥' },
                            { value: 'anxiety', label: 'Ansia e stress', emoji: 'üò∞' },
                            { value: 'low_self_esteem', label: 'Bassa autostima', emoji: 'üòî' },
                            { value: 'bad_habits', label: 'Cattive abitudini', emoji: 'üö´' },
                            { value: 'lack_focus', label: 'Mancanza di concentrazione', emoji: 'ü§Ø' },
                            { value: 'time_management', label: 'Gestione del tempo', emoji: '‚è∞' },
                            { value: 'work_life_balance', label: 'Equilibrio vita-lavoro', emoji: '‚öñÔ∏è' }
                        ]
                    },
                    {
                        id: 'daily_routine',
                        title: 'Routine Quotidiana',
                        icon: 'üïê',
                        question: 'Come descriveresti la tua routine quotidiana attuale?',
                        subtitle: 'Il tuo ritmo di vita',
                        type: 'single',
                        category: 'lifestyle',
                        options: [
                            { value: 'chaotic', label: 'Caotica, ogni giorno √® diverso', emoji: 'üå™Ô∏è' },
                            { value: 'loose', label: 'Flessibile, con alcuni punti fissi', emoji: 'üåä' },
                            { value: 'structured', label: 'Strutturata, con orari definiti', emoji: 'üìÖ' },
                            { value: 'rigid', label: 'Rigida, seguo sempre lo stesso schema', emoji: 'üóìÔ∏è' }
                        ]
                    },
                    {
                        id: 'goal_setting_history',
                        title: 'Esperienza con gli Obiettivi',
                        icon: 'üìà',
                        question: 'Qual √® la tua esperienza nel raggiungere gli obiettivi che ti poni?',
                        subtitle: 'Il tuo track record',
                        type: 'single',
                        category: 'achievement',
                        options: [
                            { value: 'rarely', label: 'Raramente li raggiungo', emoji: 'üòû' },
                            { value: 'sometimes', label: 'A volte li raggiungo', emoji: 'üòê' },
                            { value: 'often', label: 'Spesso li raggiungo', emoji: 'üòä' },
                            { value: 'always', label: 'Li raggiungo quasi sempre', emoji: 'üèÜ' }
                        ]
                    },
                    {
                        id: 'support_system',
                        title: 'Sistema di Supporto',
                        icon: 'üë•',
                        question: 'Quanto supporto senti di avere dalle persone intorno a te?',
                        subtitle: 'La tua rete di sostegno',
                        type: 'scale',
                        category: 'social',
                        options: [
                            { value: 1, label: 'Nessun supporto', emoji: 'üòî' },
                            { value: 2, label: 'Poco supporto', emoji: 'üòï' },
                            { value: 3, label: 'Supporto moderato', emoji: 'üôÇ' },
                            { value: 4, label: 'Buon supporto', emoji: 'üòä' },
                            { value: 5, label: 'Supporto eccellente', emoji: 'ü•∞' }
                        ]
                    },
                    {
                        id: 'physical_activity',
                        title: 'Attivit√† Fisica',
                        icon: 'üí™',
                        question: 'Quanto spesso fai attivit√† fisica attualmente?',
                        subtitle: 'Il tuo livello di movimento',
                        type: 'single',
                        category: 'health',
                        options: [
                            { value: 'never', label: 'Mai o quasi mai', emoji: 'üõãÔ∏è' },
                            { value: 'rarely', label: 'Raramente (1-2 volte al mese)', emoji: 'üö∂' },
                            { value: 'sometimes', label: 'Qualche volta (1-2 volte a settimana)', emoji: 'üèÉ' },
                            { value: 'regularly', label: 'Regolarmente (3-4 volte a settimana)', emoji: 'üí™' },
                            { value: 'daily', label: 'Quotidianamente', emoji: 'üèãÔ∏è' }
                        ]
                    },
                    {
                        id: 'sleep_quality',
                        title: 'Qualit√† del Sonno',
                        icon: 'üåô',
                        question: 'Come valuti la qualit√† del tuo sonno?',
                        subtitle: 'Il tuo riposo notturno',
                        type: 'scale',
                        category: 'health',
                        options: [
                            { value: 1, label: 'Pessima', emoji: 'üò¥' },
                            { value: 2, label: 'Scarsa', emoji: 'üò™' },
                            { value: 3, label: 'Nella media', emoji: 'üòê' },
                            { value: 4, label: 'Buona', emoji: 'üòå' },
                            { value: 5, label: 'Eccellente', emoji: 'üõå' }
                        ]
                    },
                    {
                        id: 'stress_management',
                        title: 'Gestione dello Stress',
                        icon: 'üß≠',
                        question: 'Come gestisci tipicamente lo stress?',
                        subtitle: 'Le tue strategie di coping',
                        type: 'multiple',
                        category: 'coping',
                        options: [
                            { value: 'exercise', label: 'Esercizio fisico', emoji: 'üèÉ' },
                            { value: 'meditation', label: 'Meditazione/mindfulness', emoji: 'üßò' },
                            { value: 'social', label: 'Parlare con amici/famiglia', emoji: 'üë•' },
                            { value: 'hobbies', label: 'Hobby e attivit√† creative', emoji: 'üé®' },
                            { value: 'avoid', label: 'Evito le situazioni stressanti', emoji: 'üö´' },
                            { value: 'work', label: 'Mi butto nel lavoro', emoji: 'üíº' },
                            { value: 'food', label: 'Mangiare (comfort food)', emoji: 'üç´' },
                            { value: 'nothing', label: 'Non ho strategie specifiche', emoji: 'ü§∑' }
                        ]
                    },
                    {
                        id: 'self_care_emotional',
                        title: 'Self-Care Emotivo',
                        icon: '‚ù§Ô∏è',
                        question: 'Quanto tempo dedichi al tuo benessere emotivo?',
                        subtitle: 'La cura delle tue emozioni',
                        type: 'scale',
                        category: 'selfcare',
                        options: [
                            { value: 1, label: 'Mai', emoji: 'üòû' },
                            { value: 2, label: 'Raramente', emoji: 'üòï' },
                            { value: 3, label: 'Qualche volta', emoji: 'üòê' },
                            { value: 4, label: 'Spesso', emoji: 'üòä' },
                            { value: 5, label: 'Sempre', emoji: 'ü•∞' }
                        ]
                    },
                    {
                        id: 'work_satisfaction',
                        title: 'Soddisfazione Professionale',
                        icon: '‚òï',
                        question: 'Quanto sei soddisfatto della tua situazione lavorativa/professionale?',
                        subtitle: 'Il tuo rapporto con il lavoro',
                        type: 'scale',
                        category: 'professional',
                        options: [
                            { value: 1, label: 'Molto insoddisfatto', emoji: 'üò´' },
                            { value: 2, label: 'Insoddisfatto', emoji: 'üòû' },
                            { value: 3, label: 'Neutrale', emoji: 'üòê' },
                            { value: 4, label: 'Soddisfatto', emoji: 'üòä' },
                            { value: 5, label: 'Molto soddisfatto', emoji: 'ü§©' }
                        ]
                    },
                    {
                        id: 'learning_growth',
                        title: 'Crescita Personale',
                        icon: 'üí°',
                        question: 'Quanto √® importante per te la crescita personale e l\'apprendimento continuo?',
                        subtitle: 'Il tuo desiderio di miglioramento',
                        type: 'scale',
                        category: 'growth',
                        options: [
                            { value: 1, label: 'Per niente importante', emoji: 'üòë' },
                            { value: 2, label: 'Poco importante', emoji: 'üòê' },
                            { value: 3, label: 'Abbastanza importante', emoji: 'üôÇ' },
                            { value: 4, label: 'Molto importante', emoji: 'üòä' },
                            { value: 5, label: 'Fondamentale', emoji: 'ü§©' }
                        ]
                    },
                    {
                        id: 'relationship_quality',
                        title: 'Qualit√† delle Relazioni',
                        icon: 'üë•',
                        question: 'Come valuti la qualit√† delle tue relazioni personali?',
                        subtitle: 'I tuoi rapporti interpersonali',
                        type: 'scale',
                        category: 'social',
                        options: [
                            { value: 1, label: 'Pessima', emoji: 'üíî' },
                            { value: 2, label: 'Scarsa', emoji: 'üòû' },
                            { value: 3, label: 'Nella media', emoji: 'üòê' },
                            { value: 4, label: 'Buona', emoji: 'üòä' },
                            { value: 5, label: 'Eccellente', emoji: 'üíï' }
                        ]
                    },
                    {
                        id: 'decision_making',
                        title: 'Processo Decisionale',
                        icon: 'üß©',
                        question: 'Come prendi solitamente le decisioni importanti?',
                        subtitle: 'Il tuo stile decisionale',
                        type: 'single',
                        category: 'personality',
                        options: [
                            { value: 'intuitive', label: 'Seguo l\'istinto e le emozioni', emoji: 'üí≠' },
                            { value: 'analytical', label: 'Analizzo tutti i pro e contro', emoji: 'üìä' },
                            { value: 'social', label: 'Chiedo consigli ad altri', emoji: 'üë•' },
                            { value: 'avoid', label: 'Rimando finch√© non sono costretto', emoji: '‚è≥' }
                        ]
                    },
                    {
                        id: 'time_perspective',
                        title: 'Prospettiva Temporale',
                        icon: 'üìÖ',
                        question: 'Su quale orizzonte temporale ti concentri di pi√π?',
                        subtitle: 'La tua visione del tempo',
                        type: 'single',
                        category: 'mindset',
                        options: [
                            { value: 'past', label: 'Rifletto spesso sul passato', emoji: '‚è™' },
                            { value: 'present', label: 'Vivo nel momento presente', emoji: 'üéØ' },
                            { value: 'near_future', label: 'Pianifico i prossimi mesi', emoji: 'üìÖ' },
                            { value: 'far_future', label: 'Penso a lungo termine (anni)', emoji: 'üîÆ' }
                        ]
                    },
                    {
                        id: 'home_environment',
                        title: 'Ambiente Domestico',
                        icon: 'üè†',
                        question: 'Come descriveresti il tuo ambiente domestico?',
                        subtitle: 'Il tuo spazio personale',
                        type: 'single',
                        category: 'environment',
                        options: [
                            { value: 'chaotic', label: 'Caotico e disorganizzato', emoji: 'üå™Ô∏è' },
                            { value: 'messy', label: 'Un po\' disordinato ma vivibile', emoji: 'üè†' },
                            { value: 'organized', label: 'Organizzato e pulito', emoji: 'üè°' },
                            { value: 'minimalist', label: 'Minimalista e zen', emoji: 'üßò' }
                        ]
                    },
                    {
                        id: 'coaching_readiness',
                        title: 'Apertura al Coaching',
                        icon: 'üß≠',
                        question: 'Quanto sei pronto a impegnarti in un percorso di coaching strutturato?',
                        subtitle: 'Il tuo livello di commitment',
                        type: 'scale',
                        category: 'readiness',
                        options: [
                            { value: 1, label: 'Per niente pronto', emoji: 'üòë' },
                            { value: 2, label: 'Un po\' scettico', emoji: 'ü§î' },
                            { value: 3, label: 'Curioso di provare', emoji: 'üòä' },
                            { value: 4, label: 'Molto motivato', emoji: 'üí™' },
                            { value: 5, label: 'Completamente pronto', emoji: 'üöÄ' }
                        ]
                    }
                ];
                
                this.init();
            }

            init() {
                this.render();
            }

            handleAnswer(questionId, value) {
                this.answers[questionId] = value;
                this.render();
            }

            handleNext() {
                if (this.currentStep < this.questions.length - 1) {
                    this.currentStep++;
                    this.render();
                } else {
                    this.showContactForm();
                }
            }

            handlePrevious() {
                if (this.showingContactForm) {
                    this.showingContactForm = false;
                    this.render();
                } else if (this.currentStep > 0) {
                    this.currentStep--;
                    this.render();
                }
            }

            showContactForm() {
                this.showingContactForm = true;
                this.render();
            }

            handleContactSubmit() {
                // Validate required fields
                const name = document.getElementById('contactName').value.trim();
                const phone = document.getElementById('contactPhone').value.trim();
                const gender = document.getElementById('contactGender').value;
                const privacy = document.getElementById('privacyConsent').checked;

                if (!name || !phone || !gender || !privacy) {
                    alert('Compila tutti i campi obbligatori e accetta l\'informativa privacy.');
                    return;
                }

                // Save contact data
                this.contactData = {
                    name: name,
                    phone: phone,
                    gender: gender,
                    email: document.getElementById('contactEmail').value.trim(),
                    city: document.getElementById('contactCity').value.trim(),
                    privacyConsent: privacy
                };

                // Generate profile
                this.generateProfile();
            }

            generateProfile() {
                const behavioral = this.answers.behavioral_competence || 3;
                const transitional = this.answers.transitional_competence || 3;
                const consciousness = this.answers.consciousness_level || 2;
                const readiness = this.answers.coaching_readiness || 3;
                
                let quadrant = '';
                let approach = '';
                
                if (behavioral >= 4 && transitional >= 4) {
                    quadrant = 'Q1: Coaching Opzionale';
                    approach = 'Hai gi√† ottime competenze. Il coaching pu√≤ aiutarti a raggiungere livelli ancora pi√π elevati.';
                } else if (behavioral >= 4 && transitional < 4) {
                    quadrant = 'Q2: Training Tecnico';
                    approach = 'Hai competenze pratiche ma devi lavorare sulla gestione emotiva del cambiamento.';
                } else if (behavioral < 4 && transitional >= 4) {
                    quadrant = 'Q3: Coaching Emotivo';
                    approach = 'Sei bravo nella gestione emotiva ma hai bisogno di competenze pratiche specifiche.';
                } else {
                    quadrant = 'Q4: Coaching Completo';
                    approach = 'Beneficerai di un approccio completo che combina coaching e training pratico.';
                }

                const consciousnessLabels = {
                    1: 'Opportunista - Risultati Immediati',
                    2: 'Conformista - Struttura e Regole', 
                    3: 'Achiever - Successo e Performance',
                    4: 'Pluralista - Crescita e Benessere'
                };

                const wellbeingScore = Math.round(((this.answers.current_life_satisfaction || 3) + 
                                                  (this.answers.sleep_quality || 3) + 
                                                  (this.answers.self_care_emotional || 3)) / 3);
                
                const healthScore = Math.round(((this.getPhysicalActivityScore() + 
                                              (this.answers.sleep_quality || 3)) / 2));

                const professionalScore = this.answers.work_satisfaction || 3;
                const socialScore = Math.round(((this.answers.support_system || 3) + 
                                               (this.answers.relationship_quality || 3)) / 2);

                this.profile = {
                    ...this.contactData,
                    quadrant,
                    approach,
                    consciousnessLevel: consciousnessLabels[consciousness],
                    motivationDrivers: this.answers.motivation_driver || [],
                    challenges: this.answers.current_challenges || [],
                    readinessLevel: readiness,
                    scores: {
                        wellbeing: wellbeingScore,
                        health: healthScore,
                        professional: professionalScore,
                        social: socialScore
                    },
                    insights: {
                        goalAchievement: this.answers.goal_setting_history,
                        stressCoping: this.answers.stress_management || [],
                        timeOrientation: this.answers.time_perspective,
                        decisionStyle: this.answers.decision_making
                    }
                };
                
                this.render();
            }

            getPhysicalActivityScore() {
                const activity = this.answers.physical_activity;
                switch(activity) {
                    case 'daily': return 5;
                    case 'regularly': return 4;
                    case 'sometimes': return 3;
                    case 'rarely': return 2;
                    default: return 1;
                }
            }

            render() {
                if (this.profile) {
                    this.renderProfile();
                } else if (this.showingContactForm) {
                    this.renderContactForm();
                } else {
                    this.renderQuestion();
                }
            }

            renderContactForm() {
                const progress = 95; // Almost done
                
                this.container.innerHTML = `
                    <div class="header">
                        <h1>üë§ I Tuoi Dati</h1>
                        <p>Ultimi dettagli per personalizzare il tuo percorso</p>
                    </div>
                    
                    <div class="content">
                        <div class="progress-section">
                            <div class="progress-header">
                                <span class="progress-text">Quasi finito!</span>
                                <span class="progress-text">20 di 20 ‚úì</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: ${progress}%"></div>
                            </div>
                            <div class="progress-labels">
                                <span class="progress-label">Inizio</span>
                                <span class="progress-label">Completamento</span>
                            </div>
                        </div>
                        
                        <div class="contact-form">
                            <div class="question-header">
                                <div class="question-icon">‚ú®</div>
                                <div class="question-text">
                                    <h2 class="question-title">Conosciamoci Meglio</h2>
                                    <p class="question-subtitle">Questi dati mi aiutano a personalizzare il tuo percorso</p>
                                    <p class="question-description">Tutti i tuoi dati saranno trattati secondo il GDPR</p>
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label required" for="contactName">Nome</label>
                                    <input type="text" id="contactName" class="form-input" placeholder="Il tuo nome" required>
                                </div>
                                <div class="form-group">
                                    <label class="form-label required" for="contactPhone">Telefono</label>
                                    <input type="tel" id="contactPhone" class="form-input" placeholder="+39 123 456 7890" required>
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label required" for="contactGender">Sesso</label>
                                    <select id="contactGender" class="form-select" required>
                                        <option value="">Seleziona...</option>
                                        <option value="M">Maschio</option>
                                        <option value="F">Femmina</option>
                                        <option value="Other">Altro</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label class="form-label" for="contactEmail">Email (opzionale)</label>
                                    <input type="email" id="contactEmail" class="form-input" placeholder="tua@email.com">
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group full-width">
                                    <label class="form-label" for="contactCity">Citt√† (opzionale)</label>
                                    <input type="text" id="contactCity" class="form-input" placeholder="La tua citt√†">
                                </div>
                            </div>
                            
                            <div class="privacy-checkbox">
                                <input type="checkbox" id="privacyConsent" required>
                                <label for="privacyConsent" class="privacy-text">
                                    Accetto l'<strong>informativa privacy</strong> e autorizzo il trattamento dei miei dati personali per ricevere il percorso di coaching personalizzato e comunicazioni relative al servizio.
                                </label>
                            </div>
                            
                            <div class="whatsapp-preview">
                                <div class="whatsapp-preview-title">üì± Messaggio WhatsApp che riceverai:</div>
                                <div class="whatsapp-preview-text">
                                    "Ciao [Nome]! üëã Sono Andrea, il tuo Lifestyle Coach. Ho preparato il tuo percorso personalizzato di trasformazione. Accedi qui per iniziare: [link dashboard]"
                                </div>
                            </div>
                        </div>
                        
                        <div class="navigation">
                            <button class="nav-button prev" onclick="quiz.handlePrevious()">
                                ‚Üê Indietro
                            </button>
                            
                            <div class="progress-dots">
                                <div class="dot completed"></div>
                                <div class="dot completed"></div>
                                <div class="dot completed"></div>
                                <div class="dot completed"></div>
                                <div class="dot completed"></div>
                                <div class="dot completed"></div>
                                <div class="dot completed"></div>
                                <div class="dot current"></div>
                            </div>
                            
                            <button class="nav-button next" onclick="quiz.handleContactSubmit()">
                                üéØ Genera il Mio Profilo ‚Üí
                            </button>
                        </div>
                    </div>
                `;
            }

            renderProfile() {
                this.container.innerHTML = `
                    <div class="profile-header">
                        <h1>üéØ Ciao ${this.profile.name}!</h1>
                        <p>Il tuo profilo lifestyle personalizzato √® pronto</p>
                    </div>
                    <div class="profile-content">
                        <div class="profile-section">
                            <div class="profile-grid">
                                <div class="profile-card primary">
                                    <h3>üìä Il Tuo Quadrante</h3>
                                    <p class="profile-text">${this.profile.quadrant}</p>
                                    <p class="profile-description">${this.profile.approach}</p>
                                </div>
                                <div class="profile-card secondary">
                                    <h3>üß† Livello di Coscienza</h3>
                                    <p class="profile-text">${this.profile.consciousnessLevel}</p>
                                    <div class="readiness-meter">
                                        <div class="readiness-label">Motivazione: ${this.profile.readinessLevel}/5</div>
                                        <div class="readiness-bar">
                                            <div class="readiness-fill" style="width: ${(this.profile.readinessLevel / 5) * 100}%"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="profile-section">
                            <div class="profile-card success">
                                <h3>üìà Le Tue Aree di Valutazione</h3>
                                <div class="dashboard-grid">
                                    ${Object.entries(this.profile.scores).map(([key, score]) => `
                                        <div class="dashboard-item">
                                            <div class="dashboard-score">${score}/5</div>
                                            <div class="dashboard-label">${this.getScoreLabel(key)}</div>
                                            <div class="dashboard-bar">
                                                <div class="dashboard-fill" style="width: ${(score / 5) * 100}%"></div>
                                            </div>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                        </div>
                        
                        <div class="profile-section">
                            <div class="profile-grid">
                                ${this.profile.motivationDrivers.length > 0 ? `
                                    <div class="profile-card secondary">
                                        <h3>üí™ Tue Motivazioni</h3>
                                        <div class="list-container">
                                            ${this.profile.motivationDrivers.slice(0, 3).map(driver => `
                                                <div class="list-item">
                                                    <div class="list-icon">‚úì</div>
                                                    <div class="list-text">${driver}</div>
                                                </div>
                                            `).join('')}
                                        </div>
                                    </div>
                                ` : ''}
                                
                                ${this.profile.challenges.length > 0 ? `
                                    <div class="profile-card primary">
                                        <h3>‚ö° Sfide da Superare</h3>
                                        <div class="list-container">
                                            ${this.profile.challenges.slice(0, 3).map(challenge => `
                                                <div class="list-item">
                                                    <div class="list-icon">üéØ</div>
                                                    <div class="list-text">${challenge}</div>
                                                </div>
                                            `).join('')}
                                        </div>
                                    </div>
                                ` : ''}
                            </div>
                        </div>
                        
                        <div class="profile-section">
                            <div class="cta-section">
                                <h3>üöÄ Inizia Ora la Tua Trasformazione</h3>
                                <p>Il tuo percorso personalizzato di 7 settimane ti aspetta nella dashboard</p>
                                <button class="cta-button" onclick="saveProfileAndRedirect()">
                                    üéØ Accedi alla Tua Dashboard Personale
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }

            renderQuestion() {
                const currentQuestion = this.questions[this.currentStep];
                const progress = ((this.currentStep + 1) / this.questions.length) * 100;
                const canProceed = this.answers[currentQuestion.id] !== undefined;
                const isLastStep = this.currentStep === this.questions.length - 1;

                this.container.innerHTML = `
                    <div class="header">
                        <h1>üéØ Lifestyle Assessment</h1>
                        <p>Scopri il tuo profilo personalizzato in 20 domande</p>
                    </div>
                    
                    <div class="content">
                        <div class="progress-section">
                            <div class="progress-header">
                                <span class="progress-text">Progresso</span>
                                <span class="progress-text">${this.currentStep + 1} di ${this.questions.length}</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: ${progress}%"></div>
                            </div>
                            <div class="progress-labels">
                                <span class="progress-label">Inizio</span>
                                <span class="progress-label">Fine</span>
                            </div>
                        </div>
                        
                        <div class="question-card">
                            <div class="question-header">
                                <div class="question-icon">
                                    ${currentQuestion.icon}
                                </div>
                                <div class="question-text">
                                    <h2 class="question-title">${currentQuestion.title}</h2>
                                    <p class="question-subtitle">${currentQuestion.question}</p>
                                    <p class="question-description">${currentQuestion.subtitle}</p>
                                </div>
                            </div>
                            
                            <div class="options-container ${currentQuestion.type === 'scale' ? 'scale-options' : ''}">
                                ${this.renderOptions(currentQuestion)}
                            </div>
                            
                            ${currentQuestion.maxSelections ? `
                                <div class="selection-info">
                                    Seleziona fino a ${currentQuestion.maxSelections} opzioni
                                    (${(this.answers[currentQuestion.id] || []).length}/${currentQuestion.maxSelections})
                                </div>
                            ` : ''}
                        </div>
                        
                        <div class="navigation">
                            <button class="nav-button prev" ${this.currentStep === 0 ? 'disabled' : ''} onclick="quiz.handlePrevious()">
                                ‚Üê Precedente
                            </button>
                            
                            <div class="progress-dots">
                                ${this.questions.map((_, index) => `
                                    <div class="dot ${index === this.currentStep ? 'current' : index < this.currentStep ? 'completed' : ''}"></div>
                                `).join('')}
                            </div>
                            
                            <button class="nav-button next" ${!canProceed ? 'disabled' : ''} onclick="quiz.handleNext()">
                                ${isLastStep ? 'Avanti' : 'Avanti'} ‚Üí
                            </button>
                        </div>
                    </div>
                `;
            }

            renderOptions(question) {
                return question.options.map(option => {
                    if (question.type === 'scale') {
                        return `
                            <button class="option-button ${this.answers[question.id] === option.value ? 'selected' : ''}" 
                                    onclick="quiz.handleAnswer('${question.id}', ${option.value})">
                                <div class="option-emoji">${option.emoji}</div>
                                <div class="option-value">${option.value}</div>
                                <div class="option-label">${option.label}</div>
                            </button>
                        `;
                    } else if (question.type === 'single') {
                        return `
                            <button class="option-button single-option ${this.answers[question.id] === option.value ? 'selected' : ''}" 
                                    onclick="quiz.handleAnswer('${question.id}', '${option.value}')">
                                <div class="option-content">
                                    <span class="option-emoji">${option.emoji}</span>
                                    <span class="option-label">${option.label}</span>
                                </div>
                            </button>
                        `;
                    } else if (question.type === 'multiple') {
                        const isSelected = (this.answers[question.id] || []).includes(option.value);
                        const currentSelections = this.answers[question.id] || [];
                        const maxReached = question.maxSelections && currentSelections.length >= question.maxSelections;
                        
                        return `
                            <button class="option-button multiple-option ${isSelected ? 'selected' : ''}" 
                                    ${!isSelected && maxReached ? 'disabled' : ''}
                                    onclick="quiz.handleMultipleAnswer('${question.id}', '${option.value}')">
                                <div class="option-content">
                                    <div class="option-left">
                                        <span class="option-emoji">${option.emoji}</span>
                                        <span class="option-label">${option.label}</span>
                                    </div>
                                    ${isSelected ? '<div class="check-icon">‚úì</div>' : ''}
                                </div>
                            </button>
                        `;
                    }
                }).join('');
            }

            handleMultipleAnswer(questionId, value) {
                const question = this.questions.find(q => q.id === questionId);
                const current = this.answers[questionId] || [];
                const isSelected = current.includes(value);
                const maxReached = question.maxSelections && current.length >= question.maxSelections;
                
                if (isSelected || !maxReached) {
                    const updated = isSelected 
                        ? current.filter(v => v !== value)
                        : [...current, value];
                    this.handleAnswer(questionId, updated);
                }
            }

            getScoreLabel(key) {
                const labels = {
                    'wellbeing': 'Benessere',
                    'health': 'Salute',
                    'professional': 'Lavoro',
                    'social': 'Sociale'
                };
                return labels[key] || key;
            }
        }

        // Initialize when page loads
        const quiz = new LifestyleQuiz();
        
        // Save profile and redirect function
        function saveProfileAndRedirect() {
            if (quiz.profile) {
                // Save to localStorage as backup
                localStorage.setItem('lifestyleQuizResults', JSON.stringify(quiz.profile));
                
                // Save to Firebase
                saveToFirebase(quiz.profile);
                
                // Redirect to user dashboard
                window.location.href = 'user-dashboard.html';
            }
        }
        
        // Firebase integration
        async function saveToFirebase(profileData) {
            try {
                console.log('üíæ Tentativo salvataggio Firebase...', profileData);
                
                // Check if Firebase is available
                if (!window.firebaseDB) {
                    console.error('‚ùå Firebase non disponibile');
                    return;
                }
                
                // Generate user ID
                const userId = generateUserId();
                
                // Prepare data for Firebase
                const firebaseData = {
                    ...profileData,
                    userId: userId,
                    timestamp: window.firebaseServerTimestamp(),
                    source: 'lifestyle_quiz',
                    version: '1.0',
                    
                    // Convert answers to serializable format
                    answers: quiz.answers,
                    
                    // Add metadata
                    userAgent: navigator.userAgent,
                    referrer: document.referrer,
                    completedAt: new Date().toISOString()
                };
                
                // Save to quiz_results collection
                const docRef = await window.firebaseAddDoc(
                    window.firebaseCollection(window.firebaseDB, 'quiz_results'), 
                    firebaseData
                );
                
                console.log('‚úÖ Profilo salvato su Firebase:', docRef.id);
                
                // Store IDs for dashboard
                localStorage.setItem('lifestyleProfileId', docRef.id);
                localStorage.setItem('lifestyleUserId', userId);
                
                // Also save to leads collection for admin dashboard
                await window.firebaseAddDoc(
                    window.firebaseCollection(window.firebaseDB, 'leads'), 
                    {
                        name: profileData.name || 'Utente Lifestyle',
                        email: profileData.email || '',
                        phone: profileData.phone || '',
                        gender: profileData.gender || '',
                        city: profileData.city || '',
                        source: 'lifestyle_quiz',
                        leadScore: calculateLeadScore(profileData),
                        status: 'new',
                        
                        // Lifestyle specific data
                        quadrant: profileData.quadrant,
                        consciousnessLevel: profileData.consciousnessLevel,
                        readinessLevel: profileData.readinessLevel,
                        challenges: profileData.challenges,
                        scores: profileData.scores,
                        
                        timestamp: window.firebaseServerTimestamp()
                    }
                );
                
                console.log('‚úÖ Lead salvato per dashboard admin');
                
            } catch (error) {
                console.error('‚ùå Errore salvataggio Firebase:', error);
                // Continue anyway, data is in localStorage
            }
        }
        
        function calculateLeadScore(profileData) {
            let score = 0;
            
            // Score based on readiness level (30 points max)
            if (profileData.readinessLevel) {
                score += profileData.readinessLevel * 6;
            }
            
            // Score based on quadrant (25 points max)
            if (profileData.quadrant) {
                if (profileData.quadrant.includes('Q4')) score += 25;
                else if (profileData.quadrant.includes('Q3')) score += 20;
                else if (profileData.quadrant.includes('Q2')) score += 15;
                else if (profileData.quadrant.includes('Q1')) score += 10;
            }
            
            // Score based on consciousness level (20 points max)
            if (profileData.consciousnessLevel) {
                if (profileData.consciousnessLevel.includes('Pluralista')) score += 20;
                else if (profileData.consciousnessLevel.includes('Achiever')) score += 15;
                else if (profileData.consciousnessLevel.includes('Conformista')) score += 10;
                else if (profileData.consciousnessLevel.includes('Opportunista')) score += 5;
            }
            
            // Score based on challenges (15 points max)
            if (profileData.challenges && profileData.challenges.length > 0) {
                score += Math.min(profileData.challenges.length * 3, 15);
            }
            
            // Score based on wellbeing scores (10 points max)
            if (profileData.scores) {
                const avgScore = Object.values(profileData.scores).reduce((a, b) => a + b, 0) / Object.keys(profileData.scores).length;
                if (avgScore < 3) score += 10;
                else if (avgScore < 4) score += 5;
            }
            
            return Math.min(Math.max(score, 0), 100);
        }
        
        function generateUserId() {
            return 'user_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
        }
    </script>
</body>
</html>