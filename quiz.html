<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz TribuCoach - Analisi Completa del Profilo Fitness</title>
    <meta name="description" content="Quiz avanzato per analizzare il tuo profilo fitness completo e ricevere un piano personalizzato da TribuCoach">
    
    <style>
        /* Stili CSS esistenti */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #000 0%, #1a1a1a 100%);
            color: #fff;
            min-height: 100vh;
            line-height: 1.6;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
        }

        .header h1 {
            font-size: 2.8rem;
            background: linear-gradient(135deg, #ff6600, #ff9933);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 15px;
        }

        .header p {
            font-size: 1.1rem;
            color: #ccc;
        }

        .progress-bar-container {
            width: 100%;
            background-color: #333;
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 30px;
            height: 15px;
        }

        .progress-bar {
            height: 100%;
            width: 0%;
            background: linear-gradient(90deg, #ff6600, #ff9933);
            border-radius: 10px;
            transition: width 0.4s ease-in-out;
        }

        .quiz-card {
            background-color: #1c1c1c;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.4);
            position: relative;
            overflow: hidden; /* Nasconde le domande fuori schermo */
            min-height: 500px; /* Altezza minima per contenere le domande */
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .question-container {
            display: none; /* Inizialmente nascosto */
            animation: fadeIn 0.5s ease-out forwards;
            padding-bottom: 20px; /* Spazio per i bottoni */
        }

        .question-container.active {
            display: block; /* Mostra la domanda attiva */
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .section-intro {
            background-color: #2a2a2a;
            padding: 15px 20px;
            border-left: 5px solid #ff6600;
            border-radius: 8px;
            margin-bottom: 25px;
        }

        .section-intro h3 {
            color: #ff6600;
            font-size: 1.3rem;
            margin-bottom: 5px;
        }

        .section-intro p {
            font-size: 0.95rem;
            color: #ccc;
        }


        .question-title {
            color: #ff6600;
            font-size: 1.8rem;
            margin-bottom: 10px;
            text-align: center;
        }

        .question-subtitle {
            font-size: 1rem;
            color: #bbb;
            margin-bottom: 25px;
            text-align: center;
        }

        /* Stili per input */
        .input-group {
            margin-bottom: 20px;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            color: #ccc;
            font-weight: bold;
        }

        .input-group input[type="text"],
        .input-group input[type="email"],
        .input-group input[type="number"],
        .input-group input[type="tel"] {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #444;
            border-radius: 8px;
            background-color: #333;
            color: #fff;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .input-group input[type="text"]:focus,
        .input-group input[type="email"]:focus,
        .input-group input[type="number"]:focus,
        .input-group input[type="tel"]:focus {
            outline: none;
            border-color: #ff6600;
        }

        .input-group input::placeholder {
            color: #888;
        }

        /* Stili per radio buttons (selezione singola) */
        .option-group {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .option-item {
            background-color: #2a2a2a;
            border: 1px solid #444;
            border-radius: 10px;
            padding: 15px 20px;
            cursor: pointer;
            transition: background-color 0.3s ease, border-color 0.3s ease;
            display: flex;
            align-items: center;
        }

        .option-item:hover {
            background-color: #3a3a3a;
            border-color: #ff6600;
        }

        .option-item.selected {
            background-color: #ff6600;
            border-color: #ff6600;
            color: #fff;
        }

        .option-item input[type="radio"] {
            display: none; /* Nasconde l'input radio nativo */
        }

        .option-item label {
            cursor: pointer;
            font-size: 1.05rem;
            font-weight: normal; /* Override default label bold */
            margin-bottom: 0; /* Override input-group label margin */
            flex-grow: 1;
            display: flex;
            align-items: center;
        }

        .option-item label::before {
            content: '';
            display: inline-block;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            border: 2px solid #ccc;
            margin-right: 12px;
            background-color: #333;
            transition: all 0.3s ease;
        }

        .option-item.selected label::before {
            background-color: #fff;
            border-color: #fff;
            box-shadow: 0 0 0 4px #ff6600;
        }

        /* Stili per checkboxes (selezione multipla) */
        .checkbox-group {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .checkbox-item {
            background-color: #2a2a2a;
            border: 1px solid #444;
            border-radius: 10px;
            padding: 15px 20px;
            cursor: pointer;
            transition: background-color 0.3s ease, border-color 0.3s ease;
            display: flex;
            align-items: center;
        }

        .checkbox-item:hover {
            background-color: #3a3a3a;
            border-color: #ff6600;
        }

        .checkbox-item input[type="checkbox"] {
            display: none;
        }

        .checkbox-item label {
            cursor: pointer;
            font-size: 1.05rem;
            font-weight: normal;
            margin-bottom: 0;
            flex-grow: 1;
            display: flex;
            align-items: center;
        }

        .checkbox-item label::before {
            content: '';
            display: inline-block;
            width: 20px;
            height: 20px;
            border-radius: 4px;
            border: 2px solid #ccc;
            margin-right: 12px;
            background-color: #333;
            transition: all 0.3s ease;
        }

        .checkbox-item input[type="checkbox"]:checked + label::before {
            background-color: #ff6600;
            border-color: #ff6600;
            content: '‚úì'; /* Segno di spunta */
            display: flex;
            justify-content: center;
            align-items: center;
            color: #fff;
            font-size: 14px;
            font-weight: bold;
        }

        .checkbox-item input[type="checkbox"]:checked + label {
            color: #ff6600;
        }


        /* Navigazione */
        .quiz-navigation {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
            gap: 15px;
        }

        .nav-btn {
            background-color: #ff6600;
            color: #fff;
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.1rem;
            font-weight: bold;
            transition: background-color 0.3s ease, transform 0.2s ease;
            flex-grow: 1;
            text-align: center;
            text-decoration: none;
        }

        .nav-btn:hover {
            background-color: #e65c00;
            transform: translateY(-2px);
        }

        .nav-btn:disabled {
            background-color: #555;
            cursor: not-allowed;
            transform: none;
        }

        .nav-btn.secondary {
            background-color: #3a3a3a;
        }

        .nav-btn.secondary:hover:not(:disabled) {
            background-color: #4a4a4a;
        }

        /* Result container */
        .result-container {
            text-align: center;
            padding: 30px;
            background-color: #1c1c1c;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.4);
        }

        .result-container h2 {
            color: #ff6600;
            font-size: 2.5rem;
            margin-bottom: 20px;
        }

        .result-profile {
            font-size: 1.8rem;
            color: #fff;
            margin-bottom: 15px;
        }

        .result-description {
            font-size: 1.1rem;
            color: #ccc;
            margin-bottom: 30px;
            max-width: 700px;
            margin-left: auto;
            margin-right: auto;
            text-align: justify; /* Per testo discorsivo */
        }

        .result-recommendations {
            text-align: left;
            margin-top: 30px;
            margin-bottom: 40px;
            background-color: #2a2a2a;
            padding: 25px;
            border-radius: 10px;
        }

        .result-recommendations h3 {
            color: #ff9933;
            font-size: 1.5rem;
            margin-bottom: 15px;
            text-align: center;
        }

        .result-recommendations ul {
            list-style: none;
            padding: 0;
        }

        .result-recommendations ul li {
            background-color: #3a3a3a;
            padding: 12px 15px;
            margin-bottom: 10px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            font-size: 1rem;
            color: #eee;
        }

        .result-recommendations ul li::before {
            content: '‚úÖ'; /* Icona a sinistra */
            margin-right: 10px;
            color: #ff6600;
            font-size: 1.2em;
        }

        .cta-buttons {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-top: 30px;
            max-width: 400px;
            margin-left: auto;
            margin-right: auto;
        }

        .cta-primary, .cta-secondary {
            display: block;
            padding: 15px 25px;
            border-radius: 10px;
            font-size: 1.2rem;
            font-weight: bold;
            text-decoration: none;
            transition: transform 0.2s ease;
            text-align: center; /* Centra il testo nei bottoni CTA */
        }

        .cta-primary {
            background-color: #ff6600;
            color: #fff;
        }

        .cta-primary:hover {
            transform: translateY(-3px);
            background-color: #e65c00;
        }

        .cta-secondary {
            background-color: #333;
            color: #ff6600;
            border: 2px solid #ff6600;
        }

        .cta-secondary:hover {
            transform: translateY(-3px);
            background-color: #ff6600;
            color: #fff;
        }

        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            z-index: 1000;
            color: #ff6600;
            font-size: 1.5rem;
            display: none; /* Inizialmente nascosto */
        }

        .loading-screen.active {
            display: flex;
        }

        .spinner {
            border: 6px solid rgba(255, 255, 255, 0.3);
            border-top: 6px solid #ff6600;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error-message {
            color: red;
            background-color: rgba(255, 0, 0, 0.1);
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            display: none;
        }

        .error-message.active {
            display: block;
        }


        @media (max-width: 768px) {
            .header h1 {
                font-size: 2rem;
            }

            .quiz-card {
                padding: 20px;
            }

            .nav-btn {
                padding: 10px 15px;
                font-size: 1rem;
            }

            .cta-primary, .cta-secondary {
                font-size: 1rem;
                padding: 12px 20px;
            }
        }
    </style>
</head>
<body>
    <div class="loading-screen" id="loading-screen">
        <div class="spinner"></div>
        <p>Analizzando il tuo profilo...</p>
        <div class="error-message" id="error-message"></div>
    </div>

    <div class="container">
        <header class="header">
            <h1>üî• TribuCoach Quiz</h1>
            <p>Scopri il tuo profilo fitness unico e ricevi un piano personalizzato!</p>
        </header>

        <div class="progress-bar-container">
            <div class="progress-bar" id="progress-bar"></div>
        </div>

        <div class="quiz-card" id="quiz-card">
            <div class="question-container active" id="question-1">
                <div class="section-intro">
                    <h3>üëã Sezione 1: Chi Sei?</h3>
                    <p>Iniziamo a conoscerti meglio per personalizzare al massimo il tuo percorso.</p>
                </div>
                <h2 class="question-title">Le tue informazioni di base</h2>
                <p class="question-subtitle">Questi dati ci aiuteranno a creare un profilo su misura.</p>
                <div class="input-group">
                    <label for="name">Nome completo:</label>
                    <input type="text" id="name" placeholder="Come ti chiami?" required>
                </div>
                <div class="input-group">
                    <label for="email">Email:</label>
                    <input type="email" id="email" placeholder="La tua email per ricevere il piano personalizzato" required>
                </div>
                <div class="input-group">
                    <label for="phone">Numero di Telefono (WhatsApp):</label>
                    <input type="tel" id="phone" placeholder="Il tuo numero WhatsApp per un contatto veloce (opzionale)">
                </div>
                <div class="input-group">
                    <label for="age">Et√†:</label>
                    <input type="number" id="age" min="16" max="80" placeholder="Quanti anni hai?" required>
                </div>
                <div class="input-group">
                    <label for="city">Citt√†:</label>
                    <input type="text" id="city" placeholder="Dove vivi? (es. Verona, Milano...)">
                </div>
            </div>

            <div class="question-container" id="question-2">
                <div class="section-intro">
                    <h3>üöÄ Sezione 2: La Tua Esperienza</h3>
                    <p>Raccontaci il tuo percorso nel mondo del fitness per capire da dove partire.</p>
                </div>
                <h2 class="question-title">Qual √® la tua esperienza attuale nel fitness?</h2>
                <p class="question-subtitle">Seleziona l'opzione che meglio ti descrive.</p>
                <div class="option-group">
                    <div class="option-item">
                        <input type="radio" id="exp-beginner" name="experience" value="principiante">
                        <label for="exp-beginner">Sono un principiante (meno di 6 mesi di attivit√†)</label>
                    </div>
                    <div class="option-item">
                        <input type="radio" id="exp-intermediate" name="experience" value="intermedio">
                        <label for="exp-intermediate">Ho esperienza intermedia (6 mesi - 2 anni)</label>
                    </div>
                    <div class="option-item">
                        <input type="radio" id="exp-advanced" name="experience" value="avanzato">
                        <label for="exp-advanced">Sono avanzato (pi√π di 2 anni di allenamento costante)</label>
                    </div>
                </div>
            </div>

            <div class="question-container" id="question-3">
                <div class="section-intro">
                    <h3>üéØ Sezione 3: I Tuoi Obiettivi</h3>
                    <p>Quali risultati vuoi raggiungere? Sii specifico per un piano mirato!</p>
                </div>
                <h2 class="question-title">Quali sono i tuoi 3 obiettivi principali?</h2>
                <p class="question-subtitle">Seleziona massimo 3 opzioni.</p>
                <div class="checkbox-group">
                    <div class="checkbox-item">
                        <input type="checkbox" id="goal-massa" value="aumento_massa_muscolare">
                        <label for="goal-massa">üí™ Aumento massa muscolare</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="goal-peso" value="perdita_peso_grasso">
                        <label for="goal-peso">‚öñÔ∏è Perdita di peso e massa grassa</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="goal-forza" value="aumento_forza">
                        <label for="goal-forza">üèãÔ∏è‚Äç‚ôÄÔ∏è Aumento della forza</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="goal-tonificazione" value="tonificazione_generale">
                        <label for="goal-tonificazione">üßò‚Äç‚ôÄÔ∏è Tonificazione generale</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="goal-resistenza" value="miglioramento_resistenza">
                        <label for="goal-resistenza">üèÉ‚Äç‚ôÇÔ∏è Miglioramento resistenza</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="goal-salute" value="benessere_salute">
                        <label for="goal-salute">üçè Benessere e salute generale</label>
                    </div>
                </div>
            </div>

            <div class="question-container" id="question-4">
                <div class="section-intro">
                    <h3>üóìÔ∏è Sezione 4: Il Tuo Impegno</h3>
                    <p>Quante volte alla settimana sei disposto ad allenarti?</p>
                </div>
                <h2 class="question-title">Quanti giorni a settimana ti alleni o vorresti allenarti?</h2>
                <p class="question-subtitle">Sii realistico per un piano sostenibile.</p>
                <div class="option-group">
                    <div class="option-item">
                        <input type="radio" id="freq-1-2" name="frequency" value="1-2">
                        <label for="freq-1-2">1-2 giorni</label>
                    </div>
                    <div class="option-item">
                        <input type="radio" id="freq-3-4" name="frequency" value="3-4">
                        <label for="freq-3-4">3-4 giorni</label>
                    </div>
                    <div class="option-item">
                        <input type="radio" id="freq-5-6" name="frequency" value="5-6">
                        <label for="freq-5-6">5-6 giorni</label>
                    </div>
                </div>
            </div>

            <div class="question-container" id="question-5">
                <div class="section-intro">
                    <h3>üèãÔ∏è‚Äç‚ôÄÔ∏è Sezione 5: Le Tue Preferenze</h3>
                    <p>Qual √® il tuo ambiente di allenamento ideale?</p>
                </div>
                <h2 class="question-title">Dove preferisci allenarti principalmente?</h2>
                <p class="question-subtitle">Questo ci aiuter√† a creare un piano adatto alle tue risorse.</p>
                <div class="option-group">
                    <div class="option-item">
                        <input type="radio" id="place-gym" name="place" value="palestra">
                        <label for="place-gym">In palestra con attrezzi</label>
                    </div>
                    <div class="option-item">
                        <input type="radio" id="place-home" name="place" value="casa">
                        <label for="place-home">A casa con poca attrezzatura</label>
                    </div>
                    <div class="option-item">
                        <input type="radio" id="place-outdoor" name="place" value="all_aperto">
                        <label for="place-outdoor">All'aperto (corsa, corpo libero, ecc.)</label>
                    </div>
                    <div class="option-item">
                        <input type="radio" id="place-mixed" name="place" value="misto">
                        <label for="place-mixed">Misto (palestra + casa/all'aperto)</label>
                    </div>
                </div>
            </div>

            <div class="question-container" id="question-6">
                <div class="section-intro">
                    <h3>üí° Sezione 6: La Tua Spinta</h3>
                    <p>Cosa ti motiva veramente a raggiungere i tuoi obiettivi?</p>
                </div>
                <h2 class="question-title">Qual √® la tua motivazione principale?</h2>
                <p class="question-subtitle">Seleziona l'opzione che meglio descrive la tua spinta interiore.</p>
                <div class="option-group">
                    <div class="option-item">
                        <input type="radio" id="motivation-health" name="motivation" value="salute_benessere">
                        <label for="motivation-health">Salute e benessere generale</label>
                    </div>
                    <div class="option-item">
                        <input type="radio" id="motivation-appearance" name="motivation" value="aspetto_fisico">
                        <label for="motivation-appearance">Miglioramento dell'aspetto fisico e autostima</label>
                    </div>
                    <div class="option-item">
                        <input type="radio" id="motivation-performance" name="motivation" value="performance_sportiva">
                        <label for="motivation-performance">Aumento delle prestazioni sportive o fisiche</label>
                    </div>
                    <div class="option-item">
                        <input type="radio" id="motivation-lifestyle" name="motivation" value="stile_vita_attivo">
                        <label for="motivation-lifestyle">Adottare uno stile di vita pi√π attivo e dinamico</label>
                    </div>
                </div>
            </div>

            <div class="question-container" id="question-7">
                <div class="section-intro">
                    <h3>üöß Sezione 7: Le Sfide</h3>
                    <p>Identifichiamo insieme cosa ti ha frenato finora.</p>
                </div>
                <h2 class="question-title">Quali sono i principali ostacoli che incontri?</h2>
                <p class="question-subtitle">Scegli quelli che ti impediscono di progredire. (Puoi selezionare pi√π di uno)</p>
                <div class="checkbox-group">
                    <div class="checkbox-item">
                        <input type="checkbox" id="obstacle-time" value="mancanza_tempo">
                        <label for="obstacle-time">‚è≥ Mancanza di tempo</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="obstacle-motivation" value="mancanza_motivazione">
                        <label for="obstacle-motivation">üò¥ Mancanza di motivazione o costanza</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="obstacle-knowledge" value="mancanza_conoscenze">
                        <label for="obstacle-knowledge">üß† Mancanza di conoscenze su allenamento/nutrizione</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="obstacle-cost" value="costi_elevati">
                        <label for="obstacle-cost">üí∞ Costi elevati (palestra, PT, alimenti specifici)</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="obstacle-injury" value="infortuni_dolori">
                        <label for="obstacle-injury">ü§ï Infortuni o dolori fisici</label>
                    </div>
                </div>
            </div>

            <div class="question-container" id="question-8">
                <div class="section-intro">
                    <h3>üçé Sezione 8: La Tua Alimentazione</h3>
                    <p>Comprendere le tue abitudini alimentari √® cruciale per il successo.</p>
                </div>
                <h2 class="question-title">Come descriveresti le tue attuali abitudini alimentari?</h2>
                <p class="question-subtitle">Sii onesto, non ti giudichiamo!</p>
                <div class="option-group">
                    <div class="option-item">
                        <input type="radio" id="diet-balanced" name="diet" value="equilibrata_consapevole">
                        <label for="diet-balanced">Generalmente equilibrata e consapevole</label>
                    </div>
                    <div class="option-item">
                        <input type="radio" id="diet-sometimes" name="diet" value="a_volte_sgarro">
                        <label for="diet-sometimes">A volte sgarro, ma cerco di stare attento/a</label>
                    </div>
                    <div class="option-item">
                        <input type="radio" id="diet-no-focus" name="diet" value="non_ci_penso_molto">
                        <label for="diet-no-focus">Non ci penso molto, mangio quello che capita</label>
                    </div>
                </div>
            </div>

            <div class="question-container" id="question-9">
                <div class="section-intro">
                    <h3>üîÑ Sezione 9: Il Tuo Passato Fitness</h3>
                    <p>Quali esperienze hai avuto con programmi di allenamento?</p>
                </div>
                <h2 class="question-title">Hai gi√† seguito programmi di allenamento strutturati in passato?</h2>
                <p class="question-subtitle">Questo ci aiuta a capire cosa funziona (o no) per te.</p>
                <div class="option-group">
                    <div class="option-item">
                        <input type="radio" id="past-yes-success" name="past_experience" value="si_con_successo">
                        <label for="past-yes-success">S√¨, e ho avuto buoni risultati</label>
                    </div>
                    <div class="option-item">
                        <input type="radio" id="past-yes-failed" name="past_experience" value="si_interrotto_senza_risultati">
                        <label for="past-yes-failed">S√¨, ma ho interrotto o non ho visto risultati</label>
                    </div>
                    <div class="option-item">
                        <input type="radio" id="past-no" name="past_experience" value="no_mai_strutturato">
                        <label for="past-no">No, non ho mai seguito un programma strutturato</label>
                    </div>
                </div>
            </div>

            <div class="question-container" id="question-10">
                <div class="section-intro">
                    <h3>üö∂‚Äç‚ôÄÔ∏è Sezione 10: Il Tuo Stile di Vita</h3>
                    <p>Quanto sei attivo/a al di fuori dell'allenamento?</p>
                </div>
                <h2 class="question-title">Come descriveresti il tuo livello di attivit√† fisica quotidiana?</h2>
                <p class="question-subtitle">Escludendo l'allenamento specifico, quanto ti muovi?</p>
                <div class="option-group">
                    <div class="option-item">
                        <input type="radio" id="daily-active" name="daily_activity" value="molto_attivo">
                        <label for="daily-active">Molto attivo (lavoro dinamico, tanti passi, ecc.)</label>
                    </div>
                    <div class="option-item">
                        <input type="radio" id="daily-moderate" name="daily_activity" value="moderatamente_attivo">
                        <label for="daily-moderate">Moderatamente attivo (qualche camminata, lavori occasionali)</label>
                    </div>
                    <div class="option-item">
                        <input type="radio" id="daily-sedentary" name="daily_activity" value="sedentario">
                        <label for="daily-sedentary">Sedentario (lavoro d'ufficio, poco movimento)</label>
                    </div>
                </div>
            </div>


            <div class="question-container" id="result-container">
                <div class="section-intro">
                    <h3>üéâ Quiz Completato!</h3>
                    <p>Grazie per aver dedicato il tuo tempo. Ecco il tuo profilo personalizzato.</p>
                </div>
                <h2 class="question-title">Il Tuo Profilo TribuCoach</h2>
                <p class="result-profile" id="result-profile"></p>
                <p class="result-description" id="result-description"></p>
                
                <div class="result-recommendations">
                    <h3>Consigli Personalizzati per Te:</h3>
                    <ul>
                        </ul>
                </div>

                <div class="cta-buttons">
                    <a href="#" id="cta-contact" class="cta-primary">‚úçÔ∏è Scrivimi per una consulenza!</a>
                    <a href="index.html" id="cta-chatbot" class="cta-secondary">üí¨ Usa la mia chat per domande!</a>
                </div>
            </div>

            <div class="quiz-navigation">
                <button id="prevBtn" class="nav-btn secondary">Indietro</button>
                <button id="nextBtn" class="nav-btn">Avanti</button>
                <button id="submitBtn" class="nav-btn" style="display: none;">Vedi il tuo profilo</button>
            </div>
        </div>
    </div>

    <script type="module">
        import { saveQuizResult, calculateLeadScore, getProfileIcon } from './firebase-functions.js'; 
        import { analytics } from './firebase.js'; // Importa analytics (l'istanza)
        import { logEvent } from 'https://www.gstatic.com/firebasejs/9.23.0/firebase-analytics.js'; 
        
        let currentQuestion = 1;
        const totalQuestions = 10; // Aggiornato per le 5 nuove domande
        const questionsContainer = document.getElementById('quiz-card');
        const prevBtn = document.getElementById('prevBtn');
        const nextBtn = document.getElementById('nextBtn');
        const submitBtn = document.getElementById('submitBtn');
        const progressBar = document.getElementById('progress-bar');
        const loadingScreen = document.getElementById('loading-screen');
        const errorMessage = document.getElementById('error-message');

        const questionMap = {
            1: 'question-1',
            2: 'question-2',
            3: 'question-3',
            4: 'question-4',
            5: 'question-5',
            6: 'question-6', // Nuova domanda
            7: 'question-7', // Nuova domanda
            8: 'question-8', // Nuova domanda
            9: 'question-9', // Nuova domanda
            10: 'question-10',// Nuova domanda
            11: 'result-container' // L'ultima "domanda" √® il risultato
        };

        function showQuestion(questionNumber) {
            document.querySelectorAll('.question-container').forEach(q => {
                q.classList.remove('active');
            });
            document.getElementById(questionMap[questionNumber]).classList.add('active');
            currentQuestion = questionNumber;
            updateProgress();
            updateNavigation();
            validateCurrentQuestion();
        }

        function updateProgress() {
            const progress = (currentQuestion - 1) / totalQuestions * 100;
            progressBar.style.width = `${progress}%`;
        }

        function updateNavigation() {
            prevBtn.style.display = currentQuestion === 1 ? 'none' : 'block';
            nextBtn.style.display = currentQuestion >= totalQuestions ? 'none' : 'block';
            submitBtn.style.display = currentQuestion === totalQuestions ? 'block' : 'none';
        }

        function validateCurrentQuestion() {
            let isValid = false;
            const currentQuestionElement = document.getElementById(questionMap[currentQuestion]);

            if (!currentQuestionElement) return false;

            switch(currentQuestion) {
                case 1: // Dati personali
                    const name = document.getElementById('name').value;
                    const email = document.getElementById('email').value;
                    const ageInput = document.getElementById('age').value;
                    const age = parseInt(ageInput);

                    isValid = name.length > 0 && 
                              email.length > 0 && 
                              email.includes('@') && 
                              ageInput.length > 0 && 
                              !isNaN(age) && 
                              age >= 16 && age <= 80;
                    break;
                case 2: // Esperienza Fitness
                    isValid = document.querySelector('input[name="experience"]:checked') !== null;
                    break;
                case 3: // Obiettivi Principali
                    const checkedGoals = document.querySelectorAll('#question-3 input[type="checkbox"]:checked').length;
                    isValid = checkedGoals > 0;
                    break;
                case 4: // Frequenza Allenamento
                    isValid = document.querySelector('input[name="frequency"]:checked') !== null;
                    break;
                case 5: // Tipo di Allenamento Preferito
                    isValid = document.querySelector('input[name="place"]:checked') !== null;
                    break;
                case 6: // Motivazione (Nuova)
                    isValid = document.querySelector('input[name="motivation"]:checked') !== null;
                    break;
                case 7: // Ostacoli (Nuova)
                    const checkedObstacles = document.querySelectorAll('#question-7 input[type="checkbox"]:checked').length;
                    isValid = checkedObstacles > 0;
                    break;
                case 8: // Abitudini Alimentari (Nuova)
                    isValid = document.querySelector('input[name="diet"]:checked') !== null;
                    break;
                case 9: // Esperienze Passate (Nuova)
                    isValid = document.querySelector('input[name="past_experience"]:checked') !== null;
                    break;
                case 10: // Livello di Attivit√† Quotidiana (Nuova)
                    isValid = document.querySelector('input[name="daily_activity"]:checked') !== null;
                    break;
                case 11: // Risultato (non ha validazione diretta)
                    isValid = true;
                    break;
            }

            nextBtn.disabled = !isValid;
            submitBtn.disabled = !isValid;
            return isValid;
        }


        function collectQuizData() {
            const name = document.getElementById('name').value;
            const email = document.getElementById('email').value;
            const phone = document.getElementById('phone').value;
            const age = document.getElementById('age').value;
            const city = document.getElementById('city').value;
            
            const experience = document.querySelector('input[name="experience"]:checked')?.value;
            
            const goals = Array.from(document.querySelectorAll('#question-3 input[type="checkbox"]:checked'))
                               .map(cb => cb.value);
            
            const frequency = document.querySelector('input[name="frequency"]:checked')?.value;
            const place = document.querySelector('input[name="place"]:checked')?.value;

            // Nuovi campi
            const motivation = document.querySelector('input[name="motivation"]:checked')?.value;
            const obstacles = Array.from(document.querySelectorAll('#question-7 input[type="checkbox"]:checked'))
                                   .map(cb => cb.value);
            const diet = document.querySelector('input[name="diet"]:checked')?.value;
            const pastExperience = document.querySelector('input[name="past_experience"]:checked')?.value;
            const dailyActivity = document.querySelector('input[name="daily_activity"]:checked')?.value;


            return {
                name,
                email,
                phone,
                age: parseInt(age),
                city,
                experience,
                goals,
                frequency,
                place,
                motivation,      // Nuovo
                obstacles,       // Nuovo
                diet,            // Nuovo
                pastExperience,  // Nuovo
                dailyActivity    // Nuovo
            };
        }

        async function submitQuiz() {
            if (!validateCurrentQuestion()) {
                alert('Per favore, completa tutti i campi richiesti prima di procedere.');
                return;
            }

            loadingScreen.classList.add('active');
            errorMessage.classList.remove('active');
            errorMessage.textContent = '';

            const quizData = collectQuizData();
            const lead_score = calculateLeadScore(quizData);
            quizData.lead_score = lead_score;

            // Determina il profilo in base al punteggio e all'esperienza
            let profileType = '';
            if (quizData.experience === 'avanzato' && lead_score >= 80) {
                profileType = 'Atleta';
            } else if (quizData.experience === 'intermedio' && lead_score >= 60) {
                profileType = 'Guerriero';
            } else {
                profileType = 'Nuovo Esploratore';
            }
            quizData.profile = profileType;

            try {
                await saveQuizResult(quizData);
                console.log('Quiz saved successfully!');
                displayResult(quizData, lead_score, profileType);
                showQuestion(totalQuestions + 1); // Mostra la schermata dei risultati
                loadingScreen.classList.remove('active');

                // Imposta i link dei nuovi CTA
                const ctaContact = document.getElementById('cta-contact');
                const ctaChatbot = document.getElementById('cta-chatbot');

                const whatsappMessage = encodeURIComponent(`Ciao, sono ${quizData.name}! Ho completato il quiz su TribuCoach e vorrei fissare una consulenza o avere maggiori informazioni sui tuoi programmi personalizzati. Il mio profilo √® "${profileType}".`);
                ctaContact.href = `https://wa.me/3478881515?text=${whatsappMessage}`;
                
                // Il link al chatbot sar√† semplicemente alla home page, dato che il bot √® un widget fluttuante
                ctaChatbot.href = `index.html`;

            } catch (error) {
                console.error('Errore salvataggio quiz:', error);
                errorMessage.textContent = 'Si √® verificato un errore durante il salvataggio dei tuoi dati. Riprova pi√π tardi.';
                errorMessage.classList.add('active');
                loadingScreen.classList.remove('active');
            }
        }

        function displayResult(quizData, lead_score, profileType) {
            document.getElementById('result-profile').innerHTML = `${getProfileIcon(profileType)} Sei un ${profileType}!`;
            
            let descriptionHTML = ``;
            let recommendationsList = [];

            // Introduzione generale
            descriptionHTML += `<p>Complimenti ${quizData.name}, hai completato il quiz e il tuo profilo fitness √® emerso come un **${profileType}**!</p>`;
            descriptionHTML += `<p>Con i tuoi ${quizData.age} anni e la tua chiara ambizione di **${quizData.goals.map(g => g.replace(/_/g, ' ')).join(', ')}**, abbiamo un'ottima base di partenza per costruire il tuo successo.</p>`;
            
            // Dettagli in base al profilo
            if (profileType === 'Atleta') {
                descriptionHTML += `<p>Sei un vero Atleta! La tua dedizione, la tua esperienza **${quizData.experience}** e la tua preferenza per ${quizData.place.replace(/_/g, ' ')} indicano che sei pronto/a a strategie avanzate. Ti offro un supporto mirato a superare i tuoi limiti attuali e a perfezionare ogni aspetto delle tue performance.</p>`;
            } else if (profileType === 'Guerriero') {
                descriptionHTML += `<p>Sei un Guerriero! La tua esperienza **${quizData.experience}** e la tua volont√† di allenarti ${quizData.frequency} giorni a settimana mostrano una forte determinazione. Ti aiuter√≤ a consolidare i tuoi progressi, a superare gli eventuali plateau e a massimizzare i tuoi risultati con un percorso su misura.</p>`;
            } else { // Nuovo Esploratore
                descriptionHTML += `<p>Sei un Nuovo Esploratore! Stai iniziando il tuo viaggio nel fitness con grande entusiasmo. La tua frequenza desiderata di ${quizData.frequency} allenamenti a settimana e la tua scelta di allenarti ${quizData.place.replace(/_/g, ' ')} sono un ottimo punto di partenza. Ti guider√≤ passo dopo passo, fornendoti le basi solide e la motivazione per costruire abitudini durature e raggiungere i tuoi primi successi.</p>`;
            }

            // Integrazione nuove domande per la descrizione
            if (quizData.motivation === 'salute_benessere') {
                descriptionHTML += `<p>La tua motivazione principale √® focalizzata sulla **salute e il benessere generale**. Questo √® un motore potente e sostenibile per un cambiamento duraturo.</p>`;
            } else if (quizData.motivation === 'aspetto_fisico') {
                descriptionHTML += `<p>Il **miglioramento dell'aspetto fisico e l'autostima** sono la tua principale spinta. Lavoreremo per farti sentire bene nel tuo corpo, dentro e fuori.</p>`;
            } else if (quizData.motivation === 'performance_sportiva') {
                descriptionHTML += `<p>Sei spinto/a dall'**aumento delle prestazioni sportive o fisiche**. Questo richiede un approccio metodico e progressivo che affronteremo insieme.</p>`;
            } else if (quizData.motivation === 'stile_vita_attivo') {
                descriptionHTML += `<p>Il desiderio di **adottare uno stile di vita pi√π attivo e dinamico** √® una motivazione eccellente, che trasformeremo in abitudini quotidiane.</p>`;
            }

            if (quizData.obstacles.length > 0) {
                const obstacleMap = {
                    'mancanza_tempo': 'mancanza di tempo',
                    'mancanza_motivazione': 'mancanza di motivazione o costanza',
                    'mancanza_conoscenze': 'mancanza di conoscenze',
                    'costi_elevati': 'costi elevati',
                    'infortuni_dolori': 'infortuni o dolori'
                };
                const formattedObstacles = quizData.obstacles.map(o => obstacleMap[o] || o).join(', ');
                descriptionHTML += `<p>Comprendiamo che hai incontrato ostacoli come **${formattedObstacles}**. Sono qui per fornirti soluzioni pratiche e superare insieme queste sfide, trasformandole in punti di forza.</p>`;
            }

            if (quizData.diet === 'equilibrata_consapevole') {
                descriptionHTML += `<p>Le tue abitudini alimentari sono **generalmente equilibrate e consapevoli**, un fattore chiave che ci permetter√† di ottimizzare rapidamente i tuoi risultati.</p>`;
            } else if (quizData.diet === 'a_volte_sgarro') {
                descriptionHTML += `<p>A volte sgarri, ma cerchi di stare attento/a. Questa flessibilit√† pu√≤ essere un'opportunit√† per imparare a gestire al meglio la tua alimentazione senza rinunce estreme.</p>`;
            } else { // non_ci_penso_molto
                descriptionHTML += `<p>Attualmente non ti concentri molto sull'alimentazione. Questo √® un'area con un enorme potenziale di miglioramento! Ti guider√≤ verso scelte pi√π salutari e sostenibili.</p>`;
            }

            if (quizData.pastExperience === 'si_con_successo') {
                descriptionHTML += `<p>La tua **esperienza passata di successo** con programmi strutturati √® un grande vantaggio. Partiremo da l√¨ per affinare il tuo percorso e raggiungere nuovi traguardi.</p>`;
            } else if (quizData.pastExperience === 'si_interrotto_senza_risultati') {
                descriptionHTML += `<p>Hai gi√† provato programmi in passato, ma non hai ottenuto i risultati sperati o hai interrotto. Useremo queste esperienze per capire cosa non ha funzionato e costruire un piano che ti sia **veramente sostenibile ed efficace**.</p>`;
            } else { // no_mai_strutturato
                descriptionHTML += `<p>Non hai mai seguito un programma di allenamento strutturato. Questo significa che hai un mondo di progressi da scoprire! Sono qui per darti le basi e la guida necessaria.</p>`;
            }

            if (quizData.dailyActivity === 'molto_attivo') {
                descriptionHTML += `<p>Il tuo livello di attivit√† quotidiana √® **molto elevato**. Questo √® un ottimo punto di partenza per integrare l'allenamento in un lifestyle gi√† dinamico.</p>`;
            } else if (quizData.dailyActivity === 'moderatamente_attivo') {
                descriptionHTML += `<p>Sei **moderatamente attivo/a** al di fuori dell'allenamento. Troveremo il giusto equilibrio per aumentare il tuo dispendio calorico complessivo in modo graduale e piacevole.</p>`;
            } else { // sedentario
                descriptionHTML += `<p>Il tuo stile di vita √® prevalentemente **sedentario**. Inizieremo con un approccio progressivo e sostenibile per farti muovere di pi√π e migliorare la tua salute generale.</p>`;
            }

            descriptionHTML += `<p>Con TribuCoach, non sei mai solo/a. Che tu sia un **${profileType}**, un **${quizData.goals.length > 0 ? quizData.goals[0].replace(/_/g, ' ') : 'leader'}** o stia affrontando **${quizData.obstacles.length > 0 ? quizData.obstacles[0].replace(/_/g, ' ') : 'nuove sfide'}**, sono qui per fornirti il supporto personalizzato di cui hai bisogno. Il mio obiettivo √® aiutarti a raggiungere la migliore versione di te stesso/a, superando ogni ostacolo con un approccio su misura.</p>`;

            document.getElementById('result-description').innerHTML = descriptionHTML;

            // Raccomandazioni generali basate sul profilo (potrebbero essere pi√π dinamiche in futuro)
            if (profileType === 'Atleta') {
                recommendationsList = [
                    'Piani di allenamento specifici per massimizzare la performance.',
                    'Strategie nutrizionali avanzate per recupero e crescita muscolare.',
                    'Tecniche di mental coaching per la gestione della pressione competitiva.',
                    'Monitoraggio avanzato dei progressi per ottimizzare gli allenamenti.'
                ];
            } else if (profileType === 'Guerriero') {
                recommendationsList = [
                    'Piani di allenamento per superare i tuoi limiti attuali e consolidare i progressi.',
                    'Consigli nutrizionali per sostenere l\'aumento di massa o la definizione.',
                    'Strategie per mantenere alta la motivazione e la costanza nel lungo termine.',
                    'Approcci per affrontare e superare gli ostacoli comuni.'
                ];
            } else { // Nuovo Esploratore
                recommendationsList = [
                    'Programmi di allenamento fondamentali per costruire forza e resistenza in sicurezza.',
                    'Guida passo-passo alla nutrizione per principianti e creazione di abitudini sane.',
                    'Strategie efficaci per integrare l\'attivit√† fisica nella vita quotidiana.',
                    'Supporto costante per mantenere alta la motivazione e celebrare ogni progresso.'
                ];
            }

            const recommendationsUl = document.querySelector('.result-recommendations ul');
            recommendationsUl.innerHTML = ''; // Pulisci raccomandazioni precedenti
            recommendationsList.forEach(rec => {
                const li = document.createElement('li');
                li.textContent = rec;
                recommendationsUl.appendChild(li);
            });
        }


        // Event Listeners
        nextBtn.addEventListener('click', () => {
            if (validateCurrentQuestion()) {
                showQuestion(currentQuestion + 1);
            } else {
                alert('Per favore, completa tutti i campi richiesti prima di procedere.');
            }
        });

        prevBtn.addEventListener('click', () => {
            if (currentQuestion > 1) {
                showQuestion(currentQuestion - 1);
            }
        });

        submitBtn.addEventListener('click', submitQuiz);


        // Setup listeners for input changes to enable/disable buttons
        document.querySelectorAll('.option-item').forEach(item => {
            item.addEventListener('click', function() {
                const radio = this.querySelector('input[type="radio"]');
                if (radio) {
                    radio.checked = true;
                    // Rimuovi 'selected' da tutti gli altri item dello stesso gruppo
                    this.closest('.option-group').querySelectorAll('.option-item').forEach(opt => {
                        opt.classList.remove('selected');
                    });
                    this.classList.add('selected');
                    validateCurrentQuestion();
                }
            });
        });

        // Setup per input fields (name, email, age, city, phone)
        document.querySelectorAll('input[type="text"], input[type="email"], input[type="number"], input[type="tel"]').forEach(input => {
            input.addEventListener('input', validateCurrentQuestion);
        });
        
        // Setup per checkbox con limite (Obiettivi Principali)
        document.querySelectorAll('#question-3 input[type="checkbox"]').forEach(checkbox => {
            checkbox.addEventListener('change', function() {
                const checked = document.querySelectorAll('#question-3 input[type="checkbox"]:checked');
                if (checked.length > 3) {
                    this.checked = false;
                    alert('Puoi selezionare massimo 3 obiettivi principali!');
                }
                // Toggle 'selected' class based on checked state
                this.parentNode.classList.toggle('selected', this.checked);
                validateCurrentQuestion();
            });
        });

        // Setup per altri checkbox (Obiettivi/Ostacoli)
        document.querySelectorAll('#question-7 input[type="checkbox"]').forEach(checkbox => { // Specifica #question-7 per gli ostacoli
            checkbox.addEventListener('change', function() {
                this.parentNode.classList.toggle('selected', this.checked);
                validateCurrentQuestion();
            });
        });


        // Inizializza al caricamento
        document.addEventListener('DOMContentLoaded', () => {
            updateProgress();
            updateNavigation();
            validateCurrentQuestion(); // Validare la prima domanda al caricamento
            logEvent(analytics, 'advanced_quiz_started'); // Usa logEvent correttamente
        });

    </script>
</body>
</html>