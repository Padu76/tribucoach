<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz Fitness TribuCoach - Scopri il Tuo Profilo</title>
    
    <!-- Meta Tags -->
    <meta name="description" content="Fai il quiz fitness personalizzato di TribuCoach e scopri il tuo profilo di allenamento ideale. Andrea Padoan, personal trainer a Verona.">
    <meta name="keywords" content="quiz fitness, personal trainer, allenamento personalizzato, TribuCoach, Andrea Padoan, Verona">
    <meta name="author" content="Andrea Padoan - TribuCoach">
    
    <!-- Open Graph -->
    <meta property="og:title" content="Quiz Fitness TribuCoach - Scopri il Tuo Profilo">
    <meta property="og:description" content="Fai il quiz personalizzato e scopri il tuo profilo di allenamento ideale con Andrea Padoan">
    <meta property="og:image" content="https://tribucoach.netlify.app/Padu_tribu045.jpg">
    <meta property="og:url" content="https://tribucoach.netlify.app/quiz.html">
    
    <!-- Favicon -->
    <link rel="icon" type="image/ico" href="favicon.ico">
    <link rel="apple-touch-icon" href="apple-touch-icon.png">
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        /* CSS del quiz esistente - mantieni tutto il CSS originale */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a1a 50%, #2a2a2a 100%);
            color: #ffffff;
            min-height: 100vh;
            line-height: 1.6;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }

        .quiz-header {
            text-align: center;
            margin-bottom: 40px;
            padding: 40px 20px;
            background: linear-gradient(135deg, rgba(255,102,0,0.1) 0%, rgba(255,102,0,0.05) 100%);
            border-radius: 20px;
            border: 1px solid rgba(255,102,0,0.2);
        }

        .quiz-header h1 {
            font-size: 2.5rem;
            margin-bottom: 20px;
            background: linear-gradient(135deg, #ff6600, #ff9933);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .quiz-header p {
            font-size: 1.2rem;
            color: #cccccc;
            margin-bottom: 30px;
        }

        .quiz-form {
            background: linear-gradient(135deg, #2a2a2a, #333333);
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            border: 1px solid #444444;
        }

        .question-group {
            margin-bottom: 30px;
            padding: 25px;
            background: rgba(255,255,255,0.05);
            border-radius: 15px;
            border-left: 4px solid #ff6600;
        }

        .question-group h3 {
            color: #ff9933;
            margin-bottom: 15px;
            font-size: 1.3rem;
        }

        .input-group {
            margin-bottom: 20px;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            color: #ffffff;
            font-weight: 500;
        }

        .input-group input,
        .input-group select,
        .input-group textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid #555555;
            border-radius: 8px;
            background: rgba(255,255,255,0.1);
            color: #ffffff;
            font-size: 1rem;
        }

        .input-group input:focus,
        .input-group select:focus,
        .input-group textarea:focus {
            outline: none;
            border-color: #ff6600;
            box-shadow: 0 0 0 2px rgba(255,102,0,0.2);
        }

        .checkbox-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            padding: 10px;
            background: rgba(255,255,255,0.05);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .checkbox-item:hover {
            background: rgba(255,102,0,0.1);
        }

        .checkbox-item input {
            width: auto;
            margin-right: 10px;
        }

        .submit-section {
            text-align: center;
            margin-top: 40px;
            padding: 30px;
            background: linear-gradient(135deg, rgba(255,102,0,0.1), rgba(255,102,0,0.05));
            border-radius: 15px;
        }

        .cta-primary {
            background: linear-gradient(135deg, #ff6600, #ff9933);
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 1.1rem;
            font-weight: 600;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
        }

        .cta-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(255,102,0,0.4);
        }

        .results-section {
            display: none;
            text-align: center;
            padding: 40px;
            background: linear-gradient(135deg, #1a4a1a, #2a5a2a);
            border-radius: 20px;
            margin-top: 30px;
        }

        .results-section.show {
            display: block;
        }

        .profile-result {
            font-size: 2rem;
            margin-bottom: 20px;
            color: #4CAF50;
        }

        .score-display {
            font-size: 3rem;
            font-weight: bold;
            color: #ff6600;
            margin: 20px 0;
        }

        /* Chat Action Button */
        .chat-action {
            margin-top: 30px;
            padding: 20px;
            background: linear-gradient(135deg, rgba(255,102,0,0.1), rgba(255,102,0,0.05));
            border-radius: 15px;
            text-align: center;
        }

        .chat-action h4 {
            color: #ff9933;
            margin-bottom: 15px;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .quiz-header h1 {
                font-size: 2rem;
            }
            
            .quiz-form {
                padding: 25px;
            }
            
            .checkbox-group {
                grid-template-columns: 1fr;
            }
        }

        /* CHAT WIDGET STYLES */
        .chat-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            backdrop-filter: blur(5px);
        }

        .chat-container {
            width: 90%;
            max-width: 600px;
            height: 80%;
            max-height: 700px;
            background: linear-gradient(135deg, #1a1a1a, #2a2a2a);
            border-radius: 20px;
            display: flex;
            flex-direction: column;
            box-shadow: 0 20px 60px rgba(255, 102, 0, 0.3);
            border: 1px solid #ff6600;
        }

        .chat-header {
            background: linear-gradient(135deg, #ff6600, #ff8533);
            color: white;
            padding: 20px;
            border-radius: 20px 20px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .chat-header-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .chat-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            border: 2px solid white;
        }

        .chat-header h3 {
            margin: 0;
            font-size: 1.2rem;
        }

        .chat-header p {
            margin: 0;
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .chat-close {
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            padding: 5px;
        }

        .chat-messages {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            background: linear-gradient(135deg, #1a1a1a, #2a2a2a);
        }

        .message {
            margin-bottom: 15px;
            animation: messageSlideIn 0.3s ease-out;
        }

        @keyframes messageSlideIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .user-message {
            text-align: right;
        }

        .user-message .message-content {
            background: linear-gradient(135deg, #ff6600, #ff8533);
            color: white;
            display: inline-block;
            padding: 12px 16px;
            border-radius: 18px 18px 4px 18px;
            max-width: 80%;
            margin-left: 20%;
        }

        .assistant-message .message-content {
            background: #333;
            color: #eee;
            display: inline-block;
            padding: 12px 16px;
            border-radius: 18px 18px 18px 4px;
            max-width: 80%;
            border-left: 3px solid #ff6600;
        }

        .message-time {
            font-size: 0.7rem;
            color: #999;
            margin-top: 5px;
        }

        .chat-input-container {
            padding: 20px;
            background: #2a2a2a;
            border-radius: 0 0 20px 20px;
            display: flex;
            gap: 10px;
        }

        #chatInput {
            flex: 1;
            padding: 12px 16px;
            border: 1px solid #444;
            border-radius: 25px;
            background: #1a1a1a;
            color: white;
            font-size: 0.9rem;
            outline: none;
        }

        #chatInput:focus {
            border-color: #ff6600;
            box-shadow: 0 0 0 2px rgba(255, 102, 0, 0.2);
        }

        .chat-send-btn {
            background: linear-gradient(135deg, #ff6600, #ff8533);
            color: white;
            border: none;
            width: 45px;
            height: 45px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.2rem;
            transition: all 0.3s ease;
        }

        .chat-send-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 4px 15px rgba(255, 102, 0, 0.4);
        }

        .typing-indicator {
            display: none;
            padding: 10px 16px;
            background: #333;
            border-radius: 18px;
            margin-bottom: 15px;
            max-width: 80px;
        }

        .typing-dots {
            display: flex;
            gap: 4px;
        }

        .typing-dots span {
            width: 8px;
            height: 8px;
            background: #ff6600;
            border-radius: 50%;
            animation: typingPulse 1.4s infinite;
        }

        .typing-dots span:nth-child(2) { animation-delay: 0.2s; }
        .typing-dots span:nth-child(3) { animation-delay: 0.4s; }

        @keyframes typingPulse {
            0%, 60%, 100% { opacity: 0.3; }
            30% { opacity: 1; }
        }

        @media (max-width: 768px) {
            .chat-container {
                width: 95%;
                height: 90%;
                border-radius: 15px;
            }
            
            .chat-header {
                padding: 15px;
                border-radius: 15px 15px 0 0;
            }
            
            .chat-avatar {
                width: 40px;
                height: 40px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="quiz-header">
            <h1>üèãÔ∏è Quiz Fitness TribuCoach</h1>
            <p>Scopri il tuo profilo di allenamento personalizzato con Andrea Padoan</p>
            <img src="Padu_tribu045.jpg" alt="Andrea Padoan - Personal Trainer" style="width: 120px; height: 120px; border-radius: 50%; border: 3px solid #ff6600; margin: 20px 0;">
        </div>

        <form id="fitnessQuiz" class="quiz-form">
            <!-- Informazioni Base -->
            <div class="question-group">
                <h3>üìã Informazioni Base</h3>
                
                <div class="input-group">
                    <label for="name">Nome *</label>
                    <input type="text" id="name" name="name" required>
                </div>
                
                <div class="input-group">
                    <label for="email">Email *</label>
                    <input type="email" id="email" name="email" required>
                </div>
                
                <div class="input-group">
                    <label for="age">Et√†</label>
                    <input type="number" id="age" name="age" min="16" max="80">
                </div>
                
                <div class="input-group">
                    <label for="gender">Genere</label>
                    <select id="gender" name="gender">
                        <option value="">Seleziona...</option>
                        <option value="Uomo">Uomo</option>
                        <option value="Donna">Donna</option>
                        <option value="Altro">Altro</option>
                    </select>
                </div>
            </div>

            <!-- Esperienza Fitness -->
            <div class="question-group">
                <h3>üí™ La Tua Esperienza</h3>
                
                <div class="input-group">
                    <label for="experience">Livello di esperienza</label>
                    <select id="experience" name="experience">
                        <option value="">Seleziona...</option>
                        <option value="Principiante Assoluto">Principiante Assoluto</option>
                        <option value="Intermedio">Qualche Esperienza</option>
                        <option value="Avanzato">Esperienza Avanzata</option>
                    </select>
                </div>
                
                <div class="input-group">
                    <label for="frequency">Frequenza allenamento settimanale</label>
                    <select id="frequency" name="frequency">
                        <option value="">Seleziona...</option>
                        <option value="1-2">1-2 volte</option>
                        <option value="3-4">3-4 volte</option>
                        <option value="5-6">5-6 volte</option>
                        <option value="7+">Tutti i giorni</option>
                    </select>
                </div>
            </div>

            <!-- Obiettivi -->
            <div class="question-group">
                <h3>üéØ I Tuoi Obiettivi</h3>
                <p>Seleziona tutti gli obiettivi che ti interessano:</p>
                
                <div class="checkbox-group">
                    <div class="checkbox-item">
                        <input type="checkbox" id="goal1" name="goals" value="Perdita Peso">
                        <label for="goal1">Perdere peso e dimagrire</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="goal2" name="goals" value="Aumento Massa Muscolare">
                        <label for="goal2">Aumentare massa muscolare</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="goal3" name="goals" value="Tonificazione">
                        <label for="goal3">Tonificare il corpo</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="goal4" name="goals" value="Resistenza">
                        <label for="goal4">Migliorare resistenza</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="goal5" name="goals" value="Forza">
                        <label for="goal5">Aumentare la forza</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="goal6" name="goals" value="Preparazione Atletica">
                        <label for="goal6">Preparazione atletica specifica</label>
                    </div>
                </div>
            </div>

            <!-- Ostacoli e Sfide -->
            <div class="question-group">
                <h3>üöß Ostacoli e Sfide</h3>
                
                <div class="input-group">
                    <label>Quali sono i tuoi principali ostacoli?</label>
                    <div class="checkbox-group">
                        <div class="checkbox-item">
                            <input type="checkbox" id="obstacle1" name="obstacles" value="Tempo">
                            <label for="obstacle1">Mancanza di tempo</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="obstacle2" name="obstacles" value="Motivazione">
                            <label for="obstacle2">Perdita di motivazione</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="obstacle3" name="obstacles" value="Conoscenza">
                            <label for="obstacle3">Non so cosa fare</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="obstacle4" name="obstacles" value="Infortuni">
                            <label for="obstacle4">Paura di infortuni</label>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Budget e Disponibilit√† -->
            <div class="question-group">
                <h3>üí∞ Budget e Disponibilit√†</h3>
                
                <div class="input-group">
                    <label for="budget">Budget mensile per il fitness</label>
                    <select id="budget" name="budget">
                        <option value="">Seleziona...</option>
                        <option value="0-50‚Ç¨">0-50‚Ç¨</option>
                        <option value="50-100‚Ç¨">50-100‚Ç¨</option>
                        <option value="100-200‚Ç¨">100-200‚Ç¨</option>
                        <option value="200-350‚Ç¨">200-350‚Ç¨</option>
                        <option value="350‚Ç¨+">Oltre 350‚Ç¨</option>
                    </select>
                </div>
                
                <div class="input-group">
                    <label for="location">Dove preferisci allenarti?</label>
                    <select id="location" name="location">
                        <option value="">Seleziona...</option>
                        <option value="Casa">A casa</option>
                        <option value="Palestra">In palestra</option>
                        <option value="All'aperto">All'aperto</option>
                        <option value="Personal Training">Con personal trainer</option>
                    </select>
                </div>
            </div>

            <div class="submit-section">
                <button type="submit" class="cta-primary">
                    üöÄ Scopri il Tuo Profilo
                </button>
                
                <div class="chat-action">
                    <h4>Hai domande specifiche?</h4>
                    <p>Parla direttamente con Andrea Padoan per consigli personalizzati</p>
                    <button type="button" id="openChatWidget" class="cta-primary" style="margin-top: 15px;">
                        üí¨ Parla con Andrea Padoan
                    </button>
                </div>
            </div>
        </form>

        <!-- Risultati Quiz -->
        <div id="quizResults" class="results-section">
            <h2>üéâ Il Tuo Profilo Fitness</h2>
            <div id="profileResult" class="profile-result"></div>
            <div id="scoreDisplay" class="score-display"></div>
            <div id="profileDescription"></div>
            
            <div class="chat-action">
                <h4>Vuoi approfondire il tuo profilo?</h4>
                <p>Chatta con Andrea per un piano personalizzato</p>
                <button type="button" class="cta-primary" onclick="document.getElementById('openChatWidget').click();">
                    üí¨ Parla con Andrea
                </button>
            </div>
        </div>
    </div>

    <!-- WIDGET CHAT ANDREA PADOAN -->
    <div id="chatOverlay" class="chat-overlay">
        <div class="chat-container">
            <div class="chat-header">
                <div class="chat-header-info">
                    <img src="Padu_tribu045.jpg" alt="Andrea Padoan" class="chat-avatar">
                    <div>
                        <h3>üèãÔ∏è Andrea Padoan</h3>
                        <p>Personal Trainer ‚Ä¢ Sempre disponibile</p>
                    </div>
                </div>
                <button id="closeChatWidget" class="chat-close">‚úï</button>
            </div>
            
            <div id="chatMessages" class="chat-messages">
                <div class="message assistant-message">
                    <div class="message-content">
                        Ciao! Sono Andrea Padoan, il tuo personal trainer di Verona. Come posso aiutarti a raggiungere i tuoi obiettivi di fitness? üí™
                    </div>
                    <div class="message-time">Ora</div>
                </div>
            </div>
            
            <div class="chat-input-container">
                <input type="text" id="chatInput" placeholder="Scrivi il tuo messaggio ad Andrea..." />
                <button id="sendMessage" class="chat-send-btn">‚û§</button>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script type="module" src="firebase-config.js"></script>
    <script type="module" src="firebase-functions.js"></script>
    
    <script type="module">
        // Firebase Chat Integration
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js';
        import { getFunctions, httpsCallable } from 'https://www.gstatic.com/firebasejs/9.23.0/firebase-functions.js';

        // Configurazione Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyDSsQEPii_Eb99cWGs7eqozgTtIqbtO2rs",
            authDomain: "tribucoach-a2254.firebaseapp.com",
            projectId: "tribucoach-a2254",
            storageBucket: "tribucoach-a2254.firebasestorage.app",
            messagingSenderId: "425200296836",
            appId: "1:425200296836:web:7835188f40f4348567ab48"
        };

        // Inizializza Firebase
        const app = initializeApp(firebaseConfig);
        const functions = getFunctions(app);

        // Variabili chat
        let conversationId = null;
        let customerName = null;
        let customerPhone = null;
        let customerEmail = null;
        let messages = [];

        // Elementi DOM
        const chatOverlay = document.getElementById('chatOverlay');
        const chatMessages = document.getElementById('chatMessages');
        const chatInput = document.getElementById('chatInput');
        const openChatWidget = document.getElementById('openChatWidget');
        const closeChatWidget = document.getElementById('closeChatWidget');
        const sendMessage = document.getElementById('sendMessage');

        // Event Listeners Chat
        openChatWidget.addEventListener('click', () => {
            chatOverlay.style.display = 'flex';
            chatInput.focus();
        });

        closeChatWidget.addEventListener('click', () => {
            chatOverlay.style.display = 'none';
        });

        chatOverlay.addEventListener('click', (e) => {
            if (e.target === chatOverlay) {
                chatOverlay.style.display = 'none';
            }
        });

        sendMessage.addEventListener('click', sendUserMessage);
        chatInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                sendUserMessage();
            }
        });

        // Funzione per inviare messaggio
        async function sendUserMessage() {
            const userMessage = chatInput.value.trim();
            if (!userMessage) return;

            // Aggiungi messaggio utente
            addMessage(userMessage, 'user');
            chatInput.value = '';

            // Aggiungi ai messaggi
            messages.push({
                role: 'user',
                content: userMessage
            });

            // Mostra typing indicator
            showTypingIndicator();

            try {
                // Chiama Firebase Function
                const chatWithOpenAI = httpsCallable(functions, 'chatWithOpenAI');
                const result = await chatWithOpenAI({
                    messages: messages,
                    conversationId: conversationId,
                    customerName: customerName,
                    customerPhone: customerPhone,
                    customerEmail: customerEmail
                });

                // Nascondi typing indicator
                hideTypingIndicator();

                // Aggiungi risposta Andrea
                const assistantMessage = result.data.message;
                addMessage(assistantMessage, 'assistant');

                // Aggiorna dati conversazione
                conversationId = result.data.conversationId;
                if (result.data.customerName) customerName = result.data.customerName;
                if (result.data.customerPhone) customerPhone = result.data.customerPhone;
                if (result.data.customerEmail) customerEmail = result.data.customerEmail;

                // Aggiungi ai messaggi
                messages.push({
                    role: 'assistant',
                    content: assistantMessage
                });

            } catch (error) {
                hideTypingIndicator();
                console.error('Errore chat:', error);
                addMessage('Scusa, c\'√® stato un problema. Riprova tra poco! üòÖ', 'assistant');
            }
        }

        // Funzione per aggiungere messaggio al DOM
        function addMessage(content, role) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${role}-message`;
            
            const now = new Date();
            const timeString = now.toLocaleTimeString('it-IT', { hour: '2-digit', minute: '2-digit' });
            
            messageDiv.innerHTML = `
                <div class="message-content">${content}</div>
                <div class="message-time">${timeString}</div>
            `;
            
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        // Typing indicator
        function showTypingIndicator() {
            const typingDiv = document.createElement('div');
            typingDiv.className = 'typing-indicator';
            typingDiv.id = 'typingIndicator';
            typingDiv.innerHTML = `
                <div class="typing-dots">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
            `;
            typingDiv.style.display = 'block';
            chatMessages.appendChild(typingDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function hideTypingIndicator() {
            const typingIndicator = document.getElementById('typingIndicator');
            if (typingIndicator) {
                typingIndicator.remove();
            }
        }

        // Quiz Logic (mantieni la logica esistente del quiz)
        document.getElementById('fitnessQuiz').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const formData = new FormData(this);
            const quizData = {};
            
            // Raccogli dati base
            for (let [key, value] of formData.entries()) {
                if (key === 'goals' || key === 'obstacles') {
                    if (!quizData[key]) quizData[key] = [];
                    quizData[key].push(value);
                } else {
                    quizData[key] = value;
                }
            }
            
            // Calcola score e profilo
            const result = calculateProfile(quizData);
            
            // Mostra risultati
            showResults(result);
            
            // Salva in Firebase (se disponibile)
            saveQuizToFirebase(quizData, result);
        });

        function calculateProfile(data) {
            let score = 0;
            let profile = '';
            
            // Calcolo score basato su esperienza
            switch(data.experience) {
                case 'Avanzato': score += 30; break;
                case 'Intermedio': score += 20; break;
                case 'Principiante Assoluto': score += 10; break;
            }
            
            // Score basato su frequenza
            switch(data.frequency) {
                case '7+': score += 25; break;
                case '5-6': score += 20; break;
                case '3-4': score += 15; break;
                case '1-2': score += 10; break;
            }
            
            // Score basato su obiettivi
            if (data.goals) {
                score += Math.min(data.goals.length * 5, 25);
            }
            
            // Score completezza dati
            if (data.name) score += 10;
            if (data.email) score += 10;
            
            // Determina profilo
            if (score >= 80) {
                profile = 'Champion Pro';
            } else if (score >= 60) {
                profile = 'Guerriero della Forza';
            } else if (score >= 40) {
                profile = 'Guerriero';
            } else {
                profile = 'Nuovo Esploratore';
            }
            
            return { score, profile, data };
        }

        function showResults(result) {
            const resultsSection = document.getElementById('quizResults');
            const profileResult = document.getElementById('profileResult');
            const scoreDisplay = document.getElementById('scoreDisplay');
            const profileDescription = document.getElementById('profileDescription');
            
            profileResult.textContent = `Il tuo profilo: ${result.profile}`;
            scoreDisplay.textContent = `${result.score}%`;
            
            let description = '';
            switch(result.profile) {
                case 'Champion Pro':
                    description = 'üèÜ Sei un atleta esperto! Hai le conoscenze e la dedizione per risultati eccellenti. Andrea pu√≤ aiutarti a ottimizzare le performance.';
                    break;
                case 'Guerriero della Forza':
                    description = 'üí™ Hai una buona base! Con il giusto supporto puoi raggiungere grandi risultati. Perfetto per un programma avanzato.';
                    break;
                case 'Guerriero':
                    description = '‚öîÔ∏è Sei sulla strada giusta! Hai motivazione e alcuni strumenti. Andrea ti aiuter√† a strutturare meglio il tuo percorso.';
                    break;
                default:
                    description = 'üå± Benvenuto nel mondo del fitness! Ogni grande viaggio inizia con il primo passo. Andrea sar√† la tua guida perfetta.';
            }
            
            profileDescription.innerHTML = `<p style="font-size: 1.2rem; margin: 20px 0; color: #cccccc;">${description}</p>`;
            
            resultsSection.classList.add('show');
            resultsSection.scrollIntoView({ behavior: 'smooth' });
        }

        async function saveQuizToFirebase(quizData, result) {
            try {
                // Importa funzione di salvataggio se disponibile
                const { saveQuizResult } = await import('./firebase-functions.js');
                
                const dataToSave = {
                    ...quizData,
                    profile: result.profile,
                    lead_score: result.score,
                    completed_at: new Date().toISOString(),
                    source: 'quiz_tribucoach_v2'
                };
                
                await saveQuizResult(dataToSave);
                console.log('‚úÖ Quiz salvato in Firebase');
            } catch (error) {
                console.log('‚ÑπÔ∏è Salvataggio Firebase non disponibile:', error.message);
            }
        }
    </script>
</body>
</html>