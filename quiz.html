<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz TribuCoach - Analisi Completa del Profilo Fitness</title>
    <meta name="description" content="Quiz avanzato per analizzare il tuo profilo fitness completo e ricevere un piano personalizzato da TribuCoach">
    
    <style>
        /* Stili CSS esistenti */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #000 0%, #1a1a1a 100%);
            color: #fff;
            min-height: 100vh;
            line-height: 1.6;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
        }

        .header h1 {
            font-size: 2.8rem;
            background: linear-gradient(135deg, #ff6600, #ff9933);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 15px;
        }

        .header p {
            font-size: 1.1rem;
            color: #ccc;
        }

        .quiz-section {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.3);
        }

        .progress-bar-container {
            width: 100%;
            background-color: #333;
            border-radius: 5px;
            margin-bottom: 30px;
            overflow: hidden; /* Ensure inner bar respects border-radius */
        }

        .progress-bar {
            height: 20px;
            width: 0%;
            background-color: #ff6600;
            border-radius: 5px;
            text-align: center;
            color: #fff;
            font-weight: bold;
            line-height: 20px; /* Vertically align text */
            transition: width 0.3s ease-in-out;
        }

        .question-block {
            display: none; /* Hidden by default */
            animation: fadeIn 0.5s ease-out;
        }

        .question-block.active {
            display: block; /* Show active question */
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .question-block h2 {
            font-size: 1.8rem;
            color: #ff6600;
            margin-bottom: 25px;
            text-align: center;
        }

        .question-options {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            justify-content: center;
            margin-bottom: 30px;
        }

        .option-card {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid transparent;
            border-radius: 8px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            flex: 1 1 calc(33.333% - 20px); /* 3 cards per row */
            max-width: calc(33.333% - 20px);
            text-align: center;
        }

        .option-card:hover {
            border-color: #ff9933;
            background: rgba(255, 255, 255, 0.15);
        }

        .option-card.selected {
            border-color: #ff6600;
            background: rgba(255, 102, 0, 0.3);
            box-shadow: 0 0 15px rgba(255, 102, 0, 0.5);
            transform: translateY(-5px);
        }

        .option-card label {
            cursor: pointer;
            display: block;
            font-size: 1.1rem;
            font-weight: bold;
            color: #fff;
        }
        
        .option-card p {
            font-size: 0.9rem;
            color: #ccc;
            margin-top: 5px;
        }

        .option-card input[type="radio"],
        .option-card input[type="checkbox"] {
            display: none; /* Hide default radio/checkbox */
        }

        /* Stili per input di testo */
        input[type="text"],
        input[type="email"],
        input[type="number"] {
            width: calc(100% - 40px); /* Adjust width to fit padding */
            padding: 15px 20px;
            margin-bottom: 20px;
            border: 2px solid #555;
            border-radius: 8px;
            background-color: #333;
            color: #fff;
            font-size: 1.1rem;
            outline: none;
            transition: border-color 0.3s ease;
            display: block; /* Ensure it takes full width */
            margin-left: auto;
            margin-right: auto;
        }

        input[type="text"]:focus,
        input[type="email"]:focus,
        input[type="number"]:focus {
            border-color: #ff6600;
        }

        .navigation-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
        }

        .btn {
            background-color: #ff6600;
            color: #fff;
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.1rem;
            font-weight: bold;
            transition: background-color 0.3s ease, transform 0.2s ease;
        }

        .btn:hover {
            background-color: #ff9933;
            transform: translateY(-2px);
        }

        .btn:disabled {
            background-color: #555;
            cursor: not-allowed;
            opacity: 0.7;
            transform: none;
        }

        .btn-prev {
            background-color: #555;
        }

        .btn-prev:hover:enabled {
            background-color: #777;
        }

        #quiz-result {
            text-align: center;
            padding: 40px 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.3);
            display: none; /* Hidden until quiz is complete */
        }

        #quiz-result h2 {
            color: #ff6600;
            font-size: 2.5rem;
            margin-bottom: 20px;
        }

        #quiz-result p {
            font-size: 1.2rem;
            color: #ccc;
            margin-bottom: 10px;
        }
        
        #quiz-result #result-message {
            font-size: 1.3rem;
            color: #fff;
            margin-top: 30px;
            margin-bottom: 20px;
            line-height: 1.8;
            white-space: pre-wrap; /* Preserve whitespace for newlines */
            text-align: left; /* Align message text to left */
            background: rgba(255,102,0,0.1);
            border-radius: 8px;
            padding: 20px;
        }

        #contact-info {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        #contact-info h3 {
            color: #ff9933;
            margin-bottom: 15px;
        }

        #contact-info p {
            margin-bottom: 10px;
        }

        #contact-info .btn-contact {
            background-color: #25D366; /* WhatsApp green */
            margin-top: 15px;
            padding: 15px 30px;
            font-size: 1.2rem;
        }

        #contact-info .btn-contact:hover {
            background-color: #1DA851;
        }

        @media (max-width: 768px) {
            .option-card {
                flex: 1 1 calc(50% - 15px); /* 2 cards per row on smaller screens */
                max-width: calc(50% - 15px);
            }
            .header h1 {
                font-size: 2rem;
            }
            .question-block h2 {
                font-size: 1.5rem;
            }
            .btn {
                padding: 10px 20px;
                font-size: 1rem;
            }
        }

        @media (max-width: 480px) {
            .option-card {
                flex: 1 1 100%; /* 1 card per row on very small screens */
                max-width: 100%;
            }
            .quiz-section, #quiz-result {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <h1>Analisi Completa del Profilo Fitness</h1>
            <p>Rispondi a poche domande per ricevere un'analisi personalizzata e scoprire come TribuCoach può aiutarti a raggiungere i tuoi obiettivi.</p>
        </header>

        <main class="quiz-section" id="quiz-section">
            <div class="progress-bar-container">
                <div class="progress-bar" id="progress-bar">0%</div>
            </div>

            <div class="question-block active" id="question-1">
                <h2>1. Qual è il tuo nome e cognome?</h2>
                <input type="text" id="user-name" placeholder="Inserisci il tuo nome e cognome" required>
            </div>

            <div class="question-block" id="question-2">
                <h2>2. Qual è la tua email?</h2>
                <input type="email" id="user-email" placeholder="Inserisci la tua email" required>
            </div>

            <div class="question-block" id="question-3">
                <h2>3. Quali sono i tuoi <b>3</b> obiettivi principali? (seleziona massimo 3)</h2>
                <div class="question-options">
                    <label class="option-card">
                        <input type="checkbox" name="goals" value="perdita_peso_grasso">
                        <label>Perdita di peso/grasso</label>
                    </label>
                    <label class="option-card">
                        <input type="checkbox" name="goals" value="aumento_massa_muscolare">
                        <label>Aumento massa muscolare</label>
                    </label>
                    <label class="option-card">
                        <input type="checkbox" name="goals" value="tonificazione_generale">
                        <label>Tonificazione generale</label>
                    </label>
                    <label class="option-card">
                        <input type="checkbox" name="goals" value="aumento_forza">
                        <label>Aumento della forza</label>
                    </label>
                    <label class="option-card">
                        <input type="checkbox" name="goals" value="miglioramento_resistenza">
                        <label>Miglioramento della resistenza</label>
                    </label>
                    <label class="option-card">
                        <input type="checkbox" name="goals" value="benessere_salute">
                        <label>Benessere e salute generale</label>
                    </label>
                </div>
            </div>

            <div class="question-block" id="question-4">
                <h2>4. Quante volte a settimana vorresti allenarti?</h2>
                <div class="question-options">
                    <label class="option-card">
                        <input type="radio" name="frequency" value="1-2">
                        <label>1-2 volte</label>
                    </label>
                    <label class="option-card">
                        <input type="radio" name="frequency" value="3-4">
                        <label>3-4 volte</label>
                    </label>
                    <label class="option-card">
                        <input type="radio" name="frequency" value="5-6">
                        <label>5-6 volte</label>
                    </label>
                </div>
            </div>

            <div class="question-block" id="question-5">
                <h2>5. Dove preferisci allenarti?</h2>
                <div class="question-options">
                    <label class="option-card">
                        <input type="radio" name="place" value="palestra">
                        <label>In palestra</label>
                    </label>
                    <label class="option-card">
                        <input type="radio" name="place" value="casa">
                        <label>A casa</label>
                    </label>
                    <label class="option-card">
                        <input type="radio" name="place" value="all_aperto">
                        <label>All'aperto</label>
                    </label>
                    <label class="option-card">
                        <input type="radio" name="place" value="misto">
                        <label>Misto (palestra, casa, all'aperto)</label>
                    </label>
                </div>
            </div>

            <div class="question-block" id="question-6">
                <h2>6. Qual è il tuo livello di esperienza attuale con l'allenamento?</h2>
                <div class="question-options">
                    <label class="option-card">
                        <input type="radio" name="experience" value="principiante">
                        <label>Principiante</label>
                        <p>Inizio ora, ho poca esperienza o riparto da zero.</p>
                    </label>
                    <label class="option-card">
                        <input type="radio" name="experience" value="intermedio">
                        <label>Intermedio</label>
                        <p>Mi alleno già, ma senza un piano strutturato o risultati costanti.</p>
                    </label>
                    <label class="option-card">
                        <input type="radio" name="experience" value="avanzato">
                        <label>Avanzato</label>
                        <p>Mi alleno regolarmente, ho buona tecnica e cerco nuovi stimoli o massimizzazione dei risultati.</p>
                    </label>
                </div>
            </div>

            <div class="question-block" id="question-7">
                <h2>7. Quali sono i principali ostacoli che ti impediscono di raggiungere i tuoi obiettivi? (puoi selezionare più opzioni)</h2>
                <div class="question-options">
                    <label class="option-card">
                        <input type="checkbox" name="obstacles" value="mancanza_tempo">
                        <label>Mancanza di tempo</label>
                    </label>
                    <label class="option-card">
                        <input type="checkbox" name="obstacles" value="mancanza_motivazione">
                        <label>Mancanza di motivazione</label>
                    </label>
                    <label class="option-card">
                        <input type="checkbox" name="obstacles" value="mancanza_conoscenze">
                        <label>Mancanza di conoscenze (cosa fare, come farlo)</label>
                    </label>
                    <label class="option-card">
                        <input type="checkbox" name="obstacles" value="costo_pt">
                        <label>Costo elevato del personal trainer</label>
                    </label>
                    <label class="option-card">
                        <input type="checkbox" name="obstacles" value="difficolta_costanza">
                        <label>Difficoltà a mantenere la costanza</label>
                    </label>
                    <label class="option-card">
                        <input type="checkbox" name="obstacles" value="mancanza_risultati_passati">
                        <label>Mancanza di risultati con approcci passati</label>
                    </label>
                    <label class="option-card">
                        <input type="checkbox" name="obstacles" value="altro_ostacolo">
                        <label>Altro</label>
                    </label>
                </div>
            </div>

            <div class="question-block" id="question-8">
                <h2>8. Qual è la tua principale motivazione a migliorare la tua forma fisica?</h2>
                <div class="question-options">
                    <label class="option-card">
                        <input type="radio" name="motivation" value="salute_benessere">
                        <label>Salute e benessere generale</label>
                    </label>
                    <label class="option-card">
                        <input type="radio" name="motivation" value="aspetto_fisico">
                        <label>Miglioramento dell'aspetto fisico</label>
                    </label>
                    <label class="option-card">
                        <input type="radio" name="motivation" value="performance_sportiva">
                        <label>Aumento delle performance sportive</label>
                    </label>
                    <label class="option-card">
                        <input type="radio" name="motivation" value="stile_vita_attivo">
                        <label>Adottare uno stile di vita più attivo</label>
                    </label>
                </div>
            </div>

            <div class="question-block" id="question-9">
                <h2>9. Come descriveresti le tue attuali abitudini alimentari?</h2>
                <div class="question-options">
                    <label class="option-card">
                        <input type="radio" name="diet" value="equilibrata_consapevole">
                        <label>Equilibrata e consapevole</label>
                    </label>
                    <label class="option-card">
                        <input type="radio" name="diet" value="a_volte_sgarro">
                        <label>Generalmente buona, ma a volte "sgarro"</label>
                    </label>
                    <label class="option-card">
                        <input type="radio" name="diet" value="non_ci_penso_molto">
                        <label>Non ci penso molto, mangio quello che capita</label>
                    </label>
                </div>
            </div>

            <div class="question-block" id="question-10">
                <h2>10. Qual è il tuo livello di attività fisica quotidiana (non legata all'allenamento)?</h2>
                <div class="question-options">
                    <label class="option-card">
                        <input type="radio" name="dailyActivity" value="molto_attivo">
                        <label>Molto attivo (lavoro fisicamente impegnativo, tanti spostamenti a piedi)</label>
                    </label>
                    <label class="option-card">
                        <input type="radio" name="dailyActivity" value="moderatamente_attivo">
                        <label>Moderatamente attivo (cammino o mi muovo regolarmente durante il giorno)</label>
                    </label>
                    <label class="option-card">
                        <input type="radio" name="dailyActivity" value="sedentario">
                        <label>Sedentario (lavoro d'ufficio, poco movimento)</label>
                    </label>
                </div>
            </div>

            <div class="question-block" id="question-11">
                <h2>11. Quali attività fisiche preferisci? (puoi selezionare più opzioni)</h2>
                <div class="question-options">
                    <label class="option-card">
                        <input type="checkbox" name="preferredActivities" value="palestra">
                        <label>Palestra</label>
                    </label>
                    <label class="option-card">
                        <input type="checkbox" name="preferredActivities" value="corsa">
                        <label>Corsa</label>
                    </label>
                    <label class="option-card">
                        <input type="checkbox" name="preferredActivities" value="yoga_pilates">
                        <label>Yoga/Pilates</label>
                    </label>
                    <label class="option-card">
                        <input type="checkbox" name="preferredActivities" value="sport_di_squadra">
                        <label>Sport di squadra</label>
                    </label>
                    <label class="option-card">
                        <input type="checkbox" name="preferredActivities" value="camminate">
                        <label>Camminate</label>
                    </label>
                    <label class="option-card">
                        <input type="checkbox" name="preferredActivities" value="altro_attivita">
                        <label>Altro</label>
                    </label>
                </div>
            </div>

            <div class="question-block" id="question-12">
                <h2>12. Usi un personal trainer o ti alleni da solo?</h2>
                <div class="question-options">
                    <label class="option-card">
                        <input type="radio" name="personalTrainerUsage" value="con_pt">
                        <label>Con personal trainer</label>
                    </label>
                    <label class="option-card">
                        <input type="radio" name="personalTrainerUsage" value="da_solo">
                        <label>Mi alleno da solo</label>
                    </label>
                    <label class="option-card">
                        <input type="radio" name="personalTrainerUsage" value="entrambi">
                        <label>Entrambi</label>
                    </label>
                </div>
            </div>

            <div class="question-block" id="question-13">
                <h2>13. Quanto tempo dura in media il tuo allenamento?</h2>
                <div class="question-options">
                    <label class="option-card">
                        <input type="radio" name="avgWorkoutDuration" value="meno_30">
                        <label>Meno di 30 minuti</label>
                    </label>
                    <label class="option-card">
                        <input type="radio" name="avgWorkoutDuration" value="30-45">
                        <label>30-45 minuti</label>
                    </label>
                    <label class="option-card">
                        <input type="radio" name="avgWorkoutDuration" value="45-60">
                        <label>45-60 minuti</label>
                    </label>
                    <label class="option-card">
                        <input type="radio" name="avgWorkoutDuration" value="piu_un_ora">
                        <label>Più di un’ora</label>
                    </label>
                </div>
            </div>

            <div class="question-block" id="question-14">
                <h2>14. Fai colazione regolarmente?</h2>
                <div class="question-options">
                    <label class="option-card">
                        <input type="radio" name="breakfastHabit" value="si_ogni_giorno">
                        <label>Sì, ogni giorno</label>
                    </label>
                    <label class="option-card">
                        <input type="radio" name="breakfastHabit" value="qualche_volta">
                        <label>Qualche volta</label>
                    </label>
                    <label class="option-card">
                        <input type="radio" name="breakfastHabit" value="mai_colazione">
                        <label>Mai</label>
                    </label>
                </div>
            </div>

            <div class="question-block" id="question-15">
                <h2>15. Consumi integratori o vitamine?</h2>
                <div class="question-options">
                    <label class="option-card">
                        <input type="radio" name="supplementsUsage" value="si_regolarmente">
                        <label>Sì, regolarmente</label>
                    </label>
                    <label class="option-card">
                        <input type="radio" name="supplementsUsage" value="a_volte">
                        <label>A volte</label>
                    </label>
                    <label class="option-card">
                        <input type="radio" name="supplementsUsage" value="no_integratori">
                        <label>No</label>
                    </label>
                </div>
            </div>

            <div class="question-block" id="question-16">
                <h2>16. Quante volte mangi fuori casa ogni settimana?</h2>
                <div class="question-options">
                    <label class="option-card">
                        <input type="radio" name="eatOutFrequency" value="mai_fuori">
                        <label>Mai</label>
                    </label>
                    <label class="option-card">
                        <input type="radio" name="eatOutFrequency" value="1-2_volte">
                        <label>1-2 volte</label>
                    </label>
                    <label class="option-card">
                        <input type="radio" name="eatOutFrequency" value="3-4_volte">
                        <label>3-4 volte</label>
                    </label>
                    <label class="option-card">
                        <input type="radio" name="eatOutFrequency" value="5_piu_volte">
                        <label>5+ volte</label>
                    </label>
                </div>
            </div>

            <div class="question-block" id="question-17">
                <h2>17. Pratichi tecniche di gestione dello stress (es. meditazione, mindfulness, hobby rilassanti)?</h2>
                <div class="question-options">
                    <label class="option-card">
                        <input type="radio" name="stressManagement" value="si_ogni_giorno">
                        <label>Sì, ogni giorno</label>
                    </label>
                    <label class="option-card">
                        <input type="radio" name="stressManagement" value="si_qualche_volta">
                        <label>Sì, qualche volta</label>
                    </label>
                    <label class="option-card">
                        <input type="radio" name="stressManagement" value="no_stress">
                        <label>No</label>
                    </label>
                </div>
            </div>

            <div class="question-block" id="question-18">
                <h2>18. Ti senti soddisfatto del tuo equilibrio vita-lavoro?</h2>
                <div class="question-options">
                    <label class="option-card">
                        <input type="radio" name="workLifeBalance" value="si_molto_soddisfatto">
                        <label>Sì, molto soddisfatto</label>
                    </label>
                    <label class="option-card">
                        <input type="radio" name="workLifeBalance" value="abbastanza">
                        <label>Abbastanza</label>
                    </label>
                    <label class="option-card">
                        <input type="radio" name="workLifeBalance" value="poco">
                        <label>Poco</label>
                    </label>
                    <label class="option-card">
                        <input type="radio" name="workLifeBalance" value="per_niente">
                        <label>Per niente</label>
                    </label>
                </div>
            </div>

            <div class="question-block" id="question-19">
                <h2>19. Quanto spesso prendi pause attive (es. camminare, stretching) durante il lavoro?</h2>
                <div class="question-options">
                    <label class="option-card">
                        <input type="radio" name="activeBreaks" value="mai_pause">
                        <label>Mai</label>
                    </label>
                    <label class="option-card">
                        <input type="radio" name="activeBreaks" value="una_volta_giorno">
                        <label>Una volta al giorno</label>
                    </label>
                    <label class="option-card">
                        <input type="radio" name="activeBreaks" value="piu_volte_giorno">
                        <label>Più volte al giorno</label>
                    </label>
                    <label class="option-card">
                        <input type="radio" name="activeBreaks" value="ogni_ora">
                        <label>Ogni ora</label>
                    </label>
                </div>
            </div>

            <div class="question-block" id="question-20">
                <h2>20. Ti svegli durante la notte?</h2>
                <div class="question-options">
                    <label class="option-card">
                        <input type="radio" name="wakeUpAtNight" value="mai_svegliarsi">
                        <label>Mai</label>
                    </label>
                    <label class="option-card">
                        <input type="radio" name="wakeUpAtNight" value="raramente">
                        <label>Raramente</label>
                    </label>
                    <label class="option-card">
                        <input type="radio" name="wakeUpAtNight" value="spesso">
                        <label>Spesso</label>
                    </label>
                    <label class="option-card">
                        <input type="radio" name="wakeUpAtNight" value="sempre">
                        <label>Sempre</label>
                    </label>
                </div>
            </div>

            <div class="question-block" id="question-21">
                <h2>21. Qual è la tua principale fonte di motivazione per l'allenamento e il benessere?</h2>
                <div class="question-options">
                    <label class="option-card">
                        <input type="radio" name="mainMotivationNew" value="obiettivi_personali">
                        <label>Raggiungere obiettivi personali (es. un tempo in una gara, un certo peso)</label>
                    </label>
                    <label class="option-card">
                        <input type="radio" name="mainMotivationNew" value="salute_benessere_profondo">
                        <label>Migliorare salute e benessere generale a lungo termine</label>
                    </label>
                    <label class="option-card">
                        <input type="radio" name="mainMotivationNew" value="estetica">
                        <label>Migliorare l'aspetto estetico</label>
                    </label>
                    <label class="option-card">
                        <input type="radio" name="mainMotivationNew" value="altro_motivazione">
                        <label>Altro</label>
                    </label>
                </div>
            </div>

            <div class="question-block" id="question-22">
                <h2>22. Ti capita di saltare allenamenti per mancanza di voglia o motivazione?</h2>
                <div class="question-options">
                    <label class="option-card">
                        <input type="radio" name="skipWorkouts" value="mai_saltare">
                        <label>Mai</label>
                    </label>
                    <label class="option-card">
                        <input type="radio" name="skipWorkouts" value="raramente">
                        <label>Raramente</label>
                    </label>
                    <label class="option-card">
                        <input type="radio" name="skipWorkouts" value="a_volte">
                        <label>A volte</label>
                    </label>
                    <label class="option-card">
                        <input type="radio" name="skipWorkouts" value="spesso">
                        <label>Spesso</label>
                    </label>
                </div>
            </div>

            <div class="question-block" id="question-23">
                <h2>23. Ti confronti o cerchi feedback da altre persone (amici, coach, community) per migliorarti?</h2>
                <div class="question-options">
                    <label class="option-card">
                        <input type="radio" name="compareWithOthers" value="si_spesso">
                        <label>Sì, spesso</label>
                    </label>
                    <label class="option-card">
                        <input type="radio" name="compareWithOthers" value="a_volte">
                        <label>A volte</label>
                    </label>
                    <label class="option-card">
                        <input type="radio" name="compareWithOthers" value="raramente">
                        <label>Raramente</label>
                    </label>
                    <label class="option-card">
                        <input type="radio" name="compareWithOthers" value="mai_confronto">
                        <label>Mai</label>
                    </label>
                </div>
            </div>

            <div class="question-block" id="question-24">
                <h2>24. Usi dispositivi elettronici (smartphone, tablet, TV) nei 30 minuti prima di dormire?</h2>
                <div class="question-options">
                    <label class="option-card">
                        <input type="radio" name="electronicsBeforeSleep" value="sempre_elettronici">
                        <label>Sempre</label>
                    </label>
                    <label class="option-card">
                        <input type="radio" name="electronicsBeforeSleep" value="qualche_volta">
                        <label>Qualche volta</label>
                    </label>
                    <label class="option-card">
                        <input type="radio" name="electronicsBeforeSleep" value="raramente">
                        <label>Raramente</label>
                    </label>
                    <label class="option-card">
                        <input type="radio" name="electronicsBeforeSleep" value="mai_elettronici">
                        <label>Mai</label>
                    </label>
                </div>
            </div>

            <div class="question-block" id="question-25">
                <h2>25. Ti senti generalmente riposato e carico di energia al mattino?</h2>
                <div class="question-options">
                    <label class="option-card">
                        <input type="radio" name="restedInMorning" value="sempre_riposato">
                        <label>Sempre</label>
                    </label>
                    <label class="option-card">
                        <input type="radio" name="restedInMorning" value="spesso">
                        <label>Spesso</label>
                    </label>
                    <label class="option-card">
                        <input type="radio" name="restedInMorning" value="raramente">
                        <label>Raramente</label>
                    </label>
                    <label class="option-card">
                        <input type="radio" name="restedInMorning" value="mai_riposato">
                        <label>Mai</label>
                    </label>
                </div>
            </div>
            
            <div class="navigation-buttons">
                <button class="btn btn-prev" id="prev-btn" disabled>Indietro</button>
                <button class="btn btn-next" id="next-btn">Avanti</button>
            </div>
        </main>

        <section id="quiz-result" class="quiz-result">
            <h2>🎉 Complimenti, <span id="user-name-display">[Nome Utente]</span>!</h2>
            <p>La tua analisi è completa. Ecco il tuo profilo fitness e alcuni consigli personalizzati:</p>
            <p>Il tuo profilo: <span id="profile-type"></span> <span id="profile-icon"></span></p>
            <p>Punteggio Lead: <span id="lead-score"></span>/100</p>
            
            <div id="result-message">
                </div>

            <div id="contact-info">
                <h3>Pronto a trasformare il tuo potenziale in risultati reali?</h3>
                <p>Un coach ti contatterà a breve per discutere la tua analisi e come possiamo creare il programma perfetto per te.</p>
                <p>Oppure, contattaci subito su WhatsApp per accelerare il processo:</p>
                <button class="btn btn-contact" id="contact-whatsapp-btn">Contatta su WhatsApp</button>
            </div>
        </section>
    </div>

    <script type="module">
        import { calculateLeadScore, saveQuizResult, getProfileIcon } from './firebase-functions.js';
        import { analytics } from './firebase.js'; // Importa l'oggetto analytics
        import { logEvent } from 'https://www.gstatic.com/firebasejs/9.23.0/firebase-analytics.js'; // Importa logEvent direttamente

        let currentQuestion = 1;
        const totalQuestions = 25; // Aggiornato il numero totale di domande
        const questionMap = {
            1: { type: 'text', id: 'user-name' },
            2: { type: 'email', id: 'user-email' },
            3: { type: 'checkbox', name: 'goals', min: 1, max: 3 }, // Min 1, Max 3 per gli obiettivi
            4: { type: 'radio', name: 'frequency' },
            5: { type: 'radio', name: 'place' },
            6: { type: 'radio', name: 'experience' },
            7: { type: 'checkbox', name: 'obstacles', min: 0 }, // Min 0 per gli ostacoli (opzionale)
            8: { type: 'radio', name: 'motivation' }, // Vecchia motivazione (generale)
            9: { type: 'radio', name: 'diet' },
            10: { type: 'radio', name: 'dailyActivity' },
            // Nuove domande
            11: { type: 'checkbox', name: 'preferredActivities', min: 1 },
            12: { type: 'radio', name: 'personalTrainerUsage' },
            13: { type: 'radio', name: 'avgWorkoutDuration' },
            14: { type: 'radio', name: 'breakfastHabit' },
            15: { type: 'radio', name: 'supplementsUsage' },
            16: { type: 'radio', name: 'eatOutFrequency' },
            17: { type: 'radio', name: 'stressManagement' },
            18: { type: 'radio', name: 'workLifeBalance' },
            19: { type: 'radio', name: 'activeBreaks' },
            20: { type: 'radio', name: 'wakeUpAtNight' },
            21: { type: 'radio', name: 'mainMotivationNew' }, // Nuova motivazione (più specifica)
            22: { type: 'radio', name: 'skipWorkouts' },
            23: { type: 'radio', name: 'compareWithOthers' },
            24: { type: 'radio', name: 'electronicsBeforeSleep' },
            25: { type: 'radio', name: 'restedInMorning' }
        };

        const quizData = {};

        function updateProgress() {
            const progressBar = document.getElementById('progress-bar');
            const progress = (currentQuestion / totalQuestions) * 100;
            progressBar.style.width = progress + '%';
            progressBar.textContent = Math.round(progress) + '%';
        }

        function updateNavigation() {
            const prevBtn = document.getElementById('prev-btn');
            const nextBtn = document.getElementById('next-btn');

            prevBtn.disabled = currentQuestion === 1;
            nextBtn.textContent = currentQuestion === totalQuestions ? 'Completa' : 'Avanti';
            
            // Validate current question to enable/disable next button
            validateCurrentQuestion();
        }

        function showQuestion(questionNumber) {
            document.querySelectorAll('.question-block').forEach(block => {
                block.classList.remove('active');
            });
            document.getElementById(`question-${questionNumber}`).classList.add('active');
            updateProgress();
            updateNavigation();
        }

        function validateCurrentQuestion() {
            const currentQ = questionMap[currentQuestion];
            let isValid = false;

            if (currentQ.type === 'text' || currentQ.type === 'email') {
                const input = document.getElementById(currentQ.id);
                isValid = input.value.trim() !== '';
                if (currentQ.type === 'email') {
                    isValid = isValid && /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(input.value); // Basic email validation
                }
            } else if (currentQ.type === 'radio') {
                isValid = document.querySelector(`#question-${currentQuestion} input[name="${currentQ.name}"]:checked`) !== null;
            } else if (currentQ.type === 'checkbox') {
                const checkedCount = document.querySelectorAll(`#question-${currentQuestion} input[name="${currentQ.name}"]:checked`).length;
                isValid = checkedCount >= (currentQ.min || 1) && (currentQ.max ? checkedCount <= currentQ.max : true);
            }
            
            document.getElementById('next-btn').disabled = !isValid;
            return isValid;
        }

        function collectQuizData() {
            // General function to collect data from ALL questions
            for (let i = 1; i <= totalQuestions; i++) {
                const q = questionMap[i];
                if (q.type === 'text' || q.type === 'email') {
                    quizData[q.id] = document.getElementById(q.id).value.trim();
                } else if (q.type === 'radio') {
                    const selected = document.querySelector(`#question-${i} input[name="${q.name}"]:checked`);
                    if (selected) {
                        quizData[q.name] = selected.value;
                    }
                } else if (q.type === 'checkbox') {
                    const checkedValues = [];
                    document.querySelectorAll(`#question-${i} input[name="${q.name}"]:checked`).forEach(checkbox => {
                        checkedValues.push(checkbox.value);
                    });
                    quizData[q.name] = checkedValues;
                }
            }
        }

        async function completeQuiz() {
            collectQuizData();

            // Calculate lead score
            const leadScore = calculateLeadScore(quizData);
            quizData.lead_score = leadScore; // Store score in quizData

            // Determine profile type based on score and experience
            let profileType = 'Nuovo Esploratore';
            const experience = quizData.experience;

            if (leadScore >= 80) { // New higher thresholds due to more questions
                profileType = 'Atleta';
            } else if (leadScore >= 50) { 
                profileType = 'Guerriero';
            } else {
                profileType = 'Nuovo Esploratore';
            }

            // Refine profile type based on experience (these are more general guidelines now with more factors)
            // The score is more holistic, so experience influences less directly unless it's an extreme case.
            if (experience === 'avanzato' && leadScore < 80) {
                 // If advanced, but score is not super high, could be a very specific 'Atleta' needing niche help
                 // or perhaps their habits aren't fully aligned despite experience.
                 // We'll keep 'Atleta' if advanced unless score is extremely low.
                if (leadScore > 60) profileType = 'Atleta';
            } else if (experience === 'principiante' && leadScore >= 50) {
                 // If beginner, but high score due to good habits, still classify as 'Nuovo Esploratore'
                 // but acknowledge high potential.
                if (leadScore > 60) profileType = 'Guerriero'; // Beginner with high potential
            }


            quizData.profile = profileType; // Store profile in quizData
            
            // Save to Firestore
            try {
                const docId = await saveQuizResult(quizData);
                console.log('Quiz salvato con ID:', docId);

                // Display results
                document.getElementById('quiz-section').style.display = 'none';
                const resultSection = document.getElementById('quiz-result');
                resultSection.style.display = 'block';

                document.getElementById('profile-type').textContent = profileType;
                document.getElementById('profile-icon').textContent = getProfileIcon(profileType); 
                document.getElementById('lead-score').textContent = leadScore;
                document.getElementById('user-name-display').textContent = quizData['user-name']; // Display name in result title

                // Generate personalized message
                const personalizedMessage = generatePersonalizedMessage(quizData, leadScore, profileType);
                document.getElementById('result-message').innerHTML = personalizedMessage;

                // Update contact button for WhatsApp
                const whatsappName = encodeURIComponent(quizData['user-name'] || 'Cliente');
                const whatsappMessage = encodeURIComponent(`Ciao! Ho appena completato il quiz sul tuo sito. Sono ${quizData['user-name']} (${quizData['user-email']}). Vorrei saperne di più sul mio profilo fitness e come TribuCoach può aiutarmi.`);
                document.getElementById('contact-whatsapp-btn').onclick = () => {
                    window.open(`https://wa.me/3478881515?text=${whatsappMessage}`, '_blank');
                };

                // Log analytics
                logEvent(analytics, 'quiz_completed_success', {
                    profile_type: profileType,
                    score: leadScore
                });

            } catch (error) {
                console.error('Errore durante il completamento del quiz:', error);
                alert('Si è verificato un errore durante il salvataggio del quiz. Riprova più tardi.');
                logEvent(analytics, 'quiz_completed_error', { error_message: error.message });
            }
        }

        // Function to generate personalized message
        function generatePersonalizedMessage(quizData, score, profile) {
            let message = `Ciao **${quizData['user-name'] || 'futuro atleta'}**! Grazie per aver completato il tuo quiz. Analizzando le tue risposte, abbiamo elaborato il tuo profilo unico e preparato alcuni consigli su misura per te.\n\n`;

            message += `**Il tuo Profilo: ${profile} ${getProfileIcon(profile)}** (Punteggio: ${score}/100)\n\n`;

            // General advice based on profile
            if (profile === 'Atleta') {
                message += `Complimenti! Sei un vero **Atleta** con un'ottima base e grande determinazione. Il tuo impegno è evidente, e sei pronto a spingerti oltre per massimizzare i tuoi risultati. Con TribuCoach potrai affinare le tue tecniche, ottimizzare la periodizzazione e superare i tuoi limiti attuali con strategie avanzate e supporto continuo.\n\n`;
            } else if (profile === 'Guerriero') {
                message += `Ottimo! Sei un **Guerriero** con buona disciplina e la voglia di migliorare. Hai già delle buone abitudini, ma cerchi la spinta giusta per superare gli altopiani e raggiungere la tua massima performance. TribuCoach ti fornirà la struttura e la motivazione necessarie per trasformare i tuoi sforzi in successi concreti e duraturi.\n\n`;
            } else { // Nuovo Esploratore
                message += `Benvenuto, **Nuovo Esploratore**! Sei all'inizio del tuo percorso o cerchi un nuovo inizio. Questo è il momento perfetto per costruire solide fondamenta. TribuCoach è qui per guidarti passo dopo passo, fornendoti le conoscenze e il supporto per iniziare con il piede giusto e trasformare la tua voglia di cambiamento in risultati tangibili, senza stress.\n\n`;
            }

            message += `**Dalla tua analisi, abbiamo notato alcuni punti chiave e suggerimenti specifici:**\n\n`;

            // Personalized advice based on specific answers
            // Fitness Activities
            if (quizData.preferredActivities?.includes('camminate') && quizData.frequency !== '5-6' && quizData.goals?.includes('perdita_peso_grasso')) {
                message += `👉 Le camminate sono un ottimo punto di partenza, ma per una perdita di peso più efficace, potremmo integrare allenamenti mirati o aumentare l'intensità. Siamo qui per trovare ciò che ti stimola!\n`;
            } else if (quizData.preferredActivities?.includes('palestra') && quizData.experience === 'principiante') {
                message += `👉 Se ami la palestra e sei un principiante, un programma ben strutturato è fondamentale per prevenire infortuni e massimizzare i guadagni. Con TribuCoach, avrai un piano chiaro da seguire.\n`;
            } else if (quizData.preferredActivities?.includes('sport_di_squadra') && quizData.goals?.includes('performance_sportiva')) {
                message += `👉 La tua passione per gli sport di squadra è un grande motore! Possiamo creare programmi di forza e condizionamento specifici per migliorare la tua performance nel tuo sport preferito.\n`;
            }

            // Trainer Usage
            if (quizData.personalTrainerUsage === 'da_solo') {
                message += `👉 Allenarsi da soli è sfidante. Se senti di non progredire o cerchi maggiore responsabilità, un personal trainer può offrirti la guida e la motivazione necessarie per sbloccare il tuo potenziale.\n`;
            } else if (quizData.personalTrainerUsage === 'con_pt') {
                 message += `👉 Se ti alleni già con un personal trainer, sei sulla strada giusta per risultati di qualità! Possiamo fornirti strumenti complementari o un secondo parere per ottimizzare ulteriormente il tuo percorso.\n`;
            }

            // Workout Duration
            if (quizData.avgWorkoutDuration === 'meno_30') {
                message += `👉 Anche sessioni brevi sono efficaci! Possiamo ottimizzare al massimo il tuo tempo con allenamenti ad alta intensità o circuiti che massimizzano i risultati in meno di 30 minuti.\n`;
            } else if (quizData.avgWorkoutDuration === 'piu_un_ora') {
                message += `👉 Dedicare molto tempo all'allenamento è un impegno notevole. Assicuriamoci che ogni minuto sia efficace e che non ci sia il rischio di sovrallenamento. Un programma ottimizzato può darti di più in meno tempo.\n`;
            }

            // Breakfast Habit
            if (quizData.breakfastHabit === 'qualche_volta' || quizData.breakfastHabit === 'mai_colazione') {
                message += `👉 La colazione è il primo "carburante" della giornata. Iniziare con un pasto equilibrato può migliorare l'energia, l'umore e aiutare a controllare la fame. Ti aiuteremo a trovare opzioni facili e veloci.\n`;
            }

            // Supplements Usage
            if (quizData.supplementsUsage === 'no_integratori' && (quizData.goals?.includes('aumento_massa_muscolare') || quizData.goals?.includes('aumento_forza'))) {
                message += `👉 Per obiettivi come l'aumento di massa o forza, una valutazione su possibili integratori (proteine, creatina) potrebbe supportare i tuoi progressi, se la dieta non basta. Ma sempre con un approccio consapevole!\n`;
            } else if (quizData.supplementsUsage === 'si_regolarmente') {
                message += `👉 Ottimo che tu sia attento agli integratori! Assicuriamoci che quelli che usi siano effettivamente utili per i tuoi obiettivi e ben bilanciati con la tua dieta. Una revisione personalizzata è sempre utile.\n`;
            }

            // Eating Out Frequency
            if (quizData.eatOutFrequency === '3-4_volte' || quizData.eatOutFrequency === '5_piu_volte') {
                message += `👉 Mangiare spesso fuori casa rende più difficile il controllo della dieta. Possiamo fornirti strategie pratiche per fare scelte più sane al ristorante o preparare pasti veloci che puoi portare con te.\n`;
            } else if (quizData.eatOutFrequency === 'mai_fuori') {
                message += `👉 Complimenti per la tua disciplina alimentare! Questo è un grande vantaggio per raggiungere i tuoi obiettivi. Continua così e vediamo come ottimizzare al massimo la tua alimentazione casalinga.\n`;
            }

            // Stress Management
            if (quizData.stressManagement === 'no_stress') {
                message += `👉 Lo stress influisce notevolmente su energia, sonno e recupero. Anche semplici tecniche di gestione dello stress possono avere un impatto positivo sui tuoi risultati fisici e sul benessere generale. Scopri come integrarle!\n`;
            } else if (quizData.stressManagement === 'si_ogni_giorno') {
                 message += `👉 Fantastico che tu dia importanza alla gestione dello stress! Questo ti pone in una posizione privilegiata per massimizzare i tuoi progressi. Un corpo e una mente equilibrati sono la base del successo.\n`;
            }

            // Work-Life Balance
            if (quizData.workLifeBalance === 'poco' || quizData.workLifeBalance === 'per_niente') {
                message += `👉 Un buon equilibrio vita-lavoro è essenziale. Se ti senti sopraffatto, questo può essere un freno per i tuoi obiettivi fitness. Possiamo aiutarti a trovare soluzioni che integrino il benessere nella tua routine frenetica.\n`;
            } else if (quizData.workLifeBalance === 'si_molto_soddisfatto') {
                message += `👉 Avere un ottimo equilibrio vita-lavoro è una risorsa incredibile! Questo ti permette di dedicare energia e concentrazione al tuo benessere. Sfruttiamo al meglio questa stabilità per i tuoi obiettivi!\n`;
            }

            // Active Breaks
            if (quizData.activeBreaks === 'mai_pause' && quizData.dailyActivity === 'sedentario') {
                message += `👉 Dato il tuo lavoro sedentario, le pause attive sono fondamentali! Anche solo pochi minuti di stretching o camminata ogni ora possono migliorare la postura, la circolazione e mantenere alta l'energia.\n`;
            } else if (quizData.activeBreaks === 'ogni_ora' || quizData.activeBreaks === 'piu_volte_giorno') {
                message += `👉 Ottima abitudine le pause attive! Questo mostra proattività e attenzione alla salute anche sul lavoro. Continua così, è un pilastro importante per il tuo benessere generale.\n`;
            }

            // Sleep Quality
            if (quizData.wakeUpAtNight === 'spesso' || quizData.wakeUpAtNight === 'sempre' || quizData.restedInMorning === 'raramente' || quizData.restedInMorning === 'mai_riposato') {
                message += `👉 Il sonno è il tuo migliore alleato per il recupero e l'energia. Se la qualità del sonno è scarsa, può rallentare i tuoi progressi. Possiamo lavorare sull'igiene del sonno per migliorare il tuo riposo.\n`;
            }
            if (quizData.electronicsBeforeSleep === 'sempre_elettronici' || quizData.electronicsBeforeSleep === 'qualche_volta') {
                message += `👉 La luce blu degli schermi prima di dormire può ostacolare il sonno. Prova a creare una "zona cuscinetto" di 30-60 minuti senza dispositivi prima di coricarti per un riposo più profondo.\n`;
            } else if (quizData.electronicsBeforeSleep === 'mai_elettronici') {
                message += `👉 Complimenti per l'ottima abitudine di evitare gli schermi prima di dormire! Questo è un fattore chiave per un sonno ristoratore e un recupero ottimale. Sei già avanti su questo fronte!\n`;
            }

            // Motivation and Consistency
            if (quizData.skipWorkouts === 'a_volte' || quizData.skipWorkouts === 'spesso') {
                message += `👉 La mancanza di voglia è un ostacolo comune. Un piano personalizzato e un supporto costante possono aiutarti a superare questi momenti e a costruire una routine inarrestabile. Con TribuCoach, non sarai più solo!\n`;
            }
            if (quizData.mainMotivationNew === 'estetica' && score < 60) {
                 message += `👉 La motivazione estetica è potente, ma spesso è più sostenibile se abbinata a un focus sul benessere generale. Costruiremo un piano che ti faccia sentire bene dentro e fuori!\n`;
            } else if (quizData.mainMotivationNew === 'salute_benessere_profondo') {
                 message += `👉 La tua motivazione orientata a salute e benessere è la più solida! Questo approccio ti garantirà risultati duraturi e un miglioramento della qualità della vita. Siamo allineati sui tuoi valori!\n`;
            }

            // Comparison/Feedback
            if (quizData.compareWithOthers === 'raramente' || quizData.compareWithOthers === 'mai_confronto') {
                message += `👉 Cercare feedback e confrontarsi con altri può accelerare la crescita e offrire nuove prospettive. Entrare in una community o avere un coach è un modo eccellente per rimanere motivati e imparare.\n`;
            } else if (quizData.compareWithOthers === 'si_spesso') {
                 message += `👉 Il tuo approccio proattivo nel cercare confronto e feedback è ammirevole. Sei una persona orientata alla crescita, e questo ti porterà lontano nel tuo percorso fitness.\n`;
            }


            // Final Call to action
            message += `\n**Noi di TribuCoach siamo pronti a trasformare queste intuizioni in un piano d'azione concreto e personalizzato per te!**\n`;
            message += `Il tuo percorso personalizzato inizia adesso.`;

            return message;
        }

        // Event Listeners for option cards
        document.querySelectorAll('.option-card').forEach(card => {
            card.addEventListener('click', function() {
                const input = this.querySelector('input');
                if (input.type === 'radio') {
                    // Deselect other radio buttons in the same group
                    document.querySelectorAll(`input[name="${input.name}"]`).forEach(radio => {
                        radio.closest('.option-card').classList.remove('selected');
                    });
                    input.checked = true;
                    this.classList.add('selected');
                } else if (input.type === 'checkbox') {
                    input.checked = !input.checked; // Toggle checkbox state
                    this.classList.toggle('selected', input.checked);
                    // Specific logic for goals to limit to 3
                    if (input.name === 'goals') {
                        const checked = document.querySelectorAll('#question-3 input[name="goals"]:checked');
                        if (checked.length > 3) {
                            input.checked = false; // Revert if over limit
                            this.classList.remove('selected');
                            alert('Puoi selezionare massimo 3 obiettivi principali!');
                        }
                    }
                }
                validateCurrentQuestion();
            });
        });
        
        // Event Listeners for text/email/number inputs
        document.querySelectorAll('input[type="text"], input[type="email"], input[type="number"]').forEach(input => {
            input.addEventListener('input', validateCurrentQuestion);
        });
        
        // Navigation button logic
        document.getElementById('next-btn').addEventListener('click', () => {
            if (validateCurrentQuestion()) {
                if (currentQuestion < totalQuestions) {
                    currentQuestion++;
                    showQuestion(currentQuestion);
                } else {
                    completeQuiz();
                }
            }
        });

        document.getElementById('prev-btn').addEventListener('click', () => {
            if (currentQuestion > 1) {
                currentQuestion--;
                showQuestion(currentQuestion);
            }
        });

        // Initialize quiz on page load
        document.addEventListener('DOMContentLoaded', () => {
            showQuestion(currentQuestion); // Show the first question
            validateCurrentQuestion(); // Validare la prima domanda al caricamento
            logEvent(analytics, 'advanced_quiz_started'); // Log inizio quiz
        });
    </script>
</body>
</html>