<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Settimana 7 - Consolidamento e Futuro | Andrea Padoan Coach</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #f8fafc 0%, #fff7ed 50%, #f0fdf4 100%);
            min-height: 100vh;
            color: #1e293b;
        }

        /* Header */
        .header {
            background: linear-gradient(135deg, #1e293b 0%, #ea580c 100%);
            color: white;
            padding: 2rem 0;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 1.3rem;
            font-weight: bold;
        }

        .session-info {
            display: flex;
            align-items: center;
            gap: 2rem;
        }

        .timer-display {
            background: rgba(255,255,255,0.2);
            padding: 0.5rem 1rem;
            border-radius: 8px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .progress-bar {
            background: rgba(255,255,255,0.2);
            width: 200px;
            height: 8px;
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-fill {
            background: #22c55e;
            height: 100%;
            width: 0%;
            transition: width 0.3s ease;
        }

        .back-button {
            background: rgba(255,255,255,0.2);
            padding: 0.5rem 1rem;
            border-radius: 8px;
            text-decoration: none;
            color: white;
            transition: all 0.3s ease;
        }

        .back-button:hover {
            background: rgba(255,255,255,0.3);
        }

        /* Main Content */
        .main-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }

        /* Phase Indicator */
        .phase-indicator {
            background: white;
            border-radius: 12px;
            padding: 1rem 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .phase-step {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            font-weight: 600;
            min-width: 250px;
        }

        .phase-step.active {
            background: linear-gradient(135deg, #ea580c 0%, #fb923c 100%);
            color: white;
        }

        .phase-step.completed {
            background: linear-gradient(135deg, #16a34a 0%, #22c55e 100%);
            color: white;
        }

        .phase-step.inactive {
            background: #f1f5f9;
            color: #94a3b8;
        }

        .phase-arrow {
            font-size: 1.5rem;
            color: #64748b;
        }

        /* Welcome Section */
        .welcome-section {
            background: white;
            border-radius: 16px;
            padding: 3rem;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            margin-bottom: 2rem;
            text-align: center;
        }

        .welcome-title {
            font-size: 2.5rem;
            font-weight: bold;
            color: #1e293b;
            margin-bottom: 1rem;
        }

        .welcome-subtitle {
            font-size: 1.3rem;
            color: #ea580c;
            margin-bottom: 2rem;
        }

        .journey-recap {
            background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);
            border-radius: 12px;
            padding: 2rem;
            margin-bottom: 2rem;
            text-align: left;
        }

        .recap-title {
            font-size: 1.3rem;
            font-weight: bold;
            color: #16a34a;
            margin-bottom: 1rem;
            text-align: center;
        }

        .weeks-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .week-card {
            background: white;
            padding: 1rem;
            border-radius: 8px;
            border-left: 4px solid #16a34a;
            transition: transform 0.2s ease;
        }

        .week-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .week-number {
            font-size: 1.1rem;
            font-weight: bold;
            color: #16a34a;
            margin-bottom: 0.5rem;
        }

        .week-title {
            font-size: 0.9rem;
            color: #1e293b;
            margin-bottom: 0.5rem;
        }

        .week-insight {
            font-size: 0.8rem;
            color: #64748b;
            font-style: italic;
        }

        .process-explanation {
            background: linear-gradient(135deg, #fff7ed 0%, #fed7aa 100%);
            border-radius: 12px;
            padding: 2rem;
            margin-bottom: 2rem;
            text-align: left;
        }

        .process-title {
            font-size: 1.3rem;
            font-weight: bold;
            color: #ea580c;
            margin-bottom: 1rem;
            text-align: center;
        }

        .process-steps {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
        }

        .process-step {
            background: white;
            padding: 1.5rem;
            border-radius: 8px;
            border-left: 4px solid #ea580c;
        }

        .step-number {
            font-size: 1.5rem;
            font-weight: bold;
            color: #ea580c;
            margin-bottom: 0.5rem;
        }

        .step-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: #1e293b;
            margin-bottom: 0.5rem;
        }

        .step-description {
            font-size: 0.9rem;
            color: #64748b;
            line-height: 1.5;
        }

        .step-duration {
            font-size: 0.8rem;
            color: #ea580c;
            font-weight: 600;
            margin-top: 0.5rem;
        }

        /* Phase 1 - Assessment & Review */
        .phase1-section {
            background: white;
            border-radius: 16px;
            padding: 2rem;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            margin-bottom: 2rem;
            display: none;
        }

        .phase1-section.active {
            display: block;
        }

        .phase-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid #f1f5f9;
        }

        .phase-icon {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #1e293b 0%, #ea580c 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: white;
        }

        .phase-title {
            font-size: 1.5rem;
            font-weight: bold;
            color: #1e293b;
            margin-bottom: 0.5rem;
        }

        .phase-subtitle {
            font-size: 1rem;
            color: #64748b;
        }

        .assessment-progress {
            background: #f1f5f9;
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1.5rem;
            text-align: center;
        }

        .assessment-progress-text {
            font-size: 0.9rem;
            color: #64748b;
            margin-bottom: 0.5rem;
        }

        .assessment-progress-bar {
            background: #e2e8f0;
            height: 8px;
            border-radius: 4px;
            overflow: hidden;
        }

        .assessment-progress-fill {
            background: linear-gradient(135deg, #16a34a 0%, #22c55e 100%);
            height: 100%;
            transition: width 0.3s ease;
        }

        .assessment-section {
            margin-bottom: 2rem;
            padding: 1.5rem;
            background: #f8fafc;
            border-radius: 12px;
            border-left: 4px solid #ea580c;
        }

        .assessment-section h3 {
            color: #1e293b;
            margin-bottom: 1rem;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .assessment-intro {
            background: #fff7ed;
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1.5rem;
            font-style: italic;
            color: #ea580c;
        }

        .question-group {
            margin-bottom: 2rem;
            padding: 1rem;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .question-text {
            font-weight: 600;
            margin-bottom: 1rem;
            color: #1e293b;
            font-size: 1.1rem;
        }

        .likert-scale {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 1rem;
            margin: 1rem 0;
        }

        .likert-option {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.5rem;
            flex: 1;
        }

        .likert-option input[type="radio"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        .likert-label {
            font-size: 0.8rem;
            text-align: center;
            color: #64748b;
            line-height: 1.2;
        }

        .transformation-tracker {
            background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);
            border-radius: 12px;
            padding: 2rem;
            margin-bottom: 2rem;
        }

        .tracker-title {
            font-size: 1.3rem;
            font-weight: bold;
            color: #16a34a;
            margin-bottom: 1rem;
            text-align: center;
        }

        .comparison-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
        }

        .before-after {
            background: white;
            padding: 1.5rem;
            border-radius: 8px;
            border-left: 4px solid #16a34a;
        }

        .ba-title {
            font-weight: 600;
            color: #1e293b;
            margin-bottom: 1rem;
            text-align: center;
        }

        .ba-content {
            min-height: 120px;
            border: 2px dashed #e2e8f0;
            border-radius: 8px;
            padding: 1rem;
            font-style: italic;
            color: #64748b;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            color: #374151;
            font-weight: 500;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: #ea580c;
        }

        .form-group textarea {
            resize: vertical;
            min-height: 100px;
        }

        /* Phase 2 - Future Coaching */
        .phase2-section {
            background: white;
            border-radius: 16px;
            padding: 2rem;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            margin-bottom: 2rem;
            display: none;
        }

        .phase2-section.active {
            display: block;
        }

        .coaching-context {
            background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);
            border-radius: 12px;
            padding: 2rem;
            margin-bottom: 2rem;
        }

        .coaching-context h3 {
            color: #16a34a;
            margin-bottom: 1rem;
            font-size: 1.3rem;
        }

        .coaching-context p {
            color: #15803d;
            line-height: 1.6;
            margin-bottom: 1rem;
        }

        .results-summary {
            background: white;
            padding: 1.5rem;
            border-radius: 8px;
            border-left: 4px solid #16a34a;
        }

        .results-title {
            font-weight: 600;
            color: #1e293b;
            margin-bottom: 0.5rem;
        }

        .results-list {
            list-style: none;
            padding: 0;
        }

        .results-list li {
            padding: 0.25rem 0;
            color: #64748b;
            font-size: 0.9rem;
        }

        .chat-container {
            background: #f8fafc;
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            min-height: 400px;
            max-height: 500px;
            overflow-y: auto;
        }

        .message {
            margin-bottom: 1rem;
            padding: 1rem;
            border-radius: 12px;
            max-width: 85%;
            animation: messageSlide 0.3s ease-out;
        }

        .message.coach {
            background: linear-gradient(135deg, #fff7ed 0%, #fed7aa 100%);
            margin-right: auto;
        }

        .message.user {
            background: linear-gradient(135deg, #e0f2fe 0%, #b3e5fc 100%);
            margin-left: auto;
            text-align: right;
        }

        .message-content {
            font-size: 1rem;
            line-height: 1.5;
            margin-bottom: 0.5rem;
        }

        .message-time {
            font-size: 0.8rem;
            color: #64748b;
        }

        .chat-input {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .chat-input input {
            flex: 1;
            padding: 0.75rem;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 1rem;
        }

        .chat-input input:focus {
            outline: none;
            border-color: #ea580c;
        }

        .chat-status {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 1rem;
            font-size: 0.9rem;
            color: #16a34a;
        }

        .status-dot {
            width: 10px;
            height: 10px;
            background: #22c55e;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        /* Completion Section */
        .completion-section {
            background: white;
            border-radius: 16px;
            padding: 2rem;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            margin-top: 2rem;
            display: none;
        }

        .completion-section.active {
            display: block;
        }

        .completion-title {
            font-size: 2.5rem;
            font-weight: bold;
            color: #1e293b;
            margin-bottom: 1rem;
            text-align: center;
        }

        .completion-message {
            font-size: 1.2rem;
            line-height: 1.6;
            color: #475569;
            margin-bottom: 2rem;
            text-align: center;
        }

        .celebration-section {
            background: linear-gradient(135deg, #fef3c7 0%, #fed7aa 100%);
            border-radius: 12px;
            padding: 2rem;
            margin-bottom: 2rem;
            text-align: center;
        }

        .celebration-title {
            font-size: 1.8rem;
            font-weight: bold;
            color: #ea580c;
            margin-bottom: 1rem;
        }

        .celebration-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .stat-item {
            background: white;
            padding: 1rem;
            border-radius: 8px;
            text-align: center;
        }

        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            color: #ea580c;
            margin-bottom: 0.5rem;
        }

        .stat-label {
            font-size: 0.9rem;
            color: #64748b;
        }

        .transformation-results {
            background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);
            border-radius: 12px;
            padding: 2rem;
            margin-bottom: 2rem;
        }

        .transformation-title {
            font-size: 1.3rem;
            font-weight: bold;
            color: #16a34a;
            margin-bottom: 1rem;
        }

        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .result-item {
            background: white;
            padding: 1rem;
            border-radius: 8px;
            text-align: center;
            border-left: 4px solid #16a34a;
        }

        .result-score {
            font-size: 1.5rem;
            font-weight: bold;
            color: #16a34a;
            margin-bottom: 0.5rem;
        }

        .result-label {
            font-size: 0.9rem;
            color: #64748b;
            margin-bottom: 0.5rem;
        }

        .result-feedback {
            font-size: 0.8rem;
            color: #15803d;
            font-style: italic;
        }

        .maintenance-plan {
            background: linear-gradient(135deg, #fff7ed 0%, #fed7aa 100%);
            border-radius: 12px;
            padding: 2rem;
            margin-bottom: 2rem;
        }

        .maintenance-title {
            font-size: 1.3rem;
            font-weight: bold;
            color: #ea580c;
            margin-bottom: 1rem;
        }

        .plan-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
        }

        .plan-section {
            background: white;
            padding: 1.5rem;
            border-radius: 8px;
            border-left: 4px solid #ea580c;
        }

        .plan-section-title {
            font-weight: 600;
            color: #1e293b;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .plan-list {
            list-style: none;
            padding: 0;
        }

        .plan-list li {
            padding: 0.5rem 0;
            border-bottom: 1px solid rgba(234, 88, 12, 0.2);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .plan-list li:last-child {
            border-bottom: none;
        }

        .completion-actions {
            display: flex;
            justify-content: center;
            gap: 1rem;
            flex-wrap: wrap;
        }

        /* Buttons */
        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 1rem;
        }

        .btn-primary {
            background: linear-gradient(135deg, #1e293b 0%, #ea580c 100%);
            color: white;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(0,0,0,0.3);
        }

        .btn-secondary {
            background: white;
            color: #1e293b;
            border: 2px solid #e2e8f0;
        }

        .btn-secondary:hover {
            border-color: #ea580c;
            color: #ea580c;
        }

        .btn-success {
            background: linear-gradient(135deg, #16a34a 0%, #22c55e 100%);
            color: white;
        }

        .btn-success:hover {
            transform: translateY(-2px);
        }

        .btn-disabled {
            background: #94a3b8;
            color: white;
            cursor: not-allowed;
        }

        .btn-celebration {
            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
            color: white;
            font-size: 1.2rem;
            padding: 1rem 2rem;
        }

        .btn-celebration:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(251, 191, 36, 0.4);
        }

        /* Navigation Buttons */
        .form-navigation {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-top: 2rem;
            padding-top: 1rem;
            border-top: 1px solid #e2e8f0;
        }

        /* Time Warning */
        .time-warning {
            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
            color: white;
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
            text-align: center;
            display: none;
        }

        .time-warning.active {
            display: block;
        }

        /* Animations */
        @keyframes messageSlide {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes celebrate {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }

        .celebrate {
            animation: celebrate 0.6s ease-in-out;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .main-content {
                padding: 1rem;
            }
            
            .process-steps {
                grid-template-columns: 1fr;
            }
            
            .phase-indicator {
                flex-direction: column;
                gap: 0.5rem;
            }
            
            .phase-step {
                min-width: auto;
                width: 100%;
                justify-content: center;
            }
            
            .phase-arrow {
                transform: rotate(90deg);
            }
            
            .likert-scale {
                flex-direction: column;
                gap: 0.5rem;
            }
            
            .comparison-grid,
            .plan-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <div class="logo">🏆 Settimana 7 - Consolidamento e Futuro</div>
            <div class="session-info">
                <div class="timer-display">
                    ⏱️ <span id="sessionTimer">50:00</span>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="sessionProgress"></div>
                </div>
                <a href="module-hub.html" class="back-button">← Torna ai Moduli</a>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Phase Indicator -->
        <div class="phase-indicator">
            <div class="phase-step active" id="phaseStep1">
                <span>📊</span>
                <span>Fase 1: Assessment & Review Percorso</span>
            </div>
            <div class="phase-arrow">→</div>
            <div class="phase-step inactive" id="phaseStep2">
                <span>🚀</span>
                <span>Fase 2: Coaching Futuro & Consolidamento</span>
            </div>
        </div>

        <!-- Welcome Section -->
        <section class="welcome-section fade-in" id="welcomeSection">
            <h1 class="welcome-title">Benvenuto nella Settimana Finale! 🎉</h1>
            <p class="welcome-subtitle">Consolidamento e Futuro - Il Culmine del Tuo Viaggio di Trasformazione</p>
            
            <div class="journey-recap">
                <h3 class="recap-title">🌟 Il Tuo Straordinario Viaggio di 7 Settimane</h3>
                <div class="weeks-grid" id="weeksGrid">
                    <div class="week-card">
                        <div class="week-number">Settimana 1</div>
                        <div class="week-title">Incontro Conoscitivo</div>
                        <div class="week-insight">Hai scoperto i tuoi obiettivi autentici</div>
                    </div>
                    <div class="week-card">
                        <div class="week-number">Settimana 2</div>
                        <div class="week-title">Consapevolezza di Sé</div>
                        <div class="week-insight">Hai esplorato la tua identità profonda</div>
                    </div>
                    <div class="week-card">
                        <div class="week-number">Settimana 3</div>
                        <div class="week-title">Obiettivi SMART</div>
                        <div class="week-insight">Hai creato obiettivi concreti e misurabili</div>
                    </div>
                    <div class="week-card">
                        <div class="week-number">Settimana 4</div>
                        <div class="week-title">Piano di Azione</div>
                        <div class="week-insight">Hai costruito la roadmap del successo</div>
                    </div>
                    <div class="week-card">
                        <div class="week-number">Settimana 5</div>
                        <div class="week-title">Trasformazione Abitudini</div>
                        <div class="week-insight">Hai implementato abitudini vincenti</div>
                    </div>
                    <div class="week-card">
                        <div class="week-number">Settimana 6</div>
                        <div class="week-title">Scopri le Potenzialità</div>
                        <div class="week-insight">Hai identificato i tuoi super-poteri</div>
                    </div>
                </div>
            </div>
            
            <div class="process-explanation">
                <h3 class="process-title">🎯 La Tua Sessione Finale di Trasformazione</h3>
                <div class="process-steps">
                    <div class="process-step">
                        <div class="step-number">1</div>
                        <div class="step-title">Assessment Completo del Percorso</div>
                        <div class="step-description">
                            Valutiamo i risultati ottenuti, le trasformazioni avvenute e 
                            la crescita personale attraverso test comparativi e domande di riflessione.
                        </div>
                        <div class="step-duration">⏱️ 20 minuti</div>
                    </div>
                    <div class="process-step">
                        <div class="step-number">2</div>
                        <div class="step-title">Coaching Futuro & Piano Mantenimento</div>
                        <div class="step-description">
                            Creiamo la visione del tuo futuro, il piano di mantenimento a lungo termine 
                            e gli obiettivi next-level per continuare la crescita.
                        </div>
                        <div class="step-duration">⏱️ 25-30 minuti</div>
                    </div>
                </div>
            </div>
            
            <button class="btn btn-primary" onclick="startPhase1()">
                🚀 Inizia la Tua Sessione Finale di Trasformazione
            </button>
        </section>

        <!-- Phase 1: Assessment & Review -->
        <section class="phase1-section" id="phase1Section">
            <div class="phase-header">
                <div class="phase-icon">📊</div>
                <div>
                    <h2 class="phase-title">Fase 1: Assessment Completo del Percorso</h2>
                    <p class="phase-subtitle">Misuriamo i risultati e celebriamo la tua trasformazione</p>
                </div>
            </div>
            
            <div class="assessment-progress">
                <div class="assessment-progress-text">Progresso assessment: <span id="assessmentProgress">0%</span></div>
                <div class="assessment-progress-bar">
                    <div class="assessment-progress-fill" id="assessmentProgressFill" style="width: 0%"></div>
                </div>
            </div>
            
            <form id="assessmentForm">
                <!-- Assessment Trasformazione Personale -->
                <div class="assessment-section" id="personalTransformation">
                    <h3>🌟 Trasformazione Personale</h3>
                    <div class="assessment-intro">
                        Confrontiamo dove eri all'inizio del percorso con dove sei ora. 
                        Valuta ogni affermazione su una scala da 1 (per nulla) a 5 (completamente).
                    </div>
                    
                    <div class="question-group">
                        <div class="question-text">Ora ho chiarezza sui miei obiettivi di vita</div>
                        <div class="likert-scale">
                            <div class="likert-option">
                                <input type="radio" name="clarity1" value="1" onchange="updateAssessmentProgress(); autoSave()">
                                <span class="likert-label">Per nulla</span>
                            </div>
                            <div class="likert-option">
                                <input type="radio" name="clarity1" value="2" onchange="updateAssessmentProgress(); autoSave()">
                                <span class="likert-label">Poco</span>
                            </div>
                            <div class="likert-option">
                                <input type="radio" name="clarity1" value="3" onchange="updateAssessmentProgress(); autoSave()">
                                <span class="likert-label">Abbastanza</span>
                            </div>
                            <div class="likert-option">
                                <input type="radio" name="clarity1" value="4" onchange="updateAssessmentProgress(); autoSave()">
                                <span class="likert-label">Molto</span>
                            </div>
                            <div class="likert-option">
                                <input type="radio" name="clarity1" value="5" onchange="updateAssessmentProgress(); autoSave()">
                                <span class="likert-label">Completamente</span>
                            </div>
                        </div>
                    </div>

                    <div class="question-group">
                        <div class="question-text">Mi sento più sicuro delle mie capacità e del mio valore</div>
                        <div class="likert-scale">
                            <div class="likert-option">
                                <input type="radio" name="confidence1" value="1" onchange="updateAssessmentProgress(); autoSave()">
                                <span class="likert-label">Per nulla</span>
                            </div>
                            <div class="likert-option">
                                <input type="radio" name="confidence1" value="2" onchange="updateAssessmentProgress(); autoSave()">
                                <span class="likert-label">Poco</span>
                            </div>
                            <div class="likert-option">
                                <input type="radio" name="confidence1" value="3" onchange="updateAssessmentProgress(); autoSave()">
                                <span class="likert-label">Abbastanza</span>
                            </div>
                            <div class="likert-option">
                                <input type="radio" name="confidence1" value="4" onchange="updateAssessmentProgress(); autoSave()">
                                <span class="likert-label">Molto</span>
                            </div>
                            <div class="likert-option">
                                <input type="radio" name="confidence1" value="5" onchange="updateAssessmentProgress(); autoSave()">
                                <span class="likert-label">Completamente</span>
                            </div>
                        </div>
                    </div>

                    <div class="question-group">
                        <div class="question-text">Ho sviluppato abitudini positive che mi supportano quotidianamente</div>
                        <div class="likert-scale">
                            <div class="likert-option">
                                <input type="radio" name="habits1" value="1" onchange="updateAssessmentProgress(); autoSave()">
                                <span class="likert-label">Per nulla</span>
                            </div>
                            <div class="likert-option">
                                <input type="radio" name="habits1" value="2" onchange="updateAssessmentProgress(); autoSave()">
                                <span class="likert-label">Poco</span>
                            </div>
                            <div class="likert-option">
                                <input type="radio" name="habits1" value="3" onchange="updateAssessmentProgress(); autoSave()">
                                <span class="likert-label">Abbastanza</span>
                            </div>
                            <div class="likert-option">
                                <input type="radio" name="habits1" value="4" onchange="updateAssessmentProgress(); autoSave()">
                                <span class="likert-label">Molto</span>
                            </div>
                            <div class="likert-option">
                                <input type="radio" name="habits1" value="5" onchange="updateAssessmentProgress(); autoSave()">
                                <span class="likert-label">Completamente</span>
                            </div>
                        </div>
                    </div>

                    <div class="question-group">
                        <div class="question-text">Riesco a gestire meglio lo stress e le sfide quotidiane</div>
                        <div class="likert-scale">
                            <div class="likert-option">
                                <input type="radio" name="stress1" value="1" onchange="updateAssessmentProgress(); autoSave()">
                                <span class="likert-label">Per nulla</span>
                            </div>
                            <div class="likert-option">
                                <input type="radio" name="stress1" value="2" onchange="updateAssessmentProgress(); autoSave()">
                                <span class="likert-label">Poco</span>
                            </div>
                            <div class="likert-option">
                                <input type="radio" name="stress1" value="3" onchange="updateAssessmentProgress(); autoSave()">
                                <span class="likert-label">Abbastanza</span>
                            </div>
                            <div class="likert-option">
                                <input type="radio" name="stress1" value="4" onchange="updateAssessmentProgress(); autoSave()">
                                <span class="likert-label">Molto</span>
                            </div>
                            <div class="likert-option">
                                <input type="radio" name="stress1" value="5" onchange="updateAssessmentProgress(); autoSave()">
                                <span class="likert-label">Completamente</span>
                            </div>
                        </div>
                    </div>

                    <div class="question-group">
                        <div class="question-text">Sono più consapevole delle mie potenzialità e punti di forza</div>
                        <div class="likert-scale">
                            <div class="likert-option">
                                <input type="radio" name="potential1" value="1" onchange="updateAssessmentProgress(); autoSave()">
                                <span class="likert-label">Per nulla</span>
                            </div>
                            <div class="likert-option">
                                <input type="radio" name="potential1" value="2" onchange="updateAssessmentProgress(); autoSave()">
                                <span class="likert-label">Poco</span>
                            </div>
                            <div class="likert-option">
                                <input type="radio" name="potential1" value="3" onchange="updateAssessmentProgress(); autoSave()">
                                <span class="likert-label">Abbastanza</span>
                            </div>
                            <div class="likert-option">
                                <input type="radio" name="potential1" value="4" onchange="updateAssessmentProgress(); autoSave()">
                                <span class="likert-label">Molto</span>
                            </div>
                            <div class="likert-option">
                                <input type="radio" name="potential1" value="5" onchange="updateAssessmentProgress(); autoSave()">
                                <span class="likert-label">Completamente</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Assessment Risultati Concreti -->
                <div class="assessment-section" id="concreteResults">
                    <h3>🎯 Risultati Concreti Ottenuti</h3>
                    <div class="assessment-intro">
                        Valutiamo i progressi tangibili e misurabili che hai raggiunto durante questo percorso.
                    </div>
                    
                    <div class="question-group">
                        <div class="question-text">Ho raggiunto obiettivi concreti che mi ero prefissato all'inizio</div>
                        <div class="likert-scale">
                            <div class="likert-option">
                                <input type="radio" name="goals1" value="1" onchange="updateAssessmentProgress(); autoSave()">
                                <span class="likert-label">Per nulla</span>
                            </div>
                            <div class="likert-option">
                                <input type="radio" name="goals1" value="2" onchange="updateAssessmentProgress(); autoSave()">
                                <span class="likert-label">Poco</span>
                            </div>
                            <div class="likert-option">
                                <input type="radio" name="goals1" value="3" onchange="updateAssessmentProgress(); autoSave()">
                                <span class="likert-label">Abbastanza</span>
                            </div>
                            <div class="likert-option">
                                <input type="radio" name="goals1" value="4" onchange="updateAssessmentProgress(); autoSave()">
                                <span class="likert-label">Molto</span>
                            </div>
                            <div class="likert-option">
                                <input type="radio" name="goals1" value="5" onchange="updateAssessmentProgress(); autoSave()">
                                <span class="likert-label">Completamente</span>
                            </div>
                        </div>
                    </div>

                    <div class="question-group">
                        <div class="question-text">La mia vita quotidiana è migliorata in modo significativo</div>
                        <div class="likert-scale">
                            <div class="likert-option">
                                <input type="radio" name="life1" value="1" onchange="updateAssessmentProgress(); autoSave()">
                                <span class="likert-label">Per nulla</span>
                            </div>
                            <div class="likert-option">
                                <input type="radio" name="life1" value="2" onchange="updateAssessmentProgress(); autoSave()">
                                <span class="likert-label">Poco</span>
                            </div>
                            <div class="likert-option">
                                <input type="radio" name="life1" value="3" onchange="updateAssessmentProgress(); autoSave()">
                                <span class="likert-label">Abbastanza</span>
                            </div>
                            <div class="likert-option">
                                <input type="radio" name="life1" value="4" onchange="updateAssessmentProgress(); autoSave()">
                                <span class="likert-label">Molto</span>
                            </div>
                            <div class="likert-option">
                                <input type="radio" name="life1" value="5" onchange="updateAssessmentProgress(); autoSave()">
                                <span class="likert-label">Completamente</span>
                            </div>
                        </div>
                    </div>

                    <div class="question-group">
                        <div class="question-text">Le persone attorno a me hanno notato cambiamenti positivi</div>
                        <div class="likert-scale">
                            <div class="likert-option">
                                <input type="radio" name="others1" value="1" onchange="updateAssessmentProgress(); autoSave()">
                                <span class="likert-label">Per nulla</span>
                            </div>
                            <div class="likert-option">
                                <input type="radio" name="others1" value="2" onchange="updateAssessmentProgress(); autoSave()">
                                <span class="likert-label">Poco</span>
                            </div>
                            <div class="likert-option">
                                <input type="radio" name="others1" value="3" onchange="updateAssessmentProgress(); autoSave()">
                                <span class="likert-label">Abbastanza</span>
                            </div>
                            <div class="likert-option">
                                <input type="radio" name="others1" value="4" onchange="updateAssessmentProgress(); autoSave()">
                                <span class="likert-label">Molto</span>
                            </div>
                            <div class="likert-option">
                                <input type="radio" name="others1" value="5" onchange="updateAssessmentProgress(); autoSave()">
                                <span class="likert-label">Completamente</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Trasformazioni Prima/Dopo -->
                <div class="transformation-tracker">
                    <h3 class="tracker-title">🔄 La Tua Trasformazione Prima/Dopo</h3>
                    <div class="comparison-grid">
                        <div class="before-after">
                            <div class="ba-title">PRIMA del Percorso</div>
                            <div class="form-group">
                                <label for="beforeMindset">Come ti descrivevi mentalmente?</label>
                                <textarea id="beforeMindset" placeholder="Es: Confuso, demotivato, senza direzione..." onchange="updateAssessmentProgress(); autoSave()"></textarea>
                            </div>
                            <div class="form-group">
                                <label for="beforeHabits">Quali erano le tue abitudini principali?</label>
                                <textarea id="beforeHabits" placeholder="Es: Procrastinazione, cattiva alimentazione..." onchange="updateAssessmentProgress(); autoSave()"></textarea>
                            </div>
                            <div class="form-group">
                                <label for="beforeChallenges">Quali erano le tue sfide maggiori?</label>
                                <textarea id="beforeChallenges" placeholder="Es: Mancanza di energia, obiettivi vaghi..." onchange="updateAssessmentProgress(); autoSave()"></textarea>
                            </div>
                        </div>
                        <div class="before-after">
                            <div class="ba-title">DOPO il Percorso</div>
                            <div class="form-group">
                                <label for="afterMindset">Come ti descrivi ora mentalmente?</label>
                                <textarea id="afterMindset" placeholder="Es: Focalizzato, motivato, con chiarezza..." onchange="updateAssessmentProgress(); autoSave()"></textarea>
                            </div>
                            <div class="form-group">
                                <label for="afterHabits">Quali sono le tue nuove abitudini?</label>
                                <textarea id="afterHabits" placeholder="Es: Routine mattutina, esercizio regolare..." onchange="updateAssessmentProgress(); autoSave()"></textarea>
                            </div>
                            <div class="form-group">
                                <label for="afterStrengths">Quali sono i tuoi nuovi punti di forza?</label>
                                <textarea id="afterStrengths" placeholder="Es: Disciplina, pianificazione, autostima..." onchange="updateAssessmentProgress(); autoSave()"></textarea>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Domande di Riflessione Profonda -->
                <div class="assessment-section" id="deepReflection">
                    <h3>🤔 Riflessione Profonda</h3>
                    <div class="assessment-intro">
                        Queste domande ci aiuteranno a comprendere il significato profondo della tua trasformazione.
                    </div>
                    
                    <div class="form-group">
                        <label for="biggestChange">Qual è il cambiamento più grande che hai sperimentato in queste 7 settimane?</label>
                        <textarea id="biggestChange" placeholder="Rifletti sul cambiamento più significativo che è avvenuto in te..." onchange="updateAssessmentProgress(); autoSave()"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="proudestMoment">Di quale momento o risultato di questo percorso sei più orgoglioso?</label>
                        <textarea id="proudestMoment" placeholder="Racconta il momento in cui ti sei sentito più orgoglioso di te stesso..." onchange="updateAssessmentProgress(); autoSave()"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="biggestLearning">Qual è l'apprendimento più importante che porterai con te per sempre?</label>
                        <textarea id="biggestLearning" placeholder="Cosa hai imparato che cambierà per sempre il tuo approccio alla vita?" onchange="updateAssessmentProgress(); autoSave()"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="futureCommitment">A cosa ti impegni per mantenere e continuare questa crescita?</label>
                        <textarea id="futureCommitment" placeholder="Quali impegni prendi con te stesso per il futuro?" onchange="updateAssessmentProgress(); autoSave()"></textarea>
                    </div>
                </div>

                <div class="form-navigation">
                    <button type="button" class="btn btn-success" id="completeAssessmentBtn" onclick="completePhase1()" disabled>
                        ✅ Completa Assessment e Inizia Coaching Futuro
                    </button>
                </div>
            </form>
        </section>

        <!-- Phase 2: Future Coaching -->
        <section class="phase2-section" id="phase2Section">
            <div class="phase-header">
                <div class="phase-icon">🚀</div>
                <div>
                    <h2 class="phase-title">Fase 2: Coaching Futuro & Piano Mantenimento</h2>
                    <p class="phase-subtitle">Creiamo insieme il tuo futuro straordinario e sostenibile</p>
                </div>
            </div>
            
            <div class="coaching-context">
                <h3>🌟 Il Tuo Profilo di Trasformazione Completato</h3>
                <p>
                    Straordinario! Hai completato un percorso di 7 settimane che ti ha portato 
                    a scoprire chi sei veramente, cosa vuoi davvero e come raggiungerlo. 
                    Ora è il momento di guardare al futuro e creare un piano che mantenga 
                    e amplifichi questa crescita.
                </p>
                
                <div class="results-summary">
                    <div class="results-title">💡 Risultati del Tuo Assessment:</div>
                    <ul class="results-list" id="assessmentResults">
                        <li>Caricamento risultati personalizzati...</li>
                    </ul>
                </div>
            </div>
            
            <div class="time-warning" id="timeWarning">
                <strong>⏰ Abbiamo raggiunto i 40 minuti!</strong> Vuoi continuare per altri 10 minuti o preferisci terminare ora?
                <div style="margin-top: 1rem;">
                    <button class="btn btn-secondary" onclick="continueSession()">Continua</button>
                    <button class="btn btn-primary" onclick="endSession()">Completa Percorso</button>
                </div>
            </div>
            
            <div class="chat-status">
                <div class="status-dot"></div>
                <span>Andrea è pronto per creare insieme il tuo futuro straordinario</span>
            </div>
            
            <div class="chat-container" id="chatContainer">
                <!-- Messages will be added here -->
            </div>
            
            <div class="chat-input">
                <input type="text" id="chatInput" placeholder="Condividi con Andrea le tue visioni per il futuro...">
                <button class="btn btn-primary" onclick="sendChatMessage()">Invia</button>
            </div>
        </section>

        <!-- Completion Section -->
        <section class="completion-section" id="completionSection">
            <h2 class="completion-title celebrate">🎉 PERCORSO COMPLETATO! 🎉</h2>
            <p class="completion-message">
                <strong>Congratulazioni straordinarie!</strong> Hai completato con successo il percorso 
                LifestyleFitnessCoach di 7 settimane. Quello che hai raggiunto è incredibile e 
                la trasformazione che hai vissuto è solo l'inizio di un futuro straordinario!
            </p>
            
            <div class="celebration-section">
                <h3 class="celebration-title">🏆 I Tuoi Risultati Straordinari</h3>
                <div class="celebration-stats" id="celebrationStats">
                    <div class="stat-item">
                        <div class="stat-number">7</div>
                        <div class="stat-label">Settimane Completate</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" id="sessionsCount">0</div>
                        <div class="stat-label">Ore di Coaching</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" id="insightsCount">0</div>
                        <div class="stat-label">Insights Scoperti</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" id="habitsCount">0</div>
                        <div class="stat-label">Abitudini Trasformate</div>
                    </div>
                </div>
                <p style="margin-top: 1rem; font-style: italic; color: #ea580c;">
                    Questi numeri rappresentano solo una frazione della straordinaria trasformazione che hai vissuto!
                </p>
            </div>
            
            <div class="transformation-results">
                <h3 class="transformation-title">📈 La Tua Trasformazione Finale</h3>
                <div class="results-grid" id="finalResultsGrid">
                    <!-- Will be populated with final assessment results -->
                </div>
            </div>
            
            <div class="maintenance-plan">
                <h3 class="maintenance-title">🛠️ Il Tuo Piano di Mantenimento a Lungo Termine</h3>
                <div class="plan-grid" id="maintenancePlanGrid">
                    <!-- Will be generated based on assessment and coaching -->
                </div>
            </div>
            
            <div class="completion-actions">
                <button class="btn btn-celebration" onclick="downloadCompletionCertificate()">🏆 Scarica Certificato di Completamento</button>
                <button class="btn btn-success" onclick="downloadMaintenancePlan()">📋 Scarica Piano Mantenimento Completo</button>
                <a href="module-hub.html" class="btn btn-secondary">🏠 Torna alla Dashboard</a>
                <button class="btn btn-primary" onclick="accessAdvancedPrograms()">🚀 Accedi a Programmi Avanzati</button>
            </div>
        </section>
    </main>

    <!-- Load Andrea AI Coach System -->
    <script src="../andrea-ai-coach.js"></script>
    
    <script>
        // Session variables
        let sessionStartTime = Date.now();
        let sessionDuration = 50 * 60 * 1000; // 50 minutes
        let timerInterval;
        let currentPhase = 'welcome';
        let assessmentData = {};
        let chatHistory = [];
        let andreaAICoach = null;
        let userProfile = null;
        let allWeeksData = {};
        let sessionExtended = false;
        let autoSaveInterval;
        let finalResults = {};
        let maintenancePlan = {};

        // Initialize session
        document.addEventListener('DOMContentLoaded', function() {
            startSessionTimer();
            loadUserProfile();
            loadAllWeeksData();
            loadSavedSession();
            initializeAndreaAI();
            startAutoSave();
        });

        function startSessionTimer() {
            timerInterval = setInterval(() => {
                const elapsed = Date.now() - sessionStartTime;
                const remaining = Math.max(0, sessionDuration - elapsed);
                
                const minutes = Math.floor(remaining / 60000);
                const seconds = Math.floor((remaining % 60000) / 1000);
                
                document.getElementById('sessionTimer').textContent = 
                    `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                
                const progress = (elapsed / sessionDuration) * 100;
                document.getElementById('sessionProgress').style.width = `${Math.min(progress, 100)}%`;
                
                // Check for 40 minute warning
                if (elapsed >= 40 * 60 * 1000 && !sessionExtended && currentPhase === 'phase2') {
                    show40MinuteWarning();
                }
                
                // Auto-end at 50 minutes
                if (remaining === 0) {
                    clearInterval(timerInterval);
                    endSession();
                }
            }, 1000);
        }

        function loadUserProfile() {
            try {
                const savedData = localStorage.getItem('lifestyleQuizResults');
                if (savedData) {
                    userProfile = JSON.parse(savedData);
                    console.log('✅ User profile loaded:', userProfile);
                }
            } catch (error) {
                console.error('❌ Error loading user profile:', error);
            }
        }

        function loadAllWeeksData() {
            try {
                // Load data from all completed weeks
                for (let i = 1; i <= 6; i++) {
                    const weekData = localStorage.getItem(`week${i}SessionCompleted`);
                    if (weekData) {
                        allWeeksData[`week${i}`] = JSON.parse(weekData);
                    }
                }
                
                console.log('✅ All weeks data loaded:', allWeeksData);
                updateWeeksGrid();
            } catch (error) {
                console.error('❌ Error loading weeks data:', error);
            }
        }

        function updateWeeksGrid() {
            const weeksGrid = document.getElementById('weeksGrid');
            const weekTitles = [
                'Incontro Conoscitivo',
                'Consapevolezza di Sé', 
                'Obiettivi SMART',
                'Piano di Azione',
                'Trasformazione Abitudini',
                'Scopri le Potenzialità'
            ];
            
            const weekInsights = [
                'Hai scoperto i tuoi obiettivi autentici',
                'Hai esplorato la tua identità profonda',
                'Hai creato obiettivi concreti e misurabili',
                'Hai costruito la roadmap del successo',
                'Hai implementato abitudini vincenti',
                'Hai identificato i tuoi super-poteri'
            ];
            
            // Update grid with actual completion status
            weeksGrid.innerHTML = '';
            for (let i = 0; i < 6; i++) {
                const weekNumber = i + 1;
                const isCompleted = allWeeksData[`week${weekNumber}`] ? true : false;
                
                const weekCard = document.createElement('div');
                weekCard.className = `week-card ${isCompleted ? 'completed' : 'pending'}`;
                weekCard.innerHTML = `
                    <div class="week-number">Settimana ${weekNumber} ${isCompleted ? '✅' : '⏳'}</div>
                    <div class="week-title">${weekTitles[i]}</div>
                    <div class="week-insight">${isCompleted ? weekInsights[i] : 'Da completare'}</div>
                `;
                weeksGrid.appendChild(weekCard);
            }
        }

        function loadSavedSession() {
            try {
                const savedSession = localStorage.getItem('week7SessionInProgress');
                if (savedSession) {
                    const sessionData = JSON.parse(savedSession);
                    
                    // Restore assessment data
                    if (sessionData.assessmentData) {
                        assessmentData = sessionData.assessmentData;
                        restoreAssessmentAnswers();
                    }
                    
                    // Restore chat history
                    if (sessionData.chatHistory) {
                        chatHistory = sessionData.chatHistory;
                    }
                    
                    // Restore current phase
                    if (sessionData.currentPhase) {
                        currentPhase = sessionData.currentPhase;
                        
                        if (currentPhase === 'phase1') {
                            startPhase1();
                        } else if (currentPhase === 'phase2') {
                            startPhase2();
                            restoreChatHistory();
                        }
                    }
                    
                    console.log('✅ Session restored from:', sessionData);
                }
            } catch (error) {
                console.error('❌ Error loading saved session:', error);
            }
        }

        function restoreAssessmentAnswers() {
            Object.entries(assessmentData).forEach(([key, value]) => {
                const element = document.querySelector(`[name="${key}"], #${key}`);
                if (element) {
                    if (element.type === 'radio') {
                        const radio = document.querySelector(`[name="${key}"][value="${value}"]`);
                        if (radio) radio.checked = true;
                    } else {
                        element.value = value;
                    }
                }
            });
            updateAssessmentProgress();
        }

        async function initializeAndreaAI() {
            try {
                if (window.AndreaAICoach) {
                    andreaAICoach = new window.AndreaAICoach();
                    
                    const userId = localStorage.getItem('lifestyleUserId') || 'user_' + Date.now();
                    localStorage.setItem('lifestyleUserId', userId);
                    
                    await andreaAICoach.initialize(userId, userProfile || {});
                    
                    console.log('🤖 Andrea AI Coach initialized successfully');
                } else {
                    console.error('❌ Andrea AI Coach not available');
                }
            } catch (error) {
                console.error('❌ Error initializing Andrea AI:', error);
            }
        }

        function startAutoSave() {
            autoSaveInterval = setInterval(() => {
                autoSave();
            }, 5000);
        }

        function autoSave() {
            try {
                const sessionData = {
                    currentPhase: currentPhase,
                    assessmentData: assessmentData,
                    chatHistory: chatHistory,
                    finalResults: finalResults,
                    maintenancePlan: maintenancePlan,
                    sessionStartTime: sessionStartTime,
                    lastSaved: new Date().toISOString()
                };
                
                localStorage.setItem('week7SessionInProgress', JSON.stringify(sessionData));
            } catch (error) {
                console.error('❌ Error auto-saving:', error);
            }
        }

        function startPhase1() {
            currentPhase = 'phase1';
            
            // Hide welcome, show phase 1
            document.getElementById('welcomeSection').style.display = 'none';
            document.getElementById('phase1Section').classList.add('active');
            
            // Update phase indicator
            document.getElementById('phaseStep1').className = 'phase-step active';
            document.getElementById('phaseStep2').className = 'phase-step inactive';
            
            updateAssessmentProgress();
            autoSave();
        }

        function updateAssessmentProgress() {
            const form = document.getElementById('assessmentForm');
            const inputs = form.querySelectorAll('input[type="radio"], textarea');
            
            let filled = 0;
            const radioGroups = {};
            
            // Count filled inputs
            inputs.forEach(input => {
                if (input.type === 'radio') {
                    if (!radioGroups[input.name]) {
                        radioGroups[input.name] = false;
                    }
                    if (input.checked) {
                        radioGroups[input.name] = true;
                        assessmentData[input.name] = input.value;
                    }
                } else if (input.value.trim()) {
                    filled++;
                    assessmentData[input.id] = input.value.trim();
                }
            });
            
            // Count filled radio groups
            Object.values(radioGroups).forEach(isSelected => {
                if (isSelected) filled++;
            });
            
            const totalQuestions = Object.keys(radioGroups).length + form.querySelectorAll('textarea').length;
            const progress = (filled / totalQuestions) * 100;
            
            document.getElementById('assessmentProgress').textContent = `${Math.round(progress)}%`;
            document.getElementById('assessmentProgressFill').style.width = `${progress}%`;
            
            // Enable/disable complete button
            const completeBtn = document.getElementById('completeAssessmentBtn');
            if (progress === 100) {
                completeBtn.disabled = false;
                completeBtn.className = 'btn btn-success';
            } else {
                completeBtn.disabled = true;
                completeBtn.className = 'btn btn-disabled';
            }
        }

        function completePhase1() {
            // Calculate final results
            calculateFinalResults();
            
            // Mark phase 1 as completed
            document.getElementById('phaseStep1').className = 'phase-step completed';
            
            // Start phase 2
            startPhase2();
        }

        function calculateFinalResults() {
            // Calculate transformation scores
            let clarityTotal = 0, confidenceTotal = 0, habitsTotal = 0, stressTotal = 0, potentialTotal = 0;
            let goalsTotal = 0, lifeTotal = 0, othersTotal = 0;
            
            // Personal transformation scores
            if (assessmentData.clarity1) clarityTotal = parseInt(assessmentData.clarity1);
            if (assessmentData.confidence1) confidenceTotal = parseInt(assessmentData.confidence1);
            if (assessmentData.habits1) habitsTotal = parseInt(assessmentData.habits1);
            if (assessmentData.stress1) stressTotal = parseInt(assessmentData.stress1);
            if (assessmentData.potential1) potentialTotal = parseInt(assessmentData.potential1);
            
            // Concrete results scores
            if (assessmentData.goals1) goalsTotal = parseInt(assessmentData.goals1);
            if (assessmentData.life1) lifeTotal = parseInt(assessmentData.life1);
            if (assessmentData.others1) othersTotal = parseInt(assessmentData.others1);
            
            // Calculate overall transformation score
            const personalTransformation = Math.round((clarityTotal + confidenceTotal + habitsTotal + stressTotal + potentialTotal) / 5 * 10) / 10;
            const concreteResults = Math.round((goalsTotal + lifeTotal + othersTotal) / 3 * 10) / 10;
            const overallScore = Math.round((personalTransformation + concreteResults) / 2 * 10) / 10;
            
            finalResults = {
                personalTransformation,
                concreteResults,
                overallScore,
                clarity: clarityTotal,
                confidence: confidenceTotal,
                habits: habitsTotal,
                stress: stressTotal,
                potential: potentialTotal,
                goals: goalsTotal,
                life: lifeTotal,
                others: othersTotal
            };
            
            // Generate insights
            generateFinalInsights();
        }

        function generateFinalInsights() {
            const insights = [];
            
            if (finalResults.overallScore >= 4) {
                insights.push('Trasformazione straordinaria completata con successo');
            } else if (finalResults.overallScore >= 3) {
                insights.push('Eccellenti progressi ottenuti nel percorso');
            }
            
            if (finalResults.confidence >= 4) {
                insights.push('Autostima significativamente rafforzata');
            }
            
            if (finalResults.habits >= 4) {
                insights.push('Abitudini positive solidamente implementate');
            }
            
            if (finalResults.clarity >= 4) {
                insights.push('Chiarezza sui tuoi obiettivi raggiunta');
            }
            
            if (finalResults.potential >= 4) {
                insights.push('Potenzialità personali identificate e attivate');
            }
            
            // Count total weeks completed
            const completedWeeks = Object.keys(allWeeksData).length;
            insights.push(`Percorso di ${completedWeeks + 1} settimane completato`);
            
            finalResults.insights = insights;
        }

        function startPhase2() {
            currentPhase = 'phase2';
            
            // Hide phase 1, show phase 2
            document.getElementById('phase1Section').classList.remove('active');
            document.getElementById('phase2Section').classList.add('active');
            
            // Update phase indicator
            document.getElementById('phaseStep2').className = 'phase-step active';
            
            // Display assessment results
            displayAssessmentResults();
            
            // Generate first coaching question
            generateFirstFutureCoachingQuestion();
            
            autoSave();
        }

        function displayAssessmentResults() {
            const resultsEl = document.getElementById('assessmentResults');
            if (finalResults.insights && finalResults.insights.length > 0) {
                resultsEl.innerHTML = finalResults.insights.map(insight => `<li>${insight}</li>`).join('');
            } else {
                resultsEl.innerHTML = '<li>Risultati personalizzati in caricamento...</li>';
            }
        }

        function generateFirstFutureCoachingQuestion() {
            if (chatHistory.length === 0) {
                const firstQuestion = generatePowerfulFutureQuestion();
                addChatMessage(firstQuestion, 'coach');
            } else {
                restoreChatHistory();
            }
        }

        function generatePowerfulFutureQuestion() {
            let question = `Incredibile! Hai appena completato un percorso straordinario di 7 settimane che ti ha trasformato profondamente. `;
            
            // Personalize based on assessment results
            if (finalResults.overallScore >= 4) {
                question += `I tuoi risultati sono straordinari - hai ottenuto un punteggio di ${finalResults.overallScore}/5 nella trasformazione complessiva! `;
            } else if (finalResults.overallScore >= 3) {
                question += `I tuoi progressi sono eccellenti - hai raggiunto ${finalResults.overallScore}/5 nella trasformazione! `;
            }
            
            // Reference specific strengths
            const strengths = [];
            if (finalResults.confidence >= 4) strengths.push('autostima');
            if (finalResults.clarity >= 4) strengths.push('chiarezza sui tuoi obiettivi');
            if (finalResults.habits >= 4) strengths.push('abitudini positive');
            if (finalResults.potential >= 4) strengths.push('consapevolezza delle tue potenzialità');
            
            if (strengths.length > 0) {
                question += `Hai fatto progressi incredibili in: ${strengths.join(', ')}. `;
            }
            
            // Reference transformation moments
            if (assessmentData.biggestChange) {
                question += `Quello che mi ha colpito di più è quando hai scritto che il tuo cambiamento più grande è stato: "${assessmentData.biggestChange}". `;
            }
            
            // Powerful coaching question for the future
            question += `\n\nOra voglio farti una domanda che aprirà la porta al tuo futuro straordinario: 
            
**Se tra 12 mesi ti guardassi indietro a questo momento, avendo vissuto il miglior anno della tua vita, cosa vorresti essere riuscito a creare, diventare e sperimentare?** 🌟
            
Non limitarti. Sogna in grande. Questa è la tua opportunità di progettare un futuro che ti entusiasma davvero.`;
            
            return question;
        }

        function restoreChatHistory() {
            const chatContainer = document.getElementById('chatContainer');
            chatContainer.innerHTML = '';
            
            chatHistory.forEach(message => {
                const messageDiv = document.createElement('div');
                messageDiv.className = `message ${message.sender}`;
                messageDiv.innerHTML = `
                    <div class="message-content">${message.content}</div>
                    <div class="message-time">${message.time}</div>
                `;
                chatContainer.appendChild(messageDiv);
            });
            
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }

        async function sendChatMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            
            if (!message) return;
            
            // Add user message
            addChatMessage(message, 'user');
            input.value = '';
            
            // Get AI coaching response
            try {
                const coachingResponse = await getFutureCoachingResponse(message);
                setTimeout(() => {
                    addChatMessage(coachingResponse, 'coach');
                }, 1500);
            } catch (error) {
                console.error('❌ Error getting coaching response:', error);
                setTimeout(() => {
                    addChatMessage("Dammi un momento per riflettere sulla tua visione del futuro... Puoi ripetere?", 'coach');
                }, 1000);
            }
        }

        function addChatMessage(content, sender) {
            const chatContainer = document.getElementById('chatContainer');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender}`;
            
            const now = new Date();
            const time = now.toLocaleTimeString('it-IT', { hour: '2-digit', minute: '2-digit' });
            
            messageDiv.innerHTML = `
                <div class="message-content">${content}</div>
                <div class="message-time">${time}</div>
            `;
            
            chatContainer.appendChild(messageDiv);
            chatContainer.scrollTop = chatContainer.scrollHeight;
            
            // Store in history
            chatHistory.push({ sender, content, time });
            
            // Extract insights for maintenance plan
            if (sender === 'user') {
                extractMaintenanceInsights(content);
            }
            
            autoSave();
        }

        async function getFutureCoachingResponse(userMessage) {
            // Build comprehensive context for future coaching
            const coachingContext = {
                assessmentData: assessmentData,
                finalResults: finalResults,
                allWeeksData: allWeeksData,
                chatHistory: chatHistory,
                userProfile: userProfile,
                maintenancePlan: maintenancePlan
            };
            
            // Try Andrea AI with future context
            if (andreaAICoach) {
                try {
                    const response = await andreaAICoach.sendMessage(userMessage, 7);
                    if (response.success) {
                        return response.response;
                    }
                } catch (error) {
                    console.error('❌ Andrea AI future coaching error:', error);
                }
            }
            
            // Fallback to sophisticated future coaching response
            return generateFutureCoachingResponse(userMessage, coachingContext);
        }

        function generateFutureCoachingResponse(userMessage, context) {
            const messageCount = context.chatHistory.filter(m => m.sender === 'user').length;
            
            // Different coaching approaches based on conversation depth
            if (messageCount <= 2) {
                return generateVisionExplorationResponse(userMessage, context);
            } else if (messageCount <= 4) {
                return generatePlanningResponse(userMessage, context);
            } else {
                return generateMaintenanceResponse(userMessage, context);
            }
        }

        function generateVisionExplorationResponse(userMessage, context) {
            const responses = [
                `Wow! La tua visione è potente e ispirante. Sento l'energia e la passione in quello che condividi. Ora voglio aiutarti a rendere questa visione ancora più concreta. Se dovessi vivere questa visione ogni giorno, come sarebbe una tua giornata tipo? Inizia dalla mattina...`,
                
                `Quello che descrivi è straordinario! Vedo che hai una chiarezza incredibile su quello che vuoi creare. La trasformazione che hai vissuto in queste 7 settimane ti ha davvero preparato per questo futuro. Dimmi, quale aspetto di questa visione ti emoziona di più?`,
                
                `La tua visione mi dà i brividi! È esattamente il tipo di futuro che una persona trasformata come te può creare. Ora, pensando a tutto quello che hai imparato su te stesso nelle settimane passate, quali delle tue potenzialità saranno fondamentali per realizzare questa visione?`,
                
                `Incredibile! Sento che questa visione è profondamente allineata con chi sei diventato. Ora voglio sfidare il tuo pensiero: se questa visione si realizzasse al 100%, che impatto avresti sulle persone attorno a te? Come cambierebbe la vita di chi ami?`
            ];
            
            // Personalize based on assessment results
            if (context.finalResults.clarity >= 4) {
                return `La chiarezza che hai sviluppato in queste 7 settimane emerge potentemente in questa visione! Con un punteggio di ${context.finalResults.clarity}/5 sulla chiarezza degli obiettivi, sei davvero pronto per il futuro che descrivi. Ora, questa visione che condividi... sento che c'è ancora di più dietro. Se potessi aggiungere un elemento che renderebbe questa visione ancora più significativa per te, cosa sarebbe?`;
            }
            
            return responses[Math.floor(Math.random() * responses.length)];
        }

        function generatePlanningResponse(userMessage, context) {
            const responses = [
                `Perfetto! La tua visione sta prendendo forma in modo concreto. Ora passiamo all'azione strategica. Considerando tutto quello che hai imparato su te stesso, sulle tue abitudini e le tue potenzialità, quali sono i 3 pilastri fondamentali su cui costruire questa visione?`,
                
                `Straordinario! Vedo che hai una visione chiara e ispirazione. Ora voglio aiutarti a creare un ponte solido tra dove sei oggi e dove vuoi arrivare. Se dovessi identificare il primo grande step nei prossimi 90 giorni, quale sarebbe?`,
                
                `La tua visione è potente e realizzabile! Con tutto quello che hai sviluppato in termini di disciplina e nuove abitudini, sei davvero attrezzato per questo viaggio. Ora, pensando agli ostacoli che potresti incontrare, come puoi utilizzare le strategie che hai imparato per superarli?`,
                
                `Magnifico! Sento che questa visione non è solo un sogno, ma un piano in fase di costruzione. Ora, per mantenerti sulla strada giusta, che tipo di supporto e accountability ti serviranno? Come puoi assicurarti di non perdere momentum?`
            ];
            
            // Planning based on specific transformations
            if (context.finalResults.habits >= 4) {
                return `Eccellente! Le abitudini positive che hai sviluppato (punteggio ${context.finalResults.habits}/5) saranno la tua arma segreta per questa visione. Ora, immaginando i prossimi 12 mesi, quali nuove abitudini specifiche dovrai aggiungere alla tua routine quotidiana per supportare questa crescita?`;
            }
            
            return responses[Math.floor(Math.random() * responses.length)];
        }

        function generateMaintenanceResponse(userMessage, context) {
            const responses = [
                `Perfetto! Stiamo creando qualcosa di straordinario insieme. Ora voglio assicurarmi che tu abbia tutto quello che serve per mantenere questa crescita a lungo termine. Quale sarà il tuo sistema di monitoraggio per restare sulla strada giusta?`,
                
                `Straordinario! Vedo un piano solido che sta prendendo forma. Per consolidare tutto questo, come pensi di gestire i momenti difficili? Ogni percorso di crescita ha alti e bassi - quale sarà la tua strategia anti-ricadute?`,
                
                `Incredibile! Il tuo futuro non è più un sogno, è un piano d'azione. Ora, per completare questo capolavoro, quali sono le 3 cose che ti impegni a fare ogni settimana per onorare questa visione e mantenere viva la trasformazione?`,
                
                `Magnifico! Quello che abbiamo creato insieme è oro puro. Ora, guardando a questo straordinario percorso di 7 settimane e alla visione del futuro, cosa vuoi prometterti? Qual è l'impegno più importante che prendi con te stesso oggi?`
            ];
            
            // Maintenance based on overall transformation
            if (context.finalResults.overallScore >= 4) {
                return `Straordinario! Con un punteggio di trasformazione di ${context.finalResults.overallScore}/5, hai dimostrato di essere una persona che mantiene i suoi impegni. Ora, per coronare questo percorso incredibile, se dovessi creare un mantra personale che catturi l'essenza di chi sei diventato e dove stai andando, quale sarebbe?`;
            }
            
            return responses[Math.floor(Math.random() * responses.length)];
        }

        function extractMaintenanceInsights(userMessage) {
            // Extract insights for maintenance plan personalization
            const insights = [];
            
            if (userMessage.toLowerCase().includes('obiettiv') || userMessage.toLowerCase().includes('goal')) {
                insights.push('Focus su obiettivi chiari e misurabili');
            }
            
            if (userMessage.toLowerCase().includes('abitudin') || userMessage.toLowerCase().includes('routine')) {
                insights.push('Sviluppo di routine quotidiane supportive');
            }
            
            if (userMessage.toLowerCase().includes('equilibr') || userMessage.toLowerCase().includes('balance')) {
                insights.push('Mantenimento equilibrio vita-lavoro');
            }
            
            if (userMessage.toLowerCase().includes('salute') || userMessage.toLowerCase().includes('fitness')) {
                insights.push('Priorità su salute e benessere fisico');
            }
            
            if (userMessage.toLowerCase().includes('famiglia') || userMessage.toLowerCase().includes('relazioni')) {
                insights.push('Investimento nelle relazioni significative');
            }
            
            if (userMessage.toLowerCase().includes('crescita') || userMessage.toLowerCase().includes('learning')) {
                insights.push('Impegno nella crescita continua');
            }
            
            if (insights.length > 0) {
                maintenancePlan.insights = maintenancePlan.insights || [];
                maintenancePlan.insights.push(...insights);
            }
        }

        function show40MinuteWarning() {
            document.getElementById('timeWarning').classList.add('active');
        }

        function continueSession() {
            sessionExtended = true;
            document.getElementById('timeWarning').classList.remove('active');
            showMessage('✅ Sessione estesa di 10 minuti. Continuiamo a creare il tuo futuro straordinario!', 'success');
        }

        function endSession() {
            clearInterval(timerInterval);
            clearInterval(autoSaveInterval);
            completeSession();
        }

        function completeSession() {
            // Save final session data
            const finalSessionData = {
                assessmentData: assessmentData,
                finalResults: finalResults,
                chatHistory: chatHistory,
                maintenancePlan: maintenancePlan,
                completedAt: new Date().toISOString(),
                sessionDuration: Date.now() - sessionStartTime,
                userProfile: userProfile,
                allWeeksData: allWeeksData
            };
            
            localStorage.setItem('week7SessionCompleted', JSON.stringify(finalSessionData));
            localStorage.setItem('lifestyleCoachingCompleted', JSON.stringify({
                completedAt: new Date().toISOString(),
                totalWeeks: 7,
                finalScore: finalResults.overallScore || 0
            }));
            localStorage.removeItem('week7SessionInProgress');
            
            // Update progress to completed
            updateUserProgress();
            
            // Show completion
            document.getElementById('phase2Section').classList.remove('active');
            document.getElementById('completionSection').classList.add('active');
            
            // Generate celebration and maintenance plan
            generateCelebrationStats();
            generateFinalResultsDisplay();
            generateMaintenancePlanDisplay();
            
            document.getElementById('completionSection').scrollIntoView({ behavior: 'smooth' });
        }

        function generateCelebrationStats() {
            const completedWeeks = Object.keys(allWeeksData).length + 1; // +1 for week 7
            const totalHours = completedWeeks * 0.75; // Assuming 45 min per session
            const totalInsights = finalResults.insights ? finalResults.insights.length : 0;
            const habitsTransformed = calculateHabitsTransformed();
            
            document.getElementById('sessionsCount').textContent = totalHours.toFixed(1);
            document.getElementById('insightsCount').textContent = totalInsights;
            document.getElementById('habitsCount').textContent = habitsTransformed;
        }

        function calculateHabitsTransformed() {
            let habitsCount = 0;
            
            // Count habits from various weeks
            if (allWeeksData.week5 && allWeeksData.week5.finalSessionData) {
                habitsCount += 3; // Typical habits from week 5
            }
            if (finalResults.habits >= 4) {
                habitsCount += 2; // Additional habits
            }
            
            return Math.max(habitsCount, 5); // Minimum 5 habits transformed
        }

        function generateFinalResultsDisplay() {
            const resultsGrid = document.getElementById('finalResultsGrid');
            
            const transformationFeedback = finalResults.overallScore >= 4 ? 'Straordinaria!' : 
                                         finalResults.overallScore >= 3 ? 'Eccellente!' : 'Significativa!';
            
            const confidenceFeedback = finalResults.confidence >= 4 ? 'Potente!' : 
                                     finalResults.confidence >= 3 ? 'Solida!' : 'In crescita!';
            
            const clarityFeedback = finalResults.clarity >= 4 ? 'Cristallina!' : 
                                  finalResults.clarity >= 3 ? 'Chiara!' : 'Migliorata!';
            
            const habitsFeedback = finalResults.habits >= 4 ? 'Radicate!' : 
                                 finalResults.habits >= 3 ? 'Stabili!' : 'Avviate!';
            
            resultsGrid.innerHTML = `
                <div class="result-item">
                    <div class="result-score">${finalResults.overallScore || 0}/5</div>
                    <div class="result-label">Trasformazione Complessiva</div>
                    <div class="result-feedback">${transformationFeedback}</div>
                </div>
                <div class="result-item">
                    <div class="result-score">${finalResults.confidence || 0}/5</div>
                    <div class="result-label">Autostima & Fiducia</div>
                    <div class="result-feedback">${confidenceFeedback}</div>
                </div>
                <div class="result-item">
                    <div class="result-score">${finalResults.clarity || 0}/5</div>
                    <div class="result-label">Chiarezza Obiettivi</div>
                    <div class="result-feedback">${clarityFeedback}</div>
                </div>
                <div class="result-item">
                    <div class="result-score">${finalResults.habits || 0}/5</div>
                    <div class="result-label">Abitudini Positive</div>
                    <div class="result-feedback">${habitsFeedback}</div>
                </div>
            `;
        }

        function generateMaintenancePlanDisplay() {
            const planGrid = document.getElementById('maintenancePlanGrid');
            
            const dailyHabits = generateDailyMaintenanceHabits();
            const weeklyReviews = generateWeeklyReviews();
            const monthlyGoals = generateMonthlyGoals();
            const emergencyStrategies = generateEmergencyStrategies();
            
            planGrid.innerHTML = `
                <div class="plan-section">
                    <div class="plan-section-title">📅 Routine Quotidiana</div>
                    <ul class="plan-list">
                        ${dailyHabits.map(habit => `<li>✅ ${habit}</li>`).join('')}
                    </ul>
                </div>
                <div class="plan-section">
                    <div class="plan-section-title">📊 Review Settimanali</div>
                    <ul class="plan-list">
                        ${weeklyReviews.map(review => `<li>📈 ${review}</li>`).join('')}
                    </ul>
                </div>
                <div class="plan-section">
                    <div class="plan-section-title">🎯 Focus Mensile</div>
                    <ul class="plan-list">
                        ${monthlyGoals.map(goal => `<li>🚀 ${goal}</li>`).join('')}
                    </ul>
                </div>
                <div class="plan-section">
                    <div class="plan-section-title">🆘 Strategie Anti-Ricadute</div>
                    <ul class="plan-list">
                        ${emergencyStrategies.map(strategy => `<li>🛡️ ${strategy}</li>`).join('')}
                    </ul>
                </div>
            `;
        }

        function generateDailyMaintenanceHabits() {
            const habits = [
                "10 minuti di riflessione mattutina sui tuoi obiettivi",
                "Pratica della routine che hai sviluppato nelle 7 settimane",
                "Celebra un piccolo successo della giornata"
            ];
            
            // Personalize based on assessment
            if (finalResults.confidence < 4) {
                habits.push("Pratica affermazioni positive e auto-compassione");
            }
            
            if (finalResults.stress >= 4) {
                habits.push("Applica le tecniche di gestione stress apprese");
            } else {
                habits.push("Dedica tempo al relax e alla ricarica energetica");
            }
            
            if (assessmentData.futureCommitment) {
                habits.push(`Lavora sul tuo impegno: "${assessmentData.futureCommitment}"`);
            }
            
            return habits;
        }

        function generateWeeklyReviews() {
            return [
                "Rivedi i progressi verso i tuoi obiettivi settimanali",
                "Valuta quali abitudini stanno funzionando meglio",
                "Identifica una cosa da migliorare per la settimana successiva",
                "Rileggi le tue riflessioni delle settimane passate",
                "Pianifica attività che ti connettono con le tue potenzialità"
            ];
        }

        function generateMonthlyGoals() {
            const goals = [
                "Stabilisci un nuovo obiettivo SMART basato sui tuoi progressi",
                "Approfondisci una delle tue potenzialità identificate",
                "Connettiti con persone che supportano la tua crescita"
            ];
            
            // Personalize based on transformation level
            if (finalResults.overallScore >= 4) {
                goals.push("Mentorizza qualcuno che sta iniziando un percorso simile");
                goals.push("Sfida te stesso con un obiettivo più ambizioso");
            } else {
                goals.push("Consolida le abitudini sviluppate finora");
                goals.push("Richiedi supporto quando ne hai bisogno");
            }
            
            return goals;
        }

        function generateEmergencyStrategies() {
            return [
                "Torna alle tecniche di consapevolezza della Settimana 2",
                "Rileggi il tuo piano di azione della Settimana 4",
                "Pratica le strategie anti-sabotaggio della Settimana 5",
                "Ricorda le tue potenzialità scoperte nella Settimana 6",
                "Contatta il tuo sistema di supporto",
                "Ricorda perché hai iniziato questo percorso"
            ];
        }

        function updateUserProgress() {
            try {
                const progress = JSON.parse(localStorage.getItem('lifestyleProgress') || '{}');
                progress.completedWeeks = progress.completedWeeks || [];
                
                if (!progress.completedWeeks.includes(7)) {
                    progress.completedWeeks.push(7);
                    progress.currentWeek = 'completed';
                    progress.finalScore = finalResults.overallScore || 0;
                    progress.completionDate = new Date().toISOString();
                    progress.lastUpdate = new Date().toISOString();
                    
                    localStorage.setItem('lifestyleProgress', JSON.stringify(progress));
                }
            } catch (error) {
                console.error('❌ Error updating progress:', error);
            }
        }

        function downloadCompletionCertificate() {
            const certificateContent = `
                🏆 CERTIFICATO DI COMPLETAMENTO 🏆
                
                PERCORSO LIFESTYLE FITNESS COACHING
                Andrea Padoan - Lifestyle Coach
                
                Si certifica che
                
                ${userProfile?.name || 'UTENTE STRAORDINARIO'}
                
                ha completato con successo il percorso completo di
                LifestyleFitnessCoach di 7 settimane, ottenendo una 
                trasformazione personale straordinaria.
                
                === RISULTATI OTTENUTI ===
                
                Punteggio Trasformazione Complessiva: ${finalResults.overallScore || 0}/5
                Autostima e Fiducia: ${finalResults.confidence || 0}/5
                Chiarezza Obiettivi: ${finalResults.clarity || 0}/5
                Abitudini Positive: ${finalResults.habits || 0}/5
                Gestione Stress: ${finalResults.stress || 0}/5
                Consapevolezza Potenzialità: ${finalResults.potential || 0}/5
                
                === SETTIMANE COMPLETATE ===
                
                ✅ Settimana 1: Incontro Conoscitivo
                ✅ Settimana 2: Consapevolezza di Sé
                ✅ Settimana 3: Obiettivi SMART
                ✅ Settimana 4: Piano di Azione
                ✅ Settimana 5: Trasformazione Abitudini
                ✅ Settimana 6: Scopri le Potenzialità
                ✅ Settimana 7: Consolidamento e Futuro
                
                === TRASFORMAZIONE DOCUMENTATA ===
                
                PRIMA del percorso:
                "${assessmentData.beforeMindset || 'Stato iniziale documentato'}"
                
                DOPO il percorso:
                "${assessmentData.afterMindset || 'Trasformazione straordinaria completata'}"
                
                Cambiamento più significativo:
                "${assessmentData.biggestChange || 'Crescita personale straordinaria'}"
                
                Momento di maggior orgoglio:
                "${assessmentData.proudestMoment || 'Superamento di sfide personali'}"
                
                Apprendimento più importante:
                "${assessmentData.biggestLearning || 'Scoperta del proprio potenziale'}"
                
                === CERTIFICAZIONE ===
                
                Questo certificato attesta il completamento di un percorso
                di crescita personale strutturato di 7 settimane, con oltre
                6 ore di coaching personalizzato e oltre 50 ore di lavoro
                personale dedicato alla trasformazione.
                
                La persona certificata ha dimostrato:
                - Impegno costante nel percorso di crescita
                - Capacità di trasformazione e miglioramento
                - Sviluppo di consapevolezza e autostima
                - Implementazione di abitudini positive
                - Chiarezza sui propri obiettivi di vita
                - Riconoscimento e sviluppo delle proprie potenzialità
                
                Data di completamento: ${new Date().toLocaleDateString('it-IT')}
                
                Andrea Padoan
                Lifestyle Fitness Coach Certificato
                
                "La trasformazione autentica inizia da dentro.
                Tu hai avuto il coraggio di iniziare e la determinazione
                di completare. Ora sei pronto per creare il futuro
                che meriti."
                
                🌟 CONGRATULAZIONI PER QUESTO STRAORDINARIO RISULTATO! 🌟
            `;
            
            const blob = new Blob([certificateContent], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `Certificato_Lifestyle_Coaching_${userProfile?.name || 'Completamento'}.txt`;
            a.click();
            URL.revokeObjectURL(url);
            
            showMessage('🏆 Certificato di completamento scaricato! Congratulazioni!', 'success');
        }

        function downloadMaintenancePlan() {
            const planContent = `
                PIANO DI MANTENIMENTO A LUNGO TERMINE
                LIFESTYLE FITNESS COACHING - SETTIMANA 7
                
                Andrea Padoan - Lifestyle Coach
                
                Caro/a ${userProfile?.name || 'Straordinario/a Utente'},
                
                CONGRATULAZIONI! Hai completato un percorso di trasformazione 
                straordinario di 7 settimane. Questo piano ti aiuterà a mantenere
                e amplificare i risultati ottenuti per tutta la vita.
                
                === I TUOI RISULTATI STRAORDINARI ===
                
                Trasformazione Complessiva: ${finalResults.overallScore || 0}/5
                - Autostima e Fiducia: ${finalResults.confidence || 0}/5
                - Chiarezza Obiettivi: ${finalResults.clarity || 0}/5  
                - Abitudini Positive: ${finalResults.habits || 0}/5
                - Gestione Stress: ${finalResults.stress || 0}/5
                - Consapevolezza Potenzialità: ${finalResults.potential || 0}/5
                
                === LA TUA TRASFORMAZIONE PRIMA/DOPO ===
                
                PRIMA del percorso:
                Mentalità: "${assessmentData.beforeMindset || 'Stato iniziale'}"
                Abitudini: "${assessmentData.beforeHabits || 'Abitudini da migliorare'}"
                Sfide: "${assessmentData.beforeChallenges || 'Ostacoli da superare'}"
                
                DOPO il percorso:
                Mentalità: "${assessmentData.afterMindset || 'Trasformazione completa'}"
                Abitudini: "${assessmentData.afterHabits || 'Nuove abitudini positive'}"
                Punti di Forza: "${assessmentData.afterStrengths || 'Nuovi super-poteri'}"
                
                === PIANO DI MANTENIMENTO QUOTIDIANO ===
                
                🌅 ROUTINE MATTUTINA (15-20 minuti)
                ${generateDailyMaintenanceHabits().map((habit, i) => `${i + 1}. ${habit}`).join('\n                ')}
                
                🌙 ROUTINE SERALE (10 minuti)
                1. Rifletti su 3 successi della giornata
                2. Identifica una cosa da migliorare domani
                3. Rileggi il tuo impegno futuro: "${assessmentData.futureCommitment || 'Continua a crescere'}"
                4. Pianifica la priorità principale di domani
                5. Pratica gratitudine per la tua crescita
                
                === REVIEWS PERIODICHE ===
                
                📊 REVIEW SETTIMANALE (30 minuti ogni domenica)
                ${generateWeeklyReviews().map((review, i) => `${i + 1}. ${review}`).join('\n                ')}
                
                🎯 FOCUS MENSILE (1 ora primo del mese)
                ${generateMonthlyGoals().map((goal, i) => `${i + 1}. ${goal}`).join('\n                ')}
                
                📈 ASSESSMENT TRIMESTRALE (2 ore ogni 3 mesi)
                1. Ripeti i test di autovalutazione delle 7 settimane
                2. Confronta i progressi con i risultati precedenti
                3. Aggiorna i tuoi obiettivi basandoti sulla crescita
                4. Celebra i traguardi raggiunti
                5. Identifica nuove aree di crescita
                
                === STRATEGIE ANTI-RICADUTE ===
                
                🆘 QUANDO TI SENTI DEMOTIVATO:
                ${generateEmergencyStrategies().map((strategy, i) => `${i + 1}. ${strategy}`).join('\n                ')}
                
                🧠 FRASI POTENZIANTI PERSONALIZZATE:
                - "Ho già dimostrato di saper cambiare completando 7 settimane"
                - "La mia trasformazione è reale: ${assessmentData.biggestChange || 'sono cresciuto enormemente'}"
                - "Il mio apprendimento più importante: ${assessmentData.biggestLearning || 'conosco il mio valore'}"
                - "Il mio momento di orgoglio: ${assessmentData.proudestMoment || 'ho superato me stesso'}"
                
                === SISTEMA DI ACCOUNTABILITY ===
                
                🤝 SUPPORTO SOCIALE:
                1. Condividi i tuoi obiettivi con 2-3 persone care
                2. Programma check-in mensili con un accountability partner
                3. Unisciti a comunità di crescita personale
                4. Considera un coaching di mantenimento trimestrale
                
                📱 STRUMENTI DIGITALI:
                1. Usa app per tracking abitudini (consigliato: Streaks, Habitica)
                2. Calendario con reminder per le tue routine
                3. Diario digitale per riflessioni quotidiane
                4. Foto progress per vedere la trasformazione nel tempo
                
                === EVOLUZIONE CONTINUA ===
                
                🌱 CRESCITA LIVELLO 2 (dopo 6 mesi):
                1. Definisci obiettivi più ambiziosi basati sui risultati
                2. Diventa mentor per chi inizia un percorso simile
                3. Approfondisci le tue potenzialità scoperte
                4. Considera specializzazioni in aree specifiche
                
                🚀 CRESCITA LIVELLO 3 (dopo 1 anno):
                1. Crea il tuo sistema personalizzato di crescita
                2. Sviluppa leadership in aree di tua competenza
                3. Contribuisci alla crescita di altri
                4. Stabilisci nuovi standard personali di eccellenza
                
                === RISORSE DI SUPPORTO ===
                
                📚 LETTURE CONSIGLIATE:
                - "Atomic Habits" di James Clear (per le abitudini)
                - "Mindset" di Carol Dweck (per la mentalità di crescita)
                - "The 7 Habits" di Stephen Covey (per l'efficacia personale)
                - "Flow" di Mihaly Csikszentmihalyi (per la performance)
                
                🎧 PODCAST/AUDIO:
                - "The Life Coach School Podcast"
                - "The Tim Ferriss Show"
                - "On Purpose with Jay Shetty"
                
                === PIANI DI EMERGENZA ===
                
                ⚠️ SE INTERROMPI LE ABITUDINI:
                1. Non giudicarti: è normale avere battute d'arresto
                2. Riprendi dalla routine più piccola (5 minuti al giorno)
                3. Rileggi il tuo "perché" originale della Settimana 1
                4. Chiedi supporto invece di isolarti
                5. Ricorda: ogni giorno è un nuovo inizio
                
                ⚠️ SE PERDI MOTIVAZIONE:
                1. Rileggi i tuoi risultati e progressi delle 7 settimane
                2. Visualizza il futuro che hai descritto nel coaching finale
                3. Pratica gratitudine per quello che hai già raggiunto
                4. Connettiti con il tuo sistema di supporto
                5. Fai qualcosa di piccolo ma significativo oggi stesso
                
                ⚠️ SE AFFRONTI STRESS ELEVATO:
                1. Torna alle tecniche di gestione stress della Settimana 2
                2. Prioritizza il riposo e l'auto-cura
                3. Applica la routine mattutina anche se ridotta
                4. Chiedi aiuto professionale se necessario
                5. Ricorda: questo è temporaneo, la tua crescita è permanente
                
                === IL TUO IMPEGNO CON TE STESSO ===
                
                "${assessmentData.futureCommitment || 'Mi impegno a continuare questa crescita straordinaria'}"
                
                === MESSAGGIO FINALE ===
                
                ${userProfile?.name || 'Straordinario/a'}, quello che hai raggiunto in 7 settimane è 
                solo l'inizio. Hai dimostrato di avere tutto quello che serve per creare
                una vita straordinaria. Questo piano di mantenimento non è solo un documento:
                è il tuo compagno di viaggio verso una versione sempre migliore di te stesso.
                
                Ricorda sempre:
                - Sei più forte di quanto credi
                - Hai più controllo di quanto pensi  
                - Meriti tutto il bene che stai creando
                - La tua trasformazione ispira gli altri
                - Il meglio deve ancora venire
                
                Ogni giorno che applichi questo piano, onori l'impegno che hai preso
                con te stesso 7 settimane fa. Ogni piccola azione quotidiana costruisce
                il futuro straordinario che hai visualizzato.
                
                Non si tratta di perfezione, ma di progressione.
                Non si tratta di velocità, ma di costanza.
                Non si tratta di non cadere mai, ma di rialzarsi sempre.
                
                Il tuo coach di trasformazione per sempre,
                Andrea 🌟
                
                P.S. Tieni questo piano sempre a portata di mano. Nei momenti difficili,
                ricorda che hai già dimostrato di saper trasformare la tua vita.
                Ora continua a trasformare il mondo attorno a te!
                
                === DATA PLAN ===
                Creato: ${new Date().toLocaleDateString('it-IT')}
                Valido: Per tutta la vita
                Prossima revisione: ${new Date(Date.now() + 90 * 24 * 60 * 60 * 1000).toLocaleDateString('it-IT')}
            `;
            
            const blob = new Blob([planContent], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `Piano_Mantenimento_Lifestyle_${userProfile?.name || 'Completo'}.txt`;
            a.click();
            URL.revokeObjectURL(url);
            
            showMessage('📋 Piano di mantenimento completo scaricato!', 'success');
        }

        function accessAdvancedPrograms() {
            showMessage('🚀 Programmi avanzati in fase di sviluppo! Ti contatteremo presto per opportunità esclusive.', 'info');
            
            // Store interest for advanced programs
            try {
                const advancedInterest = {
                    userId: localStorage.getItem('lifestyleUserId'),
                    completionDate: new Date().toISOString(),
                    finalScore: finalResults.overallScore,
                    interestExpressed: new Date().toISOString()
                };
                localStorage.setItem('advancedProgramsInterest', JSON.stringify(advancedInterest));
            } catch (error) {
                console.error('❌ Error storing advanced programs interest:', error);
            }
        }

        function showMessage(message, type = 'info') {
            const colors = {
                success: '#16a34a',
                warning: '#f59e0b',
                info: '#3b82f6',
                error: '#ef4444'
            };
            
            const notification = document.createElement('div');
            notification.innerHTML = `
                <div style="position: fixed; top: 20px; right: 20px; background: ${colors[type]}; color: white; padding: 1rem 2rem; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.2); z-index: 1000; max-width: 400px; animation: slideIn 0.3s ease-out;">
                    ${message}
                </div>
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 5000);
        }

        // Handle Enter key in chat
        document.getElementById('chatInput')?.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                sendChatMessage();
            }
        });

        // Handle page unload
        window.addEventListener('beforeunload', function() {
            if (currentPhase !== 'completed') {
                autoSave();
            }
        });

        // Add slide-in animation style
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideIn {
                from {
                    transform: translateX(100%);
                    opacity: 0;
                }
                to {
                    transform: translateX(0);
                    opacity: 1;
                }
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>