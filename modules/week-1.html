<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Settimana 1 - Incontro Conoscitivo | Andrea Padoan Coach</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #f8fafc 0%, #fff7ed 50%, #f0fdf4 100%);
            min-height: 100vh;
            color: #1e293b;
        }

        /* Header */
        .header {
            background: linear-gradient(135deg, #1e293b 0%, #ea580c 100%);
            color: white;
            padding: 2rem 0;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 1.3rem;
            font-weight: bold;
        }

        .session-info {
            display: flex;
            align-items: center;
            gap: 2rem;
        }

        .timer-display {
            background: rgba(255,255,255,0.2);
            padding: 0.5rem 1rem;
            border-radius: 8px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .progress-bar {
            background: rgba(255,255,255,0.2);
            width: 200px;
            height: 8px;
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-fill {
            background: #22c55e;
            height: 100%;
            width: 0%;
            transition: width 0.3s ease;
        }

        .back-button {
            background: rgba(255,255,255,0.2);
            padding: 0.5rem 1rem;
            border-radius: 8px;
            text-decoration: none;
            color: white;
            transition: all 0.3s ease;
        }

        .back-button:hover {
            background: rgba(255,255,255,0.3);
        }

        /* Main Content */
        .main-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }

        /* Phase Indicator */
        .phase-indicator {
            background: white;
            border-radius: 12px;
            padding: 1rem 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .phase-step {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            font-weight: 600;
            min-width: 250px;
        }

        .phase-step.active {
            background: linear-gradient(135deg, #ea580c 0%, #fb923c 100%);
            color: white;
        }

        .phase-step.completed {
            background: linear-gradient(135deg, #16a34a 0%, #22c55e 100%);
            color: white;
        }

        .phase-step.inactive {
            background: #f1f5f9;
            color: #94a3b8;
        }

        .phase-arrow {
            font-size: 1.5rem;
            color: #64748b;
        }

        /* Welcome Section */
        .welcome-section {
            background: white;
            border-radius: 16px;
            padding: 3rem;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            margin-bottom: 2rem;
            text-align: center;
        }

        .welcome-title {
            font-size: 2.5rem;
            font-weight: bold;
            color: #1e293b;
            margin-bottom: 1rem;
        }

        .welcome-subtitle {
            font-size: 1.3rem;
            color: #ea580c;
            margin-bottom: 2rem;
        }

        .process-explanation {
            background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);
            border-radius: 12px;
            padding: 2rem;
            margin-bottom: 2rem;
            text-align: left;
        }

        .process-title {
            font-size: 1.3rem;
            font-weight: bold;
            color: #16a34a;
            margin-bottom: 1rem;
            text-align: center;
        }

        .process-steps {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
        }

        .process-step {
            background: white;
            padding: 1.5rem;
            border-radius: 8px;
            border-left: 4px solid #16a34a;
        }

        .step-number {
            font-size: 1.5rem;
            font-weight: bold;
            color: #16a34a;
            margin-bottom: 0.5rem;
        }

        .step-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: #1e293b;
            margin-bottom: 0.5rem;
        }

        .step-description {
            font-size: 0.9rem;
            color: #64748b;
            line-height: 1.5;
        }

        .step-duration {
            font-size: 0.8rem;
            color: #ea580c;
            font-weight: 600;
            margin-top: 0.5rem;
        }

        /* Phase 1 - Complete Questionnaire */
        .phase1-section {
            background: white;
            border-radius: 16px;
            padding: 2rem;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            margin-bottom: 2rem;
            display: none;
        }

        .phase1-section.active {
            display: block;
        }

        .phase-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid #f1f5f9;
        }

        .phase-icon {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #1e293b 0%, #ea580c 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: white;
        }

        .phase-title {
            font-size: 1.5rem;
            font-weight: bold;
            color: #1e293b;
            margin-bottom: 0.5rem;
        }

        .phase-subtitle {
            font-size: 1rem;
            color: #64748b;
        }

        .form-progress {
            background: #f1f5f9;
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1.5rem;
            text-align: center;
        }

        .form-progress-text {
            font-size: 0.9rem;
            color: #64748b;
            margin-bottom: 0.5rem;
        }

        .form-progress-bar {
            background: #e2e8f0;
            height: 8px;
            border-radius: 4px;
            overflow: hidden;
        }

        .form-progress-fill {
            background: linear-gradient(135deg, #16a34a 0%, #22c55e 100%);
            height: 100%;
            transition: width 0.3s ease;
        }

        .form-section {
            margin-bottom: 2rem;
        }

        .form-section h3 {
            color: #1e293b;
            margin-bottom: 1rem;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            color: #374151;
            font-weight: 500;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: #ea580c;
        }

        .form-group textarea {
            resize: vertical;
            min-height: 100px;
        }

        /* Phase 2 - AI Deep Dive */
        .phase2-section {
            background: white;
            border-radius: 16px;
            padding: 2rem;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            margin-bottom: 2rem;
            display: none;
        }

        .phase2-section.active {
            display: block;
        }

        .coaching-intro {
            background: linear-gradient(135deg, #fff7ed 0%, #fed7aa 100%);
            border-radius: 12px;
            padding: 2rem;
            margin-bottom: 2rem;
            text-align: center;
        }

        .coaching-intro h3 {
            color: #1e293b;
            margin-bottom: 1rem;
            font-size: 1.3rem;
        }

        .coaching-intro p {
            color: #ea580c;
            line-height: 1.6;
        }

        .chat-container {
            background: #f8fafc;
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            min-height: 400px;
            max-height: 500px;
            overflow-y: auto;
        }

        .message {
            margin-bottom: 1rem;
            padding: 1rem;
            border-radius: 12px;
            max-width: 85%;
            animation: messageSlide 0.3s ease-out;
        }

        .message.coach {
            background: linear-gradient(135deg, #fff7ed 0%, #fed7aa 100%);
            margin-right: auto;
        }

        .message.user {
            background: linear-gradient(135deg, #e0f2fe 0%, #b3e5fc 100%);
            margin-left: auto;
            text-align: right;
        }

        .message-content {
            font-size: 1rem;
            line-height: 1.5;
            margin-bottom: 0.5rem;
        }

        .message-time {
            font-size: 0.8rem;
            color: #64748b;
        }

        .chat-input {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .chat-input input {
            flex: 1;
            padding: 0.75rem;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 1rem;
        }

        .chat-input input:focus {
            outline: none;
            border-color: #ea580c;
        }

        .chat-status {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 1rem;
            font-size: 0.9rem;
            color: #16a34a;
        }

        .status-dot {
            width: 10px;
            height: 10px;
            background: #22c55e;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        /* Buttons */
        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 1rem;
        }

        .btn-primary {
            background: linear-gradient(135deg, #1e293b 0%, #ea580c 100%);
            color: white;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(0,0,0,0.3);
        }

        .btn-secondary {
            background: white;
            color: #1e293b;
            border: 2px solid #e2e8f0;
        }

        .btn-secondary:hover {
            border-color: #ea580c;
            color: #ea580c;
        }

        .btn-success {
            background: linear-gradient(135deg, #16a34a 0%, #22c55e 100%);
            color: white;
        }

        .btn-success:hover {
            transform: translateY(-2px);
        }

        .btn-disabled {
            background: #94a3b8;
            color: white;
            cursor: not-allowed;
        }

        /* Navigation Buttons */
        .form-navigation {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 2rem;
            padding-top: 1rem;
            border-top: 1px solid #e2e8f0;
        }

        /* Time Warning */
        .time-warning {
            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
            color: white;
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
            text-align: center;
            display: none;
        }

        .time-warning.active {
            display: block;
        }

        /* Completion Section */
        .completion-section {
            background: white;
            border-radius: 16px;
            padding: 2rem;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            margin-top: 2rem;
            display: none;
        }

        .completion-section.active {
            display: block;
        }

        .completion-title {
            font-size: 2rem;
            font-weight: bold;
            color: #1e293b;
            margin-bottom: 1rem;
            text-align: center;
        }

        .completion-message {
            font-size: 1.1rem;
            line-height: 1.6;
            color: #475569;
            margin-bottom: 2rem;
            text-align: center;
        }

        .homework-section {
            background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);
            border-radius: 12px;
            padding: 2rem;
            margin-bottom: 2rem;
        }

        .homework-title {
            font-size: 1.3rem;
            font-weight: bold;
            color: #16a34a;
            margin-bottom: 1rem;
        }

        .homework-list {
            list-style: none;
            padding: 0;
        }

        .homework-list li {
            padding: 0.5rem 0;
            border-bottom: 1px solid rgba(34, 197, 94, 0.2);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .homework-list li:last-child {
            border-bottom: none;
        }

        .completion-actions {
            display: flex;
            justify-content: center;
            gap: 1rem;
            flex-wrap: wrap;
        }

        /* Animations */
        @keyframes messageSlide {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .main-content {
                padding: 1rem;
            }
            
            .process-steps {
                grid-template-columns: 1fr;
            }
            
            .phase-indicator {
                flex-direction: column;
                gap: 0.5rem;
            }
            
            .phase-step {
                min-width: auto;
                width: 100%;
                justify-content: center;
            }
            
            .phase-arrow {
                transform: rotate(90deg);
            }
            
            .form-navigation {
                flex-direction: column;
                gap: 1rem;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <div class="logo">🤝 Settimana 1 - Incontro Conoscitivo</div>
            <div class="session-info">
                <div class="timer-display">
                    ⏱️ <span id="sessionTimer">40:00</span>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="sessionProgress"></div>
                </div>
                <a href="module-hub.html" class="back-button">← Torna ai Moduli</a>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Phase Indicator -->
        <div class="phase-indicator">
            <div class="phase-step active" id="phaseStep1">
                <span>📋</span>
                <span>Fase 1: Questionario Conoscitivo Completo</span>
            </div>
            <div class="phase-arrow">→</div>
            <div class="phase-step inactive" id="phaseStep2">
                <span>🤖</span>
                <span>Fase 2: Approfondimento Coaching AI</span>
            </div>
        </div>

        <!-- Welcome Section -->
        <section class="welcome-section fade-in" id="welcomeSection">
            <h1 class="welcome-title">Benvenuto nella Tua Prima Sessione! 🎉</h1>
            <p class="welcome-subtitle">Incontro Conoscitivo - Settimana 1</p>
            
            <div class="process-explanation">
                <h3 class="process-title">🎯 Il Tuo Percorso di Coaching Personalizzato</h3>
                <div class="process-steps">
                    <div class="process-step">
                        <div class="step-number">1</div>
                        <div class="step-title">Questionario Conoscitivo Completo</div>
                        <div class="step-description">
                            17 domande approfondite per esplorare il tuo passato, presente e futuro. 
                            Questo mi darà un panorama completo della tua situazione.
                        </div>
                        <div class="step-duration">⏱️ 10-15 minuti</div>
                    </div>
                    <div class="process-step">
                        <div class="step-number">2</div>
                        <div class="step-title">Approfondimento Coaching AI</div>
                        <div class="step-description">
                            Attraverso domande potenti personalizzate, faremo emergere nuove consapevolezze 
                            e definiremo insieme i tuoi obiettivi autentici.
                        </div>
                        <div class="step-duration">⏱️ 20-25 minuti</div>
                    </div>
                </div>
            </div>
            
            <button class="btn btn-primary" onclick="startPhase1()">
                🚀 Inizia il Tuo Percorso di Conoscenza
            </button>
        </section>

        <!-- Phase 1: Complete Questionnaire -->
        <section class="phase1-section" id="phase1Section">
            <div class="phase-header">
                <div class="phase-icon">📋</div>
                <div>
                    <h2 class="phase-title">Fase 1: Questionario Conoscitivo Completo</h2>
                    <p class="phase-subtitle">Esploriamo insieme la tua storia, il presente e i tuoi obiettivi</p>
                </div>
            </div>
            
            <div class="form-progress">
                <div class="form-progress-text">Progresso: <span id="phase1Progress">0%</span> - Sezione <span id="currentSectionNum">1</span> di 5</div>
                <div class="form-progress-bar">
                    <div class="form-progress-fill" id="phase1ProgressFill" style="width: 0%"></div>
                </div>
            </div>
            
            <form id="phase1Form">
                <!-- Sezione 1: Informazioni Personali -->
                <div class="form-section" id="section1">
                    <h3>📝 Informazioni Personali</h3>
                    <div class="form-group">
                        <label for="currentSituation">Descrivi la tua situazione attuale in poche parole:</label>
                        <textarea id="currentSituation" placeholder="Es: Manager stressato, mamma sempre di corsa, studente demotivato..." onchange="updatePhase1Progress(); autoSave()"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="dailyLife">Come descriveresti una tua giornata tipo?</label>
                        <textarea id="dailyLife" placeholder="Raccontami come si svolge una giornata normale..." onchange="updatePhase1Progress(); autoSave()"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="lifestyle">Conduci una vita dinamica o sedentaria?</label>
                        <select id="lifestyle" onchange="updatePhase1Progress(); autoSave()">
                            <option value="">Seleziona...</option>
                            <option value="molto_dinamica">Molto dinamica - sempre in movimento</option>
                            <option value="dinamica">Dinamica - abbastanza attivo</option>
                            <option value="equilibrata">Equilibrata - momenti attivi e di riposo</option>
                            <option value="sedentaria">Sedentaria - principalmente davanti al computer</option>
                            <option value="molto_sedentaria">Molto sedentaria - quasi sempre fermo</option>
                        </select>
                    </div>
                </div>

                <!-- Sezione 2: Il Tuo Passato -->
                <div class="form-section" id="section2" style="display: none;">
                    <h3>🔙 Il Tuo Passato</h3>
                    <div class="form-group">
                        <label for="pastDecision">Quando è stata l'ultima volta che hai preso una decisione importante per te?</label>
                        <textarea id="pastDecision" placeholder="Dimmi dell'ultima decisione che ha cambiato qualcosa nella tua vita..." onchange="updatePhase1Progress(); autoSave()"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="pastSuccess">Qual è stata la cosa più importante che hai fatto nella tua vita?</label>
                        <textarea id="pastSuccess" placeholder="Racconta il tuo successo o momento di cui sei più orgoglioso..." onchange="updatePhase1Progress(); autoSave()"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="pastChallenge">Cosa ti ha fatto e ti fa superare meglio gli ostacoli?</label>
                        <textarea id="pastChallenge" placeholder="Quali sono le tue strategie per superare le difficoltà?" onchange="updatePhase1Progress(); autoSave()"></textarea>
                    </div>
                </div>

                <!-- Sezione 3: Il Tuo Presente -->
                <div class="form-section" id="section3" style="display: none;">
                    <h3>📍 Il Tuo Presente</h3>
                    <div class="form-group">
                        <label for="currentMoment">In che momento sei della tua vita?</label>
                        <textarea id="currentMoment" placeholder="Cosa caratterizza questo periodo della tua vita?" onchange="updatePhase1Progress(); autoSave()"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="workSatisfaction">Il lavoro ti soddisfa?</label>
                        <select id="workSatisfaction" onchange="updatePhase1Progress(); autoSave()">
                            <option value="">Seleziona...</option>
                            <option value="molto_soddisfatto">Molto soddisfatto - amo quello che faccio</option>
                            <option value="soddisfatto">Soddisfatto - nel complesso va bene</option>
                            <option value="neutro">Neutro - né soddisfatto né insoddisfatto</option>
                            <option value="insoddisfatto">Insoddisfatto - non mi piace quello che faccio</option>
                            <option value="molto_insoddisfatto">Molto insoddisfatto - odio il mio lavoro</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="selfCare">Ti concedi tempo sufficiente per lo svago e la cura di te?</label>
                        <select id="selfCare" onchange="updatePhase1Progress(); autoSave()">
                            <option value="">Seleziona...</option>
                            <option value="sempre">Sempre - ho un buon equilibrio</option>
                            <option value="spesso">Spesso - riesco a ritagliarmi del tempo</option>
                            <option value="a_volte">A volte - dipende dal periodo</option>
                            <option value="raramente">Raramente - sono sempre impegnato</option>
                            <option value="mai">Mai - non ho tempo per me</option>
                        </select>
                    </div>
                </div>

                <!-- Sezione 4: Il Tuo Futuro -->
                <div class="form-section" id="section4" style="display: none;">
                    <h3>🚀 Il Tuo Futuro</h3>
                    <div class="form-group">
                        <label for="changeReason">Quando ti sei reso conto di voler cambiare? Cosa è scattato?</label>
                        <textarea id="changeReason" placeholder="Racconta il momento in cui hai deciso che dovevi cambiare qualcosa..." onchange="updatePhase1Progress(); autoSave()"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="dreamGoal">Qual è il tuo obiettivo da sogno?</label>
                        <textarea id="dreamGoal" placeholder="Se potessi realizzare qualsiasi cosa, cosa vorresti raggiungere?" onchange="updatePhase1Progress(); autoSave()"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="yearGoal">Quale obiettivo ti puoi dare per quest'anno?</label>
                        <textarea id="yearGoal" placeholder="Un obiettivo realistico ma sfidante per i prossimi 12 mesi..." onchange="updatePhase1Progress(); autoSave()"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="monthGoal">Obiettivo entro il prossimo mese:</label>
                        <textarea id="monthGoal" placeholder="Cosa vuoi raggiungere nei prossimi 30 giorni?" onchange="updatePhase1Progress(); autoSave()"></textarea>
                    </div>
                </div>

                <!-- Sezione 5: Le Tue Motivazioni -->
                <div class="form-section" id="section5" style="display: none;">
                    <h3>💪 Le Tue Motivazioni</h3>
                    <div class="form-group">
                        <label for="mainDesire">Qual è il desiderio principale che ti spinge?</label>
                        <textarea id="mainDesire" placeholder="Cosa vuoi davvero raggiungere con questo percorso?" onchange="updatePhase1Progress(); autoSave()"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="mainPain">Cosa ti fa maggiormente soffrire della tua situazione attuale?</label>
                        <textarea id="mainPain" placeholder="Cosa non sopporti più della tua vita attuale?" onchange="updatePhase1Progress(); autoSave()"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="mainJoy">Cosa ti fa maggiormente gioire?</label>
                        <textarea id="mainJoy" placeholder="Cosa ti rende davvero felice?" onchange="updatePhase1Progress(); autoSave()"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="feelGood">Cosa ti fa sentire bene?</label>
                        <textarea id="feelGood" placeholder="Attività, momenti, situazioni che ti danno energia positiva..." onchange="updatePhase1Progress(); autoSave()"></textarea>
                    </div>
                </div>

                <div class="form-navigation">
                    <button type="button" class="btn btn-secondary" id="prevBtn" onclick="prevSection()" style="display: none;">← Precedente</button>
                    <div>
                        <button type="button" class="btn btn-primary" id="nextBtn" onclick="nextSection()">Continua →</button>
                        <button type="button" class="btn btn-success" id="completePhase1Btn" onclick="completePhase1()" style="display: none;">✅ Completa e Passa al Coaching AI</button>
                    </div>
                </div>
            </form>
        </section>

        <!-- Phase 2: AI Coaching Deep Dive -->
        <section class="phase2-section" id="phase2Section">
            <div class="phase-header">
                <div class="phase-icon">🤖</div>
                <div>
                    <h2 class="phase-title">Fase 2: Approfondimento Coaching con Andrea AI</h2>
                    <p class="phase-subtitle">Attraverso domande potenti, faremo emergere nuove consapevolezze</p>
                </div>
            </div>
            
            <div class="coaching-intro">
                <h3>🎯 Il Mio Approccio di Coaching con Te</h3>
                <p>
                    Ho analizzato le tue 17 risposte e ora voglio accompagnarti in un viaggio di scoperta. 
                    Attraverso <strong>domande potenti</strong> ti aiuterò a guardare dentro di te, 
                    far emergere il tuo <strong>potenziale nascosto</strong> e definire chiaramente 
                    il tuo <strong>stato desiderato</strong>. Non ci sono risposte giuste o sbagliate, 
                    solo la tua autentica verità.
                </p>
            </div>
            
            <div class="time-warning" id="timeWarning">
                <strong>⏰ Abbiamo raggiunto i 30 minuti!</strong> Vuoi continuare per altri 10 minuti o preferisci terminare ora?
                <div style="margin-top: 1rem;">
                    <button class="btn btn-secondary" onclick="continueSession()">Continua</button>
                    <button class="btn btn-primary" onclick="endSession()">Termina Ora</button>
                </div>
            </div>
            
            <div class="chat-status">
                <div class="status-dot"></div>
                <span>Andrea è pronto per il coaching profondo con te</span>
            </div>
            
            <div class="chat-container" id="chatContainer">
                <!-- Messages will be added here -->
            </div>
            
            <div class="chat-input">
                <input type="text" id="chatInput" placeholder="Prenditi il tempo che serve per rispondere ad Andrea...">
                <button class="btn btn-primary" onclick="sendChatMessage()">Invia</button>
            </div>
        </section>

        <!-- Completion Section -->
        <section class="completion-section" id="completionSection">
            <h2 class="completion-title">🎉 Sessione di Coaching Completata!</h2>
            <p class="completion-message">
                Che viaggio incredibile abbiamo fatto insieme! Attraverso il questionario completo e il nostro coaching approfondito, 
                abbiamo fatto emergere aspetti importanti della tua storia e definito chiaramente i tuoi obiettivi autentici.
            </p>
            
            <div class="homework-section">
                <h3 class="homework-title">📚 I Tuoi Compiti Personalizzati di Coaching</h3>
                <ul class="homework-list" id="personalizedHomework">
                    <!-- Will be generated based on coaching session -->
                </ul>
            </div>
            
            <div class="completion-actions">
                <button class="btn btn-success" onclick="downloadPersonalizedHomework()">📄 Scarica Piano Personalizzato</button>
                <a href="module-hub.html" class="btn btn-secondary">← Torna ai Moduli</a>
                <button class="btn btn-primary" onclick="scheduleNextSession()">📅 Programma Settimana 2</button>
            </div>
        </section>
    </main>

    <!-- Load Andrea AI Coach System -->
    <script src="../andrea-ai-coach.js"></script>
    
    <script>
        // Session variables
        let sessionStartTime = Date.now();
        let sessionDuration = 40 * 60 * 1000; // 40 minutes
        let timerInterval;
        let currentPhase = 'welcome';
        let currentSection = 1;
        let totalSections = 5;
        let phase1Data = {};
        let chatHistory = [];
        let andreaAICoach = null;
        let userProfile = null;
        let sessionExtended = false;
        let autoSaveInterval;
        let coachingInsights = [];

        // Coaching principles for AI
        const COACHING_PRINCIPLES = {
            objectives: [
                "Comprendere lo stato presente e lo stato desiderato",
                "Fare chiarezza e connettere con autenticità",
                "Utilizzare intelligenza emotiva ed intuitiva",
                "Far emergere nuove consapevolezze",
                "Definire obiettivi autentici",
                "Tirare fuori la migliore versione di sé"
            ],
            methods: [
                "Domande potenti che lasciano spazio e tempo",
                "Ascolto attivo privo di giudizio",
                "Ricerca del potenziale inespresso",
                "Sviluppo fiducia reciproca",
                "Miglioramento performance attraverso azioni concrete"
            ]
        };

        // Initialize session
        document.addEventListener('DOMContentLoaded', function() {
            startSessionTimer();
            loadUserProfile();
            loadSavedSession();
            initializeAndreaAI();
            startAutoSave();
        });

        function startSessionTimer() {
            timerInterval = setInterval(() => {
                const elapsed = Date.now() - sessionStartTime;
                const remaining = Math.max(0, sessionDuration - elapsed);
                
                const minutes = Math.floor(remaining / 60000);
                const seconds = Math.floor((remaining % 60000) / 1000);
                
                document.getElementById('sessionTimer').textContent = 
                    `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                
                const progress = (elapsed / sessionDuration) * 100;
                document.getElementById('sessionProgress').style.width = `${Math.min(progress, 100)}%`;
                
                // Check for 30 minute warning
                if (elapsed >= 30 * 60 * 1000 && !sessionExtended && currentPhase === 'phase2') {
                    show30MinuteWarning();
                }
                
                // Auto-end at 40 minutes
                if (remaining === 0) {
                    clearInterval(timerInterval);
                    endSession();
                }
            }, 1000);
        }

        function loadUserProfile() {
            try {
                const savedData = localStorage.getItem('lifestyleQuizResults');
                if (savedData) {
                    userProfile = JSON.parse(savedData);
                    console.log('✅ User profile loaded:', userProfile);
                }
            } catch (error) {
                console.error('❌ Error loading user profile:', error);
            }
        }

        function loadSavedSession() {
            try {
                const savedSession = localStorage.getItem('week1SessionInProgress');
                if (savedSession) {
                    const sessionData = JSON.parse(savedSession);
                    
                    // Restore phase 1 data
                    if (sessionData.phase1Data) {
                        phase1Data = sessionData.phase1Data;
                        Object.entries(phase1Data).forEach(([key, value]) => {
                            const element = document.getElementById(key);
                            if (element) {
                                element.value = value;
                            }
                        });
                    }
                    
                    // Restore current section
                    if (sessionData.currentSection) {
                        currentSection = sessionData.currentSection;
                    }
                    
                    // Restore chat history
                    if (sessionData.chatHistory) {
                        chatHistory = sessionData.chatHistory;
                    }
                    
                    // Restore current phase
                    if (sessionData.currentPhase) {
                        currentPhase = sessionData.currentPhase;
                        
                        // Show the correct phase
                        if (currentPhase === 'phase1') {
                            startPhase1();
                            showSection(currentSection);
                        } else if (currentPhase === 'phase2') {
                            startPhase2();
                            restoreChatHistory();
                        }
                    }
                    
                    console.log('✅ Session restored from:', sessionData);
                }
            } catch (error) {
                console.error('❌ Error loading saved session:', error);
            }
        }

        async function initializeAndreaAI() {
            try {
                if (window.AndreaAICoach) {
                    andreaAICoach = new window.AndreaAICoach();
                    
                    const userId = localStorage.getItem('lifestyleUserId') || 'user_' + Date.now();
                    localStorage.setItem('lifestyleUserId', userId);
                    
                    await andreaAICoach.initialize(userId, userProfile || {});
                    
                    console.log('🤖 Andrea AI Coach initialized successfully');
                } else {
                    console.error('❌ Andrea AI Coach not available');
                }
            } catch (error) {
                console.error('❌ Error initializing Andrea AI:', error);
            }
        }

        function startAutoSave() {
            autoSaveInterval = setInterval(() => {
                autoSave();
            }, 5000); // Auto-save every 5 seconds
        }

        function autoSave() {
            try {
                const sessionData = {
                    currentPhase: currentPhase,
                    currentSection: currentSection,
                    phase1Data: phase1Data,
                    chatHistory: chatHistory,
                    coachingInsights: coachingInsights,
                    sessionStartTime: sessionStartTime,
                    lastSaved: new Date().toISOString()
                };
                
                localStorage.setItem('week1SessionInProgress', JSON.stringify(sessionData));
            } catch (error) {
                console.error('❌ Error auto-saving:', error);
            }
        }

        function startPhase1() {
            currentPhase = 'phase1';
            
            // Hide welcome, show phase 1
            document.getElementById('welcomeSection').style.display = 'none';
            document.getElementById('phase1Section').classList.add('active');
            
            // Update phase indicator
            document.getElementById('phaseStep1').className = 'phase-step active';
            document.getElementById('phaseStep2').className = 'phase-step inactive';
            
            showSection(1);
            updatePhase1Progress();
            autoSave();
        }

        function showSection(sectionNum) {
            // Hide all sections
            for (let i = 1; i <= totalSections; i++) {
                document.getElementById(`section${i}`).style.display = 'none';
            }
            
            // Show current section
            document.getElementById(`section${sectionNum}`).style.display = 'block';
            currentSection = sectionNum;
            
            // Update section indicator
            document.getElementById('currentSectionNum').textContent = sectionNum;
            
            // Update navigation buttons
            const prevBtn = document.getElementById('prevBtn');
            const nextBtn = document.getElementById('nextBtn');
            const completeBtn = document.getElementById('completePhase1Btn');
            
            prevBtn.style.display = sectionNum === 1 ? 'none' : 'inline-flex';
            
            if (sectionNum === totalSections) {
                nextBtn.style.display = 'none';
                completeBtn.style.display = 'inline-flex';
            } else {
                nextBtn.style.display = 'inline-flex';
                completeBtn.style.display = 'none';
            }
            
            updatePhase1Progress();
        }

        function nextSection() {
            if (currentSection < totalSections) {
                showSection(currentSection + 1);
                autoSave();
            }
        }

        function prevSection() {
            if (currentSection > 1) {
                showSection(currentSection - 1);
                autoSave();
            }
        }

        function updatePhase1Progress() {
            const form = document.getElementById('phase1Form');
            const inputs = form.querySelectorAll('input, textarea, select');
            
            let filled = 0;
            inputs.forEach(input => {
                if (input.value.trim()) {
                    filled++;
                    phase1Data[input.id] = input.value.trim();
                }
            });
            
            const progress = (filled / inputs.length) * 100;
            document.getElementById('phase1Progress').textContent = `${Math.round(progress)}%`;
            document.getElementById('phase1ProgressFill').style.width = `${progress}%`;
            
            // Enable/disable complete button if on last section
            if (currentSection === totalSections) {
                const completeBtn = document.getElementById('completePhase1Btn');
                const currentSectionInputs = document.getElementById(`section${currentSection}`).querySelectorAll('input, textarea, select');
                const currentFilled = Array.from(currentSectionInputs).filter(input => input.value.trim()).length;
                
                if (currentFilled === currentSectionInputs.length) {
                    completeBtn.disabled = false;
                    completeBtn.className = 'btn btn-success';
                } else {
                    completeBtn.disabled = true;
                    completeBtn.className = 'btn btn-disabled';
                }
            }
        }

        function completePhase1() {
            // Mark phase 1 as completed
            document.getElementById('phaseStep1').className = 'phase-step completed';
            
            // Start phase 2
            startPhase2();
        }

        function startPhase2() {
            currentPhase = 'phase2';
            
            // Hide phase 1, show phase 2
            document.getElementById('phase1Section').classList.remove('active');
            document.getElementById('phase2Section').classList.add('active');
            
            // Update phase indicator
            document.getElementById('phaseStep2').className = 'phase-step active';
            
            // Generate first coaching question based on complete phase 1 data
            generateFirstCoachingQuestion();
            
            autoSave();
        }

        function generateFirstCoachingQuestion() {
            if (chatHistory.length === 0) {
                // Analyze the 17 responses and generate a powerful coaching question
                const firstQuestion = generatePowerfulOpeningQuestion();
                addChatMessage(firstQuestion, 'coach');
            } else {
                // Restore existing chat if resuming
                restoreChatHistory();
            }
        }

        function generatePowerfulOpeningQuestion() {
            // Analyze key themes from the 17 responses
            let question = `Ho letto tutte le tue 17 risposte con grande attenzione, e c'è qualcosa di molto autentico che emerge dalla tua storia. `;
            
            // Focus on the transformation moment
            if (phase1Data.changeReason) {
                question += `Mi ha colpito particolarmente quando hai scritto che ti sei reso conto di voler cambiare: "${phase1Data.changeReason}". `;
            }
            
            // Connect present state with desired future
            if (phase1Data.currentSituation && phase1Data.dreamGoal) {
                question += `Vedo che oggi ti descrivi come "${phase1Data.currentSituation}" ma il tuo obiettivo da sogno è "${phase1Data.dreamGoal}". `;
            }
            
            // Ask a powerful coaching question
            question += `\n\nOra, voglio farti una domanda potente e ti chiedo di prendere tutto il tempo che serve per rispondere dal profondo del tuo cuore: 
            
**Se tra un anno dovessi guardare indietro a questo momento, cosa vorresti essere riuscito a scoprire di te stesso che oggi ancora non conosci?** 🤔
            
Non c'è fretta. Lascia che la risposta emerga naturalmente.`;
            
            return question;
        }

        function restoreChatHistory() {
            const chatContainer = document.getElementById('chatContainer');
            chatContainer.innerHTML = '';
            
            chatHistory.forEach(message => {
                const messageDiv = document.createElement('div');
                messageDiv.className = `message ${message.sender}`;
                messageDiv.innerHTML = `
                    <div class="message-content">${message.content}</div>
                    <div class="message-time">${message.time}</div>
                `;
                chatContainer.appendChild(messageDiv);
            });
            
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }

        async function sendChatMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            
            if (!message) return;
            
            // Add user message
            addChatMessage(message, 'user');
            input.value = '';
            
            // Get AI coaching response
            try {
                const coachingResponse = await getCoachingResponse(message);
                setTimeout(() => {
                    addChatMessage(coachingResponse, 'coach');
                }, 1500); // Slightly longer delay for thoughtful coaching
            } catch (error) {
                console.error('❌ Error getting coaching response:', error);
                setTimeout(() => {
                    addChatMessage("Dammi un momento per riflettere sulla tua risposta... Puoi ripetere?", 'coach');
                }, 1000);
            }
        }

        function addChatMessage(content, sender) {
            const chatContainer = document.getElementById('chatContainer');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender}`;
            
            const now = new Date();
            const time = now.toLocaleTimeString('it-IT', { hour: '2-digit', minute: '2-digit' });
            
            messageDiv.innerHTML = `
                <div class="message-content">${content}</div>
                <div class="message-time">${time}</div>
            `;
            
            chatContainer.appendChild(messageDiv);
            chatContainer.scrollTop = chatContainer.scrollHeight;
            
            // Store in history
            chatHistory.push({ sender, content, time });
            
            // Extract insights if it's a user message
            if (sender === 'user') {
                extractCoachingInsights(content);
            }
            
            autoSave();
        }

        async function getCoachingResponse(userMessage) {
            // Build comprehensive context for coaching
            const coachingContext = {
                phase1Data: phase1Data,
                chatHistory: chatHistory,
                coachingInsights: coachingInsights,
                userProfile: userProfile,
                coachingPrinciples: COACHING_PRINCIPLES
            };
            
            // Try Andrea AI with coaching context
            if (andreaAICoach) {
                try {
                    const response = await andreaAICoach.sendMessage(userMessage, 1);
                    if (response.success) {
                        return response.response;
                    }
                } catch (error) {
                    console.error('❌ Andrea AI coaching error:', error);
                }
            }
            
            // Fallback to sophisticated coaching response
            return generateCoachingResponse(userMessage, coachingContext);
        }

        function generateCoachingResponse(userMessage, context) {
            // Sophisticated coaching responses based on principles
            const messageCount = context.chatHistory.filter(m => m.sender === 'user').length;
            
            // Different coaching approaches based on conversation depth
            if (messageCount <= 2) {
                // Early exploration - dig deeper into emotions and motivations
                return generateExplorationResponse(userMessage, context);
            } else if (messageCount <= 4) {
                // Middle - challenge assumptions and explore possibilities
                return generateChallengeResponse(userMessage, context);
            } else {
                // Later - action orientation and commitment
                return generateActionResponse(userMessage, context);
            }
        }

        function generateExplorationResponse(userMessage, context) {
            const responses = [
                `Quello che condividi è molto profondo. Sento una grande autenticità nelle tue parole. Quando pensi a questa trasformazione che desideri, cosa senti nel corpo? C'è eccitazione, paura, o qualcos'altro?`,
                
                `Ti ringrazio per la tua onestà. Quello che mi dici risuona con la mia esperienza di quando ho iniziato il mio percorso. Se dovessi immaginare la persona che vuoi diventare, cosa farebbe diversamente domani mattina appena sveglio?`,
                
                `Interessante... Sento che c'è qualcosa di molto importante in quello che stai dicendo. Se questa parte di te che vuole cambiare potesse parlare, cosa ti direbbe? Che messaggio ha per te?`,
                
                `La tua risposta tocca qualcosa di molto vero. Nel mio lavoro ho imparato che spesso le risposte più autentiche arrivano quando ci permettiamo di sentire davvero. Cosa ti sta impedendo di essere già la persona che vuoi diventare?`
            ];
            
            // Personalize based on phase 1 data
            if (context.phase1Data.mainPain) {
                return `Quello che condividi risuona profondamente con me. Quando hai scritto che ti fa soffrire "${context.phase1Data.mainPain}", ho sentito una grande verità. Ora, ascoltando le tue parole, mi chiedo: se potessi trasformare questa sofferenza in una forza, come sarebbe? Che superpotere nasconde dentro di sé?`;
            }
            
            return responses[Math.floor(Math.random() * responses.length)];
        }

        function generateChallengeResponse(userMessage, context) {
            const responses = [
                `Le tue parole mi fanno riflettere... Sento che hai una consapevolezza molto profonda. Ora voglio farti una domanda che potrebbe sembrare provocatoria: cosa accadrebbe se scoprissi che tutto quello che credi di non saper fare, in realtà lo sai già fare?`,
                
                `Quello che dici è molto potente. Mi viene in mente una cosa: spesso ciò che pensiamo sia il nostro limite, in realtà è la porta verso la nostra trasformazione. Se questa situazione che vivi fosse perfetta per insegnarti esattamente quello che devi imparare, cosa ti starebbe insegnando?`,
                
                `Sento una forza incredibile nelle tue parole, anche se forse tu non te ne rendi conto. Facciamo un esperimento mentale: se fossi già la versione migliore di te stesso, come vedresti la situazione che stai vivendo ora?`,
                
                `Le tue risposte mi mostrano una persona che ha dentro di sé risorse enormi. Mi chiedo: se dovessi dare un consiglio al te stesso di un anno fa, cosa gli diresti? E cosa pensi che il te stesso di un anno nel futuro direbbe al te di oggi?`
            ];
            
            // Challenge based on specific data
            if (context.phase1Data.pastSuccess) {
                return `Quando mi hai raccontato del tuo successo passato - "${context.phase1Data.pastSuccess}" - ho visto una persona capace di grandi cose. Ora mi chiedo: quella stessa forza che ti ha permesso di ottenere quel risultato, dov'è ora? È ancora dentro di te, vero? Come potresti riattivarla per questa nuova sfida?`;
            }
            
            return responses[Math.floor(Math.random() * responses.length)];
        }

        function generateActionResponse(userMessage, context) {
            const responses = [
                `Sento che stiamo arrivando al cuore di qualcosa di molto importante. Le nostre parole stanno creando chiarezza. Ora voglio spostarci verso l'azione: se dovessi fare UNA cosa domani che ti avvicini a questa versione migliore di te stesso, cosa sarebbe? Qualcosa di piccolo ma significativo.`,
                
                `La nostra conversazione mi sta mostrando un potenziale incredibile in te. Ora è il momento di trasformare questa consapevolezza in movimento. Quale piccolo esperimento potresti fare questa settimana per testare questa nuova versione di te stesso?`,
                
                `Quello che stiamo scoprendo insieme è oro puro. Sento che sei pronto per il prossimo passo. Se dovessi impegnarti con me stesso qui e ora su UNA cosa che farai diversamente da oggi, cosa sarebbe? Qualcosa che onori questa nuova consapevolezza.`,
                
                `Le tue risposte mi stanno confermando quello che pensavo: hai tutto dentro di te per creare questo cambiamento. Ora la domanda è: sei pronto a fidarti di te stesso? Qual è il primo piccolo passo coraggioso che puoi fare?`
            ];
            
            // Action-oriented based on goals
            if (context.phase1Data.monthGoal) {
                return `Tutto quello che abbiamo esplorato insieme sta prendendo forma. Ricordi che hai scritto come obiettivo del mese: "${context.phase1Data.monthGoal}". Ora, con tutto quello che abbiamo scoperto, come vedi questo obiettivo? È ancora autentico per te? E se sì, quale piccola azione di oggi può avvicinarti a questo risultato?`;
            }
            
            return responses[Math.floor(Math.random() * responses.length)];
        }

        function extractCoachingInsights(userMessage) {
            // Extract key insights from user responses for homework personalization
            const insights = [];
            
            if (userMessage.toLowerCase().includes('paura') || userMessage.toLowerCase().includes('timore')) {
                insights.push('Lavoro su paure e limitazioni');
            }
            
            if (userMessage.toLowerCase().includes('energia') || userMessage.toLowerCase().includes('forza')) {
                insights.push('Focus su energie e risorse personali');
            }
            
            if (userMessage.toLowerCase().includes('cambiare') || userMessage.toLowerCase().includes('trasformare')) {
                insights.push('Motivazione al cambiamento forte');
            }
            
            if (userMessage.toLowerCase().includes('famiglia') || userMessage.toLowerCase().includes('relazioni')) {
                insights.push('Importanza relazioni e supporto sociale');
            }
            
            coachingInsights.push(...insights);
        }

        function show30MinuteWarning() {
            document.getElementById('timeWarning').classList.add('active');
        }

        function continueSession() {
            sessionExtended = true;
            document.getElementById('timeWarning').classList.remove('active');
            showMessage('✅ Sessione estesa di 10 minuti. Il nostro coaching continua!', 'success');
        }

        function endSession() {
            clearInterval(timerInterval);
            clearInterval(autoSaveInterval);
            completeSession();
        }

        function completeSession() {
            // Save final session data
            const finalSessionData = {
                phase1Data: phase1Data,
                chatHistory: chatHistory,
                coachingInsights: coachingInsights,
                completedAt: new Date().toISOString(),
                sessionDuration: Date.now() - sessionStartTime,
                userProfile: userProfile
            };
            
            localStorage.setItem('week1SessionCompleted', JSON.stringify(finalSessionData));
            localStorage.removeItem('week1SessionInProgress');
            
            // Update progress
            updateUserProgress();
            
            // Show completion
            document.getElementById('phase2Section').classList.remove('active');
            document.getElementById('completionSection').classList.add('active');
            
            // Generate personalized coaching homework
            generateCoachingHomework();
            
            document.getElementById('completionSection').scrollIntoView({ behavior: 'smooth' });
        }

        function generateCoachingHomework() {
            const homeworkList = document.getElementById('personalizedHomework');
            let homework = [];
            
            // Base coaching homework
            homework.push("✅ Pratica 10 minuti di riflessione quotidiana sulle consapevolezze emerse");
            homework.push("✅ Rileggi le tue risposte del questionario e nota cosa è cambiato");
            
            // Personalized based on phase 1 key data
            if (phase1Data.dreamGoal) {
                homework.push(`✅ Visualizza ogni mattina il tuo obiettivo da sogno: "${phase1Data.dreamGoal}"`);
            }
            
            if (phase1Data.pastSuccess) {
                homework.push(`✅ Identifica 3 qualità che ti hanno permesso di ottenere: "${phase1Data.pastSuccess}"`);
            }
            
            if (phase1Data.mainPain) {
                homework.push(`✅ Trasforma "${phase1Data.mainPain}" in una domanda potente: "Come posso...?"`);
            }
            
            // Based on coaching insights
            if (coachingInsights.includes('Lavoro su paure e limitazioni')) {
                homework.push("✅ Scrivi una lettera di incoraggiamento a te stesso per quando hai paura");
            }
            
            if (coachingInsights.includes('Focus su energie e risorse personali')) {
                homework.push("✅ Crea una 'mappa delle tue energie' e identifica cosa le alimenta");
            }
            
            if (coachingInsights.includes('Motivazione al cambiamento forte')) {
                homework.push("✅ Fai una piccola azione coraggiosa ogni giorno verso il cambiamento");
            }
            
            // Always add
            homework.push("✅ Tieni un diario delle scoperte: cosa impari ogni giorno su di te?");
            
            // Update homework list
            homeworkList.innerHTML = homework.map(item => `<li>${item}</li>`).join('');
        }

        function updateUserProgress() {
            try {
                const progress = JSON.parse(localStorage.getItem('lifestyleProgress') || '{}');
                progress.completedWeeks = progress.completedWeeks || [];
                
                if (!progress.completedWeeks.includes(1)) {
                    progress.completedWeeks.push(1);
                    progress.currentWeek = 2;
                    progress.lastUpdate = new Date().toISOString();
                    
                    localStorage.setItem('lifestyleProgress', JSON.stringify(progress));
                }
            } catch (error) {
                console.error('❌ Error updating progress:', error);
            }
        }

        function downloadPersonalizedHomework() {
            const homeworkContent = `
                PIANO PERSONALIZZATO DI COACHING - SETTIMANA 1
                
                Andrea Padoan - Lifestyle Coach
                
                Caro/a ${userProfile?.name || 'Amico/a'},
                
                Che sessione straordinaria abbiamo vissuto insieme! 
                Attraverso le tue 17 risposte approfondite e il nostro coaching,
                sono emersi aspetti autentici e potenti della tua storia.
                
                === LA TUA SITUAZIONE ATTUALE ===
                Situazione: "${phase1Data.currentSituation || 'In fase di riflessione'}"
                Sfida principale: "${phase1Data.mainPain || 'Da definire insieme'}"
                Obiettivo da sogno: "${phase1Data.dreamGoal || 'In fase di scoperta'}"
                
                === LE TUE RISORSE ===
                Successo passato: "${phase1Data.pastSuccess || 'Molte risorse da scoprire'}"
                Strategie per superare ostacoli: "${phase1Data.pastChallenge || 'In via di sviluppo'}"
                Fonte di gioia: "${phase1Data.mainJoy || 'Da esplorare insieme'}"
                
                === COMPITI PERSONALIZZATI ===
                
                1. RIFLESSIONE QUOTIDIANA (10 minuti)
                   - Rileggi le consapevolezze emerse dal nostro coaching
                   - Domandati: "Cosa sto imparando oggi su me stesso?"
                   - Annota le tue scoperte in un diario
                
                2. CONNESSIONE CON IL TUO OBIETTIVO DA SOGNO
                   - Visualizza ogni mattina: "${phase1Data.dreamGoal || 'il tuo obiettivo autentico'}"
                   - Senti nel corpo cosa provi quando lo immagini realizzato
                   - Chiedi a te stesso: "Cosa posso fare oggi per avvicinarmi?"
                
                3. TRASFORMAZIONE DELLE SFIDE IN RISORSE
                   - Lavora su: "${phase1Data.mainPain || 'le tue sfide principali'}"
                   - Trasforma in domanda potente: "Come posso trasformare questo in forza?"
                   - Identifica una piccola azione quotidiana di miglioramento
                
                4. ATTIVAZIONE DELLE TUE RISORSE PASSATE
                   - Rifletti sul tuo successo: "${phase1Data.pastSuccess || 'i tuoi successi passati'}"
                   - Identifica 3 qualità che ti hanno permesso quel risultato
                   - Come puoi riattivare quelle qualità oggi?
                
                5. MOMENTO DI GIOIA QUOTIDIANO
                   - Connettiti con: "${phase1Data.mainJoy || 'ciò che ti rende felice'}"
                   - Dedica almeno 10 minuti al giorno a questa fonte di energia
                   - Osserva come influenza il resto della tua giornata
                
                === INSIGHTS DAL NOSTRO COACHING ===
                ${coachingInsights.length > 0 ? coachingInsights.map(insight => `• ${insight}`).join('\n                ') : '• Ricorda le consapevolezze emerse dalla nostra conversazione'}
                
                === DOMANDE POTENTI PER LA SETTIMANA ===
                • Se fossi già la migliore versione di me stesso, come agirei oggi?
                • Cosa mi sta insegnando questa situazione che sto vivendo?
                • Quale piccolo passo coraggioso posso fare oggi?
                • Di cosa ho bisogno per fidarmi di più di me stesso?
                
                === PROSSIMI PASSI ===
                La Settimana 2 si sbloccherà tra 7 giorni.
                Usa questo tempo per integrare le consapevolezze emerse.
                Ricorda: il cambiamento autentico inizia da piccoli passi quotidiani.
                
                === MESSAGGIO PERSONALE ===
                ${userProfile?.name || 'Amico/a'}, ho sentito una grande autenticità nelle tue parole.
                Il percorso che hai iniziato oggi è quello verso la migliore versione di te stesso.
                Abbi fiducia nel processo e ricorda: hai già dentro di te tutto quello che serve.
                
                Il tuo coach,
                Andrea 🚀
                
                P.S. Se durante la settimana emergono riflessioni importanti,
                annotale nel tuo diario. Le riprenderemo nella Settimana 2.
            `;
            
            const blob = new Blob([homeworkContent], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `Piano_Coaching_Settimana_1_${userProfile?.name || 'Utente'}.txt`;
            a.click();
            URL.revokeObjectURL(url);
            
            showMessage('📄 Piano di coaching personalizzato scaricato!', 'success');
        }

        function scheduleNextSession() {
            const nextWeekDate = new Date();
            nextWeekDate.setDate(nextWeekDate.getDate() + 7);
            
            const message = `📅 Settimana 2 "Consapevolezza di Sé" disponibile il ${nextWeekDate.toLocaleDateString('it-IT')}!`;
            showMessage(message, 'info');
            
            localStorage.setItem('nextSessionReminder', nextWeekDate.toISOString());
        }

        function showMessage(message, type = 'info') {
            const colors = {
                success: '#16a34a',
                warning: '#f59e0b',
                info: '#3b82f6',
                error: '#ef4444'
            };
            
            const notification = document.createElement('div');
            notification.innerHTML = `
                <div style="position: fixed; top: 20px; right: 20px; background: ${colors[type]}; color: white; padding: 1rem 2rem; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.2); z-index: 1000; max-width: 400px; animation: slideIn 0.3s ease-out;">
                    ${message}
                </div>
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 5000);
        }

        // Handle Enter key in chat
        document.getElementById('chatInput')?.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                sendChatMessage();
            }
        });

        // Handle page unload
        window.addEventListener('beforeunload', function() {
            if (currentPhase !== 'completed') {
                autoSave();
            }
        });

        // Add slide-in animation style
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideIn {
                from {
                    transform: translateX(100%);
                    opacity: 0;
                }
                to {
                    transform: translateX(0);
                    opacity: 1;
                }
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>