<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Settimana 2 - Consapevolezza di SÃ© | Andrea Padoan Coach</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #f8fafc 0%, #fff7ed 50%, #f0fdf4 100%);
            min-height: 100vh;
            color: #1e293b;
        }

        /* Header */
        .header {
            background: linear-gradient(135deg, #1e293b 0%, #ea580c 100%);
            color: white;
            padding: 2rem 0;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 1.3rem;
            font-weight: bold;
        }

        .session-info {
            display: flex;
            align-items: center;
            gap: 2rem;
        }

        .timer-display {
            background: rgba(255,255,255,0.2);
            padding: 0.5rem 1rem;
            border-radius: 8px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .progress-bar {
            background: rgba(255,255,255,0.2);
            width: 200px;
            height: 8px;
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-fill {
            background: #22c55e;
            height: 100%;
            width: 0%;
            transition: width 0.3s ease;
        }

        .back-button {
            background: rgba(255,255,255,0.2);
            padding: 0.5rem 1rem;
            border-radius: 8px;
            text-decoration: none;
            color: white;
            transition: all 0.3s ease;
        }

        .back-button:hover {
            background: rgba(255,255,255,0.3);
        }

        /* AI Integration Badge */
        .ai-badge {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }

        .ai-pulse {
            width: 8px;
            height: 8px;
            background: #22c55e;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        /* Main Content */
        .main-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }

        /* Phase Indicator */
        .phase-indicator {
            background: white;
            border-radius: 12px;
            padding: 1rem 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .phase-step {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            font-weight: 600;
            min-width: 250px;
        }

        .phase-step.active {
            background: linear-gradient(135deg, #ea580c 0%, #fb923c 100%);
            color: white;
        }

        .phase-step.completed {
            background: linear-gradient(135deg, #16a34a 0%, #22c55e 100%);
            color: white;
        }

        .phase-step.inactive {
            background: #f1f5f9;
            color: #94a3b8;
        }

        .phase-arrow {
            font-size: 1.5rem;
            color: #64748b;
        }

        /* Welcome Section */
        .welcome-section {
            background: white;
            border-radius: 16px;
            padding: 3rem;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            margin-bottom: 2rem;
            text-align: center;
        }

        .welcome-title {
            font-size: 2.5rem;
            font-weight: bold;
            color: #1e293b;
            margin-bottom: 1rem;
        }

        .welcome-subtitle {
            font-size: 1.3rem;
            color: #ea580c;
            margin-bottom: 2rem;
        }

        .week1-recap {
            background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);
            border-radius: 12px;
            padding: 2rem;
            margin-bottom: 2rem;
            text-align: left;
        }

        .recap-title {
            font-size: 1.3rem;
            font-weight: bold;
            color: #16a34a;
            margin-bottom: 1rem;
            text-align: center;
        }

        .process-explanation {
            background: linear-gradient(135deg, #fff7ed 0%, #fed7aa 100%);
            border-radius: 12px;
            padding: 2rem;
            margin-bottom: 2rem;
            text-align: left;
        }

        .process-title {
            font-size: 1.3rem;
            font-weight: bold;
            color: #ea580c;
            margin-bottom: 1rem;
            text-align: center;
        }

        .process-steps {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
        }

        .process-step {
            background: white;
            padding: 1.5rem;
            border-radius: 8px;
            border-left: 4px solid #ea580c;
        }

        .step-number {
            font-size: 1.5rem;
            font-weight: bold;
            color: #ea580c;
            margin-bottom: 0.5rem;
        }

        .step-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: #1e293b;
            margin-bottom: 0.5rem;
        }

        .step-description {
            font-size: 0.9rem;
            color: #64748b;
            line-height: 1.5;
        }

        .step-duration {
            font-size: 0.8rem;
            color: #ea580c;
            font-weight: 600;
            margin-top: 0.5rem;
        }

        /* Phase 1 - Awareness Tests */
        .phase1-section {
            background: white;
            border-radius: 16px;
            padding: 2rem;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            margin-bottom: 2rem;
            display: none;
        }

        .phase1-section.active {
            display: block;
        }

        .phase-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid #f1f5f9;
        }

        .phase-icon {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #1e293b 0%, #ea580c 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: white;
        }

        .phase-title {
            font-size: 1.5rem;
            font-weight: bold;
            color: #1e293b;
            margin-bottom: 0.5rem;
        }

        .phase-subtitle {
            font-size: 1rem;
            color: #64748b;
        }

        .test-progress {
            background: #f1f5f9;
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1.5rem;
            text-align: center;
        }

        .test-progress-text {
            font-size: 0.9rem;
            color: #64748b;
            margin-bottom: 0.5rem;
        }

        .test-progress-bar {
            background: #e2e8f0;
            height: 8px;
            border-radius: 4px;
            overflow: hidden;
        }

        .test-progress-fill {
            background: linear-gradient(135deg, #16a34a 0%, #22c55e 100%);
            height: 100%;
            transition: width 0.3s ease;
        }

        .test-section {
            margin-bottom: 2rem;
            padding: 1.5rem;
            background: #f8fafc;
            border-radius: 12px;
            border-left: 4px solid #ea580c;
        }

        .test-section h3 {
            color: #1e293b;
            margin-bottom: 1rem;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .test-intro {
            background: #fff7ed;
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1.5rem;
            font-style: italic;
            color: #ea580c;
        }

        .question-group {
            margin-bottom: 2rem;
            padding: 1rem;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .question-text {
            font-weight: 600;
            margin-bottom: 1rem;
            color: #1e293b;
            font-size: 1.1rem;
        }

        .likert-scale {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 1rem;
            margin: 1rem 0;
        }

        .likert-option {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.5rem;
            flex: 1;
        }

        .likert-option input[type="radio"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        .likert-label {
            font-size: 0.8rem;
            text-align: center;
            color: #64748b;
            line-height: 1.2;
        }

        .scale-labels {
            display: flex;
            justify-content: space-between;
            margin-top: 0.5rem;
            font-size: 0.8rem;
            color: #94a3b8;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            color: #374151;
            font-weight: 500;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: #ea580c;
        }

        .form-group textarea {
            resize: vertical;
            min-height: 100px;
        }

        /* Phase 2 - Deep Coaching */
        .phase2-section {
            background: white;
            border-radius: 16px;
            padding: 2rem;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            margin-bottom: 2rem;
            display: none;
        }

        .phase2-section.active {
            display: block;
        }

        .coaching-context {
            background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);
            border-radius: 12px;
            padding: 2rem;
            margin-bottom: 2rem;
        }

        .coaching-context h3 {
            color: #16a34a;
            margin-bottom: 1rem;
            font-size: 1.3rem;
        }

        .coaching-context p {
            color: #15803d;
            line-height: 1.6;
            margin-bottom: 1rem;
        }

        .insights-summary {
            background: white;
            padding: 1.5rem;
            border-radius: 8px;
            border-left: 4px solid #16a34a;
        }

        .insights-title {
            font-weight: 600;
            color: #1e293b;
            margin-bottom: 0.5rem;
        }

        .insights-list {
            list-style: none;
            padding: 0;
        }

        .insights-list li {
            padding: 0.25rem 0;
            color: #64748b;
            font-size: 0.9rem;
        }

        .chat-container {
            background: #f8fafc;
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            min-height: 400px;
            max-height: 500px;
            overflow-y: auto;
        }

        .message {
            margin-bottom: 1rem;
            padding: 1rem;
            border-radius: 12px;
            max-width: 85%;
            animation: messageSlide 0.3s ease-out;
        }

        .message.coach {
            background: linear-gradient(135deg, #fff7ed 0%, #fed7aa 100%);
            margin-right: auto;
        }

        .message.user {
            background: linear-gradient(135deg, #e0f2fe 0%, #b3e5fc 100%);
            margin-left: auto;
            text-align: right;
        }

        .message-content {
            font-size: 1rem;
            line-height: 1.5;
            margin-bottom: 0.5rem;
        }

        .message-time {
            font-size: 0.8rem;
            color: #64748b;
        }

        .chat-input {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .chat-input input {
            flex: 1;
            padding: 0.75rem;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 1rem;
        }

        .chat-input input:focus {
            outline: none;
            border-color: #ea580c;
        }

        .chat-status {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 1rem;
            font-size: 0.9rem;
            color: #16a34a;
        }

        .status-dot {
            width: 10px;
            height: 10px;
            background: #22c55e;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        /* Buttons */
        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 1rem;
        }

        .btn-primary {
            background: linear-gradient(135deg, #1e293b 0%, #ea580c 100%);
            color: white;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(0,0,0,0.3);
        }

        .btn-secondary {
            background: white;
            color: #1e293b;
            border: 2px solid #e2e8f0;
        }

        .btn-secondary:hover {
            border-color: #ea580c;
            color: #ea580c;
        }

        .btn-success {
            background: linear-gradient(135deg, #16a34a 0%, #22c55e 100%);
            color: white;
        }

        .btn-success:hover {
            transform: translateY(-2px);
        }

        .btn-disabled {
            background: #94a3b8;
            color: white;
            cursor: not-allowed;
        }

        /* Navigation Buttons */
        .form-navigation {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-top: 2rem;
            padding-top: 1rem;
            border-top: 1px solid #e2e8f0;
        }

        /* Time Warning */
        .time-warning {
            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
            color: white;
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
            text-align: center;
            display: none;
        }

        .time-warning.active {
            display: block;
        }

        /* Completion Section */
        .completion-section {
            background: white;
            border-radius: 16px;
            padding: 2rem;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            margin-top: 2rem;
            display: none;
        }

        .completion-section.active {
            display: block;
        }

        .completion-title {
            font-size: 2rem;
            font-weight: bold;
            color: #1e293b;
            margin-bottom: 1rem;
            text-align: center;
        }

        .completion-message {
            font-size: 1.1rem;
            line-height: 1.6;
            color: #475569;
            margin-bottom: 2rem;
            text-align: center;
        }

        .awareness-results {
            background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);
            border-radius: 12px;
            padding: 2rem;
            margin-bottom: 2rem;
        }

        .results-title {
            font-size: 1.3rem;
            font-weight: bold;
            color: #16a34a;
            margin-bottom: 1rem;
        }

        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .result-item {
            background: white;
            padding: 1rem;
            border-radius: 8px;
            text-align: center;
            border-left: 4px solid #16a34a;
        }

        .result-score {
            font-size: 2rem;
            font-weight: bold;
            color: #16a34a;
            margin-bottom: 0.5rem;
        }

        .result-label {
            font-size: 0.9rem;
            color: #64748b;
            margin-bottom: 0.5rem;
        }

        .result-feedback {
            font-size: 0.8rem;
            color: #15803d;
            font-style: italic;
        }

        .homework-section {
            background: linear-gradient(135deg, #fff7ed 0%, #fed7aa 100%);
            border-radius: 12px;
            padding: 2rem;
            margin-bottom: 2rem;
        }

        .homework-title {
            font-size: 1.3rem;
            font-weight: bold;
            color: #ea580c;
            margin-bottom: 1rem;
        }

        .homework-list {
            list-style: none;
            padding: 0;
        }

        .homework-list li {
            padding: 0.5rem 0;
            border-bottom: 1px solid rgba(234, 88, 12, 0.2);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .homework-list li:last-child {
            border-bottom: none;
        }

        .completion-actions {
            display: flex;
            justify-content: center;
            gap: 1rem;
            flex-wrap: wrap;
        }

        /* Animations */
        @keyframes messageSlide {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .main-content {
                padding: 1rem;
            }
            
            .process-steps {
                grid-template-columns: 1fr;
            }
            
            .phase-indicator {
                flex-direction: column;
                gap: 0.5rem;
            }
            
            .phase-step {
                min-width: auto;
                width: 100%;
                justify-content: center;
            }
            
            .phase-arrow {
                transform: rotate(90deg);
            }
            
            .likert-scale {
                flex-direction: column;
                gap: 0.5rem;
            }
            
            .results-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <div class="logo">ð§  Settimana 2 - Consapevolezza di SÃ©</div>
            <div class="session-info">
                <div class="ai-badge">
                    <div class="ai-pulse"></div>
                    AI Personalizzato
                </div>
                <div class="timer-display">
                    â±ï¸ <span id="sessionTimer">45:00</span>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="sessionProgress"></div>
                </div>
                <a href="module-hub.html" class="back-button">â Torna ai Moduli</a>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Phase Indicator -->
        <div class="phase-indicator">
            <div class="phase-step active" id="phaseStep1">
                <span>ð§ </span>
                <span>Fase 1: Test di Consapevolezza</span>
            </div>
            <div class="phase-arrow">â</div>
            <div class="phase-step inactive" id="phaseStep2">
                <span>ð¤</span>
                <span>Fase 2: Coaching Profondo AI</span>
            </div>
        </div>

        <!-- Welcome Section -->
        <section class="welcome-section fade-in" id="welcomeSection">
            <h1 class="welcome-title">Benvenuto nella Settimana 2! ð</h1>
            <p class="welcome-subtitle">Consapevolezza di SÃ© - Scopri chi sei veramente</p>
            
            <div class="week1-recap">
                <h3 class="recap-title">ð¯ Quello che Abbiamo Scoperto nella Settimana 1</h3>
                <div id="week1Summary">
                    <p>Caricamento del tuo riepilogo personalizzato dalla settimana 1...</p>
                </div>
            </div>
            
            <div class="process-explanation">
                <h3 class="process-title">ð§  Il Tuo Viaggio di Consapevolezza Personalizzato</h3>
                <div class="process-steps">
                    <div class="process-step">
                        <div class="step-number">1</div>
                        <div class="step-title">Test di Consapevolezza</div>
                        <div class="step-description">
                            Test di autostima, valori personali e motivazioni intrinseche 
                            per mappare la tua consapevolezza attuale.
                        </div>
                        <div class="step-duration">â±ï¸ 15 minuti</div>
                    </div>
                    <div class="process-step">
                        <div class="step-number">2</div>
                        <div class="step-title">Coaching Profondo AI</div>
                        <div class="step-description">
                            Andrea AI personalizzato per il tuo profilo ti guiderÃ  attraverso 
                            domande uniche per far emergere la tua autentica consapevolezza.
                        </div>
                        <div class="step-duration">â±ï¸ 25-30 minuti</div>
                    </div>
                </div>
            </div>
            
            <button class="btn btn-primary" onclick="startPhase1()">
                ð Inizia il Tuo Viaggio di Consapevolezza Personalizzato
            </button>
        </section>

        <!-- Phase 1: Awareness Tests -->
        <section class="phase1-section" id="phase1Section">
            <div class="phase-header">
                <div class="phase-icon">ð§ </div>
                <div>
                    <h2 class="phase-title">Fase 1: Test di Consapevolezza</h2>
                    <p class="phase-subtitle">Esploriamo la tua autostima, valori e motivazioni profonde</p>
                </div>
            </div>
            
            <div class="test-progress">
                <div class="test-progress-text">Progresso test: <span id="testProgress">0%</span></div>
                <div class="test-progress-bar">
                    <div class="test-progress-fill" id="testProgressFill" style="width: 0%"></div>
                </div>
            </div>
            
            <form id="awarenessForm">
                <!-- Test Autostima -->
                <div class="test-section" id="selfEsteemTest">
                    <h3>ðª Test di Autostima</h3>
                    <div class="test-intro">
                        Per ogni affermazione, indica quanto ti rappresenta su una scala da 1 (per niente) a 5 (completamente).
                        Non esistono risposte giuste o sbagliate, rispondi istintivamente.
                    </div>
                    
                    <div class="question-group">
                        <div class="question-text">Mi sento a mio agio con me stesso nella maggior parte delle situazioni</div>
                        <div class="likert-scale">
                            <div class="likert-option">
                                <input type="radio" name="esteem1" value="1" onchange="updateTestProgress(); autoSave()">
                                <span class="likert-label">Per niente</span>
                            </div>
                            <div class="likert-option">
                                <input type="radio" name="esteem1" value="2" onchange="updateTestProgress(); autoSave()">
                                <span class="likert-label">Poco</span>
                            </div>
                            <div class="likert-option">
                                <input type="radio" name="esteem1" value="3" onchange="updateTestProgress(); autoSave()">
                                <span class="likert-label">Abbastanza</span>
                            </div>
                            <div class="likert-option">
                                <input type="radio" name="esteem1" value="4" onchange="updateTestProgress(); autoSave()">
                                <span class="likert-label">Molto</span>
                            </div>
                            <div class="likert-option">
                                <input type="radio" name="esteem1" value="5" onchange="updateTestProgress(); autoSave()">
                                <span class="likert-label">Completamente</span>
                            </div>
                        </div>
                    </div>

                    <div class="question-group">
                        <div class="question-text">Credo nelle mie capacitÃ  e nel mio valore come persona</div>
                        <div class="likert-scale">
                            <div class="likert-option">
                                <input type="radio" name="esteem2" value="1" onchange="updateTestProgress(); autoSave()">
                                <span class="likert-label">Per niente</span>
                            </div>
                            <div class="likert-option">
                                <input type="radio" name="esteem2" value="2" onchange="updateTestProgress(); autoSave()">
                                <span class="likert-label">Poco</span>
                            </div>
                            <div class="likert-option">
                                <input type="radio" name="esteem2" value="3" onchange="updateTestProgress(); autoSave()">
                                <span class="likert-label">Abbastanza</span>
                            </div>
                            <div class="likert-option">
                                <input type="radio" name="esteem2" value="4" onchange="updateTestProgress(); autoSave()">
                                <span class="likert-label">Molto</span>
                            </div>
                            <div class="likert-option">
                                <input type="radio" name="esteem2" value="5" onchange="updateTestProgress(); autoSave()">
                                <span class="likert-label">Completamente</span>
                            </div>
                        </div>
                    </div>

                    <div class="question-group">
                        <div class="question-text">Riesco ad accettare i complimenti senza sentirmi a disagio</div>
                        <div class="likert-scale">
                            <div class="likert-option">
                                <input type="radio" name="esteem3" value="1" onchange="updateTestProgress(); autoSave()">
                                <span class="likert-label">Per niente</span>
                            </div>
                            <div class="likert-option">
                                <input type="radio" name="esteem3" value="2" onchange="updateTestProgress(); autoSave()">
                                <span class="likert-label">Poco</span>
                            </div>
                            <div class="likert-option">
                                <input type="radio" name="esteem3" value="3" onchange="updateTestProgress(); autoSave()">
                                <span class="likert-label">Abbastanza</span>
                            </div>
                            <div class="likert-option">
                                <input type="radio" name="esteem3" value="4" onchange="updateTestProgress(); autoSave()">
                                <span class="likert-label">Molto</span>
                            </div>
                            <div class="likert-option">
                                <input type="radio" name="esteem3" value="5" onchange="updateTestProgress(); autoSave()">
                                <span class="likert-label">Completamente</span>
                            </div>
                        </div>
                    </div>

                    <div class="question-group">
                        <div class="question-text">Non ho paura di esprimere le mie opinioni anche quando sono diverse da quelle degli altri</div>
                        <div class="likert-scale">
                            <div class="likert-option">
                                <input type="radio" name="esteem4" value="1" onchange="updateTestProgress(); autoSave()">
                                <span class="likert-label">Per niente</span>
                            </div>
                            <div class="likert-option">
                                <input type="radio" name="esteem4" value="2" onchange="updateTestProgress(); autoSave()">
                                <span class="likert-label">Poco</span>
                            </div>
                            <div class="likert-option">
                                <input type="radio" name="esteem4" value="3" onchange="updateTestProgress(); autoSave()">
                                <span class="likert-label">Abbastanza</span>
                            </div>
                            <div class="likert-option">
                                <input type="radio" name="esteem4" value="4" onchange="updateTestProgress(); autoSave()">
                                <span class="likert-label">Molto</span>
                            </div>
                            <div class="likert-option">
                                <input type="radio" name="esteem4" value="5" onchange="updateTestProgress(); autoSave()">
                                <span class="likert-label">Completamente</span>
                            </div>
                        </div>
                    </div>

                    <div class="question-group">
                        <div class="question-text">Mi perdono facilmente quando commetto errori</div>
                        <div class="likert-scale">
                            <div class="likert-option">
                                <input type="radio" name="esteem5" value="1" onchange="updateTestProgress(); autoSave()">
                                <span class="likert-label">Per niente</span>
                            </div>
                            <div class="likert-option">
                                <input type="radio" name="esteem5" value="2" onchange="updateTestProgress(); autoSave()">
                                <span class="likert-label">Poco</span>
                            </div>
                            <div class="likert-option">
                                <input type="radio" name="esteem5" value="3" onchange="updateTestProgress(); autoSave()">
                                <span class="likert-label">Abbastanza</span>
                            </div>
                            <div class="likert-option">
                                <input type="radio" name="esteem5" value="4" onchange="updateTestProgress(); autoSave()">
                                <span class="likert-label">Molto</span>
                            </div>
                            <div class="likert-option">
                                <input type="radio" name="esteem5" value="5" onchange="updateTestProgress(); autoSave()">
                                <span class="likert-label">Completamente</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Test Valori -->
                <div class="test-section" id="valuesTest">
                    <h3>ð¯ I Tuoi Valori Profondi</h3>
                    <div class="test-intro">
                        Indica l'importanza di questi valori nella tua vita su una scala da 1 (poco importante) a 5 (fondamentale).
                    </div>
                    
                    <div class="question-group">
                        <div class="question-text">Famiglia e relazioni affettive</div>
                        <div class="likert-scale">
                            <div class="likert-option">
                                <input type="radio" name="value1" value="1" onchange="updateTestProgress(); autoSave()">
                                <span class="likert-label">Poco importante</span>
                            </div>
                            <div class="likert-option">
                                <input type="radio" name="value1" value="2" onchange="updateTestProgress(); autoSave()">
                                <span class="likert-label">Abbastanza</span>
                            </div>
                            <div class="likert-option">
                                <input type="radio" name="value1" value="3" onchange="updateTestProgress(); autoSave()">
                                <span class="likert-label">Importante</span>
                            </div>
                            <div class="likert-option">
                                <input type="radio" name="value1" value="4" onchange="updateTestProgress(); autoSave()">
                                <span class="likert-label">Molto importante</span>
                            </div>
                            <div class="likert-option">
                                <input type="radio" name="value1" value="5" onchange="updateTestProgress(); autoSave()">
                                <span class="likert-label">Fondamentale</span>
                            </div>
                        </div>
                    </div>

                    <div class="question-group">
                        <div class="question-text">Successo professionale e carriera</div>
                        <div class="likert-scale">
                            <div class="likert-option">
                                <input type="radio" name="value2" value="1" onchange="updateTestProgress(); autoSave()">
                                <span class="likert-label">Poco importante</span>
                            </div>
                            <div class="likert-option">
                                <input type="radio" name="value2" value="2" onchange="updateTestProgress(); autoSave()">
                                <span class="likert-label">Abbastanza</span>
                            </div>
                            <div class="likert-option">
                                <input type="radio" name="value2" value="3" onchange="updateTestProgress(); autoSave()">
                                <span class="likert-label">Importante</span>
                            </div>
                            <div class="likert-option">
                                <input type="radio" name="value2" value="4" onchange="updateTestProgress(); autoSave()">
                                <span class="likert-label">Molto importante</span>
                            </div>
                            <div class="likert-option">
                                <input type="radio" name="value2" value="5" onchange="updateTestProgress(); autoSave()">
                                <span class="likert-label">Fondamentale</span>
                            </div>
                        </div>
                    </div>

                    <div class="question-group">
                        <div class="question-text">Salute e benessere fisico</div>
                        <div class="likert-scale">
                            <div class="likert-option">
                                <input type="radio" name="value3" value="1" onchange="updateTestProgress(); autoSave()">
                                <span class="likert-label">Poco importante</span>
                            </div>
                            <div class="likert-option">
                                <input type="radio" name="value3" value="2" onchange="updateTestProgress(); autoSave()">
                                <span class="likert-label">Abbastanza</span>
                            </div>
                            <div class="likert-option">
                                <input type="radio" name="value3" value="3" onchange="updateTestProgress(); autoSave()">
                                <span class="likert-label">Importante</span>
                            </div>
                            <div class="likert-option">
                                <input type="radio" name="value3" value="4" onchange="updateTestProgress(); autoSave()">
                                <span class="likert-label">Molto importante</span>
                            </div>
                            <div class="likert-option">
                                <input type="radio" name="value3" value="5" onchange="updateTestProgress(); autoSave()">
                                <span class="likert-label">Fondamentale</span>
                            </div>
                        </div>
                    </div>

                    <div class="question-group">
                        <div class="question-text">Crescita personale e spirituale</div>
                        <div class="likert-scale">
                            <div class="likert-option">
                                <input type="radio" name="value4" value="1" onchange="updateTestProgress(); autoSave()">
                                <span class="likert-label">Poco importante</span>
                            </div>
                            <div class="likert-option">
                                <input type="radio" name="value4" value="2" onchange="updateTestProgress(); autoSave()">
                                <span class="likert-label">Abbastanza</span>
                            </div>
                            <div class="likert-option">
                                <input type="radio" name="value4" value="3" onchange="updateTestProgress(); autoSave()">
                                <span class="likert-label">Importante</span>
                            </div>
                            <div class="likert-option">
                                <input type="radio" name="value4" value="4" onchange="updateTestProgress(); autoSave()">
                                <span class="likert-label">Molto importante</span>
                            </div>
                            <div class="likert-option">
                                <input type="radio" name="value4" value="5" onchange="updateTestProgress(); autoSave()">
                                <span class="likert-label">Fondamentale</span>
                            </div>
                        </div>
                    </div>

                    <div class="question-group">
                        <div class="question-text">LibertÃ  e indipendenza</div>
                        <div class="likert-scale">
                            <div class="likert-option">
                                <input type="radio" name="value5" value="1" onchange="updateTestProgress(); autoSave()">
                                <span class="likert-label">Poco importante</span>
                            </div>
                            <div class="likert-option">
                                <input type="radio" name="value5" value="2" onchange="updateTestProgress(); autoSave()">
                                <span class="likert-label">Abbastanza</span>
                            </div>
                            <div class="likert-option">
                                <input type="radio" name="value5" value="3" onchange="updateTestProgress(); autoSave()">
                                <span class="likert-label">Importante</span>
                            </div>
                            <div class="likert-option">
                                <input type="radio" name="value5" value="4" onchange="updateTestProgress(); autoSave()">
                                <span class="likert-label">Molto importante</span>
                            </div>
                            <div class="likert-option">
                                <input type="radio" name="value5" value="5" onchange="updateTestProgress(); autoSave()">
                                <span class="likert-label">Fondamentale</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Domande Approfondite -->
                <div class="test-section" id="deepQuestions">
                    <h3>ð Esplorazione Profonda</h3>
                    <div class="test-intro">
                        Queste domande ci aiuteranno a comprendere meglio la tua consapevolezza attuale.
                    </div>
                    
                    <div class="form-group">
                        <label for="authenticSelf">Quando ti senti piÃ¹ autentico e te stesso?</label>
                        <textarea id="authenticSelf" placeholder="Descrivi le situazioni, i momenti o i contesti in cui senti di essere veramente te stesso..." onchange="updateTestProgress(); autoSave()"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="innerCritic">Qual Ã¨ la voce del tuo critico interno? Cosa ti dice piÃ¹ spesso?</label>
                        <textarea id="innerCritic" placeholder="Quella voce dentro di te che critica, giudica o limita... cosa ti dice?" onchange="updateTestProgress(); autoSave()"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="hiddenTalents">Quale talento o capacitÃ  hai che non usi abbastanza?</label>
                        <textarea id="hiddenTalents" placeholder="Cosa sai fare bene ma non valorizzi o non sfrutti appieno?" onchange="updateTestProgress(); autoSave()"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="emotionalPattern">Quale emozione tendi a evitare di piÃ¹ e perchÃ©?</label>
                        <textarea id="emotionalPattern" placeholder="C'Ã¨ un'emozione che fai fatica a vivere o ad accettare?" onchange="updateTestProgress(); autoSave()"></textarea>
                    </div>
                </div>

                <div class="form-navigation">
                    <button type="button" class="btn btn-success" id="completeTestBtn" onclick="completePhase1()" disabled>
                        â Completa Test e Inizia Coaching AI Personalizzato
                    </button>
                </div>
            </form>
        </section>

        <!-- Phase 2: Deep Coaching -->
        <section class="phase2-section" id="phase2Section">
            <div class="phase-header">
                <div class="phase-icon">ð¤</div>
                <div>
                    <h2 class="phase-title">Fase 2: Coaching AI Personalizzato</h2>
                    <p class="phase-subtitle">Andrea AI analizza i tuoi test e ti guida con domande uniche per il tuo profilo</p>
                </div>
            </div>
            
            <div class="coaching-context">
                <h3>ð Il Tuo Profilo di Consapevolezza Personalizzato</h3>
                <p>
                    Ho analizzato i tuoi test insieme ai dati della settimana 1 e al tuo profilo lifestyle. 
                    Ora ti accompagnerÃ² con domande e riflessioni create appositamente per te, 
                    per far emergere la tua autenticitÃ  e il tuo potenziale nascosto.
                </p>
                
                <div class="insights-summary">
                    <div class="insights-title">ð¡ Prime Insights Personalizzate Emerse:</div>
                    <ul class="insights-list" id="initialInsights">
                        <li>Caricamento insights personalizzati per il tuo profilo...</li>
                    </ul>
                </div>
            </div>
            
            <div class="time-warning" id="timeWarning">
                <strong>â° Abbiamo raggiunto i 30 minuti!</strong> Vuoi continuare per altri 15 minuti o preferisci terminare ora?
                <div style="margin-top: 1rem;">
                    <button class="btn btn-secondary" onclick="continueSession()">Continua</button>
                    <button class="btn btn-primary" onclick="endSession()">Termina Ora</button>
                </div>
            </div>
            
            <div class="chat-status">
                <div class="status-dot"></div>
                <span>Andrea AI personalizzato Ã¨ pronto per esplorare la tua consapevolezza profonda</span>
            </div>
            
            <div class="chat-container" id="chatContainer">
                <!-- Messages will be added here -->
            </div>
            
            <div class="chat-input">
                <input type="text" id="chatInput" placeholder="Condividi i tuoi pensieri profondi con Andrea AI...">
                <button class="btn btn-primary" onclick="sendChatMessage()">Invia</button>
            </div>
        </section>

        <!-- Completion Section -->
        <section class="completion-section" id="completionSection">
            <h2 class="completion-title">ð Sessione di Consapevolezza Completata!</h2>
            <p class="completion-message">
                Che viaggio straordinario di consapevolezza abbiamo fatto insieme! Attraverso i test e il nostro coaching AI personalizzato, 
                sono emerse consapevolezze importanti sulla tua autenticitÃ  e il tuo potenziale unico.
            </p>
            
            <div class="awareness-results">
                <h3 class="results-title">ð I Tuoi Risultati di Consapevolezza Personalizzati</h3>
                <div class="results-grid" id="resultsGrid">
                    <!-- Will be populated with personalized test results -->
                </div>
            </div>
            
            <div class="homework-section">
                <h3 class="homework-title">ð± I Tuoi Compiti di Crescita Personalizzati</h3>
                <ul class="homework-list" id="personalizedHomework">
                    <!-- Will be generated based on personalized awareness session -->
                </ul>
            </div>
            
            <div class="completion-actions">
                <button class="btn btn-success" onclick="downloadAwarenessReport()">ð Scarica Rapporto Personalizzato</button>
                <a href="module-hub.html" class="btn btn-secondary">â Torna ai Moduli</a>
                <button class="btn btn-primary" onclick="scheduleNextSession()">ð Programma Settimana 3</button>
            </div>
        </section>
    </main>

    <!-- Load Sistema AI Integrato v2.0 e Script Integrazione -->
    <script src="../utils/integrated-ai-system.js"></script>
    <script src="../utils/modules-integration.js"></script>
    
    <script>
        // Session variables
        let sessionStartTime = Date.now();
        let sessionDuration = 45 * 60 * 1000; // 45 minutes
        let timerInterval;
        let currentPhase = 'welcome';
        let testData = {};
        let chatHistory = [];
        let aiSystem = null;
        let userProfile = null;
        let week1Data = null;
        let sessionExtended = false;
        let autoSaveInterval;
        let awarenessInsights = [];
        let testResults = {};

        // Initialize session
        document.addEventListener('DOMContentLoaded', function() {
            startSessionTimer();
            loadUserProfile();
            loadWeek1Data();
            loadSavedSession();
            initializePersonalizedAI();
            startAutoSave();
        });

        function startSessionTimer() {
            timerInterval = setInterval(() => {
                const elapsed = Date.now() - sessionStartTime;
                const remaining = Math.max(0, sessionDuration - elapsed);
                
                const minutes = Math.floor(remaining / 60000);
                const seconds = Math.floor((remaining % 60000) / 1000);
                
                document.getElementById('sessionTimer').textContent = 
                    `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                
                const progress = (elapsed / sessionDuration) * 100;
                document.getElementById('sessionProgress').style.width = `${Math.min(progress, 100)}%`;
                
                // Check for 30 minute warning
                if (elapsed >= 30 * 60 * 1000 && !sessionExtended && currentPhase === 'phase2') {
                    show30MinuteWarning();
                }
                
                // Auto-end at 45 minutes
                if (remaining === 0) {
                    clearInterval(timerInterval);
                    endSession();
                }
            }, 1000);
        }

        function loadUserProfile() {
            try {
                const savedData = localStorage.getItem('lifestyleQuizResults');
                if (savedData) {
                    userProfile = JSON.parse(savedData);
                    console.log('â User profile loaded:', userProfile);
                    updatePersonalizedWelcome();
                }
            } catch (error) {
                console.error('â Error loading user profile:', error);
            }
        }

        function loadWeek1Data() {
            try {
                const week1SessionData = localStorage.getItem('week1SessionCompleted');
                if (week1SessionData) {
                    week1Data = JSON.parse(week1SessionData);
                    console.log('â Week 1 data loaded:', week1Data);
                    displayWeek1Summary();
                } else {
                    console.log('â ï¸ No Week 1 data found');
                    displayDefaultSummary();
                }
            } catch (error) {
                console.error('â Error loading Week 1 data:', error);
                displayDefaultSummary();
            }
        }

        function updatePersonalizedWelcome() {
            if (!userProfile) return;
            
            // Update welcome title with name
            const welcomeTitle = document.querySelector('.welcome-title');
            if (welcomeTitle && userProfile.name) {
                welcomeTitle.textContent = `Benvenuto/a ${userProfile.name} nella Settimana 2! ð`;
            }
            
            // Update subtitle with profile
            const welcomeSubtitle = document.querySelector('.welcome-subtitle');
            if (welcomeSubtitle && window.LIFESTYLE_PROFILES_CONFIG && userProfile.profileType) {
                const profileConfig = window.LIFESTYLE_PROFILES_CONFIG[userProfile.profileType];
                if (profileConfig) {
                    welcomeSubtitle.textContent = `Consapevolezza di SÃ© - Personalizzato per ${profileConfig.name} ${profileConfig.emoji}`;
                }
            }
            
            // Update chat input placeholder
            const chatInput = document.getElementById('chatInput');
            if (chatInput && userProfile.profileType) {
                const placeholders = {
                    stressato_esaurito: "Prenditi tutto il tempo che serve per rispondere, non c'Ã¨ fretta...",
                    procrastinatore_bloccato: "Dimmi quello che ti viene in mente, anche se non Ã¨ perfetto...",
                    perfezionista_insoddisfatto: "Non serve la risposta perfetta, dimmi quello che senti...",
                    dispersivo_confuso: "Concentrati su UN pensiero e condividilo con me...",
                    motivato_inconsistente: "Condividi con me quello che provi in questo momento...",
                    equilibrato_ottimizzatore: "Dimmi come vedi la situazione dal tuo punto di vista..."
                };
                
                chatInput.placeholder = placeholders[userProfile.profileType] || 
                                       "Condividi i tuoi pensieri profondi con Andrea AI...";
            }
        }

        function displayWeek1Summary() {
            const summaryEl = document.getElementById('week1Summary');
            if (week1Data && week1Data.phase1Data) {
                const data = week1Data.phase1Data;
                summaryEl.innerHTML = `
                    <p><strong>La tua situazione:</strong> "${data.currentSituation || 'In definizione'}"</p>
                    <p><strong>Il tuo obiettivo principale:</strong> "${data.dreamGoal || 'In esplorazione'}"</p>
                    <p><strong>Cosa ti motiva di piÃ¹:</strong> "${data.mainJoy || 'Ancora da scoprire'}"</p>
                    <p style="margin-top: 1rem; font-style: italic; color: #ea580c;">
                        Oggi approfondiremo questi aspetti con l'AI personalizzato per il tuo profilo specifico.
                    </p>
                `;
            } else {
                displayDefaultSummary();
            }
        }

        function displayDefaultSummary() {
            const summaryEl = document.getElementById('week1Summary');
            summaryEl.innerHTML = `
                <p>Nella settimana 1 abbiamo iniziato a conoscerti attraverso il questionario approfondito e il coaching iniziale.</p>
                <p style="margin-top: 1rem; font-style: italic; color: #ea580c;">
                    Oggi costruiremo su quelle basi per sviluppare una consapevolezza piÃ¹ profonda con l'AI personalizzato.
                </p>
            `;
        }

        function loadSavedSession() {
            try {
                const savedSession = localStorage.getItem('week2SessionInProgress');
                if (savedSession) {
                    const sessionData = JSON.parse(savedSession);
                    
                    // Restore test data
                    if (sessionData.testData) {
                        testData = sessionData.testData;
                        restoreTestAnswers();
                    }
                    
                    // Restore chat history
                    if (sessionData.chatHistory) {
                        chatHistory = sessionData.chatHistory;
                    }
                    
                    // Restore current phase
                    if (sessionData.currentPhase) {
                        currentPhase = sessionData.currentPhase;
                        
                        if (currentPhase === 'phase1') {
                            startPhase1();
                        } else if (currentPhase === 'phase2') {
                            startPhase2();
                            restoreChatHistory();
                        }
                    }
                    
                    console.log('â Session restored from:', sessionData);
                }
            } catch (error) {
                console.error('â Error loading saved session:', error);
            }
        }

        function restoreTestAnswers() {
            Object.entries(testData).forEach(([key, value]) => {
                const element = document.querySelector(`[name="${key}"], #${key}`);
                if (element) {
                    if (element.type === 'radio') {
                        const radio = document.querySelector(`[name="${key}"][value="${value}"]`);
                        if (radio) radio.checked = true;
                    } else {
                        element.value = value;
                    }
                }
            });
            updateTestProgress();
        }

        async function initializePersonalizedAI() {
            try {
                // Aspetta che i sistemi AI siano caricati
                await waitForAISystems();
                
                const userId = localStorage.getItem('lifestyleUserId') || 'user_' + Date.now();
                localStorage.setItem('lifestyleUserId', userId);
                
                // Inizializza Sistema AI Integrato v2.0
                if (window.AISystemIntegrator && userProfile) {
                    aiSystem = await window.AISystemIntegrator.initializeFromQuizData(userId, userProfile);
                    aiSystem.setCurrentWeek(2); // Settimana 2
                    
                    console.log('ð¤ Sistema AI Integrato v2.0 inizializzato per Week 2');
                    console.log('ð¯ Profilo:', userProfile.profileType);
                    
                    // Update status
                    updateAIStatus();
                } else {
                    console.error('â AISystemIntegrator o userProfile non disponibili');
                }
                
            } catch (error) {
                console.error('â Error initializing personalized AI:', error);
            }
        }

        function waitForAISystems() {
            return new Promise((resolve) => {
                const checkSystems = () => {
                    if (window.IntegratedAISystem && window.AISystemIntegrator && window.LIFESTYLE_PROFILES_CONFIG) {
                        resolve(true);
                    } else {
                        setTimeout(checkSystems, 100);
                    }
                };
                checkSystems();
            });
        }

        function updateAIStatus() {
            const statusElement = document.querySelector('.chat-status span');
            if (statusElement && userProfile && window.LIFESTYLE_PROFILES_CONFIG) {
                const profileConfig = window.LIFESTYLE_PROFILES_CONFIG[userProfile.profileType];
                if (profileConfig) {
                    statusElement.textContent = `Andrea AI personalizzato per "${profileConfig.name}" Ã¨ pronto per la consapevolezza profonda`;
                }
            }
        }

        function startAutoSave() {
            autoSaveInterval = setInterval(() => {
                autoSave();
            }, 5000);
        }

        function autoSave() {
            try {
                const sessionData = {
                    currentPhase: currentPhase,
                    testData: testData,
                    chatHistory: chatHistory,
                    awarenessInsights: awarenessInsights,
                    testResults: testResults,
                    sessionStartTime: sessionStartTime,
                    lastSaved: new Date().toISOString()
                };
                
                localStorage.setItem('week2SessionInProgress', JSON.stringify(sessionData));
            } catch (error) {
                console.error('â Error auto-saving:', error);
            }
        }

        function startPhase1() {
            currentPhase = 'phase1';
            
            // Hide welcome, show phase 1
            document.getElementById('welcomeSection').style.display = 'none';
            document.getElementById('phase1Section').classList.add('active');
            
            // Update phase indicator
            document.getElementById('phaseStep1').className = 'phase-step active';
            document.getElementById('phaseStep2').className = 'phase-step inactive';
            
            updateTestProgress();
            autoSave();
        }

        function updateTestProgress() {
            const form = document.getElementById('awarenessForm');
            const inputs = form.querySelectorAll('input[type="radio"], textarea');
            
            let filled = 0;
            const radioGroups = {};
            
            // Count filled inputs
            inputs.forEach(input => {
                if (input.type === 'radio') {
                    if (!radioGroups[input.name]) {
                        radioGroups[input.name] = false;
                    }
                    if (input.checked) {
                        radioGroups[input.name] = true;
                        testData[input.name] = input.value;
                    }
                } else if (input.value.trim()) {
                    filled++;
                    testData[input.id] = input.value.trim();
                }
            });
            
            // Count filled radio groups
            Object.values(radioGroups).forEach(isSelected => {
                if (isSelected) filled++;
            });
            
            const totalQuestions = Object.keys(radioGroups).length + form.querySelectorAll('textarea').length;
            const progress = (filled / totalQuestions) * 100;
            
            document.getElementById('testProgress').textContent = `${Math.round(progress)}%`;
            document.getElementById('testProgressFill').style.width = `${progress}%`;
            
            // Enable/disable complete button
            const completeBtn = document.getElementById('completeTestBtn');
            if (progress === 100) {
                completeBtn.disabled = false;
                completeBtn.className = 'btn btn-success';
            } else {
                completeBtn.disabled = true;
                completeBtn.className = 'btn btn-disabled';
            }
        }

        function completePhase1() {
            // Calculate test results
            calculateTestResults();
            
            // Mark phase 1 as completed
            document.getElementById('phaseStep1').className = 'phase-step completed';
            
            // Start phase 2
            startPhase2();
        }

        function calculateTestResults() {
            // Calculate self-esteem score
            let esteemTotal = 0;
            let esteemCount = 0;
            for (let i = 1; i <= 5; i++) {
                if (testData[`esteem${i}`]) {
                    esteemTotal += parseInt(testData[`esteem${i}`]);
                    esteemCount++;
                }
            }
            testResults.selfEsteem = esteemCount > 0 ? Math.round(esteemTotal / esteemCount * 10) / 10 : 0;
            
            // Calculate values priorities
            const values = {
                family: testData.value1 ? parseInt(testData.value1) : 0,
                career: testData.value2 ? parseInt(testData.value2) : 0,
                health: testData.value3 ? parseInt(testData.value3) : 0,
                growth: testData.value4 ? parseInt(testData.value4) : 0,
                freedom: testData.value5 ? parseInt(testData.value5) : 0
            };
            
            // Find top values
            const sortedValues = Object.entries(values).sort((a, b) => b[1] - a[1]);
            testResults.topValues = sortedValues.slice(0, 3);
            
            // Generate personalized insights
            generatePersonalizedAwarenessInsights();
        }

        function generatePersonalizedAwarenessInsights() {
            awarenessInsights = [];
            
            // Base insights from test results
            if (testResults.selfEsteem >= 4) {
                awarenessInsights.push('Autostima solida - una risorsa importante per la crescita');
            } else if (testResults.selfEsteem <= 2.5) {
                awarenessInsights.push('Area di crescita identificata: sviluppo autostima');
            }
            
            // Values insights
            const valueLabels = {
                family: 'Famiglia e relazioni',
                career: 'Successo professionale',
                health: 'Salute e benessere',
                growth: 'Crescita personale',
                freedom: 'LibertÃ  e indipendenza'
            };
            
            if (testResults.topValues.length > 0) {
                const topValue = valueLabels[testResults.topValues[0][0]];
                awarenessInsights.push(`Valore principale: ${topValue} - guida le tue decisioni`);
            }
            
            // Personalized insights based on profile
            if (userProfile && userProfile.profileType && window.LIFESTYLE_PROFILES_CONFIG) {
                const profileConfig = window.LIFESTYLE_PROFILES_CONFIG[userProfile.profileType];
                awarenessInsights.push(`Profilo "${profileConfig.name}": approccio personalizzato attivato`);
                
                // Profile-specific insights
                switch (userProfile.profileType) {
                    case 'stressato_esaurito':
                        if (testResults.selfEsteem < 3) {
                            awarenessInsights.push('Stress e bassa autostima: prioritÃ  recupero energia');
                        }
                        break;
                    case 'perfezionista_insoddisfatto':
                        if (testData.innerCritic && testData.innerCritic.toLowerCase().includes('non abbastanza')) {
                            awarenessInsights.push('Pattern perfezionista confermato: lavoro su auto-compassione');
                        }
                        break;
                    case 'procrastinatore_bloccato':
                        if (testData.authenticSelf && testData.authenticSelf.toLowerCase().includes('quando completo')) {
                            awarenessInsights.push('Motivazione dal completamento: strategia micro-azioni');
                        }
                        break;
                }
            }
            
            // Deep questions insights
            if (testData.authenticSelf) {
                awarenessInsights.push('Consapevolezza dei momenti di autenticitÃ  identificata');
            }
            
            if (testData.innerCritic) {
                awarenessInsights.push('Pattern del critico interno riconosciuto');
            }
            
            if (testData.hiddenTalents) {
                awarenessInsights.push('Talenti nascosti da valorizzare identificati');
            }
        }

        function startPhase2() {
            currentPhase = 'phase2';
            
            // Hide phase 1, show phase 2
            document.getElementById('phase1Section').classList.remove('active');
            document.getElementById('phase2Section').classList.add('active');
            
            // Update phase indicator
            document.getElementById('phaseStep2').className = 'phase-step active';
            
            // Display personalized insights
            displayPersonalizedInsights();
            
            // Generate first AI coaching question
            generatePersonalizedOpeningQuestion();
            
            autoSave();
        }

        function displayPersonalizedInsights() {
            const insightsEl = document.getElementById('initialInsights');
            if (awarenessInsights.length > 0) {
                insightsEl.innerHTML = awarenessInsights.map(insight => `<li>${insight}</li>`).join('');
            } else {
                insightsEl.innerHTML = '<li>Insights personalizzati in caricamento...</li>';
            }
        }

        function generatePersonalizedOpeningQuestion() {
            if (chatHistory.length === 0) {
                const openingQuestion = createPersonalizedOpeningQuestion();
                addChatMessage(openingQuestion, 'coach');
            } else {
                restoreChatHistory();
            }
        }

        function createPersonalizedOpeningQuestion() {
            let question = `Ciao! Ho appena analizzato i risultati dei tuoi test di consapevolezza con il mio sistema AI personalizzato per il tuo profilo `;
            
            // Add profile-specific opening
            if (userProfile && userProfile.profileType && window.LIFESTYLE_PROFILES_CONFIG) {
                const profileConfig = window.LIFESTYLE_PROFILES_CONFIG[userProfile.profileType];
                question += `"${profileConfig.name}" ${profileConfig.emoji}. `;
                
                // Profile-specific introduction
                switch (userProfile.profileType) {
                    case 'stressato_esaurito':
                        question += `So che stai attraversando un periodo intenso, quindi andremo con i tuoi tempi, senza fretta. `;
                        break;
                    case 'procrastinatore_bloccato':
                        question += `Vedo che hai la tendenza a rimandare, ma il fatto che tu sia qui dimostra la tua determinazione a cambiare. `;
                        break;
                    case 'perfezionista_insoddisfatto':
                        question += `Riconosco in te quella ricerca di eccellenza che puÃ² essere sia una forza che una sfida. `;
                        break;
                    case 'dispersivo_confuso':
                        question += `Vedo che hai tante idee e interessi, ora concentriamoci su quello che Ã¨ davvero importante per te. `;
                        break;
                    case 'motivato_inconsistente':
                        question += `La tua energia e motivazione sono evidenti, lavoreremo insieme su come renderle piÃ¹ costanti. `;
                        break;
                    case 'equilibrato_ottimizzatore':
                        question += `Apprezzo il tuo approccio strutturato al miglioramento personale. `;
                        break;
                }
            }
            
            // Reference test results
            if (testResults.selfEsteem) {
                if (testResults.selfEsteem >= 4) {
                    question += `La tua autostima Ã¨ solida (${testResults.selfEsteem}/5), il che Ã¨ una risorsa preziosa. `;
                } else {
                    question += `L'autostima Ã¨ un'area dove vedo grandi margini di crescita (${testResults.selfEsteem}/5). `;
                }
            }
            
            // Reference top values
            if (testResults.topValues && testResults.topValues.length > 0) {
                const valueLabels = {
                    family: 'famiglia e relazioni',
                    career: 'successo professionale',
                    health: 'salute e benessere',
                    growth: 'crescita personale',
                    freedom: 'libertÃ  e indipendenza'
                };
                const topValue = valueLabels[testResults.topValues[0][0]];
                question += `Il tuo valore piÃ¹ importante Ã¨ ${topValue}. `;
            }
            
            // Reference authentic self if provided
            if (testData.authenticSelf) {
                question += `Mi ha colpito quando hai descritto quando ti senti piÃ¹ autentico. `;
            }
            
            // Personalized deep question based on profile
            question += `\n\n`;
            
            if (userProfile && userProfile.profileType) {
                const profileQuestions = {
                    stressato_esaurito: "Prima di tutto, come ti senti in questo momento? Qual Ã¨ il tuo livello di energia da 1 a 10, e cosa ti darebbe un po' di sollievo oggi?",
                    procrastinatore_bloccato: "Dimmi sinceramente: c'Ã¨ qualcosa che sai di dover fare ma continui a rimandare? Cosa pensi che ti stia davvero bloccando?",
                    perfezionista_insoddisfatto: "Se dovessi accettare che il 'abbastanza buono' puÃ² essere sufficiente, cosa ti spaventa di piÃ¹? Da dove viene questa paura di non essere all'altezza?",
                    dispersivo_confuso: "Tra tutte le cose che hai in testa, qual Ã¨ quella che senti nel cuore essere LA piÃ¹ importante per te in questo momento?",
                    motivato_inconsistente: "Quando sei nel tuo picco di motivazione, cosa succede? E quando cala, cos'Ã¨ che ti fa perdere quella spinta?",
                    equilibrato_ottimizzatore: "Dove vedi il maggior potenziale di crescita non ancora sfruttato? Quale area della tua vita senti che potrebbe dare i risultati piÃ¹ significativi?"
                };
                
                question += profileQuestions[userProfile.profileType] || 
                           "Ora che abbiamo fatto questo viaggio nei test, cosa ti ha colpito di piÃ¹ di te stesso?";
            } else {
                question += "Ora che abbiamo fatto questo viaggio nei test, cosa ti ha colpito di piÃ¹ di te stesso?";
            }
            
            return question;
        }

        function restoreChatHistory() {
            const chatContainer = document.getElementById('chatContainer');
            chatContainer.innerHTML = '';
            
            chatHistory.forEach(message => {
                const messageDiv = document.createElement('div');
                messageDiv.className = `message ${message.sender}`;
                messageDiv.innerHTML = `
                    <div class="message-content">${message.content}</div>
                    <div class="message-time">${message.time}</div>
                `;
                chatContainer.appendChild(messageDiv);
            });
            
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }

        async function sendChatMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            
            if (!message) return;
            
            // Add user message
            addChatMessage(message, 'user');
            input.value = '';
            
            // Get personalized AI coaching response
            try {
                const coachingResponse = await getPersonalizedCoachingResponse(message);
                setTimeout(() => {
                    addChatMessage(coachingResponse, 'coach');
                }, 1500);
            } catch (error) {
                console.error('â Error getting coaching response:', error);
                setTimeout(() => {
                    addChatMessage(getPersonalizedFallback(message), 'coach');
                }, 1000);
            }
        }

        function addChatMessage(content, sender) {
            const chatContainer = document.getElementById('chatContainer');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender}`;
            
            const now = new Date();
            const time = now.toLocaleTimeString('it-IT', { hour: '2-digit', minute: '2-digit' });
            
            messageDiv.innerHTML = `
                <div class="message-content">${content}</div>
                <div class="message-time">${time}</div>
            `;
            
            chatContainer.appendChild(messageDiv);
            chatContainer.scrollTop = chatContainer.scrollHeight;
            
            // Store in history
            chatHistory.push({ sender, content, time });
            
            autoSave();
        }

        async function getPersonalizedCoachingResponse(userMessage) {
            // Use Sistema AI Integrato v2.0 if available
            if (aiSystem) {
                try {
                    const response = await aiSystem.sendMessage(userMessage);
                    if (response.success) {
                        console.log('ð¯ Risposta personalizzata generata:', response.personalization);
                        return response.response;
                    } else {
                        throw new Error(response.error);
                    }
                } catch (error) {
                    console.error('â Sistema AI error:', error);
                    return getPersonalizedFallback(userMessage);
                }
            } else {
                return getPersonalizedFallback(userMessage);
            }
        }

        function getPersonalizedFallback(userMessage) {
            // Fallback personalizzato basato sul profilo
            if (!userProfile || !userProfile.profileType || !window.LIFESTYLE_PROFILES_CONFIG) {
                return "Ti ascolto con grande attenzione. Quello che condividi risuona profondamente con me. Puoi dirmi di piÃ¹?";
            }
            
            const profileConfig = window.LIFESTYLE_PROFILES_CONFIG[userProfile.profileType];
            const messageCount = chatHistory.filter(m => m.sender === 'user').length;
            
            // Fallback responses personalizzati per profilo
            const personalizedFallbacks = {
                stressato_esaurito: [
                    "Ti capisco perfettamente, e sento quanto impegno stai mettendo anche solo nel condividere questo con me. Non c'Ã¨ fretta, andiamo con i tuoi tempi.",
                    "Quello che mi descrivi Ã¨ molto autentico. Come ti senti fisicamente mentre me ne parli? Il tuo corpo cosa ti sta dicendo?",
                    "Ã normale sentirsi cosÃ¬ quando si Ã¨ dato tutto. Prima di andare avanti, di cosa avresti bisogno in questo momento per sentirti un po' meglio?"
                ],
                procrastinatore_bloccato: [
                    "Perfetto che tu ne stia parlando! Spesso il primo passo Ã¨ proprio ammettere la situazione. Ora, c'Ã¨ una cosa piccolissima che potresti fare nei prossimi 5 minuti?",
                    "Capisco quella sensazione di 'sapere ma non fare'. Non Ã¨ pigrizia, spesso Ã¨ paura. Di cosa hai paura che succeda se inizi davvero?",
                    "Bene, stai giÃ  facendo qualcosa: stai qui, stai riflettendo. Questo Ã¨ un'azione. Quale potrebbe essere la prossima micro-azione?"
                ],
                perfezionista_insoddisfatto: [
                    "Sento in quello che dici una ricerca di eccellenza che riconosco bene. Ma dimmi: quando Ã¨ stata l'ultima volta che hai celebrato un tuo risultato?",
                    "Ã interessante come riesci a vedere i dettagli che altri non vedono. Ma questa precisione a volte ti impedisce di goderti il percorso?",
                    "Quello che descrivi Ã¨ molto prezioso. Se dovessi dare un consiglio al te stesso di 5 anni fa, cosa gli diresti?"
                ],
                dispersivo_confuso: [
                    "Bene, concentriamoci su questo. Di tutto quello che hai detto, qual Ã¨ LA cosa che senti piÃ¹ importante in questo momento?",
                    "Capisco, hai molte idee e interessi. Ma se dovessi scegliere solo UNA prioritÃ  oggi, quale sarebbe?",
                    "Perfetto, facciamo chiarezza insieme. Dimmi: cosa Ã¨ davvero essenziale per te adesso?"
                ],
                motivato_inconsistente: [
                    "Quella energia che sento nelle tue parole Ã¨ fantastica! Come possiamo catturarla e trasformarla in un sistema che funziona anche nei giorni no?",
                    "Ti riconosco, anch'io ho vissuto queste ondate di motivazione. La chiave Ã¨: cosa fai quando la motivazione cala?",
                    "Ottimo! Ora che sei in questo stato positivo, che sistema puoi creare per mantenere il momentum?"
                ],
                equilibrato_ottimizzatore: [
                    "Apprezzo il tuo approccio analitico. Quello che condividi mostra una maturitÃ  nel guardare la situazione. Dove vedi il margine di miglioramento piÃ¹ significativo?",
                    "Interessante prospettiva. Se dovessi applicare il principio di Pareto (80/20) a quello che mi stai dicendo, dove concentreresti l'energia?",
                    "La tua capacitÃ  di riflettere Ã¨ notevole. Ora, dal punto di vista strategico, quale sarebbe il next step piÃ¹ intelligente?"
                ]
            };
            
            const responses = personalizedFallbacks[userProfile.profileType] || personalizedFallbacks['motivato_inconsistente'];
            const responseIndex = Math.min(messageCount - 1, responses.length - 1);
            
            return responses[responseIndex] || responses[responses.length - 1];
        }

        function show30MinuteWarning() {
            document.getElementById('timeWarning').classList.add('active');
        }

        function continueSession() {
            sessionExtended = true;
            document.getElementById('timeWarning').classList.remove('active');
            showMessage('â Sessione estesa di 15 minuti. Continuiamo il viaggio di consapevolezza personalizzato!', 'success');
        }

        function endSession() {
            clearInterval(timerInterval);
            clearInterval(autoSaveInterval);
            completeSession();
        }

        function completeSession() {
            // Save final session data with AI insights
            const finalSessionData = {
                testData: testData,
                testResults: testResults,
                chatHistory: chatHistory,
                awarenessInsights: awarenessInsights,
                aiPersonalization: aiSystem ? aiSystem.getPersonalizationInsights() : null,
                completedAt: new Date().toISOString(),
                sessionDuration: Date.now() - sessionStartTime,
                userProfile: userProfile,
                week1Data: week1Data
            };
            
            localStorage.setItem('week2SessionCompleted', JSON.stringify(finalSessionData));
            localStorage.removeItem('week2SessionInProgress');
            
            // Update progress
            updateUserProgress();
            
            // Show completion
            document.getElementById('phase2Section').classList.remove('active');
            document.getElementById('completionSection').classList.add('active');
            
            // Generate personalized results and homework
            generatePersonalizedResults();
            generatePersonalizedHomework();
            
            document.getElementById('completionSection').scrollIntoView({ behavior: 'smooth' });
        }

        function generatePersonalizedResults() {
            const resultsGrid = document.getElementById('resultsGrid');
            
            // Self-esteem result with personalized feedback
            const esteemFeedback = testResults.selfEsteem >= 4 ? 'Eccellente base!' : 
                                 testResults.selfEsteem >= 3 ? 'Buona base da sviluppare' : 'PrioritÃ  crescita';
            
            // Values result  
            const valueLabels = {
                family: 'Famiglia',
                career: 'Carriera', 
                health: 'Salute',
                growth: 'Crescita',
                freedom: 'LibertÃ '
            };
            
            const topValue = testResults.topValues && testResults.topValues.length > 0 ? 
                           valueLabels[testResults.topValues[0][0]] : 'Da esplorare';
            
            // Awareness level (enhanced with AI data)
            const aiInsights = aiSystem ? aiSystem.getPersonalizationInsights() : null;
            const awarenessLevel = awarenessInsights.length + Math.floor(chatHistory.length / 2);
            const awarenessScore = Math.min(awarenessLevel, 5);
            
            // Profile compatibility score
            const profileMatch = userProfile && userProfile.profileType ? 
                Math.round((testResults.selfEsteem + awarenessScore) / 2 * 10) / 10 : 3.5;
            
            resultsGrid.innerHTML = `
                <div class="result-item">
                    <div class="result-score">${testResults.selfEsteem}/5</div>
                    <div class="result-label">Autostima</div>
                    <div class="result-feedback">${esteemFeedback}</div>
                </div>
                <div class="result-item">
                    <div class="result-score">${topValue}</div>
                    <div class="result-label">Valore Guida</div>
                    <div class="result-feedback">La tua bussola</div>
                </div>
                <div class="result-item">
                    <div class="result-score">${awarenessScore}/5</div>
                    <div class="result-label">Consapevolezza</div>
                    <div class="result-feedback">Ben sviluppata</div>
                </div>
                <div class="result-item">
                    <div class="result-score">${profileMatch}/5</div>
                    <div class="result-label">Match Profilo</div>
                    <div class="result-feedback">Personalizzato</div>
                </div>
            `;
        }

        function generatePersonalizedHomework() {
            const homeworkList = document.getElementById('personalizedHomework');
            let homework = [];
            
            // Base awareness homework
            homework.push("â Dedica 15 minuti al giorno alla riflessione sulla tua autenticitÃ ");
            homework.push("â Tieni un diario di consapevolezza: 3 momenti autentici al giorno");
            
            // Profile-specific homework
            if (userProfile && userProfile.profileType && window.LIFESTYLE_PROFILES_CONFIG) {
                const profileConfig = window.LIFESTYLE_PROFILES_CONFIG[userProfile.profileType];
                
                switch (userProfile.profileType) {
                    case 'stressato_esaurito':
                        homework.push("â Pratica 5 minuti di respirazione profonda ogni mattina");
                        homework.push("â Identifica UN momento di pausa quotidiana non negoziabile");
                        if (testResults.selfEsteem < 3) {
                            homework.push("â Pratica l'auto-compassione: parla a te stesso come a un caro amico");
                        }
                        break;
                        
                    case 'procrastinatore_bloccato':
                        homework.push("â Fai UNA micro-azione di 5 minuti verso il tuo obiettivo ogni giorno");
                        homework.push("â Celebra ogni piccolo completamento con una nota nel diario");
                        if (testData.innerCritic) {
                            homework.push(`â Trasforma "${testData.innerCritic}" in "Posso iniziare con un piccolo passo"`);
                        }
                        break;
                        
                    case 'perfezionista_insoddisfatto':
                        homework.push("â Pratica il 'buono abbastanza' in una piccola cosa al giorno");
                        homework.push("â Elenca 3 progressi quotidiani, anche piccolissimi");
                        if (testData.innerCritic) {
                            homework.push(`â Dialoga con il critico: "${testData.innerCritic}" â "Cosa posso imparare?"`);
                        }
                        break;
                        
                    case 'dispersivo_confuso':
                        homework.push("â Ogni mattina scegli UNA prioritÃ  principale per la giornata");
                        homework.push("â Pratica la tecnica Pomodoro: 25 min focus su una cosa sola");
                        break;
                        
                    case 'motivato_inconsistente':
                        homework.push("â Crea un tracker visivo per una nuova abitudine di consapevolezza");
                        homework.push("â Sistema di reward: premia te stesso per 7 giorni consecutivi");
                        break;
                        
                    case 'equilibrato_ottimizzatore':
                        homework.push("â Analizza settimanalmente i tuoi pattern di autenticitÃ ");
                        homework.push("â Sperimenta 1 tecnica avanzata di mindfulness ogni settimana");
                        break;
                }
            }
            
            // Test-based homework
            if (testResults.selfEsteem && testResults.selfEsteem < 3) {
                homework.push("â Lista quotidiana: '3 cose che apprezzo di me oggi'");
            }
            
            if (testData.hiddenTalents) {
                homework.push(`â Esprimi il talento nascosto: "${testData.hiddenTalents}" - 20 min/settimana`);
            }
            
            if (testData.authenticSelf) {
                homework.push(`â Ricrea condizioni di autenticitÃ : "${testData.authenticSelf}" - pianifica questi momenti`);
            }
            
            // Values homework
            if (testResults.topValues && testResults.topValues.length > 0) {
                const valueLabels = {
                    family: 'alle relazioni familiari',
                    career: 'al successo professionale',
                    health: 'alla salute e benessere', 
                    growth: 'alla crescita personale',
                    freedom: 'alla libertÃ  e indipendenza'
                };
                const topValue = valueLabels[testResults.topValues[0][0]];
                homework.push(`â Onora il tuo valore principale: dedica tempo ${topValue} ogni giorno`);
            }
            
            // Always add
            homework.push("â Condividi un aspetto autentico di te con qualcuno ogni giorno");
            homework.push("â Celebra le scoperte: annota ogni sera una cosa di te che apprezzi");
            
            // Update homework list
            homeworkList.innerHTML = homework.map(item => `<li>${item}</li>`).join('');
        }

        function updateUserProgress() {
            try {
                const progress = JSON.parse(localStorage.getItem('lifestyleProgress') || '{}');
                progress.completedWeeks = progress.completedWeeks || [];
                
                if (!progress.completedWeeks.includes(2)) {
                    progress.completedWeeks.push(2);
                    progress.currentWeek = 3;
                    progress.lastUpdate = new Date().toISOString();
                    
                    localStorage.setItem('lifestyleProgress', JSON.stringify(progress));
                }
            } catch (error) {
                console.error('â Error updating progress:', error);
            }
        }

        function downloadAwarenessReport() {
            const reportContent = generatePersonalizedReport();
            
            const blob = new Blob([reportContent], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `Rapporto_Consapevolezza_Personalizzato_${userProfile?.name || 'Utente'}.txt`;
            a.click();
            URL.revokeObjectURL(url);
            
            showMessage('ð Rapporto di consapevolezza personalizzato scaricato!', 'success');
        }

        function generatePersonalizedReport() {
            const profileName = userProfile && userProfile.profileType && window.LIFESTYLE_PROFILES_CONFIG ? 
                window.LIFESTYLE_PROFILES_CONFIG[userProfile.profileType].name : 'Non definito';
            
            return `
                RAPPORTO DI CONSAPEVOLEZZA PERSONALIZZATO - SETTIMANA 2
                
                Andrea Padoan - Lifestyle Coach con AI Personalizzato
                
                Caro/a ${userProfile?.name || 'Amico/a'},
                
                Che viaggio straordinario di consapevolezza abbiamo fatto insieme! 
                Il mio sistema AI, personalizzato per il tuo profilo "${profileName}", 
                ha analizzato ogni tua risposta per offrirti insights unici e su misura.
                
                === IL TUO PROFILO PERSONALIZZATO ===
                
                PROFILO LIFESTYLE: ${profileName}
                APPROCCIO COACHING: ${userProfile && userProfile.profileType && window.LIFESTYLE_PROFILES_CONFIG ? 
                    window.LIFESTYLE_PROFILES_CONFIG[userProfile.profileType].coaching_approach : 'Adattivo'}
                
                === I TUOI RISULTATI PERSONALIZZATI ===
                
                AUTOSTIMA: ${testResults.selfEsteem}/5
                ${testResults.selfEsteem >= 4 ? 
                    'Eccellente! Hai una base solida di autostima che ti permette di affrontare le sfide con fiducia.' : 
                  testResults.selfEsteem >= 3 ? 
                    'Buona base! Ci sono margini interessanti per sviluppare ulteriormente la tua autostima.' :
                    'Area prioritaria! Lavoreremo insieme per rafforzare la tua autostima con approcci specifici per il tuo profilo.'}
                
                VALORE PRINCIPALE: ${testResults.topValues && testResults.topValues.length > 0 ? 
                    (() => {
                        const valueLabels = {
                            family: 'Famiglia e Relazioni',
                            career: 'Successo Professionale',
                            health: 'Salute e Benessere',
                            growth: 'Crescita Personale',
                            freedom: 'LibertÃ  e Indipendenza'
                        };
                        return valueLabels[testResults.topValues[0][0]];
                    })() : 'Da esplorare ulteriormente'}
                
                LIVELLO CONSAPEVOLEZZA: ${Math.min(awarenessInsights.length + Math.floor(chatHistory.length / 2), 5)}/5
                
                === LE TUE SCOPERTE PERSONALIZZATE ===
                
                QUANDO TI SENTI PIÃ AUTENTICO:
                "${testData.authenticSelf || 'Da esplorare nel coaching personalizzato'}"
                
                IL TUO CRITICO INTERNO DICE:
                "${testData.innerCritic || 'Pattern ancora da identificare'}"
                
                TALENTI NASCOSTI DA VALORIZZARE:
                "${testData.hiddenTalents || 'Da scoprire insieme'}"
                
                EMOZIONE CHE EVITI DI PIÃ:
                "${testData.emotionalPattern || 'Da esplorare ulteriormente'}"
                
                === INSIGHTS PERSONALIZZATI AI ===
                ${awarenessInsights.length > 0 ? 
                    awarenessInsights.map(insight => `â¢ ${insight}`).join('\n                ') : 
                    'â¢ Sistema AI ha identificato pattern unici nel tuo profilo'}
                
                === IL TUO PIANO DI CRESCITA PERSONALIZZATO ===
                
                ${userProfile && userProfile.profileType ? 
                    generateProfileSpecificPlan(userProfile.profileType) : 
                    generateGenericPlan()}
                
                === MESSAGGI PERSONALIZZATI PER TE ===
                
                ${userProfile?.name || 'Amico/a'}, quello che Ã¨ emerso in questa settimana Ã¨
                una mappa preziosa della tua essenza autentica, calibrata specificamente
                per il tuo profilo "${profileName}".
                
                ${getPersonalizedMessage(userProfile?.profileType)}
                
                === CONNESSIONE CON SETTIMANA 1 ===
                
                ${week1Data && week1Data.phase1Data ? 
                `Il tuo obiettivo dalla settimana 1: "${week1Data.phase1Data.dreamGoal || 'la tua trasformazione'}"
                Ora con la consapevolezza personalizzata sviluppata, puoi perseguire questo obiettivo 
                in modo piÃ¹ autentico e allineato con il tuo profilo specifico.` :
                'Questa consapevolezza personalizzata si integra perfettamente con il percorso iniziato.'}
                
                === PREPARAZIONE SETTIMANA 3 ===
                
                Nella prossima settimana "Obiettivi SMART" il sistema AI userÃ  tutta questa 
                consapevolezza personalizzata per definire obiettivi che siano non solo raggiungibili, 
                ma anche autenticamente tuoi e calibrati per il tuo profilo "${profileName}".
                
                Il tuo coach AI personalizzato,
                Andrea ð¤ð
                
                P.S. Il sistema AI ha registrato ${chatHistory.length} interazioni personalizzate 
                e ${awarenessInsights.length} insights unici per il tuo profilo. 
                Questi dati guideranno tutto il tuo percorso futuro!
            `;
        }

        function generateProfileSpecificPlan(profileType) {
            const plans = {
                stressato_esaurito: `
                1. RECUPERO ENERGIA E AUTOSTIMA
                   - 5 minuti di respirazione profonda ogni mattina
                   - Momento di pausa quotidiana non negoziabile
                   - Auto-compassione: parla a te stesso con gentilezza
                   
                2. CONSAPEVOLEZZA GRADUALE
                   - Diario di consapevolezza: 15 min/giorno quando ti senti pronto
                   - Identifica 1 momento autentico al giorno (senza pressione)
                   
                3. PROTEZIONE DEI CONFINI
                   - Pratica dire "no" a richieste non essenziali
                   - Celebra ogni piccolo progresso senza giudicarti`,
                
                procrastinatore_bloccato: `
                1. AZIONE IMMEDIATA E MICRO-PASSI
                   - UNA micro-azione di 5 minuti ogni giorno
                   - Celebra ogni completamento, anche piccolo
                   - Sistema di tracking visivo per motivazione
                   
                2. SBLOCCO MENTALE
                   - Identifica il primo micro-passo possibile
                   - "Fatto Ã¨ meglio che perfetto" - mantra quotidiano
                   - Trasforma critico interno in coach motivazionale
                   
                3. MOMENTUM BUILDING
                   - Chain delle vittorie: collegare successi piccoli
                   - Reward system per completamenti`,
                
                perfezionista_insoddisfatto: `
                1. PRATICA DEL "BUONO ABBASTANZA"
                   - Una cosa "buona abbastanza" ogni giorno
                   - Lista di 3 progressi quotidiani, anche minimi
                   - Celebrazione attiva dei risultati raggiunti
                   
                2. TRASFORMAZIONE CRITICO INTERNO
                   - Dialogo con il critico: "Cosa posso imparare?"
                   - Auto-compassione nelle situazioni di "errore"
                   - Focus su progresso, non perfezione
                   
                3. INTEGRAZIONE E ACCETTAZIONE
                   - Mindfulness sui momenti di insoddisfazione
                   - Pratica gratitudine per i propri sforzi`,
                
                dispersivo_confuso: `
                1. FOCUS E PRIORITIZZAZIONE
                   - UNA prioritÃ  principale ogni giorno
                   - Tecnica Pomodoro: 25 min focus totale
                   - Eliminazione distrazioni durante focus time
                   
                2. STRUTTURA E CHIAREZZA
                   - Planning serale per giorno successivo
                   - Liste prioritÃ : importante vs urgente
                   - Review settimanale per aggiustamenti
                   
                3. ENERGIA DIRIGIDA
                   - Bloccare tempo per riflessione profonda
                   - Una decisione importante a settimana`,
                
                motivato_inconsistente: `
                1. SISTEMI E AUTOMAZIONE
                   - Tracker visivo per abitudini chiave
                   - Sistema di reward per costanza
                   - Routine mattutina non negoziabile
                   
                2. GESTIONE ENERGIA VARIABILE
                   - Sfrutta picchi per creare sistemi
                   - Piani B per giorni di bassa energia
                   - Habit stacking per automatizzare
                   
                3. ACCOUNTABILITY E SUPPORTO
                   - Check-in settimanali con te stesso
                   - Community o partner di accountability`,
                
                equilibrato_ottimizzatore: `
                1. OTTIMIZZAZIONE AVANZATA
                   - Analisi settimanale pattern di autenticitÃ 
                   - Sperimentazione tecniche mindfulness avanzate
                   - Marginal gains quotidiani
                   
                2. PERFORMANCE E CRESCITA
                   - Tracking metrics di consapevolezza
                   - A/B testing su strategie personali
                   - Review mensile per ottimizzazioni
                   
                3. LEADERSHIP E INFLUENZA
                   - Mentoring di altri nel tuo percorso
                   - Creazione sistemi per mantenimento`
            };
            
            return plans[profileType] || generateGenericPlan();
        }

        function generateGenericPlan() {
            return `
                1. PRATICA QUOTIDIANA DI AUTENTICITÃ
                   - 15 minuti di riflessione al giorno
                   - Identifica 3 momenti autentici quotidiani
                   - Diario di consapevolezza personalizzato
                
                2. TRASFORMAZIONE DEL CRITICO INTERNO
                   - Dialogo costruttivo con il critico
                   - Pratica dell'auto-compassione
                   - Focus su apprendimento vs giudizio
                
                3. ESPRESSIONE E VALORIZZAZIONE
                   - Tempo dedicato ai talenti nascosti
                   - Condivisione aspetti autentici con altri
                   - Celebrazione progressi e scoperte`;
        }

        function getPersonalizedMessage(profileType) {
            const messages = {
                stressato_esaurito: "La tua forza nel continuare questo percorso nonostante lo stress dimostra una resilienza incredibile. Vai con i tuoi tempi, ogni piccolo passo conta.",
                procrastinatore_bloccato: "Il fatto che tu sia arrivato fin qui dimostra che hai dentro di te la forza per superare ogni blocco. Un micro-passo alla volta, ce la farai!",
                perfezionista_insoddisfatto: "La tua ricerca di eccellenza Ã¨ una risorsa, ma ricorda: sei giÃ  abbastanza, proprio cosÃ¬ come sei. Il progresso Ã¨ piÃ¹ importante della perfezione.",
                dispersivo_confuso: "La tua mente ricca e curiosa Ã¨ un dono. Ora che hai piÃ¹ chiarezza sulle prioritÃ , puoi dirigere questa energia verso ciÃ² che conta davvero.",
                motivato_inconsistente: "La tua energia e motivazione sono incredibili! Con i sistemi giusti, puoi trasformare questa energia variabile in risultati costanti e duraturi.",
                equilibrato_ottimizzatore: "Il tuo approccio strutturato e la tua capacitÃ  di auto-analisi sono impressionanti. Sei sulla strada giusta per raggiungere livelli ancora piÃ¹ alti di consapevolezza."
            };
            
            return messages[profileType] || "La tua autenticitÃ  e il tuo impegno in questo percorso sono straordinari. Continua a fidarti del processo e di te stesso.";
        }

        function scheduleNextSession() {
            const nextWeekDate = new Date();
            nextWeekDate.setDate(nextWeekDate.getDate() + 7);
            
            const message = `ð Settimana 3 "Obiettivi SMART" con AI personalizzato disponibile il ${nextWeekDate.toLocaleDateString('it-IT')}!`;
            showMessage(message, 'info');
            
            localStorage.setItem('nextSessionReminder', nextWeekDate.toISOString());
        }

        function showMessage(message, type = 'info') {
            const colors = {
                success: '#16a34a',
                warning: '#f59e0b',
                info: '#3b82f6',
                error: '#ef4444'
            };
            
            const notification = document.createElement('div');
            notification.innerHTML = `
                <div style="position: fixed; top: 20px; right: 20px; background: ${colors[type]}; color: white; padding: 1rem 2rem; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.2); z-index: 1000; max-width: 400px; animation: slideIn 0.3s ease-out;">
                    ${message}
                </div>
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 5000);
        }

        // Handle Enter key in chat
        document.getElementById('chatInput')?.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                sendChatMessage();
            }
        });

        // Handle page unload
        window.addEventListener('beforeunload', function() {
            if (currentPhase !== 'completed') {
                autoSave();
            }
        });

        // Add slide-in animation style
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideIn {
                from {
                    transform: translateX(100%);
                    opacity: 0;
                }
                to {
                    transform: translateX(0);
                    opacity: 1;
                }
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>