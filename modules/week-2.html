<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Settimana 2 - Consapevolezza di S√© | Andrea Padoan Coach</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #f8fafc 0%, #fff7ed 50%, #f0fdf4 100%);
            min-height: 100vh;
            color: #1e293b;
        }

        /* Header */
        .header {
            background: linear-gradient(135deg, #1e293b 0%, #ea580c 100%);
            color: white;
            padding: 2rem 0;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 1.3rem;
            font-weight: bold;
        }

        .session-info {
            display: flex;
            align-items: center;
            gap: 2rem;
        }

        .timer-display {
            background: rgba(255,255,255,0.2);
            padding: 0.5rem 1rem;
            border-radius: 8px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .progress-bar {
            background: rgba(255,255,255,0.2);
            width: 200px;
            height: 8px;
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-fill {
            background: #22c55e;
            height: 100%;
            width: 0%;
            transition: width 0.3s ease;
        }

        .back-button {
            background: rgba(255,255,255,0.2);
            padding: 0.5rem 1rem;
            border-radius: 8px;
            text-decoration: none;
            color: white;
            transition: all 0.3s ease;
        }

        .back-button:hover {
            background: rgba(255,255,255,0.3);
        }

        /* Main Content */
        .main-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }

        /* Phase Indicator */
        .phase-indicator {
            background: white;
            border-radius: 12px;
            padding: 1rem 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .phase-step {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            font-weight: 600;
            min-width: 250px;
        }

        .phase-step.active {
            background: linear-gradient(135deg, #ea580c 0%, #fb923c 100%);
            color: white;
        }

        .phase-step.completed {
            background: linear-gradient(135deg, #16a34a 0%, #22c55e 100%);
            color: white;
        }

        .phase-step.inactive {
            background: #f1f5f9;
            color: #94a3b8;
        }

        .phase-arrow {
            font-size: 1.5rem;
            color: #64748b;
        }

        /* Welcome Section */
        .welcome-section {
            background: white;
            border-radius: 16px;
            padding: 3rem;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            margin-bottom: 2rem;
            text-align: center;
        }

        .welcome-title {
            font-size: 2.5rem;
            font-weight: bold;
            color: #1e293b;
            margin-bottom: 1rem;
        }

        .welcome-subtitle {
            font-size: 1.3rem;
            color: #ea580c;
            margin-bottom: 2rem;
        }

        .week1-recap {
            background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);
            border-radius: 12px;
            padding: 2rem;
            margin-bottom: 2rem;
            text-align: left;
        }

        .recap-title {
            font-size: 1.3rem;
            font-weight: bold;
            color: #16a34a;
            margin-bottom: 1rem;
            text-align: center;
        }

        .process-explanation {
            background: linear-gradient(135deg, #fff7ed 0%, #fed7aa 100%);
            border-radius: 12px;
            padding: 2rem;
            margin-bottom: 2rem;
            text-align: left;
        }

        .process-title {
            font-size: 1.3rem;
            font-weight: bold;
            color: #ea580c;
            margin-bottom: 1rem;
            text-align: center;
        }

        .process-steps {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
        }

        .process-step {
            background: white;
            padding: 1.5rem;
            border-radius: 8px;
            border-left: 4px solid #ea580c;
        }

        .step-number {
            font-size: 1.5rem;
            font-weight: bold;
            color: #ea580c;
            margin-bottom: 0.5rem;
        }

        .step-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: #1e293b;
            margin-bottom: 0.5rem;
        }

        .step-description {
            font-size: 0.9rem;
            color: #64748b;
            line-height: 1.5;
        }

        .step-duration {
            font-size: 0.8rem;
            color: #ea580c;
            font-weight: 600;
            margin-top: 0.5rem;
        }

        /* Phase 1 - Awareness Tests */
        .phase1-section {
            background: white;
            border-radius: 16px;
            padding: 2rem;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            margin-bottom: 2rem;
            display: none;
        }

        .phase1-section.active {
            display: block;
        }

        .phase-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid #f1f5f9;
        }

        .phase-icon {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #1e293b 0%, #ea580c 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: white;
        }

        .phase-title {
            font-size: 1.5rem;
            font-weight: bold;
            color: #1e293b;
            margin-bottom: 0.5rem;
        }

        .phase-subtitle {
            font-size: 1rem;
            color: #64748b;
        }

        .test-progress {
            background: #f1f5f9;
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1.5rem;
            text-align: center;
        }

        .test-progress-text {
            font-size: 0.9rem;
            color: #64748b;
            margin-bottom: 0.5rem;
        }

        .test-progress-bar {
            background: #e2e8f0;
            height: 8px;
            border-radius: 4px;
            overflow: hidden;
        }

        .test-progress-fill {
            background: linear-gradient(135deg, #16a34a 0%, #22c55e 100%);
            height: 100%;
            transition: width 0.3s ease;
        }

        .test-section {
            margin-bottom: 2rem;
            padding: 1.5rem;
            background: #f8fafc;
            border-radius: 12px;
            border-left: 4px solid #ea580c;
        }

        .test-section h3 {
            color: #1e293b;
            margin-bottom: 1rem;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .test-intro {
            background: #fff7ed;
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1.5rem;
            font-style: italic;
            color: #ea580c;
        }

        .question-group {
            margin-bottom: 2rem;
            padding: 1rem;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .question-text {
            font-weight: 600;
            margin-bottom: 1rem;
            color: #1e293b;
            font-size: 1.1rem;
        }

        .likert-scale {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 1rem;
            margin: 1rem 0;
        }

        .likert-option {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.5rem;
            flex: 1;
        }

        .likert-option input[type="radio"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        .likert-label {
            font-size: 0.8rem;
            text-align: center;
            color: #64748b;
            line-height: 1.2;
        }

        .scale-labels {
            display: flex;
            justify-content: space-between;
            margin-top: 0.5rem;
            font-size: 0.8rem;
            color: #94a3b8;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            color: #374151;
            font-weight: 500;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: #ea580c;
        }

        .form-group textarea {
            resize: vertical;
            min-height: 100px;
        }

        /* Phase 2 - Deep Coaching */
        .phase2-section {
            background: white;
            border-radius: 16px;
            padding: 2rem;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            margin-bottom: 2rem;
            display: none;
        }

        .phase2-section.active {
            display: block;
        }

        .coaching-context {
            background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);
            border-radius: 12px;
            padding: 2rem;
            margin-bottom: 2rem;
        }

        .coaching-context h3 {
            color: #16a34a;
            margin-bottom: 1rem;
            font-size: 1.3rem;
        }

        .coaching-context p {
            color: #15803d;
            line-height: 1.6;
            margin-bottom: 1rem;
        }

        .insights-summary {
            background: white;
            padding: 1.5rem;
            border-radius: 8px;
            border-left: 4px solid #16a34a;
        }

        .insights-title {
            font-weight: 600;
            color: #1e293b;
            margin-bottom: 0.5rem;
        }

        .insights-list {
            list-style: none;
            padding: 0;
        }

        .insights-list li {
            padding: 0.25rem 0;
            color: #64748b;
            font-size: 0.9rem;
        }

        .chat-container {
            background: #f8fafc;
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            min-height: 400px;
            max-height: 500px;
            overflow-y: auto;
        }

        .message {
            margin-bottom: 1rem;
            padding: 1rem;
            border-radius: 12px;
            max-width: 85%;
            animation: messageSlide 0.3s ease-out;
        }

        .message.coach {
            background: linear-gradient(135deg, #fff7ed 0%, #fed7aa 100%);
            margin-right: auto;
        }

        .message.user {
            background: linear-gradient(135deg, #e0f2fe 0%, #b3e5fc 100%);
            margin-left: auto;
            text-align: right;
        }

        .message-content {
            font-size: 1rem;
            line-height: 1.5;
            margin-bottom: 0.5rem;
        }

        .message-time {
            font-size: 0.8rem;
            color: #64748b;
        }

        .chat-input {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .chat-input input {
            flex: 1;
            padding: 0.75rem;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 1rem;
        }

        .chat-input input:focus {
            outline: none;
            border-color: #ea580c;
        }

        .chat-status {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 1rem;
            font-size: 0.9rem;
            color: #16a34a;
        }

        .status-dot {
            width: 10px;
            height: 10px;
            background: #22c55e;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        /* Buttons */
        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 1rem;
        }

        .btn-primary {
            background: linear-gradient(135deg, #1e293b 0%, #ea580c 100%);
            color: white;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(0,0,0,0.3);
        }

        .btn-secondary {
            background: white;
            color: #1e293b;
            border: 2px solid #e2e8f0;
        }

        .btn-secondary:hover {
            border-color: #ea580c;
            color: #ea580c;
        }

        .btn-success {
            background: linear-gradient(135deg, #16a34a 0%, #22c55e 100%);
            color: white;
        }

        .btn-success:hover {
            transform: translateY(-2px);
        }

        .btn-disabled {
            background: #94a3b8;
            color: white;
            cursor: not-allowed;
        }

        /* Navigation Buttons */
        .form-navigation {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-top: 2rem;
            padding-top: 1rem;
            border-top: 1px solid #e2e8f0;
        }

        /* Time Warning */
        .time-warning {
            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
            color: white;
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
            text-align: center;
            display: none;
        }

        .time-warning.active {
            display: block;
        }

        /* Completion Section */
        .completion-section {
            background: white;
            border-radius: 16px;
            padding: 2rem;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            margin-top: 2rem;
            display: none;
        }

        .completion-section.active {
            display: block;
        }

        .completion-title {
            font-size: 2rem;
            font-weight: bold;
            color: #1e293b;
            margin-bottom: 1rem;
            text-align: center;
        }

        .completion-message {
            font-size: 1.1rem;
            line-height: 1.6;
            color: #475569;
            margin-bottom: 2rem;
            text-align: center;
        }

        .awareness-results {
            background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);
            border-radius: 12px;
            padding: 2rem;
            margin-bottom: 2rem;
        }

        .results-title {
            font-size: 1.3rem;
            font-weight: bold;
            color: #16a34a;
            margin-bottom: 1rem;
        }

        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .result-item {
            background: white;
            padding: 1rem;
            border-radius: 8px;
            text-align: center;
            border-left: 4px solid #16a34a;
        }

        .result-score {
            font-size: 2rem;
            font-weight: bold;
            color: #16a34a;
            margin-bottom: 0.5rem;
        }

        .result-label {
            font-size: 0.9rem;
            color: #64748b;
            margin-bottom: 0.5rem;
        }

        .result-feedback {
            font-size: 0.8rem;
            color: #15803d;
            font-style: italic;
        }

        .homework-section {
            background: linear-gradient(135deg, #fff7ed 0%, #fed7aa 100%);
            border-radius: 12px;
            padding: 2rem;
            margin-bottom: 2rem;
        }

        .homework-title {
            font-size: 1.3rem;
            font-weight: bold;
            color: #ea580c;
            margin-bottom: 1rem;
        }

        .homework-list {
            list-style: none;
            padding: 0;
        }

        .homework-list li {
            padding: 0.5rem 0;
            border-bottom: 1px solid rgba(234, 88, 12, 0.2);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .homework-list li:last-child {
            border-bottom: none;
        }

        .completion-actions {
            display: flex;
            justify-content: center;
            gap: 1rem;
            flex-wrap: wrap;
        }

        /* Animations */
        @keyframes messageSlide {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .main-content {
                padding: 1rem;
            }
            
            .process-steps {
                grid-template-columns: 1fr;
            }
            
            .phase-indicator {
                flex-direction: column;
                gap: 0.5rem;
            }
            
            .phase-step {
                min-width: auto;
                width: 100%;
                justify-content: center;
            }
            
            .phase-arrow {
                transform: rotate(90deg);
            }
            
            .likert-scale {
                flex-direction: column;
                gap: 0.5rem;
            }
            
            .results-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <div class="logo">üß† Settimana 2 - Consapevolezza di S√©</div>
            <div class="session-info">
                <div class="timer-display">
                    ‚è±Ô∏è <span id="sessionTimer">45:00</span>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="sessionProgress"></div>
                </div>
                <a href="module-hub.html" class="back-button">‚Üê Torna ai Moduli</a>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Phase Indicator -->
        <div class="phase-indicator">
            <div class="phase-step active" id="phaseStep1">
                <span>üß†</span>
                <span>Fase 1: Test di Consapevolezza</span>
            </div>
            <div class="phase-arrow">‚Üí</div>
            <div class="phase-step inactive" id="phaseStep2">
                <span>ü§ñ</span>
                <span>Fase 2: Coaching Profondo</span>
            </div>
        </div>

        <!-- Welcome Section -->
        <section class="welcome-section fade-in" id="welcomeSection">
            <h1 class="welcome-title">Benvenuto nella Settimana 2! üåü</h1>
            <p class="welcome-subtitle">Consapevolezza di S√© - Scopri chi sei veramente</p>
            
            <div class="week1-recap">
                <h3 class="recap-title">üéØ Quello che Abbiamo Scoperto nella Settimana 1</h3>
                <div id="week1Summary">
                    <p>Caricamento del tuo riepilogo personalizzato dalla settimana 1...</p>
                </div>
            </div>
            
            <div class="process-explanation">
                <h3 class="process-title">üß† Il Tuo Viaggio di Consapevolezza</h3>
                <div class="process-steps">
                    <div class="process-step">
                        <div class="step-number">1</div>
                        <div class="step-title">Test di Consapevolezza</div>
                        <div class="step-description">
                            Test di autostima, valori personali e motivazioni intrinseche 
                            per mappare la tua consapevolezza attuale.
                        </div>
                        <div class="step-duration">‚è±Ô∏è 15 minuti</div>
                    </div>
                    <div class="process-step">
                        <div class="step-number">2</div>
                        <div class="step-title">Coaching Profondo</div>
                        <div class="step-description">
                            Esploreremo insieme i risultati per far emergere la tua autenticit√† 
                            e scoprire il tuo potenziale nascosto.
                        </div>
                        <div class="step-duration">‚è±Ô∏è 25-30 minuti</div>
                    </div>
                </div>
            </div>
            
            <button class="btn btn-primary" onclick="startPhase1()">
                üöÄ Inizia il Tuo Viaggio di Consapevolezza
            </button>
        </section>

        <!-- Phase 1: Awareness Tests -->
        <section class="phase1-section" id="phase1Section">
            <div class="phase-header">
                <div class="phase-icon">üß†</div>
                <div>
                    <h2 class="phase-title">Fase 1: Test di Consapevolezza</h2>
                    <p class="phase-subtitle">Esploriamo la tua autostima, valori e motivazioni profonde</p>
                </div>
            </div>
            
            <div class="test-progress">
                <div class="test-progress-text">Progresso test: <span id="testProgress">0%</span></div>
                <div class="test-progress-bar">
                    <div class="test-progress-fill" id="testProgressFill" style="width: 0%"></div>
                </div>
            </div>
            
            <form id="awarenessForm">
                <!-- Test Autostima -->
                <div class="test-section" id="selfEsteemTest">
                    <h3>üí™ Test di Autostima</h3>
                    <div class="test-intro">
                        Per ogni affermazione, indica quanto ti rappresenta su una scala da 1 (per niente) a 5 (completamente).
                        Non esistono risposte giuste o sbagliate, rispondi istintivamente.
                    </div>
                    
                    <div class="question-group">
                        <div class="question-text">Mi sento a mio agio con me stesso nella maggior parte delle situazioni</div>
                        <div class="likert-scale">
                            <div class="likert-option">
                                <input type="radio" name="esteem1" value="1" onchange="updateTestProgress(); autoSave()">
                                <span class="likert-label">Per niente</span>
                            </div>
                            <div class="likert-option">
                                <input type="radio" name="esteem1" value="2" onchange="updateTestProgress(); autoSave()">
                                <span class="likert-label">Poco</span>
                            </div>
                            <div class="likert-option">
                                <input type="radio" name="esteem1" value="3" onchange="updateTestProgress(); autoSave()">
                                <span class="likert-label">Abbastanza</span>
                            </div>
                            <div class="likert-option">
                                <input type="radio" name="esteem1" value="4" onchange="updateTestProgress(); autoSave()">
                                <span class="likert-label">Molto</span>
                            </div>
                            <div class="likert-option">
                                <input type="radio" name="esteem1" value="5" onchange="updateTestProgress(); autoSave()">
                                <span class="likert-label">Completamente</span>
                            </div>
                        </div>
                    </div>

                    <div class="question-group">
                        <div class="question-text">Credo nelle mie capacit√† e nel mio valore come persona</div>
                        <div class="likert-scale">
                            <div class="likert-option">
                                <input type="radio" name="esteem2" value="1" onchange="updateTestProgress(); autoSave()">
                                <span class="likert-label">Per niente</span>
                            </div>
                            <div class="likert-option">
                                <input type="radio" name="esteem2" value="2" onchange="updateTestProgress(); autoSave()">
                                <span class="likert-label">Poco</span>
                            </div>
                            <div class="likert-option">
                                <input type="radio" name="esteem2" value="3" onchange="updateTestProgress(); autoSave()">
                                <span class="likert-label">Abbastanza</span>
                            </div>
                            <div class="likert-option">
                                <input type="radio" name="esteem2" value="4" onchange="updateTestProgress(); autoSave()">
                                <span class="likert-label">Molto</span>
                            </div>
                            <div class="likert-option">
                                <input type="radio" name="esteem2" value="5" onchange="updateTestProgress(); autoSave()">
                                <span class="likert-label">Completamente</span>
                            </div>
                        </div>
                    </div>

                    <div class="question-group">
                        <div class="question-text">Riesco ad accettare i complimenti senza sentirmi a disagio</div>
                        <div class="likert-scale">
                            <div class="likert-option">
                                <input type="radio" name="esteem3" value="1" onchange="updateTestProgress(); autoSave()">
                                <span class="likert-label">Per niente</span>
                            </div>
                            <div class="likert-option">
                                <input type="radio" name="esteem3" value="2" onchange="updateTestProgress(); autoSave()">
                                <span class="likert-label">Poco</span>
                            </div>
                            <div class="likert-option">
                                <input type="radio" name="esteem3" value="3" onchange="updateTestProgress(); autoSave()">
                                <span class="likert-label">Abbastanza</span>
                            </div>
                            <div class="likert-option">
                                <input type="radio" name="esteem3" value="4" onchange="updateTestProgress(); autoSave()">
                                <span class="likert-label">Molto</span>
                            </div>
                            <div class="likert-option">
                                <input type="radio" name="esteem3" value="5" onchange="updateTestProgress(); autoSave()">
                                <span class="likert-label">Completamente</span>
                            </div>
                        </div>
                    </div>

                    <div class="question-group">
                        <div class="question-text">Non ho paura di esprimere le mie opinioni anche quando sono diverse da quelle degli altri</div>
                        <div class="likert-scale">
                            <div class="likert-option">
                                <input type="radio" name="esteem4" value="1" onchange="updateTestProgress(); autoSave()">
                                <span class="likert-label">Per niente</span>
                            </div>
                            <div class="likert-option">
                                <input type="radio" name="esteem4" value="2" onchange="updateTestProgress(); autoSave()">
                                <span class="likert-label">Poco</span>
                            </div>
                            <div class="likert-option">
                                <input type="radio" name="esteem4" value="3" onchange="updateTestProgress(); autoSave()">
                                <span class="likert-label">Abbastanza</span>
                            </div>
                            <div class="likert-option">
                                <input type="radio" name="esteem4" value="4" onchange="updateTestProgress(); autoSave()">
                                <span class="likert-label">Molto</span>
                            </div>
                            <div class="likert-option">
                                <input type="radio" name="esteem4" value="5" onchange="updateTestProgress(); autoSave()">
                                <span class="likert-label">Completamente</span>
                            </div>
                        </div>
                    </div>

                    <div class="question-group">
                        <div class="question-text">Mi perdono facilmente quando commetto errori</div>
                        <div class="likert-scale">
                            <div class="likert-option">
                                <input type="radio" name="esteem5" value="1" onchange="updateTestProgress(); autoSave()">
                                <span class="likert-label">Per niente</span>
                            </div>
                            <div class="likert-option">
                                <input type="radio" name="esteem5" value="2" onchange="updateTestProgress(); autoSave()">
                                <span class="likert-label">Poco</span>
                            </div>
                            <div class="likert-option">
                                <input type="radio" name="esteem5" value="3" onchange="updateTestProgress(); autoSave()">
                                <span class="likert-label">Abbastanza</span>
                            </div>
                            <div class="likert-option">
                                <input type="radio" name="esteem5" value="4" onchange="updateTestProgress(); autoSave()">
                                <span class="likert-label">Molto</span>
                            </div>
                            <div class="likert-option">
                                <input type="radio" name="esteem5" value="5" onchange="updateTestProgress(); autoSave()">
                                <span class="likert-label">Completamente</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Test Valori -->
                <div class="test-section" id="valuesTest">
                    <h3>üéØ I Tuoi Valori Profondi</h3>
                    <div class="test-intro">
                        Indica l'importanza di questi valori nella tua vita su una scala da 1 (poco importante) a 5 (fondamentale).
                    </div>
                    
                    <div class="question-group">
                        <div class="question-text">Famiglia e relazioni affettive</div>
                        <div class="likert-scale">
                            <div class="likert-option">
                                <input type="radio" name="value1" value="1" onchange="updateTestProgress(); autoSave()">
                                <span class="likert-label">Poco importante</span>
                            </div>
                            <div class="likert-option">
                                <input type="radio" name="value1" value="2" onchange="updateTestProgress(); autoSave()">
                                <span class="likert-label">Abbastanza</span>
                            </div>
                            <div class="likert-option">
                                <input type="radio" name="value1" value="3" onchange="updateTestProgress(); autoSave()">
                                <span class="likert-label">Importante</span>
                            </div>
                            <div class="likert-option">
                                <input type="radio" name="value1" value="4" onchange="updateTestProgress(); autoSave()">
                                <span class="likert-label">Molto importante</span>
                            </div>
                            <div class="likert-option">
                                <input type="radio" name="value1" value="5" onchange="updateTestProgress(); autoSave()">
                                <span class="likert-label">Fondamentale</span>
                            </div>
                        </div>
                    </div>

                    <div class="question-group">
                        <div class="question-text">Successo professionale e carriera</div>
                        <div class="likert-scale">
                            <div class="likert-option">
                                <input type="radio" name="value2" value="1" onchange="updateTestProgress(); autoSave()">
                                <span class="likert-label">Poco importante</span>
                            </div>
                            <div class="likert-option">
                                <input type="radio" name="value2" value="2" onchange="updateTestProgress(); autoSave()">
                                <span class="likert-label">Abbastanza</span>
                            </div>
                            <div class="likert-option">
                                <input type="radio" name="value2" value="3" onchange="updateTestProgress(); autoSave()">
                                <span class="likert-label">Importante</span>
                            </div>
                            <div class="likert-option">
                                <input type="radio" name="value2" value="4" onchange="updateTestProgress(); autoSave()">
                                <span class="likert-label">Molto importante</span>
                            </div>
                            <div class="likert-option">
                                <input type="radio" name="value2" value="5" onchange="updateTestProgress(); autoSave()">
                                <span class="likert-label">Fondamentale</span>
                            </div>
                        </div>
                    </div>

                    <div class="question-group">
                        <div class="question-text">Salute e benessere fisico</div>
                        <div class="likert-scale">
                            <div class="likert-option">
                                <input type="radio" name="value3" value="1" onchange="updateTestProgress(); autoSave()">
                                <span class="likert-label">Poco importante</span>
                            </div>
                            <div class="likert-option">
                                <input type="radio" name="value3" value="2" onchange="updateTestProgress(); autoSave()">
                                <span class="likert-label">Abbastanza</span>
                            </div>
                            <div class="likert-option">
                                <input type="radio" name="value3" value="3" onchange="updateTestProgress(); autoSave()">
                                <span class="likert-label">Importante</span>
                            </div>
                            <div class="likert-option">
                                <input type="radio" name="value3" value="4" onchange="updateTestProgress(); autoSave()">
                                <span class="likert-label">Molto importante</span>
                            </div>
                            <div class="likert-option">
                                <input type="radio" name="value3" value="5" onchange="updateTestProgress(); autoSave()">
                                <span class="likert-label">Fondamentale</span>
                            </div>
                        </div>
                    </div>

                    <div class="question-group">
                        <div class="question-text">Crescita personale e spirituale</div>
                        <div class="likert-scale">
                            <div class="likert-option">
                                <input type="radio" name="value4" value="1" onchange="updateTestProgress(); autoSave()">
                                <span class="likert-label">Poco importante</span>
                            </div>
                            <div class="likert-option">
                                <input type="radio" name="value4" value="2" onchange="updateTestProgress(); autoSave()">
                                <span class="likert-label">Abbastanza</span>
                            </div>
                            <div class="likert-option">
                                <input type="radio" name="value4" value="3" onchange="updateTestProgress(); autoSave()">
                                <span class="likert-label">Importante</span>
                            </div>
                            <div class="likert-option">
                                <input type="radio" name="value4" value="4" onchange="updateTestProgress(); autoSave()">
                                <span class="likert-label">Molto importante</span>
                            </div>
                            <div class="likert-option">
                                <input type="radio" name="value4" value="5" onchange="updateTestProgress(); autoSave()">
                                <span class="likert-label">Fondamentale</span>
                            </div>
                        </div>
                    </div>

                    <div class="question-group">
                        <div class="question-text">Libert√† e indipendenza</div>
                        <div class="likert-scale">
                            <div class="likert-option">
                                <input type="radio" name="value5" value="1" onchange="updateTestProgress(); autoSave()">
                                <span class="likert-label">Poco importante</span>
                            </div>
                            <div class="likert-option">
                                <input type="radio" name="value5" value="2" onchange="updateTestProgress(); autoSave()">
                                <span class="likert-label">Abbastanza</span>
                            </div>
                            <div class="likert-option">
                                <input type="radio" name="value5" value="3" onchange="updateTestProgress(); autoSave()">
                                <span class="likert-label">Importante</span>
                            </div>
                            <div class="likert-option">
                                <input type="radio" name="value5" value="4" onchange="updateTestProgress(); autoSave()">
                                <span class="likert-label">Molto importante</span>
                            </div>
                            <div class="likert-option">
                                <input type="radio" name="value5" value="5" onchange="updateTestProgress(); autoSave()">
                                <span class="likert-label">Fondamentale</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Domande Approfondite -->
                <div class="test-section" id="deepQuestions">
                    <h3>üîç Esplorazione Profonda</h3>
                    <div class="test-intro">
                        Queste domande ci aiuteranno a comprendere meglio la tua consapevolezza attuale.
                    </div>
                    
                    <div class="form-group">
                        <label for="authenticSelf">Quando ti senti pi√π autentico e te stesso?</label>
                        <textarea id="authenticSelf" placeholder="Descrivi le situazioni, i momenti o i contesti in cui senti di essere veramente te stesso..." onchange="updateTestProgress(); autoSave()"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="innerCritic">Qual √® la voce del tuo critico interno? Cosa ti dice pi√π spesso?</label>
                        <textarea id="innerCritic" placeholder="Quella voce dentro di te che critica, giudica o limita... cosa ti dice?" onchange="updateTestProgress(); autoSave()"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="hiddenTalents">Quale talento o capacit√† hai che non usi abbastanza?</label>
                        <textarea id="hiddenTalents" placeholder="Cosa sai fare bene ma non valorizzi o non sfrutti appieno?" onchange="updateTestProgress(); autoSave()"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="emotionalPattern">Quale emozione tendi a evitare di pi√π e perch√©?</label>
                        <textarea id="emotionalPattern" placeholder="C'√® un'emozione che fai fatica a vivere o ad accettare?" onchange="updateTestProgress(); autoSave()"></textarea>
                    </div>
                </div>

                <div class="form-navigation">
                    <button type="button" class="btn btn-success" id="completeTestBtn" onclick="completePhase1()" disabled>
                        ‚úÖ Completa Test e Inizia Coaching Profondo
                    </button>
                </div>
            </form>
        </section>

        <!-- Phase 2: Deep Coaching -->
        <section class="phase2-section" id="phase2Section">
            <div class="phase-header">
                <div class="phase-icon">ü§ñ</div>
                <div>
                    <h2 class="phase-title">Fase 2: Coaching Profondo di Consapevolezza</h2>
                    <p class="phase-subtitle">Esploriamo insieme i risultati per far emergere la tua autenticit√†</p>
                </div>
            </div>
            
            <div class="coaching-context">
                <h3>üåü Il Tuo Profilo di Consapevolezza</h3>
                <p>
                    Ho analizzato i tuoi test insieme ai dati della settimana 1. Ora voglio accompagnarti 
                    in un viaggio di scoperta per far emergere la tua autenticit√† e il tuo potenziale nascosto.
                </p>
                
                <div class="insights-summary">
                    <div class="insights-title">üí° Prime Insights Emerse:</div>
                    <ul class="insights-list" id="initialInsights">
                        <li>Caricamento insights personalizzati...</li>
                    </ul>
                </div>
            </div>
            
            <div class="time-warning" id="timeWarning">
                <strong>‚è∞ Abbiamo raggiunto i 30 minuti!</strong> Vuoi continuare per altri 15 minuti o preferisci terminare ora?
                <div style="margin-top: 1rem;">
                    <button class="btn btn-secondary" onclick="continueSession()">Continua</button>
                    <button class="btn btn-primary" onclick="endSession()">Termina Ora</button>
                </div>
            </div>
            
            <div class="chat-status">
                <div class="status-dot"></div>
                <span>Andrea √® pronto per esplorare la tua consapevolezza profonda</span>
            </div>
            
            <div class="chat-container" id="chatContainer">
                <!-- Messages will be added here -->
            </div>
            
            <div class="chat-input">
                <input type="text" id="chatInput" placeholder="Condividi i tuoi pensieri con Andrea...">
                <button class="btn btn-primary" onclick="sendChatMessage()">Invia</button>
            </div>
        </section>

        <!-- Completion Section -->
        <section class="completion-section" id="completionSection">
            <h2 class="completion-title">üåü Sessione di Consapevolezza Completata!</h2>
            <p class="completion-message">
                Che viaggio straordinario di scoperta abbiamo fatto insieme! Attraverso i test e il nostro coaching approfondito, 
                sono emerse consapevolezze importanti sulla tua autenticit√† e il tuo potenziale.
            </p>
            
            <div class="awareness-results">
                <h3 class="results-title">üìä I Tuoi Risultati di Consapevolezza</h3>
                <div class="results-grid" id="resultsGrid">
                    <!-- Will be populated with test results -->
                </div>
            </div>
            
            <div class="homework-section">
                <h3 class="homework-title">üå± I Tuoi Compiti di Crescita Personale</h3>
                <ul class="homework-list" id="personalizedHomework">
                    <!-- Will be generated based on awareness session -->
                </ul>
            </div>
            
            <div class="completion-actions">
                <button class="btn btn-success" onclick="downloadAwarenessReport()">üìÑ Scarica Rapporto Consapevolezza</button>
                <a href="module-hub.html" class="btn btn-secondary">‚Üê Torna ai Moduli</a>
                <button class="btn btn-primary" onclick="scheduleNextSession()">üìÖ Programma Settimana 3</button>
            </div>
        </section>
    </main>

    <!-- Load Andrea AI Coach System -->
    <script src="../andrea-ai-coach.js"></script>
    
    <script>
        // Session variables
        let sessionStartTime = Date.now();
        let sessionDuration = 45 * 60 * 1000; // 45 minutes
        let timerInterval;
        let currentPhase = 'welcome';
        let testData = {};
        let chatHistory = [];
        let andreaAICoach = null;
        let userProfile = null;
        let week1Data = null;
        let sessionExtended = false;
        let autoSaveInterval;
        let awarenessInsights = [];
        let testResults = {};

        // Initialize session
        document.addEventListener('DOMContentLoaded', function() {
            startSessionTimer();
            loadUserProfile();
            loadWeek1Data();
            loadSavedSession();
            initializeAndreaAI();
            startAutoSave();
        });

        function startSessionTimer() {
            timerInterval = setInterval(() => {
                const elapsed = Date.now() - sessionStartTime;
                const remaining = Math.max(0, sessionDuration - elapsed);
                
                const minutes = Math.floor(remaining / 60000);
                const seconds = Math.floor((remaining % 60000) / 1000);
                
                document.getElementById('sessionTimer').textContent = 
                    `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                
                const progress = (elapsed / sessionDuration) * 100;
                document.getElementById('sessionProgress').style.width = `${Math.min(progress, 100)}%`;
                
                // Check for 30 minute warning
                if (elapsed >= 30 * 60 * 1000 && !sessionExtended && currentPhase === 'phase2') {
                    show30MinuteWarning();
                }
                
                // Auto-end at 45 minutes
                if (remaining === 0) {
                    clearInterval(timerInterval);
                    endSession();
                }
            }, 1000);
        }

        function loadUserProfile() {
            try {
                const savedData = localStorage.getItem('lifestyleQuizResults');
                if (savedData) {
                    userProfile = JSON.parse(savedData);
                    console.log('‚úÖ User profile loaded:', userProfile);
                }
            } catch (error) {
                console.error('‚ùå Error loading user profile:', error);
            }
        }

        function loadWeek1Data() {
            try {
                const week1SessionData = localStorage.getItem('week1SessionCompleted');
                if (week1SessionData) {
                    week1Data = JSON.parse(week1SessionData);
                    console.log('‚úÖ Week 1 data loaded:', week1Data);
                    displayWeek1Summary();
                } else {
                    console.log('‚ö†Ô∏è No Week 1 data found');
                    displayDefaultSummary();
                }
            } catch (error) {
                console.error('‚ùå Error loading Week 1 data:', error);
                displayDefaultSummary();
            }
        }

        function displayWeek1Summary() {
            const summaryEl = document.getElementById('week1Summary');
            if (week1Data && week1Data.phase1Data) {
                const data = week1Data.phase1Data;
                summaryEl.innerHTML = `
                    <p><strong>La tua situazione:</strong> "${data.currentSituation || 'In definizione'}"</p>
                    <p><strong>Il tuo obiettivo principale:</strong> "${data.dreamGoal || 'In esplorazione'}"</p>
                    <p><strong>Cosa ti motiva di pi√π:</strong> "${data.mainJoy || 'Ancora da scoprire'}"</p>
                    <p style="margin-top: 1rem; font-style: italic; color: #ea580c;">
                        Oggi approfondiremo questi aspetti per far emergere la tua autentica consapevolezza.
                    </p>
                `;
            } else {
                displayDefaultSummary();
            }
        }

        function displayDefaultSummary() {
            const summaryEl = document.getElementById('week1Summary');
            summaryEl.innerHTML = `
                <p>Nella settimana 1 abbiamo iniziato a conoscerti attraverso il questionario approfondito e il coaching iniziale.</p>
                <p style="margin-top: 1rem; font-style: italic; color: #ea580c;">
                    Oggi costruiremo su quelle basi per sviluppare una consapevolezza pi√π profonda di chi sei veramente.
                </p>
            `;
        }

        function loadSavedSession() {
            try {
                const savedSession = localStorage.getItem('week2SessionInProgress');
                if (savedSession) {
                    const sessionData = JSON.parse(savedSession);
                    
                    // Restore test data
                    if (sessionData.testData) {
                        testData = sessionData.testData;
                        restoreTestAnswers();
                    }
                    
                    // Restore chat history
                    if (sessionData.chatHistory) {
                        chatHistory = sessionData.chatHistory;
                    }
                    
                    // Restore current phase
                    if (sessionData.currentPhase) {
                        currentPhase = sessionData.currentPhase;
                        
                        if (currentPhase === 'phase1') {
                            startPhase1();
                        } else if (currentPhase === 'phase2') {
                            startPhase2();
                            restoreChatHistory();
                        }
                    }
                    
                    console.log('‚úÖ Session restored from:', sessionData);
                }
            } catch (error) {
                console.error('‚ùå Error loading saved session:', error);
            }
        }

        function restoreTestAnswers() {
            Object.entries(testData).forEach(([key, value]) => {
                const element = document.querySelector(`[name="${key}"], #${key}`);
                if (element) {
                    if (element.type === 'radio') {
                        const radio = document.querySelector(`[name="${key}"][value="${value}"]`);
                        if (radio) radio.checked = true;
                    } else {
                        element.value = value;
                    }
                }
            });
            updateTestProgress();
        }

        async function initializeAndreaAI() {
            try {
                if (window.AndreaAICoach) {
                    andreaAICoach = new window.AndreaAICoach();
                    
                    const userId = localStorage.getItem('lifestyleUserId') || 'user_' + Date.now();
                    localStorage.setItem('lifestyleUserId', userId);
                    
                    await andreaAICoach.initialize(userId, userProfile || {});
                    
                    console.log('ü§ñ Andrea AI Coach initialized successfully');
                } else {
                    console.error('‚ùå Andrea AI Coach not available');
                }
            } catch (error) {
                console.error('‚ùå Error initializing Andrea AI:', error);
            }
        }

        function startAutoSave() {
            autoSaveInterval = setInterval(() => {
                autoSave();
            }, 5000);
        }

        function autoSave() {
            try {
                const sessionData = {
                    currentPhase: currentPhase,
                    testData: testData,
                    chatHistory: chatHistory,
                    awarenessInsights: awarenessInsights,
                    testResults: testResults,
                    sessionStartTime: sessionStartTime,
                    lastSaved: new Date().toISOString()
                };
                
                localStorage.setItem('week2SessionInProgress', JSON.stringify(sessionData));
            } catch (error) {
                console.error('‚ùå Error auto-saving:', error);
            }
        }

        function startPhase1() {
            currentPhase = 'phase1';
            
            // Hide welcome, show phase 1
            document.getElementById('welcomeSection').style.display = 'none';
            document.getElementById('phase1Section').classList.add('active');
            
            // Update phase indicator
            document.getElementById('phaseStep1').className = 'phase-step active';
            document.getElementById('phaseStep2').className = 'phase-step inactive';
            
            updateTestProgress();
            autoSave();
        }

        function updateTestProgress() {
            const form = document.getElementById('awarenessForm');
            const inputs = form.querySelectorAll('input[type="radio"], textarea');
            
            let filled = 0;
            const radioGroups = {};
            
            // Count filled inputs
            inputs.forEach(input => {
                if (input.type === 'radio') {
                    if (!radioGroups[input.name]) {
                        radioGroups[input.name] = false;
                    }
                    if (input.checked) {
                        radioGroups[input.name] = true;
                        testData[input.name] = input.value;
                    }
                } else if (input.value.trim()) {
                    filled++;
                    testData[input.id] = input.value.trim();
                }
            });
            
            // Count filled radio groups
            Object.values(radioGroups).forEach(isSelected => {
                if (isSelected) filled++;
            });
            
            const totalQuestions = Object.keys(radioGroups).length + form.querySelectorAll('textarea').length;
            const progress = (filled / totalQuestions) * 100;
            
            document.getElementById('testProgress').textContent = `${Math.round(progress)}%`;
            document.getElementById('testProgressFill').style.width = `${progress}%`;
            
            // Enable/disable complete button
            const completeBtn = document.getElementById('completeTestBtn');
            if (progress === 100) {
                completeBtn.disabled = false;
                completeBtn.className = 'btn btn-success';
            } else {
                completeBtn.disabled = true;
                completeBtn.className = 'btn btn-disabled';
            }
        }

        function completePhase1() {
            // Calculate test results
            calculateTestResults();
            
            // Mark phase 1 as completed
            document.getElementById('phaseStep1').className = 'phase-step completed';
            
            // Start phase 2
            startPhase2();
        }

        function calculateTestResults() {
            // Calculate self-esteem score
            let esteemTotal = 0;
            let esteemCount = 0;
            for (let i = 1; i <= 5; i++) {
                if (testData[`esteem${i}`]) {
                    esteemTotal += parseInt(testData[`esteem${i}`]);
                    esteemCount++;
                }
            }
            testResults.selfEsteem = esteemCount > 0 ? Math.round(esteemTotal / esteemCount * 10) / 10 : 0;
            
            // Calculate values priorities
            const values = {
                family: testData.value1 ? parseInt(testData.value1) : 0,
                career: testData.value2 ? parseInt(testData.value2) : 0,
                health: testData.value3 ? parseInt(testData.value3) : 0,
                growth: testData.value4 ? parseInt(testData.value4) : 0,
                freedom: testData.value5 ? parseInt(testData.value5) : 0
            };
            
            // Find top values
            const sortedValues = Object.entries(values).sort((a, b) => b[1] - a[1]);
            testResults.topValues = sortedValues.slice(0, 3);
            
            // Generate insights
            generateAwarenessInsights();
        }

        function generateAwarenessInsights() {
            awarenessInsights = [];
            
            // Self-esteem insights
            if (testResults.selfEsteem >= 4) {
                awarenessInsights.push('Autostima solida - una risorsa importante per la crescita');
            } else if (testResults.selfEsteem <= 2.5) {
                awarenessInsights.push('Area di crescita identificata: sviluppo autostima');
            }
            
            // Values insights
            const valueLabels = {
                family: 'Famiglia e relazioni',
                career: 'Successo professionale',
                health: 'Salute e benessere',
                growth: 'Crescita personale',
                freedom: 'Libert√† e indipendenza'
            };
            
            if (testResults.topValues.length > 0) {
                const topValue = valueLabels[testResults.topValues[0][0]];
                awarenessInsights.push(`Valore principale: ${topValue} - guida le tue decisioni`);
            }
            
            // Deep questions insights
            if (testData.authenticSelf) {
                awarenessInsights.push('Consapevolezza dei momenti di autenticit√† identificata');
            }
            
            if (testData.innerCritic) {
                awarenessInsights.push('Pattern del critico interno riconosciuto');
            }
            
            if (testData.hiddenTalents) {
                awarenessInsights.push('Talenti nascosti da valorizzare identificati');
            }
        }

        function startPhase2() {
            currentPhase = 'phase2';
            
            // Hide phase 1, show phase 2
            document.getElementById('phase1Section').classList.remove('active');
            document.getElementById('phase2Section').classList.add('active');
            
            // Update phase indicator
            document.getElementById('phaseStep2').className = 'phase-step active';
            
            // Display insights
            displayInitialInsights();
            
            // Generate first coaching question
            generateFirstCoachingQuestion();
            
            autoSave();
        }

        function displayInitialInsights() {
            const insightsEl = document.getElementById('initialInsights');
            if (awarenessInsights.length > 0) {
                insightsEl.innerHTML = awarenessInsights.map(insight => `<li>${insight}</li>`).join('');
            } else {
                insightsEl.innerHTML = '<li>Insights personalizzati in caricamento...</li>';
            }
        }

        function generateFirstCoachingQuestion() {
            if (chatHistory.length === 0) {
                const firstQuestion = generatePowerfulAwarenessQuestion();
                addChatMessage(firstQuestion, 'coach');
            } else {
                restoreChatHistory();
            }
        }

        function generatePowerfulAwarenessQuestion() {
            let question = `Ciao! Ho appena analizzato i risultati dei tuoi test di consapevolezza e sono emersi alcuni aspetti molto interessanti. `;
            
            // Personalize based on test results
            if (testResults.selfEsteem) {
                if (testResults.selfEsteem >= 4) {
                    question += `Vedo che hai una buona autostima (${testResults.selfEsteem}/5), il che √® una risorsa preziosa. `;
                } else {
                    question += `Ho notato che l'autostima √® un'area dove puoi crescere molto (${testResults.selfEsteem}/5). `;
                }
            }
            
            // Reference top values
            if (testResults.topValues && testResults.topValues.length > 0) {
                const valueLabels = {
                    family: 'famiglia e relazioni',
                    career: 'successo professionale',
                    health: 'salute e benessere',
                    growth: 'crescita personale',
                    freedom: 'libert√† e indipendenza'
                };
                const topValue = valueLabels[testResults.topValues[0][0]];
                question += `Il tuo valore pi√π importante √® ${topValue}, e questo dice molto di te. `;
            }
            
            // Reference authentic self answer
            if (testData.authenticSelf) {
                question += `Mi ha colpito quando hai scritto che ti senti pi√π autentico: "${testData.authenticSelf}". `;
            }
            
            // Powerful coaching question
            question += `\n\nOra voglio farti una domanda che va al cuore della consapevolezza: 
            
**Se dovessi presentare la "vera te" a qualcuno che non ti conosce, chi presenteresti? Non il ruolo che ricopri o ci√≤ che fai, ma chi SEI davvero nel profondo.** ü§î
            
Prenditi tutto il tempo che serve. Non c'√® fretta di rispondere "bene", ma di rispondere autenticamente.`;
            
            return question;
        }

        function restoreChatHistory() {
            const chatContainer = document.getElementById('chatContainer');
            chatContainer.innerHTML = '';
            
            chatHistory.forEach(message => {
                const messageDiv = document.createElement('div');
                messageDiv.className = `message ${message.sender}`;
                messageDiv.innerHTML = `
                    <div class="message-content">${message.content}</div>
                    <div class="message-time">${message.time}</div>
                `;
                chatContainer.appendChild(messageDiv);
            });
            
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }

        async function sendChatMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            
            if (!message) return;
            
            // Add user message
            addChatMessage(message, 'user');
            input.value = '';
            
            // Get AI coaching response
            try {
                const coachingResponse = await getAwarenessCoachingResponse(message);
                setTimeout(() => {
                    addChatMessage(coachingResponse, 'coach');
                }, 1500);
            } catch (error) {
                console.error('‚ùå Error getting coaching response:', error);
                setTimeout(() => {
                    addChatMessage("Dammi un momento per elaborare quello che mi hai condiviso... Puoi ripetere?", 'coach');
                }, 1000);
            }
        }

        function addChatMessage(content, sender) {
            const chatContainer = document.getElementById('chatContainer');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender}`;
            
            const now = new Date();
            const time = now.toLocaleTimeString('it-IT', { hour: '2-digit', minute: '2-digit' });
            
            messageDiv.innerHTML = `
                <div class="message-content">${content}</div>
                <div class="message-time">${time}</div>
            `;
            
            chatContainer.appendChild(messageDiv);
            chatContainer.scrollTop = chatContainer.scrollHeight;
            
            // Store in history
            chatHistory.push({ sender, content, time });
            
            // Extract insights if it's a user message
            if (sender === 'user') {
                extractAwarenessInsights(content);
            }
            
            autoSave();
        }

        async function getAwarenessCoachingResponse(userMessage) {
            // Build comprehensive context for awareness coaching
            const coachingContext = {
                testData: testData,
                testResults: testResults,
                awarenessInsights: awarenessInsights,
                chatHistory: chatHistory,
                week1Data: week1Data,
                userProfile: userProfile
            };
            
            // Try Andrea AI with awareness context
            if (andreaAICoach) {
                try {
                    const response = await andreaAICoach.sendMessage(userMessage, 2);
                    if (response.success) {
                        return response.response;
                    }
                } catch (error) {
                    console.error('‚ùå Andrea AI awareness coaching error:', error);
                }
            }
            
            // Fallback to sophisticated awareness coaching response
            return generateAwarenessCoachingResponse(userMessage, coachingContext);
        }

        function generateAwarenessCoachingResponse(userMessage, context) {
            const messageCount = context.chatHistory.filter(m => m.sender === 'user').length;
            
            // Different awareness coaching approaches based on conversation depth
            if (messageCount <= 2) {
                return generateAwarenessExplorationResponse(userMessage, context);
            } else if (messageCount <= 4) {
                return generateAwarenessDeepResponse(userMessage, context);
            } else {
                return generateAwarenessIntegrationResponse(userMessage, context);
            }
        }

        function generateAwarenessExplorationResponse(userMessage, context) {
            const responses = [
                `Le tue parole toccano qualcosa di molto profondo. Sento una grande autenticit√† in quello che condividi. Quando ti connetti con questa versione di te stesso, cosa senti nel corpo? C'√® una sensazione particolare?`,
                
                `Quello che mi descrivi √® bellissimo e molto potente. Riesco a sentire la tua essenza attraverso le parole. Mi chiedo: questa persona autentica che mi stai descrivendo, quanto spazio ha nella tua vita quotidiana?`,
                
                `Ti ringrazio per questa condivisione cos√¨ onesta. Mentre parli di chi sei veramente, noto che c'√® una coerenza con quello che √® emerso dai test. Dimmi, cosa impedisce a questa versione autentica di essere pi√π presente?`,
                
                `Le tue parole mi stanno mostrando una persona con una consapevolezza profonda. Quello che mi colpisce √®... se questa √® la vera te, come mai a volte senti di non essere abbastanza? Da dove arriva questa disconnessione?`
            ];
            
            // Personalize based on test results
            if (context.testResults.selfEsteem && context.testResults.selfEsteem < 3) {
                return `Quello che condividi √® incredibilmente autentico. Mentre ti ascolto, vedo una persona con una ricchezza interiore enorme. Eppure dai test emerge che a volte fai fatica a riconoscere il tuo valore. C'√® una contraddizione qui che mi incuriosisce: come pu√≤ una persona cos√¨ consapevole e profonda avere dubbi su se stessa?`;
            }
            
            if (context.testData.innerCritic) {
                return `Quello che condividi risuona profondamente con me. E mentre ti ascolto, penso a quello che hai scritto del tuo critico interno: "${context.testData.innerCritic}". Come fa quella voce autentica che mi stai descrivendo a convivere con questa voce critica? Chi delle due ha pi√π spazio nella tua testa?`;
            }
            
            return responses[Math.floor(Math.random() * responses.length)];
        }

        function generateAwarenessDeepResponse(userMessage, context) {
            const responses = [
                `Quello che stai condividendo √® oro puro in termini di consapevolezza. Mi viene in mente una cosa: spesso il nostro critico interno e la nostra autenticit√† sono in conflitto. Se dovessi dare un messaggio di incoraggiamento alla parte di te che fatica ad accettarsi, cosa le diresti?`,
                
                `Sento che stiamo toccando il cuore della tua consapevolezza. Mi chiedo: se quella voce critica dentro di te fosse in realt√† una parte che ti vuole proteggere da qualcosa, da cosa ti starebbe proteggendo? E di cosa hai bisogno per non aver pi√π bisogno di quella protezione?`,
                
                `Le tue risposte mi stanno mostrando una persona che sa guardare dentro di s√© con onest√†. Questo √® un regalo raro. Ora, facciamo un esperimento: se fossi gi√† completamente in pace con te stesso, come cambierebbe il tuo modo di muoverti nel mondo?`,
                
                `La tua consapevolezza mi colpisce. Quello che mi incuriosisce √® questo: con tutta questa comprensione di te stesso, cosa ti trattiene dal fidarti completamente di chi sei? Qual √® l'ultimo passo che non riesci a fare?`
            ];
            
            // Deep questions based on specific test data
            if (context.testData.hiddenTalents) {
                return `Mentre parliamo di consapevolezza, ripenso a quello che hai scritto sui tuoi talenti nascosti: "${context.testData.hiddenTalents}". √à interessante... se hai questa consapevolezza dei tuoi talenti, cosa ti impedisce di esprimerli pienamente? C'√® una paura nascosta dietro? O forse un giudizio su te stesso?`;
            }
            
            if (context.testData.emotionalPattern) {
                return `Stiamo andando molto in profondit√†, e mi viene in mente quello che hai condiviso sull'emozione che eviti: "${context.testData.emotionalPattern}". Spesso le emozioni che evitiamo di pi√π sono quelle che hanno pi√π da insegnarci su noi stessi. Se dovessi accogliere questa emozione invece di evitarla, cosa pensi che scopriresti?`;
            }
            
            return responses[Math.floor(Math.random() * responses.length)];
        }

        function generateAwarenessIntegrationResponse(userMessage, context) {
            const responses = [
                `Quello che stiamo esplorando insieme √® una mappa preziosa della tua consapevolezza. Ora voglio aiutarti a integrare tutto questo. Se dovessi scegliere UNA cosa di te stesso da onorare di pi√π ogni giorno, cosa sarebbe?`,
                
                `La nostra conversazione mi sta mostrando una persona che ha fatto un lavoro profondo di consapevolezza. Ora la domanda √®: come puoi portare questa chiarezza nella tua vita quotidiana? Quale piccolo rituale o pratica potrebbe aiutarti a rimanere connesso con questa autenticit√†?`,
                
                `Sento che abbiamo fatto emergere qualcosa di molto importante insieme. Questo livello di consapevolezza √® un superpotere. Come pensi di poterlo usare per creare il cambiamento che desideri nella tua vita?`,
                
                `Le nostre parole hanno creato una mappa bellissima di chi sei. Ora voglio spostarci verso l'integrazione: se dovessi scrivere una "carta d'identit√† autentica" di te stesso, quali sarebbero le tre qualit√† che non devi mai dimenticare?`
            ];
            
            // Integration based on top values
            if (context.testResults.topValues && context.testResults.topValues.length > 0) {
                const valueLabels = {
                    family: 'famiglia e relazioni',
                    career: 'successo professionale', 
                    health: 'salute e benessere',
                    growth: 'crescita personale',
                    freedom: 'libert√† e indipendenza'
                };
                const topValue = valueLabels[context.testResults.topValues[0][0]];
                return `Tutto quello che abbiamo esplorato insieme si sta integrando in una visione chiara di chi sei. Vedo che il tuo valore principale √® ${topValue}. Con tutto quello che abbiamo scoperto sulla tua autenticit√†, come potresti onorare questo valore in modo pi√π autentico? Qual √® il modo pi√π "te" di vivere questo valore?`;
            }
            
            return responses[Math.floor(Math.random() * responses.length)];
        }

        function extractAwarenessInsights(userMessage) {
            // Extract key insights for homework personalization
            const insights = [];
            
            if (userMessage.toLowerCase().includes('autentic') || userMessage.toLowerCase().includes('vero me')) {
                insights.push('Forte connessione con autenticit√†');
            }
            
            if (userMessage.toLowerCase().includes('paura') || userMessage.toLowerCase().includes('timore')) {
                insights.push('Lavoro su paure e limitazioni consce');
            }
            
            if (userMessage.toLowerCase().includes('critico') || userMessage.toLowerCase().includes('giudizio')) {
                insights.push('Consapevolezza del critico interno');
            }
            
            if (userMessage.toLowerCase().includes('talento') || userMessage.toLowerCase().includes('capacit√†')) {
                insights.push('Riconoscimento talenti e potenziale');
            }
            
            if (userMessage.toLowerCase().includes('valore') || userMessage.toLowerCase().includes('importante')) {
                insights.push('Chiarezza sui valori personali');
            }
            
            awarenessInsights.push(...insights);
        }

        function show30MinuteWarning() {
            document.getElementById('timeWarning').classList.add('active');
        }

        function continueSession() {
            sessionExtended = true;
            document.getElementById('timeWarning').classList.remove('active');
            showMessage('‚úÖ Sessione estesa di 15 minuti. Continuiamo il viaggio di consapevolezza!', 'success');
        }

        function endSession() {
            clearInterval(timerInterval);
            clearInterval(autoSaveInterval);
            completeSession();
        }

        function completeSession() {
            // Save final session data
            const finalSessionData = {
                testData: testData,
                testResults: testResults,
                chatHistory: chatHistory,
                awarenessInsights: awarenessInsights,
                completedAt: new Date().toISOString(),
                sessionDuration: Date.now() - sessionStartTime,
                userProfile: userProfile,
                week1Data: week1Data
            };
            
            localStorage.setItem('week2SessionCompleted', JSON.stringify(finalSessionData));
            localStorage.removeItem('week2SessionInProgress');
            
            // Update progress
            updateUserProgress();
            
            // Show completion
            document.getElementById('phase2Section').classList.remove('active');
            document.getElementById('completionSection').classList.add('active');
            
            // Generate results and homework
            generateAwarenessResults();
            generateAwarenessHomework();
            
            document.getElementById('completionSection').scrollIntoView({ behavior: 'smooth' });
        }

        function generateAwarenessResults() {
            const resultsGrid = document.getElementById('resultsGrid');
            
            // Self-esteem result
            const esteemFeedback = testResults.selfEsteem >= 4 ? 'Eccellente!' : 
                                 testResults.selfEsteem >= 3 ? 'Buona base' : 'Area di crescita';
            
            // Values result  
            const valueLabels = {
                family: 'Famiglia',
                career: 'Carriera', 
                health: 'Salute',
                growth: 'Crescita',
                freedom: 'Libert√†'
            };
            
            const topValue = testResults.topValues && testResults.topValues.length > 0 ? 
                           valueLabels[testResults.topValues[0][0]] : 'Da esplorare';
            
            // Awareness level (based on insights and chat depth)
            const awarenessLevel = awarenessInsights.length + Math.floor(chatHistory.length / 2);
            const awarenessScore = Math.min(awarenessLevel, 5);
            
            resultsGrid.innerHTML = `
                <div class="result-item">
                    <div class="result-score">${testResults.selfEsteem}/5</div>
                    <div class="result-label">Autostima</div>
                    <div class="result-feedback">${esteemFeedback}</div>
                </div>
                <div class="result-item">
                    <div class="result-score">${topValue}</div>
                    <div class="result-label">Valore Principale</div>
                    <div class="result-feedback">La tua guida</div>
                </div>
                <div class="result-item">
                    <div class="result-score">${awarenessScore}/5</div>
                    <div class="result-label">Livello Consapevolezza</div>
                    <div class="result-feedback">Ben sviluppata</div>
                </div>
                <div class="result-item">
                    <div class="result-score">${awarenessInsights.length}</div>
                    <div class="result-label">Insights Scoperti</div>
                    <div class="result-feedback">Tesoro prezioso</div>
                </div>
            `;
        }

        function generateAwarenessHomework() {
            const homeworkList = document.getElementById('personalizedHomework');
            let homework = [];
            
            // Base awareness homework
            homework.push("‚úÖ Dedica 15 minuti al giorno alla riflessione sulla tua autenticit√†");
            homework.push("‚úÖ Tieni un diario di consapevolezza: 3 momenti autentici al giorno");
            
            // Personalized based on test results
            if (testResults.selfEsteem && testResults.selfEsteem < 3) {
                homework.push("‚úÖ Pratica l'auto-compassione: parla a te stesso come faresti con un caro amico");
            }
            
            if (testData.innerCritic) {
                homework.push(`‚úÖ Trasforma il critico interno: quando senti "${testData.innerCritic}", chiedi "Cosa puoi imparare?"`);
            }
            
            if (testData.hiddenTalents) {
                homework.push(`‚úÖ Esprimi il talento nascosto: "${testData.hiddenTalents}" - dedicagli 20 min a settimana`);
            }
            
            if (testData.authenticSelf) {
                homework.push(`‚úÖ Ricrea le condizioni di autenticit√†: "${testData.authenticSelf}" - programma questi momenti`);
            }
            
            // Based on top values
            if (testResults.topValues && testResults.topValues.length > 0) {
                const valueLabels = {
                    family: 'alle relazioni familiari',
                    career: 'al successo professionale',
                    health: 'alla salute e benessere', 
                    growth: 'alla crescita personale',
                    freedom: 'alla libert√† e indipendenza'
                };
                const topValue = valueLabels[testResults.topValues[0][0]];
                homework.push(`‚úÖ Onora il tuo valore principale: dedica tempo ${topValue} ogni giorno`);
            }
            
            // Based on coaching insights
            if (awarenessInsights.includes('Forte connessione con autenticit√†')) {
                homework.push("‚úÖ Crea un 'mantra di autenticit√†' personale da ripetere nei momenti difficili");
            }
            
            if (awarenessInsights.includes('Consapevolezza del critico interno')) {
                homework.push("‚úÖ Dialoga con il critico interno: chiedi cosa vuole proteggerti e ringrazialo");
            }
            
            // Always add
            homework.push("‚úÖ Condividi la tua autenticit√†: esprimi un aspetto vero di te con qualcuno ogni giorno");
            homework.push("‚úÖ Celebra le scoperte: annota ogni sera una cosa di te che apprezzi");
            
            // Update homework list
            homeworkList.innerHTML = homework.map(item => `<li>${item}</li>`).join('');
        }

        function updateUserProgress() {
            try {
                const progress = JSON.parse(localStorage.getItem('lifestyleProgress') || '{}');
                progress.completedWeeks = progress.completedWeeks || [];
                
                if (!progress.completedWeeks.includes(2)) {
                    progress.completedWeeks.push(2);
                    progress.currentWeek = 3;
                    progress.lastUpdate = new Date().toISOString();
                    
                    localStorage.setItem('lifestyleProgress', JSON.stringify(progress));
                }
            } catch (error) {
                console.error('‚ùå Error updating progress:', error);
            }
        }

        function downloadAwarenessReport() {
            const reportContent = `
                RAPPORTO DI CONSAPEVOLEZZA - SETTIMANA 2
                
                Andrea Padoan - Lifestyle Coach
                
                Caro/a ${userProfile?.name || 'Amico/a'},
                
                Che viaggio straordinario di consapevolezza abbiamo fatto insieme!
                I risultati dei test e il nostro coaching approfondito hanno rivelato
                aspetti preziosi della tua autenticit√† e del tuo potenziale.
                
                === I TUOI RISULTATI ===
                
                AUTOSTIMA: ${testResults.selfEsteem}/5
                ${testResults.selfEsteem >= 4 ? 'Eccellente! Hai una base solida di autostima.' : 
                  testResults.selfEsteem >= 3 ? 'Buona base. Ci sono margini di crescita interessanti.' :
                  'Area di crescita importante. Lavoreremo insieme per rafforzarla.'}
                
                VALORE PRINCIPALE: ${testResults.topValues && testResults.topValues.length > 0 ? 
                    (() => {
                        const valueLabels = {
                            family: 'Famiglia e Relazioni',
                            career: 'Successo Professionale',
                            health: 'Salute e Benessere',
                            growth: 'Crescita Personale',
                            freedom: 'Libert√† e Indipendenza'
                        };
                        return valueLabels[testResults.topValues[0][0]];
                    })() : 'Da esplorare ulteriormente'}
                
                LIVELLO CONSAPEVOLEZZA: ${Math.min(awarenessInsights.length + Math.floor(chatHistory.length / 2), 5)}/5
                
                === LE TUE SCOPERTE ===
                
                QUANDO TI SENTI PI√ô AUTENTICO:
                "${testData.authenticSelf || 'Da esplorare nel coaching'}"
                
                IL TUO CRITICO INTERNO DICE:
                "${testData.innerCritic || 'Pattern ancora da identificare'}"
                
                TALENTI NASCOSTI DA VALORIZZARE:
                "${testData.hiddenTalents || 'Da scoprire insieme'}"
                
                EMOZIONE CHE EVITI DI PI√ô:
                "${testData.emotionalPattern || 'Da esplorare ulteriormente'}"
                
                === INSIGHTS EMERSI DAL COACHING ===
                ${awarenessInsights.length > 0 ? awarenessInsights.map(insight => `‚Ä¢ ${insight}`).join('\n                ') : '‚Ä¢ Continua il percorso per sviluppare maggiore consapevolezza'}
                
                === IL TUO PIANO DI CRESCITA ===
                
                1. PRATICA QUOTIDIANA DI AUTENTICIT√Ä
                   - 15 minuti di riflessione al giorno
                   - Identifica 3 momenti autentici ogni giorno
                   - Annota nel diario di consapevolezza
                
                2. TRASFORMAZIONE DEL CRITICO INTERNO
                   ${testData.innerCritic ? 
                   `- Quando senti: "${testData.innerCritic}"
                   - Trasforma in: "Cosa posso imparare da questo?"
                   - Pratica l'auto-compassione` : 
                   '- Osserva i pattern critici quando emergono\n                   - Sviluppa dialogo interiore pi√π gentile'}
                
                3. ESPRESSIONE DEI TALENTI
                   ${testData.hiddenTalents ?
                   `- Dedica 20 minuti a settimana a: "${testData.hiddenTalents}"
                   - Trova modi creativi per esprimere questo talento
                   - Condividi con altri le tue capacit√†` :
                   '- Esplora talenti nascosti attraverso nuove attivit√†\n                   - Presta attenzione a cosa ti riesce naturalmente'}
                
                4. ONORARE I TUOI VALORI
                   ${testResults.topValues && testResults.topValues.length > 0 ?
                   (() => {
                       const valueLabels = {
                           family: 'famiglia e relazioni',
                           career: 'successo professionale',
                           health: 'salute e benessere',
                           growth: 'crescita personale',
                           freedom: 'libert√† e indipendenza'
                       };
                       const topValue = valueLabels[testResults.topValues[0][0]];
                       return `- Dedica tempo ogni giorno a ${topValue}
                   - Prendi decisioni allineate con questo valore
                   - Rifletti su come onorarlo meglio`;
                   })() : '- Continua a esplorare i tuoi valori pi√π profondi\n                   - Osserva cosa ti d√† davvero energia'}
                
                5. INTEGRAZIONE NELLA VITA QUOTIDIANA
                   - Crea un "mantra di autenticit√†" personale
                   - Condividi un aspetto autentico di te ogni giorno
                   - Celebra le tue scoperte e progressi
                
                === MESSAGGI CHIAVE PER TE ===
                
                ${userProfile?.name || 'Amico/a'}, quello che √® emerso in questa settimana √®
                una mappa preziosa della tua essenza autentica. La consapevolezza che hai
                sviluppato √® un superpotere che ti guider√† verso la migliore versione di te stesso.
                
                Ricorda: l'autenticit√† non √® una destinazione, ma un modo di viaggiare.
                Ogni giorno puoi scegliere di essere pi√π vero con te stesso.
                
                === CONNESSIONE CON SETTIMANA 1 ===
                
                ${week1Data && week1Data.phase1Data ? 
                `Nella settimana 1 avevi identificato come obiettivo: "${week1Data.phase1Data.dreamGoal || 'la tua trasformazione'}"
                Ora con la consapevolezza sviluppata, puoi perseguire questo obiettivo 
                in modo pi√π autentico e allineato con chi sei veramente.` :
                'Questa consapevolezza si integra perfettamente con il percorso iniziato nella settimana 1.'}
                
                === PREPARAZIONE SETTIMANA 3 ===
                
                Nella prossima settimana "Obiettivi SMART" useremo tutta questa consapevolezza
                per definire obiettivi che siano non solo raggiungibili, ma anche autenticamente tuoi.
                
                La consapevolezza che hai sviluppato sar√† la bussola per obiettivi che rispecchiano
                davvero chi sei e cosa vuoi diventare.
                
                Il tuo coach di consapevolezza,
                Andrea üåü
                
                P.S. Porta con te le insights di questa settimana. Sono il tuo tesoro
                pi√π prezioso per il resto del percorso!
            `;
            
            const blob = new Blob([reportContent], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `Rapporto_Consapevolezza_Settimana_2_${userProfile?.name || 'Utente'}.txt`;
            a.click();
            URL.revokeObjectURL(url);
            
            showMessage('üìÑ Rapporto di consapevolezza scaricato!', 'success');
        }

        function scheduleNextSession() {
            const nextWeekDate = new Date();
            nextWeekDate.setDate(nextWeekDate.getDate() + 7);
            
            const message = `üìÖ Settimana 3 "Obiettivi SMART" disponibile il ${nextWeekDate.toLocaleDateString('it-IT')}!`;
            showMessage(message, 'info');
            
            localStorage.setItem('nextSessionReminder', nextWeekDate.toISOString());
        }

        function showMessage(message, type = 'info') {
            const colors = {
                success: '#16a34a',
                warning: '#f59e0b',
                info: '#3b82f6',
                error: '#ef4444'
            };
            
            const notification = document.createElement('div');
            notification.innerHTML = `
                <div style="position: fixed; top: 20px; right: 20px; background: ${colors[type]}; color: white; padding: 1rem 2rem; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.2); z-index: 1000; max-width: 400px; animation: slideIn 0.3s ease-out;">
                    ${message}
                </div>
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 5000);
        }

        // Handle Enter key in chat
        document.getElementById('chatInput')?.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                sendChatMessage();
            }
        });

        // Handle page unload
        window.addEventListener('beforeunload', function() {
            if (currentPhase !== 'completed') {
                autoSave();
            }
        });

        // Add slide-in animation style
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideIn {
                from {
                    transform: translateX(100%);
                    opacity: 0;
                }
                to {
                    transform: translateX(0);
                    opacity: 1;
                }
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>